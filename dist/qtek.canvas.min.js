(function(t){"undefined"!=typeof define&&define.amd?define(["exports"],t.bind(window)):t(window.qtek={})})(function(t){var r,n,e;(function(t){function i(t,r){return b.call(t,r)}function a(t,r){var n,e,i,a,o,u,s,c,f,l,h=r&&r.split("/"),d=y.map,v=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(r){for(h=h.slice(0,h.length-1),t=h.concat(t.split("/")),c=0;t.length>c;c+=1)if(l=t[c],"."===l)t.splice(c,1),c-=1;else if(".."===l){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((h||v)&&d){for(n=t.split("/"),c=n.length;c>0;c-=1){if(e=n.slice(0,c).join("/"),h)for(f=h.length;f>0;f-=1)if(i=d[h.slice(0,f).join("/")],i&&(i=i[e])){a=i,o=c;break}if(a)break;!u&&v&&v[e]&&(u=v[e],s=c)}!a&&u&&(a=u,o=s),a&&(n.splice(0,o,a),t=n.join("/"))}return t}function o(r,n){return function(){return d.apply(t,x.call(arguments,0).concat([r,n]))}}function u(t){return function(r){return a(r,t)}}function s(t){return function(r){m[t]=r}}function c(r){if(i(g,r)){var n=g[r];delete g[r],_[r]=!0,h.apply(t,n)}if(!i(m,r)&&!i(_,r))throw Error("No "+r);return m[r]}function f(t){var r,n=t?t.indexOf("!"):-1;return n>-1&&(r=t.substring(0,n),t=t.substring(n+1,t.length)),[r,t]}function l(t){return function(){return y&&y.config&&y.config[t]||{}}}var h,d,v,p,m={},g={},y={},_={},b=Object.prototype.hasOwnProperty,x=[].slice;v=function(t,r){var n,e=f(t),i=e[0];return t=e[1],i&&(i=a(i,r),n=c(i)),i?t=n&&n.normalize?n.normalize(t,u(r)):a(t,r):(t=a(t,r),e=f(t),i=e[0],t=e[1],i&&(n=c(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:n}},p={require:function(t){return o(t)},exports:function(t){var r=m[t];return r!==void 0?r:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:l(t)}}},h=function(r,n,e,a){var u,f,l,h,d,y,b=[];if(a=a||r,"function"==typeof e){for(n=!n.length&&e.length?["require","exports","module"]:n,d=0;n.length>d;d+=1)if(h=v(n[d],a),f=h.f,"require"===f)b[d]=p.require(r);else if("exports"===f)b[d]=p.exports(r),y=!0;else if("module"===f)u=b[d]=p.module(r);else if(i(m,f)||i(g,f)||i(_,f))b[d]=c(f);else{if(!h.p)throw Error(r+" missing "+f);h.p.load(h.n,o(a,!0),s(f),{}),b[d]=m[f]}l=e.apply(m[r],b),r&&(u&&u.exports!==t&&u.exports!==m[r]?m[r]=u.exports:l===t&&y||(m[r]=l))}else r&&(m[r]=e)},r=n=d=function(r,n,e,i,a){return"string"==typeof r?p[r]?p[r](n):c(v(r,n).f):(r.splice||(y=r,n.splice?(r=n,n=e,e=null):r=t),n=n||function(){},"function"==typeof e&&(e=i,i=a),i?h(t,r,n,e):setTimeout(function(){h(t,r,n,e)},4),d)},d.config=function(t){return y=t,y.deps&&d(y.deps,y.callback),d},e=function(t,r,n){r.splice||(n=r,r=[]),i(m,t)||i(g,t)||(g[t]=[t,r,n])},e.amd={jQuery:!0}})(),e("../build/almond",function(){}),e("2d/camera",function(){}),e("core/mixin/derive",[],function(){function t(t,r,n){"object"==typeof r&&(n=r,r=null);var e={"instanceof":function(t){for(var r=a;r;){if(r===t)return!0;r=r.__super__}}},i=this,a=function(n){if(i.call(this),_.extend(this,"function"==typeof t?t.call(this):t),_.extend(this,n),this.constructor==a){for(var e=a,o=[r];e.__super__;)e=e.__super__,o.unshift(e.__initialize__);for(var u=0;o.length>u;u++)o[u]&&o[u].call(this)}};return a.__super__=i,a.__initialize__=r,_.extend(a.prototype,i.prototype,e,n),a.prototype.constructor=a,a.derive=i.derive,a}return{derive:t}}),e("core/mixin/notifier",[],function(){return{trigger:function(){if(this.__handlers__){var t=arguments[0],r=Array.prototype.slice.call(arguments,1),n=this.__handlers__[t];if(n)for(var e=0;n.length>e;e+=2){var i=n[e],a=n[e+1];i.apply(a||this,r)}}},on:function(t,r,n){if(t){var e=this.__handlers__||(this.__handlers__={});return e[t]||(e[t]=[]),-1==e[t].indexOf(r)&&(e[t].push(r),e[t].push(n)),r}},off:function(t,r){var n=this.__handlers__||(this.__handlers__={});if(n[t])if(r){var e=n[t],i=e.indexOf(r);i>=0&&e.splice(i,2)}else n[t]=[]},has:function(t,r){return this.__handlers__&&this.__handlers__[t]?r?-1!==this.__handlers__[t].indexOf(r):this.__handlers__[t].length:!1}}}),e("core/mixin/dirty",{dirty:function(t){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]=!0},fresh:function(t){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]=!1},isDirty:function(t){return this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]===void 0?!0:this._dirtyFlag[t]}}),e("core/cache",[],function(){var t=function(){this._contextId="",this._caches={},this._context={}};return t.prototype={use:function(t,r){if(!this._caches.hasOwnProperty(t)&&(this._caches[t]={},r))for(var n in r)this._caches[t][n]=r[n];this._contextId=t,this._context=this._caches[t]},put:function(t,r){this._context[t]=r},get:function(t){return this._context[t]},clearContext:function(){this._caches[this._contextId]={},this._context={}},"delete":function(t){delete this._context[t]},clearAll:function(){this._caches={}},getContext:function(){return this._context},miss:function(t){return!this._context.hasOwnProperty(t)}},t.prototype.constructor=t,t}),function(t){function r(e){function u(t){if(!t||en.call(t)!=C)return o;var r=t.valueOf,n="function"==typeof r&&(n=Kr(r))&&Kr(n);return n?t==n||Kr(t)==n:Z(t)}function c(t,r,n){if(!t||!S[typeof t])return t;r=r&&n===void 0?r:N.createCallback(r,n);for(var e=-1,i=S[typeof t]?yn(t):[],a=i.length;a>++e&&(n=i[e],!(r(t[n],n,t)===o)););return t}function L(t,r,n){var e;if(!t||!S[typeof t])return t;r=r&&n===void 0?r:N.createCallback(r,n);for(e in t)if(r(t[e],e,t)===o)break;return t}function R(t,r,n){var e,i=t,a=i;if(!i)return a;for(var o=arguments,u=0,s="number"==typeof n?2:o.length;s>++u;)if((i=o[u])&&S[typeof i]){var c=i.length;if(e=-1,gn(i))for(;c>++e;)a[e]===void 0&&(a[e]=i[e]);else for(var f=-1,l=S[typeof i]?yn(i):[],c=l.length;c>++f;)e=l[f],a[e]===void 0&&(a[e]=i[e])}return a}function F(t,r,n){var e,i=t,a=i;if(!i)return a;var o=arguments,u=0,s="number"==typeof n?2:o.length;if(s>3&&"function"==typeof o[s-2])var c=N.createCallback(o[--s-1],o[s--],2);else s>2&&"function"==typeof o[s-1]&&(c=o[--s]);for(;s>++u;)if((i=o[u])&&S[typeof i]){var f=i.length;if(e=-1,gn(i))for(;f>++e;)a[e]=c?c(a[e],i[e]):i[e];else for(var l=-1,h=S[typeof i]?yn(i):[],f=h.length;f>++l;)e=h[l],a[e]=c?c(a[e],i[e]):i[e]}return a}function W(t){var r,n=[];if(!t||!S[typeof t])return n;for(r in t)Jr.call(t,r)&&n.push(r);return n}function N(t){return t&&"object"==typeof t&&!gn(t)&&Jr.call(t,"__wrapped__")?t:new G(t)}function H(t){var r=t.length,n=r>=d;if(n)for(var e={},i=-1;r>++i;){var a=h+t[i];(e[a]||(e[a]=[])).push(t[i])}return function(r){if(n){var i=h+r;return e[i]&&Mr(e[i],r)>-1}return Mr(t,r)>-1}}function V(t){return t.charCodeAt(0)}function $(t,r){var n=t.b,e=r.b;if(t=t.a,r=r.a,t!==r){if(t>r||t===void 0)return 1;if(r>t||r===void 0)return-1}return e>n?-1:1}function U(t,r,n,e){function i(){var e=arguments,f=u?this:r;return o||(t=r[s]),n.length&&(e=e.length?(e=vn.call(e),c?e.concat(n):n.concat(e)):n),this instanceof i?(Y.prototype=t.prototype,f=new Y,Y.prototype=a,e=t.apply(f,e),ar(e)?e:f):t.apply(f,e)}var o=ir(t),u=!n,s=r;if(u){var c=e;n=r}else if(!o){if(!e)throw new Hr;r=t}return i}function Q(t){return"\\"+D[t]}function X(t){return _n[t]}function G(t){this.__wrapped__=t}function Y(){}function Z(t){var r=o;if(!t||en.call(t)!=C)return r;var n=t.constructor;return(ir(n)?n instanceof n:1)?(L(t,function(t,n){r=n}),r===o||Jr.call(t,r)):r}function K(t,r,n){r||(r=0),n===void 0&&(n=t?t.length:0);var e=-1;n=n-r||0;for(var i=Or(0>n?0:n);n>++e;)i[e]=t[r+e];return i}function J(t){return bn[t]}function tr(t,r,e,i,a,u){var s=t;if("function"==typeof r&&(i=e,e=r,r=o),"function"==typeof e){if(e=i===void 0?e:N.createCallback(e,i,1),s=e(s),s!==void 0)return s;s=t}if(i=ar(s)){var f=en.call(s);if(!O[f])return s;var l=gn(s)}if(!i||!r)return i?l?K(s):F({},s):s;switch(i=pn[f],f){case z:case j:return new i(+s);case T:case I:return new i(s);case P:return i(s.source,_.exec(s))}for(a||(a=[]),u||(u=[]),f=a.length;f--;)if(a[f]==t)return u[f];return s=l?i(s.length):{},l&&(Jr.call(t,"index")&&(s.index=t.index),Jr.call(t,"input")&&(s.input=t.input)),a.push(t),u.push(s),(l?vr:c)(t,function(t,i){s[i]=tr(t,r,e,n,a,u)}),s}function rr(t){var r=[];return L(t,function(t,n){ir(t)&&r.push(n)}),r.sort()}function nr(t){for(var r=-1,n=yn(t),e=n.length,i={};e>++r;){var a=n[r];i[t[a]]=a}return i}function er(t,r,n,e,u,s){var c=n===l;if("function"==typeof n&&!c){n=N.createCallback(n,e,2);var f=n(t,r);if(f!==void 0)return!!f}if(t===r)return 0!==t||1/t==1/r;var h=typeof t,d=typeof r;if(t===t&&(!t||"function"!=h&&"object"!=h)&&(!r||"function"!=d&&"object"!=d))return o;if(t==a||r==a)return t===r;if(d=en.call(t),h=en.call(r),d==k&&(d=C),h==k&&(h=C),d!=h)return o;switch(d){case z:case j:return+t==+r;case T:return t!=+t?r!=+r:0==t?1/t==1/r:t==+r;case P:case I:return t==Nr(r)}if(h=d==q,!h){if(Jr.call(t,"__wrapped__")||Jr.call(r,"__wrapped__"))return er(t.__wrapped__||t,r.__wrapped__||r,n,e,u,s);if(d!=C)return o;var d=t.constructor,v=r.constructor;if(!(d==v||ir(d)&&d instanceof d&&ir(v)&&v instanceof v))return o}for(u||(u=[]),s||(s=[]),d=u.length;d--;)if(u[d]==t)return s[d]==r;var p=0,f=i;if(u.push(t),s.push(r),h){if(d=t.length,p=r.length,f=p==t.length,!f&&!c)return f;for(;p--;)if(h=d,v=r[p],c)for(;h--&&!(f=er(t[h],v,n,e,u,s)););else if(!(f=er(t[p],v,n,e,u,s)))break;return f}return L(r,function(r,i,a){return Jr.call(a,i)?(p++,f=Jr.call(t,i)&&er(t[i],r,n,e,u,s)):void 0}),f&&!c&&L(t,function(t,r,n){return Jr.call(n,r)?f=--p>-1:void 0}),f}function ir(t){return"function"==typeof t}function ar(t){return t?S[typeof t]:o}function or(t){return"number"==typeof t||en.call(t)==T}function ur(t){return"string"==typeof t||en.call(t)==I}function sr(t,r,n){var e=arguments,i=0,a=2;if(!ar(t))return t;if(n===l)var o=e[3],s=e[4],f=e[5];else s=[],f=[],"number"!=typeof n&&(a=e.length),a>3&&"function"==typeof e[a-2]?o=N.createCallback(e[--a-1],e[a--],2):a>2&&"function"==typeof e[a-1]&&(o=e[--a]);for(;a>++i;)(gn(e[i])?vr:c)(e[i],function(r,n){var e,i,a=r,c=t[n];if(r&&((i=gn(r))||u(r))){for(a=s.length;a--;)if(e=s[a]==r){c=f[a];break}if(!e){var h;o&&(a=o(c,r),h=a!==void 0)&&(c=a),h||(c=i?gn(c)?c:[]:u(c)?c:{}),s.push(r),f.push(c),h||(c=sr(c,r,l,o,s,f))}}else o&&(a=o(c,r),a===void 0&&(a=r)),a!==void 0&&(c=a);t[n]=c});return t}function cr(t){for(var r=-1,n=yn(t),e=n.length,i=Or(e);e>++r;)i[r]=t[n[r]];return i}function fr(t,r,n){var e=-1,i=t?t.length:0,a=o;return n=(0>n?fn(0,i+n):n)||0,"number"==typeof i?a=(ur(t)?t.indexOf(r,n):Mr(t,r,n))>-1:c(t,function(t){return n>++e?void 0:!(a=t===r)}),a}function lr(t,r,n){var e=i;r=N.createCallback(r,n),n=-1;var a=t?t.length:0;if("number"==typeof a)for(;a>++n&&(e=!!r(t[n],n,t)););else c(t,function(t,n,i){return e=!!r(t,n,i)});return e}function hr(t,r,n){var e=[];r=N.createCallback(r,n),n=-1;var i=t?t.length:0;if("number"==typeof i)for(;i>++n;){var a=t[n];r(a,n,t)&&e.push(a)}else c(t,function(t,n,i){r(t,n,i)&&e.push(t)});return e}function dr(t,r,n){r=N.createCallback(r,n),n=-1;var e=t?t.length:0;if("number"!=typeof e){var i;return c(t,function(t,n,e){return r(t,n,e)?(i=t,o):void 0}),i}for(;e>++n;){var a=t[n];if(r(a,n,t))return a}}function vr(t,r,n){var e=-1,i=t?t.length:0;if(r=r&&n===void 0?r:N.createCallback(r,n),"number"==typeof i)for(;i>++e&&r(t[e],e,t)!==o;);else c(t,r);return t}function pr(t,r,n){var e=-1,i=t?t.length:0;if(r=N.createCallback(r,n),"number"==typeof i)for(var a=Or(i);i>++e;)a[e]=r(t[e],e,t);else a=[],c(t,function(t,n,i){a[++e]=r(t,n,i)});return a}function mr(t,r,n){var e=-1/0,i=e;if(!r&&gn(t)){n=-1;for(var a=t.length;a>++n;){var o=t[n];o>i&&(i=o)}}else r=!r&&ur(t)?V:N.createCallback(r,n),vr(t,function(t,n,a){n=r(t,n,a),n>e&&(e=n,i=t)});return i}function gr(t,r){var n=-1,e=t?t.length:0;if("number"==typeof e)for(var i=Or(e);e>++n;)i[n]=t[n][r];return i||pr(t,r)}function yr(t,r,n,e){if(!t)return n;var i=3>arguments.length;r=N.createCallback(r,e,4);var a=-1,u=t.length;if("number"==typeof u)for(i&&(n=t[++a]);u>++a;)n=r(n,t[a],a,t);else c(t,function(t,e,a){n=i?(i=o,t):r(n,t,e,a)});return n}function _r(t,r,n,e){var i=t?t.length:0,a=3>arguments.length;if("number"!=typeof i)var u=yn(t),i=u.length;return r=N.createCallback(r,e,4),vr(t,function(e,s,c){s=u?u[--i]:--i,n=a?(a=o,t[s]):r(n,t[s],s,c)}),n}function br(t,r,n){var e;r=N.createCallback(r,n),n=-1;var i=t?t.length:0;if("number"==typeof i)for(;i>++n&&!(e=r(t[n],n,t)););else c(t,function(t,n,i){return!(e=r(t,n,i))});return!!e}function xr(t){for(var r=-1,n=t?t.length:0,e=Yr.apply(Vr,vn.call(arguments,1)),e=H(e),i=[];n>++r;){var a=t[r];e(a)||i.push(a)}return i}function Ar(t,r,n){if(t){var e=0,i=t.length;if("number"!=typeof r&&r!=a){var o=-1;for(r=N.createCallback(r,n);i>++o&&r(t[o],o,t);)e++}else if(e=r,e==a||n)return t[0];return K(t,0,ln(fn(0,e),i))}}function wr(t,r,n,e){var i=-1,u=t?t.length:0,s=[];for("boolean"!=typeof r&&r!=a&&(e=n,n=r,r=o),n!=a&&(n=N.createCallback(n,e));u>++i;)e=t[i],n&&(e=n(e,i,t)),gn(e)?tn.apply(s,r?e:wr(e)):s.push(e);return s}function Mr(t,r,n){var e=-1,i=t?t.length:0;if("number"==typeof n)e=(0>n?fn(0,i+n):n||0)-1;else if(n)return e=kr(t,r),t[e]===r?e:-1;for(;i>++e;)if(t[e]===r)return e;return-1}function Br(t,r,n){if("number"!=typeof r&&r!=a){var e=0,i=-1,o=t?t.length:0;for(r=N.createCallback(r,n);o>++i&&r(t[i],i,t);)e++}else e=r==a||n?1:fn(0,r);return K(t,e)}function kr(t,r,n,e){var i=0,a=t?t.length:i;for(n=n?N.createCallback(n,e,1):Cr,r=n(r);a>i;)e=i+a>>>1,r>n(t[e])?i=e+1:a=e;return i}function qr(t,r,n,e){var i=-1,u=t?t.length:0,s=[],c=s;"boolean"!=typeof r&&r!=a&&(e=n,n=r,r=o);var f=!r&&u>=d;if(f)var l={};for(n!=a&&(c=[],n=N.createCallback(n,e));u>++i;){e=t[i];var v=n?n(e,i,t):e;if(f)var p=h+v,p=l[p]?!(c=l[p]):c=l[p]=[];(r?!i||c[c.length-1]!==v:p||0>Mr(c,v))&&((n||f)&&c.push(v),s.push(e))}return s}function zr(t,r){for(var n=-1,e=t?t.length:0,i={};e>++n;){var a=t[n];r?i[a]=r[n]:i[a[0]]=a[1]}return i}function jr(t,r){return mn.fastBind||an&&arguments.length>2?an.call.apply(an,arguments):U(t,r,vn.call(arguments,2))}function Tr(t){var r=vn.call(arguments,1);return nn(function(){t.apply(n,r)},1)}function Cr(t){return t}function Pr(t){vr(rr(t),function(r){var n=N[r]=t[r];N.prototype[r]=function(){var t=this.__wrapped__,r=[t];return tn.apply(r,arguments),r=n.apply(N,r),t&&"object"==typeof t&&t==r?this:new G(r)}})}function Ir(){return this.__wrapped__}e=e?E.defaults(t.Object(),e,E.pick(t,B)):t;var Or=e.Array,Sr=e.Boolean,Dr=e.Date,Er=e.Function,Lr=e.Math,Rr=e.Number,Fr=e.Object,Wr=e.RegExp,Nr=e.String,Hr=e.TypeError,Vr=Or(),$r=Fr(),Ur=e._,Qr=Wr("^"+Nr($r.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),Xr=Lr.ceil,Gr=e.clearTimeout,Yr=Vr.concat,Zr=Lr.floor,Kr=Qr.test(Kr=Fr.getPrototypeOf)&&Kr,Jr=$r.hasOwnProperty,tn=Vr.push,rn=e.setImmediate,nn=e.setTimeout,en=$r.toString,an=Qr.test(an=en.bind)&&an,on=Qr.test(on=Or.isArray)&&on,un=e.isFinite,sn=e.isNaN,cn=Qr.test(cn=Fr.keys)&&cn,fn=Lr.max,ln=Lr.min,hn=e.parseInt,dn=Lr.random,vn=Vr.slice,Lr=Qr.test(e.attachEvent),Lr=an&&!/\n|true/.test(an+Lr),pn={};pn[q]=Or,pn[z]=Sr,pn[j]=Dr,pn[C]=Fr,pn[T]=Rr,pn[P]=Wr,pn[I]=Nr;var mn=N.support={};mn.fastBind=an&&!Lr,N.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:b,variable:"",imports:{_:N}},G.prototype=N.prototype;var gn=on||function(t){return t?"object"==typeof t&&en.call(t)==q:o},yn=cn?function(t){return ar(t)?cn(t):[]}:W,_n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bn=nr(_n);return Lr&&s&&"function"==typeof rn&&(Tr=jr(rn,e)),Sr=8==hn("08")?hn:function(t,r){return hn(ur(t)?t.replace(x,""):t,r||0)},N.after=function(t,r){return 1>t?r():function(){return 1>--t?r.apply(this,arguments):void 0}},N.assign=F,N.at=function(t){for(var r=-1,n=Yr.apply(Vr,vn.call(arguments,1)),e=n.length,i=Or(e);e>++r;)i[r]=t[n[r]];return i},N.bind=jr,N.bindAll=function(t){for(var r=arguments.length>1?Yr.apply(Vr,vn.call(arguments,1)):rr(t),n=-1,e=r.length;e>++n;){var i=r[n];t[i]=jr(t[i],t)}return t},N.bindKey=function(t,r){return U(t,r,vn.call(arguments,2),l)},N.compact=function(t){for(var r=-1,n=t?t.length:0,e=[];n>++r;){var i=t[r];i&&e.push(i)}return e},N.compose=function(){var t=arguments;return function(){for(var r=arguments,n=t.length;n--;)r=[t[n].apply(this,r)];return r[0]}},N.countBy=function(t,r,n){var e={};return r=N.createCallback(r,n),vr(t,function(t,n,i){n=Nr(r(t,n,i)),Jr.call(e,n)?e[n]++:e[n]=1}),e},N.createCallback=function(t,r,n){if(t==a)return Cr;var e=typeof t;if("function"!=e){if("object"!=e)return function(r){return r[t]};var i=yn(t);return function(r){for(var n=i.length,e=o;n--&&(e=er(r[i[n]],t[i[n]],l)););return e}}return r!==void 0?1===n?function(n){return t.call(r,n)}:2===n?function(n,e){return t.call(r,n,e)}:4===n?function(n,e,i,a){return t.call(r,n,e,i,a)}:function(n,e,i){return t.call(r,n,e,i)}:t},N.debounce=function(t,r,n){function e(){s=l=a,h&&(c=t.apply(f,u))}var u,s,c,f,l,h=i;if(n===i)var d=i,h=o;else n&&S[typeof n]&&(d=n.leading,h="trailing"in n?n.trailing:h);return function(){return u=arguments,f=this,Gr(l),!s&&d?(s=i,c=t.apply(f,u)):l=nn(e,r),c}},N.defaults=R,N.defer=Tr,N.delay=function(t,r){var e=vn.call(arguments,2);return nn(function(){t.apply(n,e)},r)},N.difference=xr,N.filter=hr,N.flatten=wr,N.forEach=vr,N.forIn=L,N.forOwn=c,N.functions=rr,N.groupBy=function(t,r,n){var e={};return r=N.createCallback(r,n),vr(t,function(t,n,i){n=Nr(r(t,n,i)),(Jr.call(e,n)?e[n]:e[n]=[]).push(t)}),e},N.initial=function(t,r,n){if(!t)return[];var e=0,i=t.length;if("number"!=typeof r&&r!=a){var o=i;for(r=N.createCallback(r,n);o--&&r(t[o],o,t);)e++}else e=r==a||n?1:r||e;return K(t,0,ln(fn(0,i-e),i))},N.intersection=function(t){var r=arguments,n=r.length,e={0:{}},i=-1,a=t?t.length:0,o=a>=d,u=[],s=u;t:for(;a>++i;){var c=t[i];if(o)var f=h+c,f=e[0][f]?!(s=e[0][f]):s=e[0][f]=[];if(f||0>Mr(s,c)){o&&s.push(c);for(var l=n;--l;)if(!(e[l]||(e[l]=H(r[l])))(c))continue t;u.push(c)}}return u},N.invert=nr,N.invoke=function(t,r){var n=vn.call(arguments,2),e=-1,i="function"==typeof r,a=t?t.length:0,o=Or("number"==typeof a?a:0);return vr(t,function(t){o[++e]=(i?r:t[r]).apply(t,n)}),o},N.keys=yn,N.map=pr,N.max=mr,N.memoize=function(t,r){var n={};return function(){var e=h+(r?r.apply(this,arguments):arguments[0]);return Jr.call(n,e)?n[e]:n[e]=t.apply(this,arguments)}},N.merge=sr,N.min=function(t,r,n){var e=1/0,i=e;if(!r&&gn(t)){n=-1;for(var a=t.length;a>++n;){var o=t[n];i>o&&(i=o)}}else r=!r&&ur(t)?V:N.createCallback(r,n),vr(t,function(t,n,a){n=r(t,n,a),e>n&&(e=n,i=t)});return i},N.omit=function(t,r,n){var e="function"==typeof r,i={};if(e)r=N.createCallback(r,n);else var a=Yr.apply(Vr,vn.call(arguments,1));return L(t,function(t,n,o){(e?!r(t,n,o):0>Mr(a,n))&&(i[n]=t)}),i},N.once=function(t){var r,n;return function(){return r?n:(r=i,n=t.apply(this,arguments),t=a,n)}},N.pairs=function(t){for(var r=-1,n=yn(t),e=n.length,i=Or(e);e>++r;){var a=n[r];i[r]=[a,t[a]]}return i},N.partial=function(t){return U(t,vn.call(arguments,1))},N.partialRight=function(t){return U(t,vn.call(arguments,1),a,l)},N.pick=function(t,r,n){var e={};if("function"!=typeof r)for(var i=-1,a=Yr.apply(Vr,vn.call(arguments,1)),o=ar(t)?a.length:0;o>++i;){var u=a[i];u in t&&(e[u]=t[u])}else r=N.createCallback(r,n),L(t,function(t,n,i){r(t,n,i)&&(e[n]=t)});return e},N.pluck=gr,N.range=function(t,r,n){t=+t||0,n=+n||1,r==a&&(r=t,t=0);var e=-1;r=fn(0,Xr((r-t)/n));for(var i=Or(r);r>++e;)i[e]=t,t+=n;return i},N.reject=function(t,r,n){return r=N.createCallback(r,n),hr(t,function(t,n,e){return!r(t,n,e)})},N.rest=Br,N.shuffle=function(t){var r=-1,n=t?t.length:0,e=Or("number"==typeof n?n:0);return vr(t,function(t){var n=Zr(dn()*(++r+1));e[r]=e[n],e[n]=t}),e},N.sortBy=function(t,r,n){var e=-1,i=t?t.length:0,a=Or("number"==typeof i?i:0);for(r=N.createCallback(r,n),vr(t,function(t,n,i){a[++e]={a:r(t,n,i),b:e,c:t}}),i=a.length,a.sort($);i--;)a[i]=a[i].c;return a},N.tap=function(t,r){return r(t),t},N.throttle=function(t,r,n){function e(){f=a,d&&(l=new Dr,s=t.apply(c,u))}var u,s,c,f,l=0,h=i,d=i;return n===o?h=o:n&&S[typeof n]&&(h="leading"in n?n.leading:h,d="trailing"in n?n.trailing:d),function(){var n=new Dr;!f&&!h&&(l=n);var i=r-(n-l);return u=arguments,c=this,i>0?f||(f=nn(e,i)):(Gr(f),f=a,l=n,s=t.apply(c,u)),s}},N.times=function(t,r,n){t=(t=+t)>-1?t:0;var e=-1,i=Or(t);for(r=N.createCallback(r,n,1);t>++e;)i[e]=r(e);return i},N.toArray=function(t){return t&&"number"==typeof t.length?K(t):cr(t)},N.union=function(t){return gn(t)||(arguments[0]=t?vn.call(t):Vr),qr(Yr.apply(Vr,arguments))},N.uniq=qr,N.unzip=function(t){for(var r=-1,n=t?t.length:0,e=n?mr(gr(t,"length")):0,i=Or(e);n>++r;)for(var a=-1,o=t[r];e>++a;)(i[a]||(i[a]=Or(n)))[r]=o[a];return i},N.values=cr,N.where=hr,N.without=function(t){return xr(t,vn.call(arguments,1))},N.wrap=function(t,r){return function(){var n=[t];return tn.apply(n,arguments),r.apply(this,n)}},N.zip=function(t){for(var r=-1,n=t?mr(gr(arguments,"length")):0,e=Or(n);n>++r;)e[r]=gr(arguments,r);return e},N.zipObject=zr,N.collect=pr,N.drop=Br,N.each=vr,N.extend=F,N.methods=rr,N.object=zr,N.select=hr,N.tail=Br,N.unique=qr,Pr(N),N.clone=tr,N.cloneDeep=function(t,r,n){return tr(t,i,r,n)},N.contains=fr,N.escape=function(t){return t==a?"":Nr(t).replace(w,X)},N.every=lr,N.find=dr,N.findIndex=function(t,r,n){var e=-1,i=t?t.length:0;for(r=N.createCallback(r,n);i>++e;)if(r(t[e],e,t))return e;return-1},N.findKey=function(t,r,n){var e;return r=N.createCallback(r,n),c(t,function(t,n,i){return r(t,n,i)?(e=n,o):void 0}),e},N.has=function(t,r){return t?Jr.call(t,r):o},N.identity=Cr,N.indexOf=Mr,N.isArguments=function(t){return en.call(t)==k},N.isArray=gn,N.isBoolean=function(t){return t===i||t===o||en.call(t)==z},N.isDate=function(t){return t?"object"==typeof t&&en.call(t)==j:o},N.isElement=function(t){return t?1===t.nodeType:o},N.isEmpty=function(t){var r=i;if(!t)return r;var n=en.call(t),e=t.length;return n==q||n==I||n==k||n==C&&"number"==typeof e&&ir(t.splice)?!e:(c(t,function(){return r=o}),r)},N.isEqual=er,N.isFinite=function(t){return un(t)&&!sn(parseFloat(t))},N.isFunction=ir,N.isNaN=function(t){return or(t)&&t!=+t},N.isNull=function(t){return t===a},N.isNumber=or,N.isObject=ar,N.isPlainObject=u,N.isRegExp=function(t){return t?"object"==typeof t&&en.call(t)==P:o},N.isString=ur,N.isUndefined=function(t){return t===void 0},N.lastIndexOf=function(t,r,n){var e=t?t.length:0;for("number"==typeof n&&(e=(0>n?fn(0,e+n):ln(n,e-1))+1);e--;)if(t[e]===r)return e;return-1},N.mixin=Pr,N.noConflict=function(){return e._=Ur,this},N.parseInt=Sr,N.random=function(t,r){return t==a&&r==a&&(r=1),t=+t||0,r==a&&(r=t,t=0),t+Zr(dn()*((+r||0)-t+1))},N.reduce=yr,N.reduceRight=_r,N.result=function(t,r){var e=t?t[r]:n;return ir(e)?t[r]():e},N.runInContext=r,N.size=function(t){var r=t?t.length:0;return"number"==typeof r?r:yn(t).length},N.some=br,N.sortedIndex=kr,N.template=function(t,r,e){var a=N.templateSettings;t||(t=""),e=R({},e,a);var o,u=R({},e.imports,a.imports),a=yn(u),u=cr(u),s=0,c=e.interpolate||A,f="__p+='",c=Wr((e.escape||A).source+"|"+c.source+"|"+(c===b?y:A).source+"|"+(e.evaluate||A).source+"|$","g");t.replace(c,function(r,n,e,a,u,c){return e||(e=a),f+=t.slice(s,c).replace(M,Q),n&&(f+="'+__e("+n+")+'"),u&&(o=i,f+="';"+u+";__p+='"),e&&(f+="'+((__t=("+e+"))==null?'':__t)+'"),s=c+r.length,r}),f+="';\n",c=e=e.variable,c||(e="obj",f="with("+e+"){"+f+"}"),f=(o?f.replace(v,""):f).replace(p,"$1").replace(m,"$1;"),f="function("+e+"){"+(c?"":e+"||("+e+"={});")+"var __t,__p='',__e=_.escape"+(o?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+f+"return __p}";try{var l=Er(a,"return "+f).apply(n,u)}catch(h){throw h.source=f,h}return r?l(r):(l.source=f,l)},N.unescape=function(t){return t==a?"":Nr(t).replace(g,J)},N.uniqueId=function(t){var r=++f;return Nr(t==a?"":t)+r},N.all=lr,N.any=br,N.detect=dr,N.foldl=yr,N.foldr=_r,N.include=fr,N.inject=yr,c(N,function(t,r){N.prototype[r]||(N.prototype[r]=function(){var r=[this.__wrapped__];return tn.apply(r,arguments),t.apply(N,r)})}),N.first=Ar,N.last=function(t,r,n){if(t){var e=0,i=t.length;if("number"!=typeof r&&r!=a){var o=i;for(r=N.createCallback(r,n);o--&&r(t[o],o,t);)e++}else if(e=r,e==a||n)return t[i-1];return K(t,fn(0,i-e))}},N.take=Ar,N.head=Ar,c(N,function(t,r){N.prototype[r]||(N.prototype[r]=function(r,n){var e=t(this.__wrapped__,r,n);return r==a||n&&"function"!=typeof r?e:new G(e)})}),N.VERSION="1.2.0",N.prototype.toString=function(){return Nr(this.__wrapped__)},N.prototype.value=Ir,N.prototype.valueOf=Ir,vr(["join","pop","shift"],function(t){var r=Vr[t];N.prototype[t]=function(){return r.apply(this.__wrapped__,arguments)}}),vr(["push","reverse","sort","unshift"],function(t){var r=Vr[t];N.prototype[t]=function(){return r.apply(this.__wrapped__,arguments),this}}),vr(["concat","slice","splice"],function(t){var r=Vr[t];N.prototype[t]=function(){return new G(r.apply(this.__wrapped__,arguments))}}),N}var n,i=!0,a=null,o=!1,u="object"==typeof exports&&exports,s="object"==typeof module&&module&&module.exports==u&&module,c="object"==typeof global&&global;(c.global===c||c.window===c)&&(t=c);var f=0,l={},h=+new Date+"",d=200,v=/\b__p\+='';/g,p=/\b(__p\+=)''\+/g,m=/(__e\(.*?\)|\b__t\))\+'';/g,g=/&(?:amp|lt|gt|quot|#39);/g,y=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_=/\w*$/,b=/<%=([\s\S]+?)%>/g,x=/^0+(?=.$)/,A=/($^)/,w=/[&<>"']/g,M=/['\n\r\t\u2028\u2029\\]/g,B="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setImmediate setTimeout".split(" "),k="[object Arguments]",q="[object Array]",z="[object Boolean]",j="[object Date]",T="[object Number]",C="[object Object]",P="[object RegExp]",I="[object String]",O={"[object Function]":o};O[k]=O[q]=O[z]=O[j]=O[T]=O[C]=O[P]=O[I]=i;var S={"boolean":o,"function":i,object:i,number:o,string:o,undefined:o},D={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},E=r();"function"==typeof e&&"object"==typeof e.amd&&e.amd?(t._=E,e("_",[],function(){return E})):u&&!u.nodeType?s?(s.exports=E)._=E:u._=E:t._=E}(this),e("core/base",["require","./mixin/derive","./mixin/notifier","./mixin/dirty","./cache","_"],function(t){var r=t("./mixin/derive"),n=t("./mixin/notifier"),e=t("./mixin/dirty"),i=t("./cache"),a=t("_"),o=function(){this.cache=new i};return a.extend(o,r),a.extend(o.prototype,n),a.extend(o.prototype,e),o}),function(t){var r={};"undefined"==typeof exports?"function"==typeof e&&"object"==typeof e.amd&&e.amd?(r.exports={},e("glmatrix",[],function(){return r.exports})):r.exports="undefined"!=typeof window?window:t:r.exports=exports,function(t){if(!r)var r=1e-6;if(!n)var n="undefined"!=typeof Float32Array?Float32Array:Array;if(!e)var e=Math.random;var i={};i.setMatrixArrayType=function(t){n=t},t!==void 0&&(t.glMatrix=i);var a={};a.create=function(){var t=new n(2);return t[0]=0,t[1]=0,t},a.clone=function(t){var r=new n(2);return r[0]=t[0],r[1]=t[1],r},a.fromValues=function(t,r){var e=new n(2);return e[0]=t,e[1]=r,e},a.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t},a.set=function(t,r,n){return t[0]=r,t[1]=n,t},a.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t},a.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t},a.sub=a.subtract,a.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t},a.mul=a.multiply,a.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t},a.div=a.divide,a.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t},a.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t},a.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t},a.scaleAndAdd=function(t,r,n,e){return t[0]=r[0]+n[0]*e,t[1]=r[1]+n[1]*e,t},a.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return Math.sqrt(n*n+e*e)},a.dist=a.distance,a.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return n*n+e*e},a.sqrDist=a.squaredDistance,a.length=function(t){var r=t[0],n=t[1];return Math.sqrt(r*r+n*n)},a.len=a.length,a.squaredLength=function(t){var r=t[0],n=t[1];return r*r+n*n},a.sqrLen=a.squaredLength,a.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t},a.normalize=function(t,r){var n=r[0],e=r[1],i=n*n+e*e;return i>0&&(i=1/Math.sqrt(i),t[0]=r[0]*i,t[1]=r[1]*i),t},a.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]},a.cross=function(t,r,n){var e=r[0]*n[1]-r[1]*n[0];return t[0]=t[1]=0,t[2]=e,t},a.lerp=function(t,r,n,e){var i=r[0],a=r[1];return t[0]=i+e*(n[0]-i),t[1]=a+e*(n[1]-a),t},a.random=function(t,r){r=r||1;var n=2*e()*Math.PI;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t},a.transformMat2=function(t,r,n){var e=r[0],i=r[1];return t[0]=n[0]*e+n[2]*i,t[1]=n[1]*e+n[3]*i,t},a.transformMat2d=function(t,r,n){var e=r[0],i=r[1];return t[0]=n[0]*e+n[2]*i+n[4],t[1]=n[1]*e+n[3]*i+n[5],t},a.transformMat3=function(t,r,n){var e=r[0],i=r[1];return t[0]=n[0]*e+n[3]*i+n[6],t[1]=n[1]*e+n[4]*i+n[7],t},a.transformMat4=function(t,r,n){var e=r[0],i=r[1];return t[0]=n[0]*e+n[4]*i+n[12],t[1]=n[1]*e+n[5]*i+n[13],t},a.forEach=function(){var t=a.create();return function(r,n,e,i,a,o){var u,s;for(n||(n=2),e||(e=0),s=i?Math.min(i*n+e,r.length):r.length,u=e;s>u;u+=n)t[0]=r[u],t[1]=r[u+1],a(t,t,o),r[u]=t[0],r[u+1]=t[1];return r}}(),a.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},t!==void 0&&(t.vec2=a);var o={};o.create=function(){var t=new n(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var r=new n(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},o.fromValues=function(t,r,e){var i=new n(3);return i[0]=t,i[1]=r,i[2]=e,i},o.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},o.set=function(t,r,n,e){return t[0]=r,t[1]=n,t[2]=e,t},o.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t},o.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t[2]=r[2]-n[2],t},o.sub=o.subtract,o.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t[2]=r[2]*n[2],t},o.mul=o.multiply,o.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t[2]=r[2]/n[2],t},o.div=o.divide,o.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t},o.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t},o.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t},o.scaleAndAdd=function(t,r,n,e){return t[0]=r[0]+n[0]*e,t[1]=r[1]+n[1]*e,t[2]=r[2]+n[2]*e,t},o.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],i=r[2]-t[2];return Math.sqrt(n*n+e*e+i*i)},o.dist=o.distance,o.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],i=r[2]-t[2];return n*n+e*e+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var r=t[0],n=t[1],e=t[2];return Math.sqrt(r*r+n*n+e*e)},o.len=o.length,o.squaredLength=function(t){var r=t[0],n=t[1],e=t[2];return r*r+n*n+e*e},o.sqrLen=o.squaredLength,o.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t},o.normalize=function(t,r){var n=r[0],e=r[1],i=r[2],a=n*n+e*e+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a),t},o.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},o.cross=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=n[0],u=n[1],s=n[2];return t[0]=i*s-a*u,t[1]=a*o-e*s,t[2]=e*u-i*o,t},o.lerp=function(t,r,n,e){var i=r[0],a=r[1],o=r[2];return t[0]=i+e*(n[0]-i),t[1]=a+e*(n[1]-a),t[2]=o+e*(n[2]-o),t},o.random=function(t,r){r=r||1;var n=2*e()*Math.PI,i=2*e()-1,a=Math.sqrt(1-i*i)*r;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=i*r,t},o.transformMat4=function(t,r,n){var e=r[0],i=r[1],a=r[2];return t[0]=n[0]*e+n[4]*i+n[8]*a+n[12],t[1]=n[1]*e+n[5]*i+n[9]*a+n[13],t[2]=n[2]*e+n[6]*i+n[10]*a+n[14],t},o.transformMat3=function(t,r,n){var e=r[0],i=r[1],a=r[2];return t[0]=e*n[0]+i*n[3]+a*n[6],t[1]=e*n[1]+i*n[4]+a*n[7],t[2]=e*n[2]+i*n[5]+a*n[8],t},o.transformQuat=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=n[0],u=n[1],s=n[2],c=n[3],f=c*e+u*a-s*i,l=c*i+s*e-o*a,h=c*a+o*i-u*e,d=-o*e-u*i-s*a;return t[0]=f*c+d*-o+l*-s-h*-u,t[1]=l*c+d*-u+h*-o-f*-s,t[2]=h*c+d*-s+f*-u-l*-o,t},o.forEach=function(){var t=o.create();return function(r,n,e,i,a,o){var u,s;for(n||(n=3),e||(e=0),s=i?Math.min(i*n+e,r.length):r.length,u=e;s>u;u+=n)t[0]=r[u],t[1]=r[u+1],t[2]=r[u+2],a(t,t,o),r[u]=t[0],r[u+1]=t[1],r[u+2]=t[2];return r}}(),o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t!==void 0&&(t.vec3=o);var u={};u.create=function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},u.clone=function(t){var r=new n(4);
return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},u.fromValues=function(t,r,e,i){var a=new n(4);return a[0]=t,a[1]=r,a[2]=e,a[3]=i,a},u.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},u.set=function(t,r,n,e,i){return t[0]=r,t[1]=n,t[2]=e,t[3]=i,t},u.add=function(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t},u.subtract=function(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t[2]=r[2]-n[2],t[3]=r[3]-n[3],t},u.sub=u.subtract,u.multiply=function(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t[2]=r[2]*n[2],t[3]=r[3]*n[3],t},u.mul=u.multiply,u.divide=function(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t[2]=r[2]/n[2],t[3]=r[3]/n[3],t},u.div=u.divide,u.min=function(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t[3]=Math.min(r[3],n[3]),t},u.max=function(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t[3]=Math.max(r[3],n[3]),t},u.scale=function(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t},u.scaleAndAdd=function(t,r,n,e){return t[0]=r[0]+n[0]*e,t[1]=r[1]+n[1]*e,t[2]=r[2]+n[2]*e,t[3]=r[3]+n[3]*e,t},u.distance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],i=r[2]-t[2],a=r[3]-t[3];return Math.sqrt(n*n+e*e+i*i+a*a)},u.dist=u.distance,u.squaredDistance=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],i=r[2]-t[2],a=r[3]-t[3];return n*n+e*e+i*i+a*a},u.sqrDist=u.squaredDistance,u.length=function(t){var r=t[0],n=t[1],e=t[2],i=t[3];return Math.sqrt(r*r+n*n+e*e+i*i)},u.len=u.length,u.squaredLength=function(t){var r=t[0],n=t[1],e=t[2],i=t[3];return r*r+n*n+e*e+i*i},u.sqrLen=u.squaredLength,u.negate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t},u.normalize=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=n*n+e*e+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=r[0]*o,t[1]=r[1]*o,t[2]=r[2]*o,t[3]=r[3]*o),t},u.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]},u.lerp=function(t,r,n,e){var i=r[0],a=r[1],o=r[2],u=r[3];return t[0]=i+e*(n[0]-i),t[1]=a+e*(n[1]-a),t[2]=o+e*(n[2]-o),t[3]=u+e*(n[3]-u),t},u.random=function(t,r){return r=r||1,t[0]=e(),t[1]=e(),t[2]=e(),t[3]=e(),u.normalize(t,t),u.scale(t,t,r),t},u.transformMat4=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3];return t[0]=n[0]*e+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*e+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*e+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*e+n[7]*i+n[11]*a+n[15]*o,t},u.transformQuat=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=n[0],u=n[1],s=n[2],c=n[3],f=c*e+u*a-s*i,l=c*i+s*e-o*a,h=c*a+o*i-u*e,d=-o*e-u*i-s*a;return t[0]=f*c+d*-o+l*-s-h*-u,t[1]=l*c+d*-u+h*-o-f*-s,t[2]=h*c+d*-s+f*-u-l*-o,t},u.forEach=function(){var t=u.create();return function(r,n,e,i,a,o){var u,s;for(n||(n=4),e||(e=0),s=i?Math.min(i*n+e,r.length):r.length,u=e;s>u;u+=n)t[0]=r[u],t[1]=r[u+1],t[2]=r[u+2],t[3]=r[u+3],a(t,t,o),r[u]=t[0],r[u+1]=t[1],r[u+2]=t[2],r[u+3]=t[3];return r}}(),u.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.vec4=u);var s={};s.create=function(){var t=new n(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},s.clone=function(t){var r=new n(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},s.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},s.transpose=function(t,r){if(t===r){var n=r[1];t[1]=r[2],t[2]=n}else t[0]=r[0],t[1]=r[2],t[2]=r[1],t[3]=r[3];return t},s.invert=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=n*a-i*e;return o?(o=1/o,t[0]=a*o,t[1]=-e*o,t[2]=-i*o,t[3]=n*o,t):null},s.adjoint=function(t,r){var n=r[0];return t[0]=r[3],t[1]=-r[1],t[2]=-r[2],t[3]=n,t},s.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},s.multiply=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=n[0],s=n[1],c=n[2],f=n[3];return t[0]=e*u+i*c,t[1]=e*s+i*f,t[2]=a*u+o*c,t[3]=a*s+o*f,t},s.mul=s.multiply,s.rotate=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=Math.sin(n),s=Math.cos(n);return t[0]=e*s+i*u,t[1]=e*-u+i*s,t[2]=a*s+o*u,t[3]=a*-u+o*s,t},s.scale=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=n[0],s=n[1];return t[0]=e*u,t[1]=i*s,t[2]=a*u,t[3]=o*s,t},s.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.mat2=s);var c={};c.create=function(){var t=new n(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.clone=function(t){var r=new n(6);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r},c.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.invert=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=r[4],u=r[5],s=n*a-e*i;return s?(s=1/s,t[0]=a*s,t[1]=-e*s,t[2]=-i*s,t[3]=n*s,t[4]=(i*u-a*o)*s,t[5]=(e*o-n*u)*s,t):null},c.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},c.multiply=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=r[4],s=r[5],c=n[0],f=n[1],l=n[2],h=n[3],d=n[4],v=n[5];return t[0]=e*c+i*l,t[1]=e*f+i*h,t[2]=a*c+o*l,t[3]=a*f+o*h,t[4]=c*u+l*s+d,t[5]=f*u+h*s+v,t},c.mul=c.multiply,c.rotate=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=r[4],s=r[5],c=Math.sin(n),f=Math.cos(n);return t[0]=e*f+i*c,t[1]=-e*c+i*f,t[2]=a*f+o*c,t[3]=-a*c+f*o,t[4]=f*u+c*s,t[5]=f*s-c*u,t},c.scale=function(t,r,n){var e=n[0],i=n[1];return t[0]=r[0]*e,t[1]=r[1]*i,t[2]=r[2]*e,t[3]=r[3]*i,t[4]=r[4]*e,t[5]=r[5]*i,t},c.translate=function(t,r,n){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4]+n[0],t[5]=r[5]+n[1],t},c.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},t!==void 0&&(t.mat2d=c);var f={};f.create=function(){var t=new n(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},f.fromMat4=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[4],t[4]=r[5],t[5]=r[6],t[6]=r[8],t[7]=r[9],t[8]=r[10],t},f.clone=function(t){var r=new n(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},f.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},f.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},f.transpose=function(t,r){if(t===r){var n=r[1],e=r[2],i=r[5];t[1]=r[3],t[2]=r[6],t[3]=n,t[5]=r[7],t[6]=e,t[7]=i}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t},f.invert=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=r[4],u=r[5],s=r[6],c=r[7],f=r[8],l=f*o-u*c,h=-f*a+u*s,d=c*a-o*s,v=n*l+e*h+i*d;return v?(v=1/v,t[0]=l*v,t[1]=(-f*e+i*c)*v,t[2]=(u*e-i*o)*v,t[3]=h*v,t[4]=(f*n-i*s)*v,t[5]=(-u*n+i*a)*v,t[6]=d*v,t[7]=(-c*n+e*s)*v,t[8]=(o*n-e*a)*v,t):null},f.adjoint=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=r[4],u=r[5],s=r[6],c=r[7],f=r[8];return t[0]=o*f-u*c,t[1]=i*c-e*f,t[2]=e*u-i*o,t[3]=u*s-a*f,t[4]=n*f-i*s,t[5]=i*a-n*u,t[6]=a*c-o*s,t[7]=e*s-n*c,t[8]=n*o-e*a,t},f.determinant=function(t){var r=t[0],n=t[1],e=t[2],i=t[3],a=t[4],o=t[5],u=t[6],s=t[7],c=t[8];return r*(c*a-o*s)+n*(-c*i+o*u)+e*(s*i-a*u)},f.multiply=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=r[4],s=r[5],c=r[6],f=r[7],l=r[8],h=n[0],d=n[1],v=n[2],p=n[3],m=n[4],g=n[5],y=n[6],_=n[7],b=n[8];return t[0]=h*e+d*o+v*c,t[1]=h*i+d*u+v*f,t[2]=h*a+d*s+v*l,t[3]=p*e+m*o+g*c,t[4]=p*i+m*u+g*f,t[5]=p*a+m*s+g*l,t[6]=y*e+_*o+b*c,t[7]=y*i+_*u+b*f,t[8]=y*a+_*s+b*l,t},f.mul=f.multiply,f.translate=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=r[4],s=r[5],c=r[6],f=r[7],l=r[8],h=n[0],d=n[1];return t[0]=e,t[1]=i,t[2]=a,t[3]=o,t[4]=u,t[5]=s,t[6]=h*e+d*o+c,t[7]=h*i+d*u+f,t[8]=h*a+d*s+l,t},f.rotate=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=r[4],s=r[5],c=r[6],f=r[7],l=r[8],h=Math.sin(n),d=Math.cos(n);return t[0]=d*e+h*o,t[1]=d*i+h*u,t[2]=d*a+h*s,t[3]=d*o-h*e,t[4]=d*u-h*i,t[5]=d*s-h*a,t[6]=c,t[7]=f,t[8]=l,t},f.scale=function(t,r,n){var e=n[0],i=n[1];return t[0]=e*r[0],t[1]=e*r[1],t[2]=e*r[2],t[3]=i*r[3],t[4]=i*r[4],t[5]=i*r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},f.fromMat2d=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=0,t[3]=r[2],t[4]=r[3],t[5]=0,t[6]=r[4],t[7]=r[5],t[8]=1,t},f.fromQuat=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=n+n,u=e+e,s=i+i,c=n*o,f=n*u,l=n*s,h=e*u,d=e*s,v=i*s,p=a*o,m=a*u,g=a*s;return t[0]=1-(h+v),t[3]=f+g,t[6]=l-m,t[1]=f-g,t[4]=1-(c+v),t[7]=d+p,t[2]=l+m,t[5]=d-p,t[8]=1-(c+h),t},f.normalFromMat4=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=r[4],u=r[5],s=r[6],c=r[7],f=r[8],l=r[9],h=r[10],d=r[11],v=r[12],p=r[13],m=r[14],g=r[15],y=n*u-e*o,_=n*s-i*o,b=n*c-a*o,x=e*s-i*u,A=e*c-a*u,w=i*c-a*s,M=f*p-l*v,B=f*m-h*v,k=f*g-d*v,q=l*m-h*p,z=l*g-d*p,j=h*g-d*m,T=y*j-_*z+b*q+x*k-A*B+w*M;return T?(T=1/T,t[0]=(u*j-s*z+c*q)*T,t[1]=(s*k-o*j-c*B)*T,t[2]=(o*z-u*k+c*M)*T,t[3]=(i*z-e*j-a*q)*T,t[4]=(n*j-i*k+a*B)*T,t[5]=(e*k-n*z-a*M)*T,t[6]=(p*w-m*A+g*x)*T,t[7]=(m*b-v*w-g*_)*T,t[8]=(v*A-p*b+g*y)*T,t):null},f.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t!==void 0&&(t.mat3=f);var l={};l.create=function(){var t=new n(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.clone=function(t){var r=new n(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},l.copy=function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.transpose=function(t,r){if(t===r){var n=r[1],e=r[2],i=r[3],a=r[6],o=r[7],u=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=n,t[6]=r[9],t[7]=r[13],t[8]=e,t[9]=a,t[11]=r[14],t[12]=i,t[13]=o,t[14]=u}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},l.invert=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=r[4],u=r[5],s=r[6],c=r[7],f=r[8],l=r[9],h=r[10],d=r[11],v=r[12],p=r[13],m=r[14],g=r[15],y=n*u-e*o,_=n*s-i*o,b=n*c-a*o,x=e*s-i*u,A=e*c-a*u,w=i*c-a*s,M=f*p-l*v,B=f*m-h*v,k=f*g-d*v,q=l*m-h*p,z=l*g-d*p,j=h*g-d*m,T=y*j-_*z+b*q+x*k-A*B+w*M;return T?(T=1/T,t[0]=(u*j-s*z+c*q)*T,t[1]=(i*z-e*j-a*q)*T,t[2]=(p*w-m*A+g*x)*T,t[3]=(h*A-l*w-d*x)*T,t[4]=(s*k-o*j-c*B)*T,t[5]=(n*j-i*k+a*B)*T,t[6]=(m*b-v*w-g*_)*T,t[7]=(f*w-h*b+d*_)*T,t[8]=(o*z-u*k+c*M)*T,t[9]=(e*k-n*z-a*M)*T,t[10]=(v*A-p*b+g*y)*T,t[11]=(l*b-f*A-d*y)*T,t[12]=(u*B-o*q-s*M)*T,t[13]=(n*q-e*B+i*M)*T,t[14]=(p*_-v*x-m*y)*T,t[15]=(f*x-l*_+h*y)*T,t):null},l.adjoint=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=r[4],u=r[5],s=r[6],c=r[7],f=r[8],l=r[9],h=r[10],d=r[11],v=r[12],p=r[13],m=r[14],g=r[15];return t[0]=u*(h*g-d*m)-l*(s*g-c*m)+p*(s*d-c*h),t[1]=-(e*(h*g-d*m)-l*(i*g-a*m)+p*(i*d-a*h)),t[2]=e*(s*g-c*m)-u*(i*g-a*m)+p*(i*c-a*s),t[3]=-(e*(s*d-c*h)-u*(i*d-a*h)+l*(i*c-a*s)),t[4]=-(o*(h*g-d*m)-f*(s*g-c*m)+v*(s*d-c*h)),t[5]=n*(h*g-d*m)-f*(i*g-a*m)+v*(i*d-a*h),t[6]=-(n*(s*g-c*m)-o*(i*g-a*m)+v*(i*c-a*s)),t[7]=n*(s*d-c*h)-o*(i*d-a*h)+f*(i*c-a*s),t[8]=o*(l*g-d*p)-f*(u*g-c*p)+v*(u*d-c*l),t[9]=-(n*(l*g-d*p)-f*(e*g-a*p)+v*(e*d-a*l)),t[10]=n*(u*g-c*p)-o*(e*g-a*p)+v*(e*c-a*u),t[11]=-(n*(u*d-c*l)-o*(e*d-a*l)+f*(e*c-a*u)),t[12]=-(o*(l*m-h*p)-f*(u*m-s*p)+v*(u*h-s*l)),t[13]=n*(l*m-h*p)-f*(e*m-i*p)+v*(e*h-i*l),t[14]=-(n*(u*m-s*p)-o*(e*m-i*p)+v*(e*s-i*u)),t[15]=n*(u*h-s*l)-o*(e*h-i*l)+f*(e*s-i*u),t},l.determinant=function(t){var r=t[0],n=t[1],e=t[2],i=t[3],a=t[4],o=t[5],u=t[6],s=t[7],c=t[8],f=t[9],l=t[10],h=t[11],d=t[12],v=t[13],p=t[14],m=t[15],g=r*o-n*a,y=r*u-e*a,_=r*s-i*a,b=n*u-e*o,x=n*s-i*o,A=e*s-i*u,w=c*v-f*d,M=c*p-l*d,B=c*m-h*d,k=f*p-l*v,q=f*m-h*v,z=l*m-h*p;return g*z-y*q+_*k+b*B-x*M+A*w},l.multiply=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=r[4],s=r[5],c=r[6],f=r[7],l=r[8],h=r[9],d=r[10],v=r[11],p=r[12],m=r[13],g=r[14],y=r[15],_=n[0],b=n[1],x=n[2],A=n[3];return t[0]=_*e+b*u+x*l+A*p,t[1]=_*i+b*s+x*h+A*m,t[2]=_*a+b*c+x*d+A*g,t[3]=_*o+b*f+x*v+A*y,_=n[4],b=n[5],x=n[6],A=n[7],t[4]=_*e+b*u+x*l+A*p,t[5]=_*i+b*s+x*h+A*m,t[6]=_*a+b*c+x*d+A*g,t[7]=_*o+b*f+x*v+A*y,_=n[8],b=n[9],x=n[10],A=n[11],t[8]=_*e+b*u+x*l+A*p,t[9]=_*i+b*s+x*h+A*m,t[10]=_*a+b*c+x*d+A*g,t[11]=_*o+b*f+x*v+A*y,_=n[12],b=n[13],x=n[14],A=n[15],t[12]=_*e+b*u+x*l+A*p,t[13]=_*i+b*s+x*h+A*m,t[14]=_*a+b*c+x*d+A*g,t[15]=_*o+b*f+x*v+A*y,t},l.mul=l.multiply,l.translate=function(t,r,n){var e,i,a,o,u,s,c,f,l,h,d,v,p=n[0],m=n[1],g=n[2];return r===t?(t[12]=r[0]*p+r[4]*m+r[8]*g+r[12],t[13]=r[1]*p+r[5]*m+r[9]*g+r[13],t[14]=r[2]*p+r[6]*m+r[10]*g+r[14],t[15]=r[3]*p+r[7]*m+r[11]*g+r[15]):(e=r[0],i=r[1],a=r[2],o=r[3],u=r[4],s=r[5],c=r[6],f=r[7],l=r[8],h=r[9],d=r[10],v=r[11],t[0]=e,t[1]=i,t[2]=a,t[3]=o,t[4]=u,t[5]=s,t[6]=c,t[7]=f,t[8]=l,t[9]=h,t[10]=d,t[11]=v,t[12]=e*p+u*m+l*g+r[12],t[13]=i*p+s*m+h*g+r[13],t[14]=a*p+c*m+d*g+r[14],t[15]=o*p+f*m+v*g+r[15]),t},l.scale=function(t,r,n){var e=n[0],i=n[1],a=n[2];return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},l.rotate=function(t,n,e,i){var a,o,u,s,c,f,l,h,d,v,p,m,g,y,_,b,x,A,w,M,B,k,q,z,j=i[0],T=i[1],C=i[2],P=Math.sqrt(j*j+T*T+C*C);return r>Math.abs(P)?null:(P=1/P,j*=P,T*=P,C*=P,a=Math.sin(e),o=Math.cos(e),u=1-o,s=n[0],c=n[1],f=n[2],l=n[3],h=n[4],d=n[5],v=n[6],p=n[7],m=n[8],g=n[9],y=n[10],_=n[11],b=j*j*u+o,x=T*j*u+C*a,A=C*j*u-T*a,w=j*T*u-C*a,M=T*T*u+o,B=C*T*u+j*a,k=j*C*u+T*a,q=T*C*u-j*a,z=C*C*u+o,t[0]=s*b+h*x+m*A,t[1]=c*b+d*x+g*A,t[2]=f*b+v*x+y*A,t[3]=l*b+p*x+_*A,t[4]=s*w+h*M+m*B,t[5]=c*w+d*M+g*B,t[6]=f*w+v*M+y*B,t[7]=l*w+p*M+_*B,t[8]=s*k+h*q+m*z,t[9]=c*k+d*q+g*z,t[10]=f*k+v*q+y*z,t[11]=l*k+p*q+_*z,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)},l.rotateX=function(t,r,n){var e=Math.sin(n),i=Math.cos(n),a=r[4],o=r[5],u=r[6],s=r[7],c=r[8],f=r[9],l=r[10],h=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=a*i+c*e,t[5]=o*i+f*e,t[6]=u*i+l*e,t[7]=s*i+h*e,t[8]=c*i-a*e,t[9]=f*i-o*e,t[10]=l*i-u*e,t[11]=h*i-s*e,t},l.rotateY=function(t,r,n){var e=Math.sin(n),i=Math.cos(n),a=r[0],o=r[1],u=r[2],s=r[3],c=r[8],f=r[9],l=r[10],h=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i-c*e,t[1]=o*i-f*e,t[2]=u*i-l*e,t[3]=s*i-h*e,t[8]=a*e+c*i,t[9]=o*e+f*i,t[10]=u*e+l*i,t[11]=s*e+h*i,t},l.rotateZ=function(t,r,n){var e=Math.sin(n),i=Math.cos(n),a=r[0],o=r[1],u=r[2],s=r[3],c=r[4],f=r[5],l=r[6],h=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i+c*e,t[1]=o*i+f*e,t[2]=u*i+l*e,t[3]=s*i+h*e,t[4]=c*i-a*e,t[5]=f*i-o*e,t[6]=l*i-u*e,t[7]=h*i-s*e,t},l.fromRotationTranslation=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=e+e,s=i+i,c=a+a,f=e*u,l=e*s,h=e*c,d=i*s,v=i*c,p=a*c,m=o*u,g=o*s,y=o*c;return t[0]=1-(d+p),t[1]=l+y,t[2]=h-g,t[3]=0,t[4]=l-y,t[5]=1-(f+p),t[6]=v+m,t[7]=0,t[8]=h+g,t[9]=v-m,t[10]=1-(f+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},l.fromQuat=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=n+n,u=e+e,s=i+i,c=n*o,f=n*u,l=n*s,h=e*u,d=e*s,v=i*s,p=a*o,m=a*u,g=a*s;return t[0]=1-(h+v),t[1]=f+g,t[2]=l-m,t[3]=0,t[4]=f-g,t[5]=1-(c+v),t[6]=d+p,t[7]=0,t[8]=l+m,t[9]=d-p,t[10]=1-(c+h),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.frustum=function(t,r,n,e,i,a,o){var u=1/(n-r),s=1/(i-e),c=1/(a-o);return t[0]=2*a*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*s,t[6]=0,t[7]=0,t[8]=(n+r)*u,t[9]=(i+e)*s,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*a*c,t[15]=0,t},l.perspective=function(t,r,n,e,i){var a=1/Math.tan(r/2),o=1/(e-i);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+e)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*e*o,t[15]=0,t},l.ortho=function(t,r,n,e,i,a,o){var u=1/(r-n),s=1/(e-i),c=1/(a-o);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(r+n)*u,t[13]=(i+e)*s,t[14]=(o+a)*c,t[15]=1,t},l.lookAt=function(t,n,e,i){var a,o,u,s,c,f,h,d,v,p,m=n[0],g=n[1],y=n[2],_=i[0],b=i[1],x=i[2],A=e[0],w=e[1],M=e[2];return r>Math.abs(m-A)&&r>Math.abs(g-w)&&r>Math.abs(y-M)?l.identity(t):(h=m-A,d=g-w,v=y-M,p=1/Math.sqrt(h*h+d*d+v*v),h*=p,d*=p,v*=p,a=b*v-x*d,o=x*h-_*v,u=_*d-b*h,p=Math.sqrt(a*a+o*o+u*u),p?(p=1/p,a*=p,o*=p,u*=p):(a=0,o=0,u=0),s=d*u-v*o,c=v*a-h*u,f=h*o-d*a,p=Math.sqrt(s*s+c*c+f*f),p?(p=1/p,s*=p,c*=p,f*=p):(s=0,c=0,f=0),t[0]=a,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=c,t[6]=d,t[7]=0,t[8]=u,t[9]=f,t[10]=v,t[11]=0,t[12]=-(a*m+o*g+u*y),t[13]=-(s*m+c*g+f*y),t[14]=-(h*m+d*g+v*y),t[15]=1,t)},l.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t!==void 0&&(t.mat4=l);var h={};h.create=function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.rotationTo=function(){var t=o.create(),r=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(e,i,a){var u=o.dot(i,a);return-.999999>u?(o.cross(t,r,i),1e-6>o.length(t)&&o.cross(t,n,i),o.normalize(t,t),h.setAxisAngle(e,t,Math.PI),e):u>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(o.cross(t,i,a),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=1+u,h.normalize(e,e))}}(),h.setAxes=function(){var t=f.create();return function(r,n,e,i){return t[0]=e[0],t[3]=e[1],t[6]=e[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=n[0],t[5]=n[1],t[8]=n[2],h.normalize(r,h.fromMat3(r,t))}}(),h.clone=u.clone,h.fromValues=u.fromValues,h.copy=u.copy,h.set=u.set,h.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.setAxisAngle=function(t,r,n){n*=.5;var e=Math.sin(n);return t[0]=e*r[0],t[1]=e*r[1],t[2]=e*r[2],t[3]=Math.cos(n),t},h.add=u.add,h.multiply=function(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],u=n[0],s=n[1],c=n[2],f=n[3];return t[0]=e*f+o*u+i*c-a*s,t[1]=i*f+o*s+a*u-e*c,t[2]=a*f+o*c+e*s-i*u,t[3]=o*f-e*u-i*s-a*c,t},h.mul=h.multiply,h.scale=u.scale,h.rotateX=function(t,r,n){n*=.5;var e=r[0],i=r[1],a=r[2],o=r[3],u=Math.sin(n),s=Math.cos(n);return t[0]=e*s+o*u,t[1]=i*s+a*u,t[2]=a*s-i*u,t[3]=o*s-e*u,t},h.rotateY=function(t,r,n){n*=.5;var e=r[0],i=r[1],a=r[2],o=r[3],u=Math.sin(n),s=Math.cos(n);return t[0]=e*s-a*u,t[1]=i*s+o*u,t[2]=a*s+e*u,t[3]=o*s-i*u,t},h.rotateZ=function(t,r,n){n*=.5;var e=r[0],i=r[1],a=r[2],o=r[3],u=Math.sin(n),s=Math.cos(n);return t[0]=e*s+i*u,t[1]=i*s-e*u,t[2]=a*s+o*u,t[3]=o*s-a*u,t},h.calculateW=function(t,r){var n=r[0],e=r[1],i=r[2];return t[0]=n,t[1]=e,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-n*n-e*e-i*i)),t},h.dot=u.dot,h.lerp=u.lerp,h.slerp=function(t,r,n,e){var i,a,o,u,s,c=r[0],f=r[1],l=r[2],h=r[3],d=n[0],v=n[1],p=n[2],m=n[3];return a=c*d+f*v+l*p+h*m,0>a&&(a=-a,d=-d,v=-v,p=-p,m=-m),1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),u=Math.sin((1-e)*i)/o,s=Math.sin(e*i)/o):(u=1-e,s=e),t[0]=u*c+s*d,t[1]=u*f+s*v,t[2]=u*l+s*p,t[3]=u*h+s*m,t},h.invert=function(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=n*n+e*e+i*i+a*a,u=o?1/o:0;return t[0]=-n*u,t[1]=-e*u,t[2]=-i*u,t[3]=a*u,t},h.conjugate=function(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t},h.length=u.length,h.len=h.length,h.squaredLength=u.squaredLength,h.sqrLen=h.squaredLength,h.normalize=u.normalize,h.fromMat3=function(){var t="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(r,n){var e,i=n[0]+n[4]+n[8];if(i>0)e=Math.sqrt(i+1),r[3]=.5*e,e=.5/e,r[0]=(n[7]-n[5])*e,r[1]=(n[2]-n[6])*e,r[2]=(n[3]-n[1])*e;else{var a=0;n[4]>n[0]&&(a=1),n[8]>n[3*a+a]&&(a=2);var o=t[a],u=t[o];e=Math.sqrt(n[3*a+a]-n[3*o+o]-n[3*u+u]+1),r[a]=.5*e,e=.5/e,r[3]=(n[3*u+o]-n[3*o+u])*e,r[o]=(n[3*o+a]+n[3*a+o])*e,r[u]=(n[3*u+a]+n[3*a+u])*e}return r}}(),h.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.quat=h)}(r.exports)}(this),e("2d/style",["require","core/base","_"],function(t){function r(t){return(t||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")}var n=t("core/base"),e=t("_"),i=["fillStyle","strokeStyle","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","globalAlpha","font"],a={fill:"fillStyle",stroke:"strokeStyle",alpha:"globalAlpha",shadow:["shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor"]},o=/([0-9]+)\s+([0-9]+)\s+([0-9]+)\s+([a-zA-Z0-9\(\)\s,#]+)/,u=n.derive({},{bind:function(t){var n=i,u=a;for(var s in u)if(this.hasOwnProperty(s)){var c=u[s],f=this[s];if("shadow"==s){var l=o.exec(r(f));if(!l)continue;f=l.slice(1),e.each(f,function(r,n){c[n]&&(t[c[n]]=r)},this)}else t[c]=f}e.each(n,function(r){this.hasOwnProperty(r)&&(t[r]=this[r])},this)}});return u}),e("2d/node",["require","core/base","glmatrix","./style"],function(t){var r=t("core/base"),n=t("glmatrix"),e=n.vec2,i=n.mat2d,a=t("./style"),o=r.derive(function(){return{__mouseover__:!1,id:0,AABB:[e.fromValues(0,0),e.fromValues(0,0)],z:0,style:null,position:e.fromValues(0,0),rotation:0,scale:e.fromValues(1,1),_transform:i.create(),_transformInverse:i.create(),visible:!0,children:{},intersectLineWidth:0,clip:!1,fill:!0,stroke:!0,fixAA:!0}},function(){this.__GUID__=u()},{updateTransform:function(){var t=this._transform;return i.identity(t),this.scale&&i.scale(t,t,this.scale),this.rotation&&i.rotate(t,t,this.rotation),this.position&&i.translate(t,t,this.position),t},updateTransformInverse:function(){i.invert(this._transformInverse,this._transformInverse)},intersectAABB:function(t,r){var n=this.AABB;return t>n[0][0]&&n[1][0]>t&&r>n[0][1]&&n[1][1]>r},add:function(t){t&&(this.children[t.__GUID__]=t,t.parent=this)},remove:function(t){this.children[t.__GUID__]=null,t.parent=null},draw:function(){},render:function(t){var r=this._getSortedRenderQueue();if(t.save(),this.style)if(!this.style instanceof a)for(var n in this.style)this.style[n].bind(t);else this.style.bind(t);var e=this.updateTransform();t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),this.draw(t),this.clip&&t.clip();for(var i=0;r.length>i;i++)r[i].render(t);t.restore()},traverse:function(t){var r=t&&t(this);if(!r)for(var n=this.children,e=0,i=n.length;i>e;e++)n[e].traverse(t)},intersect:function(){},_getSortedRenderQueue:function(){var t=[];for(var r in this.children)t.push(this.children[r]);return t.sort(function(t,r){return t.z===r.z?t.__GUID__>r.__GUID__?1:-1:t.z>r.z?1:-1}),t}}),u=function(){var t=0;return function(){return++t}}();return o}),e("2d/util",["require"],function(){return{fixPos:function(t){return[t[0]+.5,t[1]+.5]},fixPosArray:function(t){for(var r=[],n=t.length,e=0;n>e;e++)r.push(this.fixPos(t[e]));return r},computeAABB:function(t){for(var r=t[0][0],n=t[0][0],e=t[0][1],i=t[0][1],a=1;t.length>a;a++)r=r>t[a][0]?t[a][0]:r,n=t[a][0]>n?t[a][0]:n,e=e>t[a][1]?t[a][1]:e,i=t[a][1]>i?t[a][1]:i;return[[r,e],[n,i]]}}}),e("2d/renderable/arc",["require","../node","../util","glmatrix"],function(t){var r=t("../node"),n=t("../util"),e=t("glmatrix");e.vec2;var i=r.derive(function(){return{center:[0,0],radius:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(){var t=this.fixAA?n.fixPos(this.center):this.center;ctx.beginPath(),ctx.arc(t[0],t[1],this.radius,this.startAngle,this.endAngle,!this.clockwise),this.stroke&&ctx.stroke(),this.fill&&ctx.fill()},intersect:function(){return!1}});return i}),e("2d/renderable/circle",["require","../node","../util","glmatrix"],function(t){var r=t("../node"),n=t("../util"),e=t("glmatrix"),i=e.vec2,a=r.derive(function(){return{center:[0,0],radius:0}},{computeAABB:function(){this.AABB=[[this.center[0]-this.radius,this.center[1]-this.radius],[this.center[0]+this.radius,this.center[1]+this.radius]]},draw:function(t){var r=this.fixAA?n.fixPos(this.center):this.center;t.beginPath(),t.arc(r[0],r[1],this.radius,0,2*Math.PI,!1),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(){return i.len([this.center[0]-x,this.center[1]-y])<this.radius}});return a}),e("2d/renderable/image",["require","../node","../util","glmatrix"],function(t){var r=t("../node"),n=t("../util"),e=t("glmatrix");e.vec2;var i={},a=r.derive(function(){return{img:"",start:[0,0],size:0,onload:function(){}}},function(){if("string"==typeof this.img){var t=this;this.load(this.img,function(r){t.img=r,t.onload.call(t)})}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(t){var r=this.fixAA?n.fixPos(this.start):this.start;"string"!=typeof this.img&&(this.size?t.drawImage(this.img,r[0],r[1],this.size[0],this.size[1]):t.drawImage(this.img,r[0],r[1]))},intersect:function(t,r){return this.intersectAABB(t,r)},load:function(t,r){if(i[t]){var n=i[t];n.constructor==Array?n.push(r):r(n)}else{i[t]=[r];var n=new a;n.onload=function(){each(i[t],function(t){t(n)}),i[t]=n},n.src=t}}});return a}),e("2d/renderable/line",["require","../node","../util","glmatrix"],function(t){var r=t("../node"),n=t("../util"),e=t("glmatrix"),i=e.vec2,a=r.derive(function(){return{start:[0,0],end:[0,0],width:0}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,this.end]),this.AABB[0][0]==this.AABB[1][0]&&(this.AABB[0][0]-=this.width/2,this.AABB[1][0]+=this.width/2),this.AABB[0][1]==this.AABB[1][1]&&(this.AABB[0][1]-=this.width/2,this.AABB[1][1]+=this.width/2)},draw:function(t){var r=this.fixAA?n.fixPos(this.start):this.start,e=this.fixAA?n.fixPos(this.end):this.end;t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(e[0],e[1]),t.stroke()},intersect:function(t,r){if(!this.intersectAABB(t,r))return!1;var n=[t,r];b=this.start,c=this.end,ba=i.sub([],n,b),bc=i.sub([],c,b);var e=i.dot(bc,ba);i.normalize(bc,bc);var a=i.add(b,i.scale(bc,e)),o=i.length(i.sub(n,n,a));return this.width/2>o}});return a}),e("2d/renderable/path",["require","../node","../util","glmatrix"],function(t){var r=t("../node");t("../util");var n=t("glmatrix"),e=n.vec2,i=r.derive(function(){return{segments:[],globalStyle:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(t){this.globalStyle?this.drawWithSameStyle(t):this.drawWithDifferentStyle(t)},drawWithSameStyle:function(t){var r=this.segments.length,n=this.segments;t.beginPath(),t.moveTo(n[0].point[0],n[0].point[1]);for(var e=1;r>e;e++)if(n[e-1].handleOut||n[e].handleIn){var i=n[e-1].handleOut||n[e-1].point,a=n[e].handleIn||n[e].point;t.bezierCurveTo(i[0],i[1],a[0],a[1],n[e].point[0],n[e].point[1])}else t.lineTo(n[e].point[0],n[e].point[1]);this.fill&&t.fill(),this.stroke&&t.stroke()},drawWithDifferentStyle:function(t){for(var r=this.segments.length,n=this.segments,e=0;r-1>e;e++){if(t.save(),n[e].style&&n[e].style.bind(t),t.beginPath(),t.moveTo(n[e].point[0],n[e].point[1]),n[e].handleOut||n[e+1].handleIn){var i=n[e].handleOut||n[e].point,a=n[e+1].handleIn||n[e+1].point;t.bezierCurveTo(i[0],i[1],a[0],a[1],n[e+1].point[0],n[e+1].point[1])}else t.lineTo(n[e+1].point[0],n[e+1].point[1]);this.stroke&&t.stroke(),this.fill&&t.fill(),t.restore()}},smooth:function(t){function r(t,r,n){var i=e.scale([],e.add([],r,n),.5);return e.sub([],t,i)}for(var n=this.segments.length,i=[],a=this.segments,o=0;n>o;o++){var u=a[o].point,s=o==n-1?a[0].point:a[o+1].point;i.push(e.scale([],e.add([],u,s),.5))}for(var o=0;n>o;o++){var u=a[o].point,c=i[o],f=0==o?i[n-1]:i[o-1],t=a[o].smoothLevel||t||1,l=e.scale([],e.add([],c,f),.5),h=e.sub([],c,l),d=e.sub([],f,l),v=r(u,f,c);e.scale(d,d,t),e.scale(h,h,t),a[o].handleIn=e.add([],e.add([],l,d),v),a[o].handleOut=e.add([],e.add([],l,h),v)}a[0].handleOut=a[0].handleIn=null,a[n-1].handleIn=a[n-1].handleOut=null},pushPoints:function(t){for(var r=0;t.length>r;r++)this.segments.push({point:t[r],handleIn:null,handleOut:null})}});return i}),e("2d/renderable/polygon",["require","../node","../util","glmatrix"],function(t){var r=t("../node"),n=t("../util"),e=t("glmatrix");return e.vec2,r.derive(function(){return{points:[]}},{computeAABB:function(){this.AABB=n.computeAABB(this.points)},draw:function(t){var r=this.fixAA?n.fixPosArray(this.points):this.points;t.beginPath(),t.moveTo(r[0][0],r[0][1]);for(var e=1;r.length>e;e++)t.lineTo(r[e][0],r[e][1]);t.closePath(),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(t,r){if(!this.intersectAABB(t,r))return!1;for(var n,e,i,a,o=this.points.length,u=0,s=this.points,c=0;o>c;c++)n=e.normalize([],[s[c][0]-t,s[c][1]-r]),i=(c+1)%o,e=e.normalize([],[s[i][0]-t,s[i][1]-r]),a=Math.acos(e.dot(n,e)),u+=a;return.001>Math.length(u-2*Math.PI)}}),r}),e("2d/renderable/rectangle",["require","../node","../util","glmatrix"],function(t){var r=t("../node"),n=t("../util"),e=t("glmatrix"),i=e.vec2,a=r.derive(function(){return{start:[0,0],size:[0,0]}},{computeAABB:function(){var t=i.add([],this.start,this.size);this.AABB=n.computeAABB([this.start,t])},draw:function(t){var r=this.fixAA?n.fixPos(this.start):this.start;t.beginPath(),t.rect(r[0],r[1],this.size[0],this.size[1]),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(t,r){return this.intersectAABB(t,r)}});return a}),e("2d/renderable/roundedrectangle",["require","../node","../util","glmatrix"],function(t){var r=t("../node"),n=t("../util"),e=t("glmatrix"),i=e.vec2,a=r.derive(function(){return{start:[0,0],size:[0,0],radius:0}},{computeAABB:function(){var t=i.add([],this.start,this.size);this.AABB=n.computeAABB([this.start,t])},draw:function(t){if(this.radius.constructor==Number)var r=[this.radius,this.radius,this.radius,this.radius];else if(2==this.radius.length)var r=[this.radius[0],this.radius[1],this.radius[0],this.radius[1]];else var r=this.radius;var e=this.fixAA?n.fixPos(this.start):this.start,a=this.size,o=i.add([],e,[r[0],0]),u=i.add([],e,[a[0],0]),s=i.add([],e,a),c=i.add([],e,[0,a[1]]);t.beginPath(),t.moveTo(o[0],o[1]),r[1]?t.arcTo(u[0],u[1],s[0],s[1],r[1]):t.lineTo(u[0],u[1]),r[2]?t.arcTo(s[0],s[1],c[0],c[1],r[2]):t.lineTo(s[0],s[1]),r[3]?t.arcTo(c[0],c[1],e[0],e[1],r[3]):t.lineTo(c[0],c[1]),r[0]?t.arcTo(e[0],e[1],u[0],u[1],r[0]):t.lineTo(e[0],e[1]),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(){return!1}});return a}),e("2d/renderable/sector",["require","../node","../util","glmatrix"],function(t){var r=t("../node"),n=t("../util"),e=t("glmatrix"),i=e.vec2,a=r.derive(function(){return{center:[0,0],innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,clockwise:!0}},{computeAABB:function(){this.AABB=[0,0]},intersect:function(t,r){var n=this.startAngle,e=this.endAngle,a=this.innerRadius,o=this.outerRadius,u=this.center,s=i.sub([],[t,r],u),c=i.length(s),f=2*Math.PI;if(a>c||c>o)return!1;var l=Math.atan2(s[1],s[0]);return 0>l&&(l+=f),this.clockwise?e>l&&l>n:(n=f-n,e=f-e,l>e&&n>l)},draw:function(t){var r=this.startAngle,e=this.endAngle,a=this.innerRadius,o=this.outerRadius,u=this.fixAA?n.fixPos(this.center):this.center;this.clockwise||(r=2*Math.PI-r,e=2*Math.PI-e);var s=i.add([],u,[a*Math.cos(r),a*Math.sin(r)]),c=i.add([],u,[o*Math.cos(r),o*Math.sin(r)]),f=i.add([],u,[a*Math.cos(e),a*Math.sin(e)]);i.add([],u,[o*Math.cos(e),o*Math.sin(e)]),t.beginPath(),t.moveTo(s[0],s[1]),t.lineTo(c[0],c[1]),t.arc(u[0],u[1],o,r,e,!this.clockwise),t.lineTo(f[0],f[1]),t.arc(u[0],u[1],a,e,r,this.clockwise),t.endPath(),this.stroke&&t.stroke(),this.fill&&t.fill()}});return a}),e("2d/renderable/text",["require","../node","../util","glmatrix"],function(t){var r=t("../node"),n=t("../util"),e=t("glmatrix");e.vec2;var i=r.derive(function(){return{text:"",start:[0,0],size:[0,0],font:"",textAlign:"",textBaseline:""}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(t){var r=this.fixAA?n.fixPos(this.start):this.start;this.font&&(t.font=this.font),this.textAlign&&(t.textAlign=this.textAlign),this.textBaseline&&(t.textBaseline=this.textBaseline),this.fill&&(this.size.length&&this.size[0]?t.fillText(this.text,r[0],r[1],this.size[0]):t.fillText(this.text,r[0],r[1])),this.stroke&&(this.size.length&&this.size[0]?t.strokeText(this.text,r[0],r[1],this.size[0]):t.strokeText(this.text,r[0],r[1]))},resize:function(t){(!this.size[0]||this.needResize)&&(this.size[0]=t.measureText(this.text).width,this.size[1]=t.measureText("m").width)
},intersect:function(t,r){return this.intersectAABB(t,r)}});return i}),e("2d/renderable/textbox",["require","../node","../util","glmatrix","./text","_"],function(t){var r=t("../node");t("../util");var n=t("glmatrix"),e=n.vec2,i=t("./text"),a=t("_"),o=r.derive(function(){return{text:"",textAlign:"",textBaseline:"top",font:"",start:[0,0],width:0,wordWrap:!1,wordBreak:!1,lineHeight:0,stroke:!1,_texts:[]}},function(){this._oldText=""},{computeAABB:function(){},draw:function(t){if(this.text!=this._oldText)if(this._oldText=this.text,this.font&&(t.font=this.font),this.wordBreak)this._texts=this.computeWordBreak(t);else if(this.wordWrap)this._texts=this.computeWordWrap(t);else{var r=new i({text:this.text,textBaseline:this.textBaseline});this.extendCommonProperties(r),this._texts=[r]}a.each(this._texts,function(r){r.draw(t)})},computeWordWrap:function(t){if(this.text){for(var r,n,a,o=this.text.split(" "),u=o.length,s=0,c=[],f=0;u>f;f++)n=f==u-1?o[f]:o[f]+" ",r=t.measureText(n).width,s+r>this.width||!a?(a=new i({text:n,start:e.add([],this.start,[0,this.lineHeight*c.length])}),this.extendCommonProperties(a),c.push(a),s=r):(s+=r,a.text+=n);return c}},computeWordBreak:function(t){if(this.text){for(var r,n,a,o=this.text.length,u=t.measureText(this.text[0]).width,s=[],c=0;o>c;c++)if(n=this.text[c],r=t.measureText(n).width,u+r>this.width||!a){var a=new i({text:n,start:e.add([],this.start,[0,this.lineHeight*s.length])});this.extendCommonProperties(a),s.push(a),u=r}else u+=r,a.text+=n;return s}},extendCommonProperties:function(t){a.extend(t,{textAlign:this.textAlign,textBaseline:this.textBaseline,style:this.style,font:this.font,fill:this.fill,stroke:this.stroke})},intersect:function(){}});return o}),e("2d/renderer",["require","core/base"],function(t){var r=t("core/base"),n=r.derive(function(){return{canvas:null,context:null,width:0,height:0,_latestRenderedScene:null}},function(){this.canvas||(this.canvas=document.createElement("canvas")),this.canvas.addEventListener("click",this._clickHandler.bind(this)),this.canvas.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this.canvas.addEventListener("mouseup",this._mouseUpHandler.bind(this)),this.canvas.addEventListener("mousemove",this._mouseMoveHandler.bind(this)),this.canvas.addEventListener("mouseout",this._mouseOutHandler.bind(this)),this.width?this.canvas.width=this.width:this.width=this.canvas.width,this.height?this.canvas.height=this.height:this.height=this.canvas.height,this.context=this.canvas.getContext("2d")},{resize:function(t,r){this.canvas.width=t,this.canvas.height=r},render:function(t){this.context.clearRect(0,0,this.width,this.height),t.render(this.context),this._latestRenderedScene=t},_clickHandler:function(){this._latestRenderedScene},_mouseDownHandler:function(){},_mouseUpHandler:function(){},_mouseMoveHandler:function(){},_mouseOutHandler:function(){}});return n}),e("2d/scene",["require","./node"],function(t){var r=t("./node"),n=r.derive(function(){return{}},{});return n}),e("core/event",["require","./base"],function(t){var r=t("./base"),n=r.derive({cancelBubble:!1},{stopPropagation:function(){this.cancelBubble=!0}});n.throw=function(t,r,n){var e=new MouseEvent(n);for(e.sourceTarget=r;r&&!e.cancelBubble;)e.target=r,r.trigger(t,e),r=r.parent}}),e("core/quaternion",["require","glmatrix"],function(t){var r=t("glmatrix"),n=r.quat,e=function(t,r,e,a){return t=t||0,r=r||0,e=e||0,a=a===void 0?1:a,Object.create(i,{x:{configurable:!1,set:function(t){this._array[0]=t,this._dirty=!0},get:function(){return this._array[0]}},y:{configurable:!1,set:function(t){this._array[1]=t,this._dirty=!0},get:function(){return this._array[1]}},z:{configurable:!1,set:function(t){this._array[2]=t,this._dirty=!0},get:function(){return this._array[2]}},w:{configurable:!1,set:function(t){this._array[2]=t,this._dirty=!0},get:function(){return this._array[2]}},_array:{writable:!1,configurable:!1,value:n.fromValues(t,r,e,a)},_dirty:{configurable:!1,value:!1}})},i={constructor:e,add:function(t){return n.add(this._array,this._array,t._array),this._dirty=!0,this},calculateW:function(){return n.calculateW(this._array,this._array),this._dirty=!0,this},set:function(t,r,n,e){return this._array[0]=t,this._array[1]=r,this._array[2]=n,this._array[3]=e,this._dirty=!0,this},clone:function(){return new e(this.x,this.y,this.z,this.w)},conjugate:function(){return n.conjugate(this._array,this._array),this._dirty=!0,this},copy:function(t){return n.copy(this._array,t._array),this._dirty=!0,this},dot:function(t){return n.dot(this._array,t._array)},fromMat3:function(t){return n.fromMat3(this._array,t._array),this._dirty=!0,this},fromMat4:function(){var t=r.mat3,e=t.create();return function(r){return t.fromMat4(e,r._array),t.transpose(e,e),n.fromMat3(this._array,e),this._dirty=!0,this}}(),identity:function(){return n.identity(this._array),this._dirty=!0,this},invert:function(){return n.invert(this._array,this._array),this._dirty=!0,this},len:function(){return n.len(this._array)},length:function(){return n.length(this._array)},lerp:function(t,r,e){return n.lerp(this._array,t._array,r._array,e),this._dirty=!0,this},mul:function(t){return n.mul(this._array,this._array,t._array),this._dirty=!0,this},multiply:function(t){return n.multiply(this._array,this._array,t._array),this._dirty=!0,this},normalize:function(){return n.normalize(this._array,this._array),this._dirty=!0,this},rotateX:function(t){return n.rotateX(this._array,this._array,t),this._dirty=!0,this},rotateY:function(t){return n.rotateY(this._array,this._array,t),this._dirty=!0,this},rotateZ:function(t){return n.rotateZ(this._array,this._array,t),this._dirty=!0,this},setAxisAngle:function(t,r){return n.setAxisAngle(this._array,t._array,r),this._dirty=!0,this},slerp:function(t,r,e){return n.slerp(this._array,t._array,r._array,e),this._dirty=!0,this},sqrLen:function(){return n.sqrLen(this._array)},squaredLength:function(){return n.squaredLength(this._array)},setFromEuler:function(){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return e}),e("core/request",["require"],function(){function t(t){var r=new XMLHttpRequest;r.open("get",t.url),r.responseType=t.responseType||"text",t.onprogress&&(r.onprogress=function(r){if(r.lengthComputable){var n=r.loaded/r.total;t.onprogress(n,r.loaded,r.total)}else t.onprogress(null)}),r.onload=function(){t.onload&&t.onload(r.response)},t.onerror&&(r.onerror=t.onerror),r.send(null)}function r(){}return{get:t,put:r}}),e("core/vector2",function(){}),e("util/color",["require"],function(){}),e("util/util",["require"],function(){return{genGUID:function(){var t=0;return function(){return++t}}()}}),e("util/xmlparser",["require"],function(){}),e("qtek2d",["require","2d/camera","2d/node","2d/renderable/arc","2d/renderable/circle","2d/renderable/image","2d/renderable/line","2d/renderable/path","2d/renderable/polygon","2d/renderable/rectangle","2d/renderable/roundedrectangle","2d/renderable/sector","2d/renderable/text","2d/renderable/textbox","2d/renderer","2d/scene","2d/style","2d/util","core/base","core/cache","core/event","core/mixin/derive","core/mixin/dirty","core/mixin/notifier","core/quaternion","core/request","core/vector2","util/color","util/util","util/xmlparser","glmatrix"],function(t){var r={"2d":{Camera:t("2d/camera"),Node:t("2d/node"),renderable:{Arc:t("2d/renderable/arc"),Circle:t("2d/renderable/circle"),Image:t("2d/renderable/image"),Line:t("2d/renderable/line"),Path:t("2d/renderable/path"),Polygon:t("2d/renderable/polygon"),Rectangle:t("2d/renderable/rectangle"),RoundedRectangle:t("2d/renderable/roundedrectangle"),Sector:t("2d/renderable/sector"),Text:t("2d/renderable/text"),TextBox:t("2d/renderable/textbox")},Renderer:t("2d/renderer"),Scene:t("2d/scene"),Style:t("2d/style"),util:t("2d/util")},core:{Base:t("core/base"),Cache:t("core/cache"),Event:t("core/event"),mixin:{derive:t("core/mixin/derive"),Dirty:t("core/mixin/dirty"),notifier:t("core/mixin/notifier")},Quaternion:t("core/quaternion"),requester:t("core/request"),Vector2:t("core/vector2")},util:{Color:t("util/color"),Util:t("util/util"),Xmlparser:t("util/xmlparser")}},n=t("glmatrix");return r.math=n,r});var i=n("qtek2d");for(var a in i)t[a]=i[a]});