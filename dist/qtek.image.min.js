(function(t){"undefined"!=typeof define&&define.amd?define(["exports"],t.bind(window)):t(window.qtek={})})(function(t){var e,r,n;(function(t){function i(t,e){return x.call(t,e)}function a(t,e){var r,n,i,a,o,s,u,c,h,l,f=e&&e.split("/"),d=g.map,p=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(e){for(f=f.slice(0,f.length-1),t=f.concat(t.split("/")),c=0;t.length>c;c+=1)if(l=t[c],"."===l)t.splice(c,1),c-=1;else if(".."===l){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((f||p)&&d){for(r=t.split("/"),c=r.length;c>0;c-=1){if(n=r.slice(0,c).join("/"),f)for(h=f.length;h>0;h-=1)if(i=d[f.slice(0,h).join("/")],i&&(i=i[n])){a=i,o=c;break}if(a)break;!s&&p&&p[n]&&(s=p[n],u=c)}!a&&s&&(a=s,o=u),a&&(r.splice(0,o,a),t=r.join("/"))}return t}function o(e,r){return function(){return d.apply(t,b.call(arguments,0).concat([e,r]))}}function s(t){return function(e){return a(e,t)}}function u(t){return function(e){m[t]=e}}function c(e){if(i(_,e)){var r=_[e];delete _[e],y[e]=!0,f.apply(t,r)}if(!i(m,e)&&!i(y,e))throw Error("No "+e);return m[e]}function h(t){var e,r=t?t.indexOf("!"):-1;return r>-1&&(e=t.substring(0,r),t=t.substring(r+1,t.length)),[e,t]}function l(t){return function(){return g&&g.config&&g.config[t]||{}}}var f,d,p,v,m={},_={},g={},y={},x=Object.prototype.hasOwnProperty,b=[].slice;p=function(t,e){var r,n=h(t),i=n[0];return t=n[1],i&&(i=a(i,e),r=c(i)),i?t=r&&r.normalize?r.normalize(t,s(e)):a(t,e):(t=a(t,e),n=h(t),i=n[0],t=n[1],i&&(r=c(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:r}},v={require:function(t){return o(t)},exports:function(t){var e=m[t];return e!==void 0?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:l(t)}}},f=function(e,r,n,a){var s,h,l,f,d,g,x=[];if(a=a||e,"function"==typeof n){for(r=!r.length&&n.length?["require","exports","module"]:r,d=0;r.length>d;d+=1)if(f=p(r[d],a),h=f.f,"require"===h)x[d]=v.require(e);else if("exports"===h)x[d]=v.exports(e),g=!0;else if("module"===h)s=x[d]=v.module(e);else if(i(m,h)||i(_,h)||i(y,h))x[d]=c(h);else{if(!f.p)throw Error(e+" missing "+h);f.p.load(f.n,o(a,!0),u(h),{}),x[d]=m[h]}l=n.apply(m[e],x),e&&(s&&s.exports!==t&&s.exports!==m[e]?m[e]=s.exports:l===t&&g||(m[e]=l))}else e&&(m[e]=n)},e=r=d=function(e,r,n,i,a){return"string"==typeof e?v[e]?v[e](r):c(p(e,r).f):(e.splice||(g=e,r.splice?(e=r,r=n,n=null):e=t),r=r||function(){},"function"==typeof n&&(n=i,i=a),i?f(t,e,r,n):setTimeout(function(){f(t,e,r,n)},4),d)},d.config=function(t){return g=t,g.deps&&d(g.deps,g.callback),d},n=function(t,e,r){e.splice||(r=e,e=[]),i(m,t)||i(_,t)||(_[t]=[t,e,r])},n.amd={jQuery:!0}})(),n("../build/almond",function(){}),n("2d/camera",function(){}),n("core/mixin/derive",[],function(){function t(t,e,r){"object"==typeof e&&(r=e,e=null);var n={"instanceof":function(t){for(var e=a;e;){if(e===t)return!0;e=e.__super__}}},i=this,a=function(r){if(i.call(this),_.extend(this,"function"==typeof t?t.call(this):t),_.extend(this,r),this.constructor==a){for(var n=a,o=[e];n.__super__;)n=n.__super__,o.unshift(n.__initialize__);for(var s=0;o.length>s;s++)o[s]&&o[s].call(this)}};return a.__super__=i,a.__initialize__=e,_.extend(a.prototype,i.prototype,n,r),a.prototype.constructor=a,a.derive=i.derive,a}return{derive:t}}),n("core/mixin/notifier",[],function(){return{trigger:function(){if(this.__handlers__){var t=arguments[0],e=Array.prototype.slice.call(arguments,1),r=this.__handlers__[t];if(r)for(var n=0;r.length>n;n+=2){var i=r[n],a=r[n+1];i.apply(a||this,e)}}},on:function(t,e,r){if(t){var n=this.__handlers__||(this.__handlers__={});return n[t]||(n[t]=[]),-1==n[t].indexOf(e)&&(n[t].push(e),n[t].push(r)),e}},off:function(t,e){var r=this.__handlers__||(this.__handlers__={});if(r[t])if(e){var n=r[t],i=n.indexOf(e);i>=0&&n.splice(i,2)}else r[t]=[]},has:function(t,e){return this.__handlers__&&this.__handlers__[t]?e?-1!==this.__handlers__[t].indexOf(e):this.__handlers__[t].length:!1}}}),n("core/mixin/dirty",{dirty:function(t){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]=!0},fresh:function(t){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]=!1},isDirty:function(t){return this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]===void 0?!0:this._dirtyFlag[t]}}),n("core/cache",[],function(){var t=function(){this._contextId="",this._caches={},this._context={}};return t.prototype={use:function(t,e){if(!this._caches.hasOwnProperty(t)&&(this._caches[t]={},e))for(var r in e)this._caches[t][r]=e[r];this._contextId=t,this._context=this._caches[t]},put:function(t,e){this._context[t]=e},get:function(t){return this._context[t]},clearContext:function(){this._caches[this._contextId]={},this._context={}},"delete":function(t){delete this._context[t]},clearAll:function(){this._caches={}},getContext:function(){return this._context},miss:function(t){return!this._context.hasOwnProperty(t)}},t.prototype.constructor=t,t}),function(t){function e(n){function i(t){return t&&"object"==typeof t&&!xn(t)&&Zr.call(t,"__wrapped__")?t:new F(t)}function o(t,e,r){var n=t.length,i=n-e>=r;if(i)for(var a={},o=e-1;n>++o;){var s=qr(t[o]);(Zr.call(a,s)?a[s]:a[s]=[]).push(t[o])}return function(r){if(i){var n=qr(r);return Zr.call(a,n)&&Ge(a[n],r)>-1}return Ge(t,r,e)>-1}}function U(t){return t.charCodeAt(0)}function k(t,e){var n=t.index,i=e.index;if(t=t.criteria,e=e.criteria,t!==e){if(t>e||t===r)return 1;if(e>t||e===r)return-1}return i>n?-1:1}function L(t,e,r,n){function i(){var n=arguments,c=o?this:e;if(a||(t=e[s]),r.length&&(n=n.length?(n=X(n),u?n.concat(r):r.concat(n)):r),this instanceof i){j.prototype=t.prototype,c=new j,j.prototype=null;var h=t.apply(c,n);return ue(h)?h:c}return t.apply(c,n)}var a=se(t),o=!r,s=e;if(o){var u=n;r=e}else if(!a){if(!n)throw new zr;e=t}return i}function W(){for(var t,e={shadowedProps:b,arrays:"isArray(iterable)",bottom:"",init:"iterable",loop:"",top:"",useHas:!0,useKeys:!!En},r=0;t=arguments[r];r++)for(var n in t)e[n]=t[n];var a=e.args;e.firstArg=/^[^,]+/.exec(a)[0];var o=Br("hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectTypes","return function("+a+") {\n"+mn(e)+"\n}");return o(Zr,J,xn,de,En,i,N)}function q(t){return"\\"+C[t]}function z(t){return An[t]}function V(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function F(t){this.__wrapped__=t}function j(){}function G(t){var e=!1;if(!t||en.call(t)!=P||!vn.argsClass&&J(t))return e;var r=t.constructor;return(se(r)?r instanceof r:vn.nodeClass||!V(t))?vn.ownLast?(In(t,function(t,r,n){return e=Zr.call(n,r),!1}),e===!0):(In(t,function(t,r){e=r}),e===!1||Zr.call(t,e)):e}function X(t,e,n){e||(e=0),n===r&&(n=t?t.length:0);for(var i=-1,a=n-e||0,o=Mr(0>a?0:a);a>++i;)o[i]=t[e+i];return o}function H(t){return wn[t]}function J(t){return en.call(t)==T}function Y(t,e,n,a,o,s){var u=t;if("function"==typeof e&&(a=n,n=e,e=!1),"function"==typeof n){if(n=a===r?n:i.createCallback(n,a,1),u=n(u),u!==r)return u;u=t}var c=ue(u);if(c){var h=en.call(u);if(!M[h]||!vn.nodeClass&&V(u))return u;var l=xn(u)}if(!c||!e)return c?l?X(u):Rn({},u):u;var f=pn[h];switch(h){case w:case R:return new f(+u);case I:case D:return new f(u);case S:return f(u.source,p.exec(u))}o||(o=[]),s||(s=[]);for(var d=o.length;d--;)if(o[d]==t)return s[d];return u=l?f(u.length):{},l&&(Zr.call(t,"index")&&(u.index=t.index),Zr.call(t,"input")&&(u.input=t.input)),o.push(t),s.push(u),(l?Re:Pn)(t,function(t,i){u[i]=Y(t,e,n,r,o,s)}),u}function Q(t,e,r){return Y(t,!0,e,r)}function Z(t,e,n){var a;return e=i.createCallback(e,n),Pn(t,function(t,n,i){return e(t,n,i)?(a=n,!1):r}),a}function $(t){var e=[];return In(t,function(t,r){se(t)&&e.push(r)}),e.sort()}function K(t,e){return t?Zr.call(t,e):!1}function te(t){for(var e=-1,r=En(t),n=r.length,i={};n>++e;){var a=r[e];i[t[a]]=a}return i}function ee(t){return t===!0||t===!1||en.call(t)==w}function re(t){return t instanceof Cr||en.call(t)==R}function ne(t){return t?1===t.nodeType:!1}function ie(t){var e=!0;if(!t)return e;var r=en.call(t),n=t.length;return r==A||r==D||(vn.argsClass?r==T:J(t))||r==P&&"number"==typeof n&&se(t.splice)?!n:(Pn(t,function(){return e=!1}),e)}function ae(t,e,n,a,o,s){var c=n===u;if(n&&!c){n=a===r?n:i.createCallback(n,a,2);var h=n(t,e);if(h!==r)return!!h}if(t===e)return 0!==t||1/t==1/e;var l=typeof t,f=typeof e;if(t===t&&(!t||"function"!=l&&"object"!=l)&&(!e||"function"!=f&&"object"!=f))return!1;if(null==t||null==e)return t===e;var d=en.call(t),p=en.call(e);if(d==T&&(d=P),p==T&&(p=P),d!=p)return!1;switch(d){case w:case R:return+t==+e;case I:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case S:case D:return t==qr(e)}var v=d==A;if(!v){if(Zr.call(t,"__wrapped__ ")||Zr.call(e,"__wrapped__"))return ae(t.__wrapped__||t,e.__wrapped__||e,n,a,o,s);if(d!=P||!vn.nodeClass&&(V(t)||V(e)))return!1;var m=!vn.argsObject&&J(t)?Lr:t.constructor,_=!vn.argsObject&&J(e)?Lr:e.constructor;if(m!=_&&!(se(m)&&m instanceof m&&se(_)&&_ instanceof _))return!1}o||(o=[]),s||(s=[]);for(var g=o.length;g--;)if(o[g]==t)return s[g]==e;var y=0;if(h=!0,o.push(t),s.push(e),v){if(g=t.length,y=e.length,h=y==t.length,!h&&!c)return h;for(;y--;){var x=g,b=e[y];if(c)for(;x--&&!(h=ae(t[x],b,n,a,o,s)););else if(!(h=ae(t[y],b,n,a,o,s)))break}return h}return In(e,function(e,i,u){return Zr.call(u,i)?(y++,h=Zr.call(t,i)&&ae(t[i],e,n,a,o,s)):r}),h&&!c&&In(t,function(t,e,n){return Zr.call(n,e)?h=--y>-1:r}),h}function oe(t){return an(t)&&!on(parseFloat(t))}function se(t){return"function"==typeof t}function ue(t){return t?N[typeof t]:!1}function ce(t){return le(t)&&t!=+t}function he(t){return null===t}function le(t){return"number"==typeof t||en.call(t)==I}function fe(t){return t instanceof Wr||en.call(t)==S}function de(t){return"string"==typeof t||en.call(t)==D}function pe(t){return t===r}function ve(t,e,n){var a=arguments,o=0,s=2;if(!ue(t))return t;if(n===u)var c=a[3],h=a[4],l=a[5];else h=[],l=[],"number"!=typeof n&&(s=a.length),s>3&&"function"==typeof a[s-2]?c=i.createCallback(a[--s-1],a[s--],2):s>2&&"function"==typeof a[s-1]&&(c=a[--s]);for(;s>++o;)(xn(a[o])?Re:Pn)(a[o],function(e,n){var i,a,o=e,s=t[n];if(e&&((a=xn(e))||Sn(e))){for(var f=h.length;f--;)if(i=h[f]==e){s=l[f];break}i||(s=a?xn(s)?s:[]:Sn(s)?s:{},c&&(o=c(s,e),o!==r&&(s=o)),h.push(e),l.push(s),c||(s=ve(s,e,u,c,h,l)))}else c&&(o=c(s,e),o===r&&(o=e)),o!==r&&(s=o);t[n]=s});return t}function me(t,e,r){var n="function"==typeof e,a={};if(n)e=i.createCallback(e,r);else var o=Jr.apply(Vr,arguments);return In(t,function(t,r,i){(n?!e(t,r,i):0>Ge(o,r,1))&&(a[r]=t)}),a}function _e(t){for(var e=-1,r=En(t),n=r.length,i=Mr(n);n>++e;){var a=r[e];i[e]=[a,t[a]]}return i}function ge(t,e,r){var n={};if("function"!=typeof e)for(var a=0,o=Jr.apply(Vr,arguments),s=ue(t)?o.length:0;s>++a;){var u=o[a];u in t&&(n[u]=t[u])}else e=i.createCallback(e,r),In(t,function(t,r,i){e(t,r,i)&&(n[r]=t)});return n}function ye(t){for(var e=-1,r=En(t),n=r.length,i=Mr(n);n>++e;)i[e]=t[r[e]];return i}function xe(t){var e=-1,r=Jr.apply(Vr,X(arguments,1)),n=r.length,i=Mr(n);for(vn.unindexedChars&&de(t)&&(t=t.split(""));n>++e;)i[e]=t[r[e]];return i}function be(t,e,n){var i=-1,a=t?t.length:0,o=!1;return n=(0>n?un(0,a+n):n)||0,"number"==typeof a?o=(de(t)?t.indexOf(e,n):Ge(t,e,n))>-1:Tn(t,function(t){return++i>=n?!(o=t===e):r}),o}function Ee(t,e,r){var n={};return e=i.createCallback(e,r),Re(t,function(t,r,i){r=qr(e(t,r,i)),Zr.call(n,r)?n[r]++:n[r]=1}),n}function Te(t,e,r){var n=!0;if(e=i.createCallback(e,r),xn(t))for(var a=-1,o=t.length;o>++a&&(n=!!e(t[a],a,t)););else Tn(t,function(t,r,i){return n=!!e(t,r,i)});return n}function Ae(t,e,r){var n=[];if(e=i.createCallback(e,r),xn(t))for(var a=-1,o=t.length;o>++a;){var s=t[a];e(s,a,t)&&n.push(s)}else Tn(t,function(t,r,i){e(t,r,i)&&n.push(t)});return n}function we(t,e,n){if(e=i.createCallback(e,n),!xn(t)){var a;return Tn(t,function(t,n,i){return e(t,n,i)?(a=t,!1):r}),a}for(var o=-1,s=t.length;s>++o;){var u=t[o];if(e(u,o,t))return u}}function Re(t,e,n){if(e&&n===r&&xn(t))for(var i=-1,a=t.length;a>++i&&e(t[i],i,t)!==!1;);else Tn(t,e,n);return t}function Oe(t,e,r){var n={};return e=i.createCallback(e,r),Re(t,function(t,r,i){r=qr(e(t,r,i)),(Zr.call(n,r)?n[r]:n[r]=[]).push(t)}),n}function Ie(t,e){var r=X(arguments,2),n=-1,i="function"==typeof e,a=t?t.length:0,o=Mr("number"==typeof a?a:0);return Re(t,function(t){o[++n]=(i?e:t[e]).apply(t,r)}),o}function Pe(t,e,r){var n=-1,a=t?t.length:0,o=Mr("number"==typeof a?a:0);if(e=i.createCallback(e,r),xn(t))for(;a>++n;)o[n]=e(t[n],n,t);else Tn(t,function(t,r,i){o[++n]=e(t,r,i)});return o}function Se(t,e,r){var n=-1/0,a=n;if(!e&&xn(t))for(var o=-1,s=t.length;s>++o;){var u=t[o];u>a&&(a=u)}else e=!e&&de(t)?U:i.createCallback(e,r),Tn(t,function(t,r,i){var o=e(t,r,i);o>n&&(n=o,a=t)});return a}function De(t,e,r){var n=1/0,a=n;if(!e&&xn(t))for(var o=-1,s=t.length;s>++o;){var u=t[o];a>u&&(a=u)}else e=!e&&de(t)?U:i.createCallback(e,r),Tn(t,function(t,r,i){var o=e(t,r,i);n>o&&(n=o,a=t)});return a}function Me(t,e,r,n){var a=3>arguments.length;if(e=i.createCallback(e,n,4),xn(t)){var o=-1,s=t.length;for(a&&(r=t[++o]);s>++o;)r=e(r,t[o],o,t)}else Tn(t,function(t,n,i){r=a?(a=!1,t):e(r,t,n,i)});return r}function Ne(t,e,r,n){var a=t,o=t?t.length:0,s=3>arguments.length;if("number"!=typeof o){var u=En(t);o=u.length}else vn.unindexedChars&&de(t)&&(a=t.split(""));return e=i.createCallback(e,n,4),Re(t,function(t,n,i){n=u?u[--o]:--o,r=s?(s=!1,a[n]):e(r,a[n],n,i)}),r}function Ce(t,e,r){return e=i.createCallback(e,r),Ae(t,function(t,r,n){return!e(t,r,n)})}function Be(t){var e=-1,r=t?t.length:0,n=Mr("number"==typeof r?r:0);return Re(t,function(t){var r=Yr(ln()*(++e+1));n[e]=n[r],n[r]=t}),n}function Ue(t){var e=t?t.length:0;return"number"==typeof e?e:En(t).length}function ke(t,e,r){var n;if(e=i.createCallback(e,r),xn(t))for(var a=-1,o=t.length;o>++a&&!(n=e(t[a],a,t)););else Tn(t,function(t,r,i){return!(n=e(t,r,i))});return!!n}function Le(t,e,r){var n=-1,a=t?t.length:0,o=Mr("number"==typeof a?a:0);for(e=i.createCallback(e,r),Re(t,function(t,r,i){o[++n]={criteria:e(t,r,i),index:n,value:t}}),a=o.length,o.sort(k);a--;)o[a]=o[a].value;return o}function We(t){return t&&"number"==typeof t.length?vn.unindexedChars&&de(t)?t.split(""):X(t):ye(t)}function qe(t){for(var e=-1,r=t?t.length:0,n=[];r>++e;){var i=t[e];i&&n.push(i)}return n}function ze(t){for(var e=-1,r=t?t.length:0,n=Jr.apply(Vr,arguments),i=o(n,r,100),a=[];r>++e;){var s=t[e];i(s)||a.push(s)}return a}function Ve(t,e,r){var n=-1,a=t?t.length:0;for(e=i.createCallback(e,r);a>++n;)if(e(t[n],n,t))return n;return-1}function Fe(t,e,r){if(t){var n=0,a=t.length;if("number"!=typeof e&&null!=e){var o=-1;for(e=i.createCallback(e,r);a>++o&&e(t[o],o,t);)n++}else if(n=e,null==n||r)return t[0];return X(t,0,cn(un(0,n),a))}}function je(t,e,r,n){var a=-1,o=t?t.length:0,s=[];for("boolean"!=typeof e&&null!=e&&(n=r,r=e,e=!1),null!=r&&(r=i.createCallback(r,n));o>++a;){var u=t[a];r&&(u=r(u,a,t)),xn(u)?$r.apply(s,e?u:je(u)):s.push(u)}return s}function Ge(t,e,r){var n=-1,i=t?t.length:0;if("number"==typeof r)n=(0>r?un(0,i+r):r||0)-1;else if(r)return n=$e(t,e),t[n]===e?n:-1;for(;i>++n;)if(t[n]===e)return n;return-1}function Xe(t,e,r){if(!t)return[];var n=0,a=t.length;if("number"!=typeof e&&null!=e){var o=a;for(e=i.createCallback(e,r);o--&&e(t[o],o,t);)n++}else n=null==e||r?1:e||n;return X(t,0,cn(un(0,a-n),a))}function He(t){var e=arguments,r=e.length,n={0:{}},i=-1,a=t?t.length:0,s=a>=100,u=[],c=u;t:for(;a>++i;){var h=t[i];if(s)var l=qr(h),f=Zr.call(n[0],l)?!(c=n[0][l]):c=n[0][l]=[];if(f||0>Ge(c,h)){s&&c.push(h);for(var d=r;--d;)if(!(n[d]||(n[d]=o(e[d],0,100)))(h))continue t;u.push(h)}}return u}function Je(t,e,r){if(t){var n=0,a=t.length;if("number"!=typeof e&&null!=e){var o=a;for(e=i.createCallback(e,r);o--&&e(t[o],o,t);)n++}else if(n=e,null==n||r)return t[a-1];return X(t,un(0,a-n))}}function Ye(t,e,r){var n=t?t.length:0;for("number"==typeof r&&(n=(0>r?un(0,n+r):cn(r,n-1))+1);n--;)if(t[n]===e)return n;return-1}function Qe(t,e,r){t=+t||0,r=+r||1,null==e&&(e=t,t=0);for(var n=-1,i=un(0,Xr((e-t)/r)),a=Mr(i);i>++n;)a[n]=t,t+=r;return a}function Ze(t,e,r){if("number"!=typeof e&&null!=e){var n=0,a=-1,o=t?t.length:0;for(e=i.createCallback(e,r);o>++a&&e(t[a],a,t);)n++}else n=null==e||r?1:un(0,e);return X(t,n)}function $e(t,e,r,n){var a=0,o=t?t.length:a;for(r=r?i.createCallback(r,n,1):xr,e=r(e);o>a;){var s=a+o>>>1;e>r(t[s])?a=s+1:o=s}return a}function Ke(){return tr(Jr.apply(Vr,arguments))}function tr(t,e,r,n){var a=-1,o=t?t.length:0,s=[],u=s;"boolean"!=typeof e&&null!=e&&(n=r,r=e,e=!1);var c=!e&&o>=75;if(c)var h={};for(null!=r&&(u=[],r=i.createCallback(r,n));o>++a;){var l=t[a],f=r?r(l,a,t):l;if(c)var d=qr(f),p=Zr.call(h,d)?!(u=h[d]):u=h[d]=[];(e?!a||u[u.length-1]!==f:p||0>Ge(u,f))&&((r||c)&&u.push(f),s.push(l))}return s}function er(t){for(var e=-1,r=t?t.length:0,n=o(arguments,1,30),i=[];r>++e;){var a=t[e];n(a)||i.push(a)}return i}function rr(t){for(var e=-1,r=t?Se(Dn(arguments,"length")):0,n=Mr(r);r>++e;)n[e]=Dn(arguments,e);return n}function nr(t,e){for(var r=-1,n=t?t.length:0,i={};n>++r;){var a=t[r];e?i[a]=e[r]:i[a[0]]=a[1]}return i}function ir(t,e){return 1>t?e():function(){return 1>--t?e.apply(this,arguments):r}}function ar(t,e){return vn.fastBind||rn&&arguments.length>2?rn.call.apply(rn,arguments):L(t,e,X(arguments,2))}function or(t){for(var e=Jr.apply(Vr,arguments),r=e.length>1?0:(e=$(t),-1),n=e.length;n>++r;){var i=e[r];t[i]=ar(t[i],t)}return t}function sr(t,e){return L(t,e,X(arguments,2),u)}function ur(){var t=arguments;return function(){for(var e=arguments,r=t.length;r--;)e=[t[r].apply(this,e)];return e[0]}}function cr(t,e,n){if(null==t)return xr;var i=typeof t;if("function"!=i){if("object"!=i)return function(e){return e[t]};var a=En(t);return function(e){for(var r=a.length,n=!1;r--&&(n=ae(e[a[r]],t[a[r]],u)););return n}}return e!==r?1===n?function(r){return t.call(e,r)}:2===n?function(r,n){return t.call(e,r,n)}:4===n?function(r,n,i,a){return t.call(e,r,n,i,a)}:function(r,n,i){return t.call(e,r,n,i)}:t}function hr(t,e,r){function n(){s=null,r||(a=t.apply(o,i))}var i,a,o,s;return function(){var u=r&&!s;return i=arguments,o=this,Hr(s),s=tn(n,e),u&&(a=t.apply(o,i)),a}}function lr(t){var e=X(arguments,1);return tn(function(){t.apply(r,e)},1)}function fr(t,e){var n=X(arguments,2);return tn(function(){t.apply(r,n)},e)}function dr(t,e){var r={};return function(){var n=qr(e?e.apply(this,arguments):arguments[0]);return Zr.call(r,n)?r[n]:r[n]=t.apply(this,arguments)}}function pr(t){var e,r;return function(){return e?r:(e=!0,r=t.apply(this,arguments),t=null,r)}}function vr(t){return L(t,X(arguments,1))}function mr(t){return L(t,X(arguments,1),null,u)}function _r(t,e){function r(){s=new Cr,o=null,i=t.apply(a,n)}var n,i,a,o,s=0;return function(){var u=new Cr,c=e-(u-s);return n=arguments,a=this,0>=c?(Hr(o),o=null,s=u,i=t.apply(a,n)):o||(o=tn(r,c)),i}}function gr(t,e){return function(){var r=[t];return $r.apply(r,arguments),e.apply(this,r)}}function yr(t){return null==t?"":qr(t).replace(g,z)}function xr(t){return t}function br(t){Re($(t),function(e){var r=i[e]=t[e];i.prototype[e]=function(){var t=this.__wrapped__,e=[t];$r.apply(e,arguments);var n=r.apply(i,e);return t&&"object"==typeof t&&t==n?this:new F(n)}})}function Er(){return n._=jr,this}function Tr(t,e){return null==t&&null==e&&(e=1),t=+t||0,null==e&&(e=t,t=0),t+Yr(ln()*((+e||0)-t+1))}function Ar(t,e){var n=t?t[e]:r;return se(n)?t[e]():n}function wr(t,e,n){var a=i.templateSettings;t||(t=""),n=On({},n,a);var o,s=On({},n.imports,a.imports),u=En(s),f=ye(s),p=0,m=n.interpolate||_,g="__p += '",x=Wr((n.escape||_).source+"|"+m.source+"|"+(m===v?d:_).source+"|"+(n.evaluate||_).source+"|$","g");t.replace(x,function(e,r,n,i,a,s){return n||(n=i),g+=t.slice(p,s).replace(y,q),r&&(g+="' +\n__e("+r+") +\n'"),a&&(o=!0,g+="';\n"+a+";\n__p += '"),n&&(g+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),p=s+e.length,e}),g+="';\n";var b=n.variable,T=b;T||(b="obj",g="with ("+b+") {\n"+g+"\n}\n"),g=(o?g.replace(c,""):g).replace(h,"$1").replace(l,"$1;"),g="function("+b+") {\n"+(T?"":b+" || ("+b+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+g+"return __p\n}";var A="\n/*\n//@ sourceURL="+(n.sourceURL||"/lodash/template/source["+E++ +"]")+"\n*/";try{var w=Br(u,"return "+g+A).apply(r,f)}catch(R){throw R.source=g,R}return e?w(e):(w.source=g,w)}function Rr(t,e,r){t=(t=+t)>-1?t:0;var n=-1,a=Mr(t);for(e=i.createCallback(e,r,1);t>++n;)a[n]=e(n);return a}function Or(t){return null==t?"":qr(t).replace(f,H)}function Ir(t){var e=++s;return qr(null==t?"":t)+e}function Pr(t,e){return e(t),t}function Sr(){return qr(this.__wrapped__)}function Dr(){return this.__wrapped__}n=n?B.defaults(t.Object(),n,B.pick(t,x)):t;var Mr=n.Array,Nr=n.Boolean,Cr=n.Date,Br=n.Function,Ur=n.Math,kr=n.Number,Lr=n.Object,Wr=n.RegExp,qr=n.String,zr=n.TypeError,Vr=Mr(),Fr=Lr(),jr=n._,Gr=Wr("^"+qr(Fr.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),Xr=Ur.ceil,Hr=n.clearTimeout,Jr=Vr.concat,Yr=Ur.floor,Qr=Gr.test(Qr=Lr.getPrototypeOf)&&Qr,Zr=Fr.hasOwnProperty,$r=Vr.push,Kr=n.setImmediate,tn=n.setTimeout,en=Fr.toString,rn=Gr.test(rn=X.bind)&&rn,nn=Gr.test(nn=Mr.isArray)&&nn,an=n.isFinite,on=n.isNaN,sn=Gr.test(sn=Lr.keys)&&sn,un=Ur.max,cn=Ur.min,hn=n.parseInt,ln=Ur.random,fn=Gr.test(n.attachEvent),dn=rn&&!/\n|true/.test(rn+fn),pn={};pn[A]=Mr,pn[w]=Nr,pn[R]=Cr,pn[P]=Lr,pn[I]=kr,pn[S]=Wr,pn[D]=qr;var vn=i.support={};(function(){var t=function(){this.x=1},e={0:1,length:1},r=[];t.prototype={valueOf:1,y:1};for(var n in new t)r.push(n);for(n in arguments);vn.argsObject=arguments.constructor==Lr,vn.argsClass=J(arguments),vn.enumPrototypes=t.propertyIsEnumerable("prototype"),vn.fastBind=rn&&!dn,vn.ownLast="x"!=r[0],vn.nonEnumArgs=0!=n,vn.nonEnumShadows=!/valueOf/.test(r),vn.spliceObjects=(Vr.splice.call(e,0,1),!e[0]),vn.unindexedChars="xx"!="x"[0]+Lr("x")[0];try{vn.nodeClass=!(en.call(document)==P&&!({toString:0}+""))}catch(i){vn.nodeClass=!0}})(1),i.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:v,variable:"",imports:{_:i}};var mn=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";\n";if(t.arrays?(e+="var length = iterable.length; index = -1;\nif ("+t.arrays+") {  ",vn.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+"\n  }\n}\nelse {  "):vn.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+"\n    }\n  } else {  "),vn.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    ",vn.enumPrototypes&&(e+="if (!(skipProto && index == 'prototype')) {\n  "),e+=t.loop,vn.enumPrototypes&&(e+="}\n"),e+="  }  ";else if(e+="\n  for (index in iterable) {",(vn.enumPrototypes||t.useHas)&&(e+="\n    if (",vn.enumPrototypes&&(e+="!(skipProto && index == 'prototype')"),vn.enumPrototypes&&t.useHas&&(e+=" && "),t.useHas&&(e+="hasOwnProperty.call(iterable, index)"),e+=") {    "),e+=t.loop+";    ",(vn.enumPrototypes||t.useHas)&&(e+="\n    }"),e+="\n  }    ",vn.nonEnumShadows){e+="\n\n  var ctor = iterable.constructor;\n      ";for(var r=0;7>r;r++)e+="\n  index = '"+t.shadowedProps[r]+"';\n  if (","constructor"==t.shadowedProps[r]&&(e+="!(ctor && ctor.prototype === iterable) && "),e+="hasOwnProperty.call(iterable, index)) {\n    "+t.loop+"\n  }      "}return(t.arrays||vn.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},_n={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},gn={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",arrays:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},yn={top:"if (!objectTypes[typeof iterable]) return result;\n"+gn.top,arrays:!1};F.prototype=i.prototype,vn.argsClass||(J=function(t){return t?Zr.call(t,"callee"):!1});var xn=nn||function(t){return vn.argsObject&&t instanceof Mr||en.call(t)==A},bn=W({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)",arrays:!1}),En=sn?function(t){return ue(t)?vn.enumPrototypes&&"function"==typeof t||vn.nonEnumArgs&&t.length&&J(t)?bn(t):sn(t):[]}:bn,Tn=W(gn),An={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},wn=te(An),Rn=W(_n,{top:_n.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),On=W(_n),In=W(gn,yn,{useHas:!1}),Pn=W(gn,yn);se(/x/)&&(se=function(t){return t instanceof Br||en.call(t)==O});var Sn=Qr?function(t){if(!t||en.call(t)!=P||!vn.argsClass&&J(t))return!1;var e=t.valueOf,r="function"==typeof e&&(r=Qr(e))&&Qr(r);return r?t==r||Qr(t)==r:G(t)}:G,Dn=Pe,Mn=Ae;dn&&a&&"function"==typeof Kr&&(lr=ar(Kr,n));var Nn=8==hn("08")?hn:function(t,e){return hn(de(t)?t.replace(m,""):t,e||0)};return i.after=ir,i.assign=Rn,i.at=xe,i.bind=ar,i.bindAll=or,i.bindKey=sr,i.compact=qe,i.compose=ur,i.countBy=Ee,i.createCallback=cr,i.debounce=hr,i.defaults=On,i.defer=lr,i.delay=fr,i.difference=ze,i.filter=Ae,i.flatten=je,i.forEach=Re,i.forIn=In,i.forOwn=Pn,i.functions=$,i.groupBy=Oe,i.initial=Xe,i.intersection=He,i.invert=te,i.invoke=Ie,i.keys=En,i.map=Pe,i.max=Se,i.memoize=dr,i.merge=ve,i.min=De,i.omit=me,i.once=pr,i.pairs=_e,i.partial=vr,i.partialRight=mr,i.pick=ge,i.pluck=Dn,i.range=Qe,i.reject=Ce,i.rest=Ze,i.shuffle=Be,i.sortBy=Le,i.tap=Pr,i.throttle=_r,i.times=Rr,i.toArray=We,i.union=Ke,i.uniq=tr,i.values=ye,i.where=Mn,i.without=er,i.wrap=gr,i.zip=rr,i.zipObject=nr,i.collect=Pe,i.drop=Ze,i.each=Re,i.extend=Rn,i.methods=$,i.object=nr,i.select=Ae,i.tail=Ze,i.unique=tr,br(i),i.clone=Y,i.cloneDeep=Q,i.contains=be,i.escape=yr,i.every=Te,i.find=we,i.findIndex=Ve,i.findKey=Z,i.has=K,i.identity=xr,i.indexOf=Ge,i.isArguments=J,i.isArray=xn,i.isBoolean=ee,i.isDate=re,i.isElement=ne,i.isEmpty=ie,i.isEqual=ae,i.isFinite=oe,i.isFunction=se,i.isNaN=ce,i.isNull=he,i.isNumber=le,i.isObject=ue,i.isPlainObject=Sn,i.isRegExp=fe,i.isString=de,i.isUndefined=pe,i.lastIndexOf=Ye,i.mixin=br,i.noConflict=Er,i.parseInt=Nn,i.random=Tr,i.reduce=Me,i.reduceRight=Ne,i.result=Ar,i.runInContext=e,i.size=Ue,i.some=ke,i.sortedIndex=$e,i.template=wr,i.unescape=Or,i.uniqueId=Ir,i.all=Te,i.any=ke,i.detect=we,i.foldl=Me,i.foldr=Ne,i.include=be,i.inject=Me,Pn(i,function(t,e){i.prototype[e]||(i.prototype[e]=function(){var e=[this.__wrapped__];return $r.apply(e,arguments),t.apply(i,e)})}),i.first=Fe,i.last=Je,i.take=Fe,i.head=Fe,Pn(i,function(t,e){i.prototype[e]||(i.prototype[e]=function(e,r){var n=t(this.__wrapped__,e,r);return null==e||r&&"function"!=typeof e?n:new F(n)})}),i.VERSION="1.1.1",i.prototype.toString=Sr,i.prototype.value=Dr,i.prototype.valueOf=Dr,Tn(["join","pop","shift"],function(t){var e=Vr[t];i.prototype[t]=function(){return e.apply(this.__wrapped__,arguments)}}),Tn(["push","reverse","sort","unshift"],function(t){var e=Vr[t];i.prototype[t]=function(){return e.apply(this.__wrapped__,arguments),this}}),Tn(["concat","slice","splice"],function(t){var e=Vr[t];i.prototype[t]=function(){return new F(e.apply(this.__wrapped__,arguments))}}),vn.spliceObjects||Tn(["pop","shift","splice"],function(t){var e=Vr[t],r="splice"==t;i.prototype[t]=function(){var t=this.__wrapped__,n=e.apply(t,arguments);return 0===t.length&&delete t[0],r?new F(n):n}}),i}var r,i="object"==typeof exports&&exports,a="object"==typeof module&&module&&module.exports==i&&module,o="object"==typeof global&&global;o.global===o&&(t=o);var s=0,u={},c=/\b__p \+= '';/g,h=/\b(__p \+=) '' \+/g,l=/(__e\(.*?\)|\b__t\)) \+\n'';/g,f=/&(?:amp|lt|gt|quot|#39);/g,d=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,p=/\w*$/,v=/<%=([\s\S]+?)%>/g,m=/^0+(?=.$)/,_=/($^)/,g=/[&<>"']/g,y=/['\n\r\t\u2028\u2029\\]/g,x=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],b=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],E=0,T="[object Arguments]",A="[object Array]",w="[object Boolean]",R="[object Date]",O="[object Function]",I="[object Number]",P="[object Object]",S="[object RegExp]",D="[object String]",M={};M[O]=!1,M[T]=M[A]=M[w]=M[R]=M[I]=M[P]=M[S]=M[D]=!0;var N={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},C={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},B=e();"function"==typeof n&&"object"==typeof n.amd&&n.amd?(t._=B,n("_",[],function(){return B})):i&&!i.nodeType?a?(a.exports=B)._=B:i._=B:t._=B}(this),n("core/base",["require","./mixin/derive","./mixin/notifier","./mixin/dirty","./cache","_"],function(t){var e=t("./mixin/derive"),r=t("./mixin/notifier"),n=t("./mixin/dirty"),i=t("./cache"),a=t("_"),o=function(){this.cache=new i};return a.extend(o,e),a.extend(o.prototype,r),a.extend(o.prototype,n),o}),function(t){var e={};"undefined"==typeof exports?"function"==typeof n&&"object"==typeof n.amd&&n.amd?(e.exports={},n("glmatrix",[],function(){return e.exports})):e.exports="undefined"!=typeof window?window:t:e.exports=exports,function(t){if(!e)var e=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!n)var n=Math.random;var i={};i.setMatrixArrayType=function(t){r=t},t!==void 0&&(t.glMatrix=i);var a={};a.create=function(){var t=new r(2);return t[0]=0,t[1]=0,t},a.clone=function(t){var e=new r(2);return e[0]=t[0],e[1]=t[1],e},a.fromValues=function(t,e){var n=new r(2);return n[0]=t,n[1]=e,n},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},a.set=function(t,e,r){return t[0]=e,t[1]=r,t},a.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},a.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},a.sub=a.subtract,a.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},a.mul=a.multiply,a.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},a.div=a.divide,a.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},a.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},a.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},a.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},a.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)},a.dist=a.distance,a.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},a.len=a.length,a.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},a.normalize=function(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},a.cross=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},a.lerp=function(t,e,r,n){var i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t},a.random=function(t,e){e=e||1;var r=2*n()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},a.transformMat2=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t},a.transformMat2d=function(t,e,r){var n=e[0],i=e[1];
return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t},a.transformMat3=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t},a.transformMat4=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t},a.forEach=function(){var t=a.create();return function(e,r,n,i,a,o){var s,u;for(r||(r=2),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;u>s;s+=r)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}(),a.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},t!==void 0&&(t.vec2=a);var o={};o.create=function(){var t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var e=new r(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.fromValues=function(t,e,n){var i=new r(3);return i[0]=t,i[1]=e,i[2]=n,i},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},o.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},o.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},o.sub=o.subtract,o.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},o.mul=o.multiply,o.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},o.div=o.divide,o.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},o.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},o.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},o.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},o.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)},o.dist=o.distance,o.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},o.len=o.length,o.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},o.cross=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t},o.lerp=function(t,e,r,n){var i=e[0],a=e[1],o=e[2];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t},o.random=function(t,e){e=e||1;var r=2*n()*Math.PI,i=2*n()-1,a=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=i*e,t},o.transformMat4=function(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12],t[1]=r[1]*n+r[5]*i+r[9]*a+r[13],t[2]=r[2]*n+r[6]*i+r[10]*a+r[14],t},o.transformMat3=function(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t},o.transformQuat=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2],c=r[3],h=c*n+s*a-u*i,l=c*i+u*n-o*a,f=c*a+o*i-s*n,d=-o*n-s*i-u*a;return t[0]=h*c+d*-o+l*-u-f*-s,t[1]=l*c+d*-s+f*-o-h*-u,t[2]=f*c+d*-u+h*-s-l*-o,t},o.forEach=function(){var t=o.create();return function(e,r,n,i,a,o){var s,u;for(r||(r=3),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;u>s;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t!==void 0&&(t.vec3=o);var s={};s.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},s.clone=function(t){var e=new r(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},s.fromValues=function(t,e,n,i){var a=new r(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=i,a},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},s.set=function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},s.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},s.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},s.sub=s.subtract,s.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},s.mul=s.multiply,s.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},s.div=s.divide,s.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},s.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},s.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},s.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},s.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+a*a)},s.dist=s.distance,s.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return r*r+n*n+i*i+a*a},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)},s.len=s.length,s.squaredLength=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},s.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},s.lerp=function(t,e,r,n){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t[3]=s+n*(r[3]-s),t},s.random=function(t,e){return e=e||1,t[0]=n(),t[1]=n(),t[2]=n(),t[3]=n(),s.normalize(t,t),s.scale(t,t,e),t},s.transformMat4=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t},s.transformQuat=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2],c=r[3],h=c*n+s*a-u*i,l=c*i+u*n-o*a,f=c*a+o*i-s*n,d=-o*n-s*i-u*a;return t[0]=h*c+d*-o+l*-u-f*-s,t[1]=l*c+d*-s+f*-o-h*-u,t[2]=f*c+d*-u+h*-s-l*-o,t},s.forEach=function(){var t=s.create();return function(e,r,n,i,a,o){var s,u;for(r||(r=4),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;u>s;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),s.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.vec4=s);var u={};u.create=function(){var t=new r(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},u.clone=function(t){var e=new r(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},u.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},u.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},u.invert=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*a-i*n;return o?(o=1/o,t[0]=a*o,t[1]=-n*o,t[2]=-i*o,t[3]=r*o,t):null},u.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},u.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},u.multiply=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],c=r[2],h=r[3];return t[0]=n*s+i*c,t[1]=n*u+i*h,t[2]=a*s+o*c,t[3]=a*u+o*h,t},u.mul=u.multiply,u.rotate=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+i*s,t[1]=n*-s+i*u,t[2]=a*u+o*s,t[3]=a*-s+o*u,t},u.scale=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1];return t[0]=n*s,t[1]=i*u,t[2]=a*s,t[3]=o*u,t},u.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.mat2=u);var c={};c.create=function(){var t=new r(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.clone=function(t){var e=new r(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},c.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.invert=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=r*a-n*i;return u?(u=1/u,t[0]=a*u,t[1]=-n*u,t[2]=-i*u,t[3]=r*u,t[4]=(i*s-a*o)*u,t[5]=(n*o-r*s)*u,t):null},c.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},c.multiply=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=r[0],h=r[1],l=r[2],f=r[3],d=r[4],p=r[5];return t[0]=n*c+i*l,t[1]=n*h+i*f,t[2]=a*c+o*l,t[3]=a*h+o*f,t[4]=c*s+l*u+d,t[5]=h*s+f*u+p,t},c.mul=c.multiply,c.rotate=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=Math.sin(r),h=Math.cos(r);return t[0]=n*h+i*c,t[1]=-n*c+i*h,t[2]=a*h+o*c,t[3]=-a*c+h*o,t[4]=h*s+c*u,t[5]=h*u-c*s,t},c.scale=function(t,e,r){var n=r[0],i=r[1];return t[0]=e[0]*n,t[1]=e[1]*i,t[2]=e[2]*n,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*i,t},c.translate=function(t,e,r){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+r[0],t[5]=e[5]+r[1],t},c.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},t!==void 0&&(t.mat2d=c);var h={};h.create=function(){var t=new r(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},h.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},h.clone=function(t){var e=new r(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},h.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},h.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},h.invert=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=h*o-s*c,f=-h*a+s*u,d=c*a-o*u,p=r*l+n*f+i*d;return p?(p=1/p,t[0]=l*p,t[1]=(-h*n+i*c)*p,t[2]=(s*n-i*o)*p,t[3]=f*p,t[4]=(h*r-i*u)*p,t[5]=(-s*r+i*a)*p,t[6]=d*p,t[7]=(-c*r+n*u)*p,t[8]=(o*r-n*a)*p,t):null},h.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8];return t[0]=o*h-s*c,t[1]=i*c-n*h,t[2]=n*s-i*o,t[3]=s*u-a*h,t[4]=r*h-i*u,t[5]=i*a-r*s,t[6]=a*c-o*u,t[7]=n*u-r*c,t[8]=r*o-n*a,t},h.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8];return e*(c*a-o*u)+r*(-c*i+o*s)+n*(u*i-a*s)},h.multiply=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],d=r[1],p=r[2],v=r[3],m=r[4],_=r[5],g=r[6],y=r[7],x=r[8];return t[0]=f*n+d*o+p*c,t[1]=f*i+d*s+p*h,t[2]=f*a+d*u+p*l,t[3]=v*n+m*o+_*c,t[4]=v*i+m*s+_*h,t[5]=v*a+m*u+_*l,t[6]=g*n+y*o+x*c,t[7]=g*i+y*s+x*h,t[8]=g*a+y*u+x*l,t},h.mul=h.multiply,h.translate=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],d=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=f*n+d*o+c,t[7]=f*i+d*s+h,t[8]=f*a+d*u+l,t},h.rotate=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*n+f*o,t[1]=d*i+f*s,t[2]=d*a+f*u,t[3]=d*o-f*n,t[4]=d*s-f*i,t[5]=d*u-f*a,t[6]=c,t[7]=h,t[8]=l,t},h.scale=function(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},h.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},h.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,c=r*o,h=r*s,l=r*u,f=n*s,d=n*u,p=i*u,v=a*o,m=a*s,_=a*u;return t[0]=1-(f+p),t[3]=h+_,t[6]=l-m,t[1]=h-_,t[4]=1-(c+p),t[7]=d+v,t[2]=l+m,t[5]=d-v,t[8]=1-(c+f),t},h.normalFromMat4=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],_=e[15],g=r*s-n*o,y=r*u-i*o,x=r*c-a*o,b=n*u-i*s,E=n*c-a*s,T=i*c-a*u,A=h*v-l*p,w=h*m-f*p,R=h*_-d*p,O=l*m-f*v,I=l*_-d*v,P=f*_-d*m,S=g*P-y*I+x*O+b*R-E*w+T*A;return S?(S=1/S,t[0]=(s*P-u*I+c*O)*S,t[1]=(u*R-o*P-c*w)*S,t[2]=(o*I-s*R+c*A)*S,t[3]=(i*I-n*P-a*O)*S,t[4]=(r*P-i*R+a*w)*S,t[5]=(n*R-r*I-a*A)*S,t[6]=(v*T-m*E+_*b)*S,t[7]=(m*x-p*T-_*y)*S,t[8]=(p*E-v*x+_*g)*S,t):null},h.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t!==void 0&&(t.mat3=h);var l={};l.create=function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.clone=function(t){var e=new r(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},l.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},l.invert=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],_=e[15],g=r*s-n*o,y=r*u-i*o,x=r*c-a*o,b=n*u-i*s,E=n*c-a*s,T=i*c-a*u,A=h*v-l*p,w=h*m-f*p,R=h*_-d*p,O=l*m-f*v,I=l*_-d*v,P=f*_-d*m,S=g*P-y*I+x*O+b*R-E*w+T*A;return S?(S=1/S,t[0]=(s*P-u*I+c*O)*S,t[1]=(i*I-n*P-a*O)*S,t[2]=(v*T-m*E+_*b)*S,t[3]=(f*E-l*T-d*b)*S,t[4]=(u*R-o*P-c*w)*S,t[5]=(r*P-i*R+a*w)*S,t[6]=(m*x-p*T-_*y)*S,t[7]=(h*T-f*x+d*y)*S,t[8]=(o*I-s*R+c*A)*S,t[9]=(n*R-r*I-a*A)*S,t[10]=(p*E-v*x+_*g)*S,t[11]=(l*x-h*E-d*g)*S,t[12]=(s*w-o*O-u*A)*S,t[13]=(r*O-n*w+i*A)*S,t[14]=(v*y-p*b-m*g)*S,t[15]=(h*b-l*y+f*g)*S,t):null},l.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],_=e[15];return t[0]=s*(f*_-d*m)-l*(u*_-c*m)+v*(u*d-c*f),t[1]=-(n*(f*_-d*m)-l*(i*_-a*m)+v*(i*d-a*f)),t[2]=n*(u*_-c*m)-s*(i*_-a*m)+v*(i*c-a*u),t[3]=-(n*(u*d-c*f)-s*(i*d-a*f)+l*(i*c-a*u)),t[4]=-(o*(f*_-d*m)-h*(u*_-c*m)+p*(u*d-c*f)),t[5]=r*(f*_-d*m)-h*(i*_-a*m)+p*(i*d-a*f),t[6]=-(r*(u*_-c*m)-o*(i*_-a*m)+p*(i*c-a*u)),t[7]=r*(u*d-c*f)-o*(i*d-a*f)+h*(i*c-a*u),t[8]=o*(l*_-d*v)-h*(s*_-c*v)+p*(s*d-c*l),t[9]=-(r*(l*_-d*v)-h*(n*_-a*v)+p*(n*d-a*l)),t[10]=r*(s*_-c*v)-o*(n*_-a*v)+p*(n*c-a*s),t[11]=-(r*(s*d-c*l)-o*(n*d-a*l)+h*(n*c-a*s)),t[12]=-(o*(l*m-f*v)-h*(s*m-u*v)+p*(s*f-u*l)),t[13]=r*(l*m-f*v)-h*(n*m-i*v)+p*(n*f-i*l),t[14]=-(r*(s*m-u*v)-o*(n*m-i*v)+p*(n*u-i*s)),t[15]=r*(s*f-u*l)-o*(n*f-i*l)+h*(n*u-i*s),t},l.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],d=t[12],p=t[13],v=t[14],m=t[15],_=e*o-r*a,g=e*s-n*a,y=e*u-i*a,x=r*s-n*o,b=r*u-i*o,E=n*u-i*s,T=c*p-h*d,A=c*v-l*d,w=c*m-f*d,R=h*v-l*p,O=h*m-f*p,I=l*m-f*v;return _*I-g*O+y*R+x*w-b*A+E*T},l.multiply=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],p=e[11],v=e[12],m=e[13],_=e[14],g=e[15],y=r[0],x=r[1],b=r[2],E=r[3];return t[0]=y*n+x*s+b*l+E*v,t[1]=y*i+x*u+b*f+E*m,t[2]=y*a+x*c+b*d+E*_,t[3]=y*o+x*h+b*p+E*g,y=r[4],x=r[5],b=r[6],E=r[7],t[4]=y*n+x*s+b*l+E*v,t[5]=y*i+x*u+b*f+E*m,t[6]=y*a+x*c+b*d+E*_,t[7]=y*o+x*h+b*p+E*g,y=r[8],x=r[9],b=r[10],E=r[11],t[8]=y*n+x*s+b*l+E*v,t[9]=y*i+x*u+b*f+E*m,t[10]=y*a+x*c+b*d+E*_,t[11]=y*o+x*h+b*p+E*g,y=r[12],x=r[13],b=r[14],E=r[15],t[12]=y*n+x*s+b*l+E*v,t[13]=y*i+x*u+b*f+E*m,t[14]=y*a+x*c+b*d+E*_,t[15]=y*o+x*h+b*p+E*g,t},l.mul=l.multiply,l.translate=function(t,e,r){var n,i,a,o,s,u,c,h,l,f,d,p,v=r[0],m=r[1],_=r[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*_+e[12],t[13]=e[1]*v+e[5]*m+e[9]*_+e[13],t[14]=e[2]*v+e[6]*m+e[10]*_+e[14],t[15]=e[3]*v+e[7]*m+e[11]*_+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=n*v+s*m+l*_+e[12],t[13]=i*v+u*m+f*_+e[13],t[14]=a*v+c*m+d*_+e[14],t[15]=o*v+h*m+p*_+e[15]),t},l.scale=function(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.rotate=function(t,r,n,i){var a,o,s,u,c,h,l,f,d,p,v,m,_,g,y,x,b,E,T,A,w,R,O,I,P=i[0],S=i[1],D=i[2],M=Math.sqrt(P*P+S*S+D*D);return e>Math.abs(M)?null:(M=1/M,P*=M,S*=M,D*=M,a=Math.sin(n),o=Math.cos(n),s=1-o,u=r[0],c=r[1],h=r[2],l=r[3],f=r[4],d=r[5],p=r[6],v=r[7],m=r[8],_=r[9],g=r[10],y=r[11],x=P*P*s+o,b=S*P*s+D*a,E=D*P*s-S*a,T=P*S*s-D*a,A=S*S*s+o,w=D*S*s+P*a,R=P*D*s+S*a,O=S*D*s-P*a,I=D*D*s+o,t[0]=u*x+f*b+m*E,t[1]=c*x+d*b+_*E,t[2]=h*x+p*b+g*E,t[3]=l*x+v*b+y*E,t[4]=u*T+f*A+m*w,t[5]=c*T+d*A+_*w,t[6]=h*T+p*A+g*w,t[7]=l*T+v*A+y*w,t[8]=u*R+f*O+m*I,t[9]=c*R+d*O+_*I,t[10]=h*R+p*O+g*I,t[11]=l*R+v*O+y*I,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},l.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+c*n,t[5]=o*i+h*n,t[6]=s*i+l*n,t[7]=u*i+f*n,t[8]=c*i-a*n,t[9]=h*i-o*n,t[10]=l*i-s*n,t[11]=f*i-u*n,t},l.rotateY=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],c=e[8],h=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-c*n,t[1]=o*i-h*n,t[2]=s*i-l*n,t[3]=u*i-f*n,t[8]=a*n+c*i,t[9]=o*n+h*i,t[10]=s*n+l*i,t[11]=u*n+f*i,t},l.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],c=e[4],h=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+c*n,t[1]=o*i+h*n,t[2]=s*i+l*n,t[3]=u*i+f*n,t[4]=c*i-a*n,t[5]=h*i-o*n,t[6]=l*i-s*n,t[7]=f*i-u*n,t},l.fromRotationTranslation=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=n+n,u=i+i,c=a+a,h=n*s,l=n*u,f=n*c,d=i*u,p=i*c,v=a*c,m=o*s,_=o*u,g=o*c;return t[0]=1-(d+v),t[1]=l+g,t[2]=f-_,t[3]=0,t[4]=l-g,t[5]=1-(h+v),t[6]=p+m,t[7]=0,t[8]=f+_,t[9]=p-m,t[10]=1-(h+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},l.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,c=r*o,h=r*s,l=r*u,f=n*s,d=n*u,p=i*u,v=a*o,m=a*s,_=a*u;return t[0]=1-(f+p),t[1]=h+_,t[2]=l-m,t[3]=0,t[4]=h-_,t[5]=1-(c+p),t[6]=d+v,t[7]=0,t[8]=l+m,t[9]=d-v,t[10]=1-(c+f),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.frustum=function(t,e,r,n,i,a,o){var s=1/(r-e),u=1/(i-n),c=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*a*c,t[15]=0,t},l.perspective=function(t,e,r,n,i){var a=1/Math.tan(e/2),o=1/(n-i);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*o,t[15]=0,t},l.ortho=function(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*c,t[15]=1,t},l.lookAt=function(t,r,n,i){var a,o,s,u,c,h,f,d,p,v,m=r[0],_=r[1],g=r[2],y=i[0],x=i[1],b=i[2],E=n[0],T=n[1],A=n[2];return e>Math.abs(m-E)&&e>Math.abs(_-T)&&e>Math.abs(g-A)?l.identity(t):(f=m-E,d=_-T,p=g-A,v=1/Math.sqrt(f*f+d*d+p*p),f*=v,d*=v,p*=v,a=x*p-b*d,o=b*f-y*p,s=y*d-x*f,v=Math.sqrt(a*a+o*o+s*s),v?(v=1/v,a*=v,o*=v,s*=v):(a=0,o=0,s=0),u=d*s-p*o,c=p*a-f*s,h=f*o-d*a,v=Math.sqrt(u*u+c*c+h*h),v?(v=1/v,u*=v,c*=v,h*=v):(u=0,c=0,h=0),t[0]=a,t[1]=u,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=d,t[7]=0,t[8]=s,t[9]=h,t[10]=p,t[11]=0,t[12]=-(a*m+o*_+s*g),t[13]=-(u*m+c*_+h*g),t[14]=-(f*m+d*_+p*g),t[15]=1,t)},l.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t!==void 0&&(t.mat4=l);var f={};f.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.rotationTo=function(){var t=o.create(),e=o.fromValues(1,0,0),r=o.fromValues(0,1,0);return function(n,i,a){var s=o.dot(i,a);return-.999999>s?(o.cross(t,e,i),1e-6>o.length(t)&&o.cross(t,r,i),o.normalize(t,t),f.setAxisAngle(n,t,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(o.cross(t,i,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+s,f.normalize(n,n))}}(),f.setAxes=function(){var t=h.create();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=r[0],t[5]=r[1],t[8]=r[2],f.normalize(e,f.fromMat3(e,t))}}(),f.clone=s.clone,f.fromValues=s.fromValues,f.copy=s.copy,f.set=s.set,f.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},f.setAxisAngle=function(t,e,r){r=.5*r;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},f.add=s.add,f.multiply=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],c=r[2],h=r[3];return t[0]=n*h+o*s+i*c-a*u,t[1]=i*h+o*u+a*s-n*c,t[2]=a*h+o*c+n*u-i*s,t[3]=o*h-n*s-i*u-a*c,t},f.mul=f.multiply,f.scale=s.scale,f.rotateX=function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s,t},f.rotateY=function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s,t},f.rotateZ=function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t},f.calculateW=function(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t},f.dot=s.dot,f.lerp=s.lerp,f.slerp=function(t,e,r,n){var i,a,o,s,u,c=e[0],h=e[1],l=e[2],f=e[3],d=r[0],p=r[1],v=r[2],m=r[3];return a=c*d+h*p+l*v+f*m,0>a&&(a=-a,d=-d,p=-p,v=-v,m=-m),1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o):(s=1-n,u=n),t[0]=s*c+u*d,t[1]=s*h+u*p,t[2]=s*l+u*v,t[3]=s*f+u*m,t},f.invert=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=a*s,t},f.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},f.length=s.length,f.len=f.length,f.squaredLength=s.squaredLength,f.sqrLen=f.squaredLength,f.normalize=s.normalize,f.fromMat3=function(){var t="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(e,r){var n,i=r[0]+r[4]+r[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(r[7]-r[5])*n,e[1]=(r[2]-r[6])*n,e[2]=(r[3]-r[1])*n;else{var a=0;r[4]>r[0]&&(a=1),r[8]>r[3*a+a]&&(a=2);var o=t[a],s=t[o];n=Math.sqrt(r[3*a+a]-r[3*o+o]-r[3*s+s]+1),e[a]=.5*n,n=.5/n,e[3]=(r[3*s+o]-r[3*o+s])*n,e[o]=(r[3*o+a]+r[3*a+o])*n,e[s]=(r[3*s+a]+r[3*a+s])*n}return e}}(),f.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.quat=f)}(e.exports)}(this),n("2d/style",["require","core/base","_"],function(t){function e(t){return(t||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")}var r=t("core/base"),n=t("_"),i=["fillStyle","strokeStyle","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","globalAlpha","font"],a={fill:"fillStyle",stroke:"strokeStyle",alpha:"globalAlpha",shadow:["shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor"]},o=/([0-9\-]+)\s+([0-9\-]+)\s+([0-9]+)\s+([a-zA-Z0-9\(\)\s,#]+)/,s=r.derive({},{bind:function(t){var r=i,s=a;for(var u in s)if(this.hasOwnProperty(u)){var c=s[u],h=this[u];if("shadow"==u){var l=o.exec(e(h));if(!l)continue;h=l.slice(1),n.each(h,function(e,r){c[r]&&(t[c[r]]=e)},this)}else t[c]=h}n.each(r,function(e){this.hasOwnProperty(e)&&(t[e]=this[e])},this)}});return s}),n("2d/node",["require","core/base","glmatrix","./style"],function(t){var e=t("core/base"),r=t("glmatrix"),n=r.vec2,i=r.mat2d,a=t("./style"),o=e.derive(function(){return{__mouseover__:!1,id:0,AABB:[n.fromValues(0,0),n.fromValues(0,0)],z:0,style:null,position:n.fromValues(0,0),rotation:0,scale:n.fromValues(1,1),_transform:i.create(),_transformInverse:i.create(),visible:!0,children:{},intersectLineWidth:0,clip:!1,fill:!0,stroke:!0,fixAA:!0}},function(){this.__GUID__=s()},{updateTransform:function(){var t=this._transform;return i.identity(t),this.scale&&i.scale(t,t,this.scale),this.rotation&&i.rotate(t,t,this.rotation),this.position&&i.translate(t,t,this.position),t},updateTransformInverse:function(){i.invert(this._transformInverse,this._transformInverse)},intersectAABB:function(t,e){var r=this.AABB;return t>r[0][0]&&r[1][0]>t&&e>r[0][1]&&r[1][1]>e},add:function(t){t&&(this.children[t.__GUID__]=t,t.parent=this)},remove:function(t){this.children[t.__GUID__]=null,t.parent=null},draw:function(){},render:function(t){var e=this._getSortedRenderQueue();if(t.save(),this.style)if(!this.style instanceof a)for(var r in this.style)this.style[r].bind(t);else this.style.bind(t);var n=this.updateTransform();t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this.draw(t),this.clip&&t.clip();for(var i=0;e.length>i;i++)e[i].render(t);t.restore()},traverse:function(t){var e=t&&t(this);if(!e)for(var r=this.children,n=0,i=r.length;i>n;n++)r[n].traverse(t)},intersect:function(){},_getSortedRenderQueue:function(){var t=[];for(var e in this.children)t.push(this.children[e]);return t.sort(function(t,e){return t.z===e.z?t.__GUID__>e.__GUID__?1:-1:t.z>e.z?1:-1}),t}}),s=function(){var t=0;return function(){return++t}}();return o}),n("2d/util",["require"],function(){return{fixPos:function(t){return[t[0]+.5,t[1]+.5]},fixPosArray:function(t){for(var e=[],r=t.length,n=0;r>n;n++)e.push(this.fixPos(t[n]));return e},computeAABB:function(t){for(var e=t[0][0],r=t[0][0],n=t[0][1],i=t[0][1],a=1;t.length>a;a++)e=e>t[a][0]?t[a][0]:e,r=t[a][0]>r?t[a][0]:r,n=n>t[a][1]?t[a][1]:n,i=t[a][1]>i?t[a][1]:i;return[[e,n],[r,i]]}}}),n("2d/renderable/arc",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),r=t("../util"),n=t("glmatrix");n.vec2;var i=e.derive(function(){return{center:[0,0],radius:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(){var t=this.fixAA?r.fixPos(this.center):this.center;ctx.beginPath(),ctx.arc(t[0],t[1],this.radius,this.startAngle,this.endAngle,!this.clockwise),this.stroke&&ctx.stroke(),this.fill&&ctx.fill()},intersect:function(){return!1}});return i}),n("2d/renderable/circle",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),r=t("../util"),n=t("glmatrix"),i=n.vec2,a=e.derive(function(){return{center:[0,0],radius:0}},{computeAABB:function(){this.AABB=[[this.center[0]-this.radius,this.center[1]-this.radius],[this.center[0]+this.radius,this.center[1]+this.radius]]},draw:function(t){var e=this.fixAA?r.fixPos(this.center):this.center;t.beginPath(),t.arc(e[0],e[1],this.radius,0,2*Math.PI,!1),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(){return i.len([this.center[0]-x,this.center[1]-y])<this.radius}});return a}),n("2d/renderable/image",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),r=t("../util"),n=t("glmatrix");n.vec2;var i={},a=e.derive(function(){return{img:"",start:[0,0],size:0,onload:function(){}}},function(){if("string"==typeof this.img){var t=this;this.load(this.img,function(e){t.img=e,t.onload.call(t)})}},{computeAABB:function(){this.AABB=r.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(t){var e=this.fixAA?r.fixPos(this.start):this.start;"string"!=typeof this.img&&(this.size?t.drawImage(this.img,e[0],e[1],this.size[0],this.size[1]):t.drawImage(this.img,e[0],e[1]))},intersect:function(t,e){return this.intersectAABB(t,e)},load:function(t,e){if(i[t]){var r=i[t];r.constructor==Array?r.push(e):e(r)}else{i[t]=[e];var r=new a;r.onload=function(){each(i[t],function(t){t(r)}),i[t]=r},r.src=t}}});return a}),n("2d/renderable/line",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),r=t("../util"),n=t("glmatrix"),i=n.vec2,a=e.derive(function(){return{start:[0,0],end:[0,0],width:0}},{computeAABB:function(){this.AABB=r.computeAABB([this.start,this.end]),this.AABB[0][0]==this.AABB[1][0]&&(this.AABB[0][0]-=this.width/2,this.AABB[1][0]+=this.width/2),this.AABB[0][1]==this.AABB[1][1]&&(this.AABB[0][1]-=this.width/2,this.AABB[1][1]+=this.width/2)},draw:function(t){var e=this.fixAA?r.fixPos(this.start):this.start,n=this.fixAA?r.fixPos(this.end):this.end;t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(n[0],n[1]),t.stroke()},intersect:function(t,e){if(!this.intersectAABB(t,e))return!1;var r=[t,e];b=this.start,c=this.end,ba=i.sub([],r,b),bc=i.sub([],c,b);var n=i.dot(bc,ba);i.normalize(bc,bc);var a=i.add(b,i.scale(bc,n)),o=i.length(i.sub(r,r,a));return this.width/2>o}});return a}),n("2d/renderable/path",["require","../node","../util","glmatrix"],function(t){var e=t("../node");t("../util");var r=t("glmatrix"),n=r.vec2,i=e.derive(function(){return{segments:[],globalStyle:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(t){this.globalStyle?this.drawWithSameStyle(t):this.drawWithDifferentStyle(t)},drawWithSameStyle:function(t){var e=this.segments.length,r=this.segments;t.beginPath(),t.moveTo(r[0].point[0],r[0].point[1]);for(var n=1;e>n;n++)if(r[n-1].handleOut||r[n].handleIn){var i=r[n-1].handleOut||r[n-1].point,a=r[n].handleIn||r[n].point;t.bezierCurveTo(i[0],i[1],a[0],a[1],r[n].point[0],r[n].point[1])}else t.lineTo(r[n].point[0],r[n].point[1]);this.fill&&t.fill(),this.stroke&&t.stroke()},drawWithDifferentStyle:function(t){for(var e=this.segments.length,r=this.segments,n=0;e-1>n;n++){if(t.save(),r[n].style&&r[n].style.bind(t),t.beginPath(),t.moveTo(r[n].point[0],r[n].point[1]),r[n].handleOut||r[n+1].handleIn){var i=r[n].handleOut||r[n].point,a=r[n+1].handleIn||r[n+1].point;t.bezierCurveTo(i[0],i[1],a[0],a[1],r[n+1].point[0],r[n+1].point[1])}else t.lineTo(r[n+1].point[0],r[n+1].point[1]);this.stroke&&t.stroke(),this.fill&&t.fill(),t.restore()}},smooth:function(t){function e(t,e,r){var i=n.scale([],n.add([],e,r),.5);return n.sub([],t,i)}for(var r=this.segments.length,i=[],a=this.segments,o=0;r>o;o++){var s=a[o].point,u=o==r-1?a[0].point:a[o+1].point;i.push(n.scale([],n.add([],s,u),.5))}for(var o=0;r>o;o++){var s=a[o].point,c=i[o],h=0==o?i[r-1]:i[o-1],t=a[o].smoothLevel||t||1,l=n.scale([],n.add([],c,h),.5),f=n.sub([],c,l),d=n.sub([],h,l),p=e(s,h,c);n.scale(d,d,t),n.scale(f,f,t),a[o].handleIn=n.add([],n.add([],l,d),p),a[o].handleOut=n.add([],n.add([],l,f),p)}a[0].handleOut=a[0].handleIn=null,a[r-1].handleIn=a[r-1].handleOut=null},pushPoints:function(t){for(var e=0;t.length>e;e++)this.segments.push({point:t[e],handleIn:null,handleOut:null})}});return i}),n("2d/renderable/polygon",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),r=t("../util"),n=t("glmatrix");return n.vec2,e.derive(function(){return{points:[]}},{computeAABB:function(){this.AABB=r.computeAABB(this.points)},draw:function(t){var e=this.fixAA?r.fixPosArray(this.points):this.points;t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var n=1;e.length>n;n++)t.lineTo(e[n][0],e[n][1]);t.closePath(),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(t,e){if(!this.intersectAABB(t,e))return!1;for(var r,n,i,a,o=this.points.length,s=0,u=this.points,c=0;o>c;c++)r=n.normalize([],[u[c][0]-t,u[c][1]-e]),i=(c+1)%o,n=n.normalize([],[u[i][0]-t,u[i][1]-e]),a=Math.acos(n.dot(r,n)),s+=a;
return.001>Math.length(s-2*Math.PI)}}),e}),n("2d/renderable/rectangle",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),r=t("../util"),n=t("glmatrix"),i=n.vec2,a=e.derive(function(){return{start:[0,0],size:[0,0]}},{computeAABB:function(){var t=i.add([],this.start,this.size);this.AABB=r.computeAABB([this.start,t])},draw:function(t){var e=this.fixAA?r.fixPos(this.start):this.start;t.beginPath(),t.rect(e[0],e[1],this.size[0],this.size[1]),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(t,e){return this.intersectAABB(t,e)}});return a}),n("2d/renderable/roundedrectangle",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),r=t("../util"),n=t("glmatrix"),i=n.vec2,a=e.derive(function(){return{start:[0,0],size:[0,0],radius:0}},{computeAABB:function(){var t=i.add([],this.start,this.size);this.AABB=r.computeAABB([this.start,t])},draw:function(t){if(this.radius.constructor==Number)var e=[this.radius,this.radius,this.radius,this.radius];else if(2==this.radius.length)var e=[this.radius[0],this.radius[1],this.radius[0],this.radius[1]];else var e=this.radius;var n=this.fixAA?r.fixPos(this.start):this.start,a=this.size,o=i.add([],n,[e[0],0]),s=i.add([],n,[a[0],0]),u=i.add([],n,a),c=i.add([],n,[0,a[1]]);t.beginPath(),t.moveTo(o[0],o[1]),e[1]?t.arcTo(s[0],s[1],u[0],u[1],e[1]):t.lineTo(s[0],s[1]),e[2]?t.arcTo(u[0],u[1],c[0],c[1],e[2]):t.lineTo(u[0],u[1]),e[3]?t.arcTo(c[0],c[1],n[0],n[1],e[3]):t.lineTo(c[0],c[1]),e[0]?t.arcTo(n[0],n[1],s[0],s[1],e[0]):t.lineTo(n[0],n[1]),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(){return!1}});return a}),n("2d/renderable/sector",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),r=t("../util"),n=t("glmatrix"),i=n.vec2,a=e.derive(function(){return{center:[0,0],innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,clockwise:!0}},{computeAABB:function(){this.AABB=[0,0]},intersect:function(t,e){var r=this.startAngle,n=this.endAngle,a=this.innerRadius,o=this.outerRadius,s=this.center,u=i.sub([],[t,e],s),c=i.length(u),h=2*Math.PI;if(a>c||c>o)return!1;var l=Math.atan2(u[1],u[0]);return 0>l&&(l+=h),this.clockwise?n>l&&l>r:(r=h-r,n=h-n,l>n&&r>l)},draw:function(t){var e=this.startAngle,n=this.endAngle,a=this.innerRadius,o=this.outerRadius,s=this.fixAA?r.fixPos(this.center):this.center;this.clockwise||(e=2*Math.PI-e,n=2*Math.PI-n);var u=i.add([],s,[a*Math.cos(e),a*Math.sin(e)]),c=i.add([],s,[o*Math.cos(e),o*Math.sin(e)]),h=i.add([],s,[a*Math.cos(n),a*Math.sin(n)]);i.add([],s,[o*Math.cos(n),o*Math.sin(n)]),t.beginPath(),t.moveTo(u[0],u[1]),t.lineTo(c[0],c[1]),t.arc(s[0],s[1],o,e,n,!this.clockwise),t.lineTo(h[0],h[1]),t.arc(s[0],s[1],a,n,e,this.clockwise),t.endPath(),this.stroke&&t.stroke(),this.fill&&t.fill()}});return a}),n("2d/renderable/text",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),r=t("../util"),n=t("glmatrix");n.vec2;var i=e.derive(function(){return{text:"",start:[0,0],size:[0,0],font:"",textAlign:"",textBaseline:""}},{computeAABB:function(){this.AABB=r.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(t){var e=this.fixAA?r.fixPos(this.start):this.start;this.font&&(t.font=this.font),this.textAlign&&(t.textAlign=this.textAlign),this.textBaseline&&(t.textBaseline=this.textBaseline),this.fill&&(this.size.length&&this.size[0]?t.fillText(this.text,e[0],e[1],this.size[0]):t.fillText(this.text,e[0],e[1])),this.stroke&&(this.size.length&&this.size[0]?t.strokeText(this.text,e[0],e[1],this.size[0]):t.strokeText(this.text,e[0],e[1]))},resize:function(t){(!this.size[0]||this.needResize)&&(this.size[0]=t.measureText(this.text).width,this.size[1]=t.measureText("m").width)},intersect:function(t,e){return this.intersectAABB(t,e)}});return i}),n("2d/renderable/textbox",["require","../node","../util","glmatrix","./text","_"],function(t){var e=t("../node");t("../util");var r=t("glmatrix"),n=r.vec2,i=t("./text"),a=t("_"),o=e.derive(function(){return{text:"",textAlign:"",textBaseline:"top",font:"",start:[0,0],width:0,wordWrap:!1,wordBreak:!1,lineHeight:0,stroke:!1,_texts:[]}},function(){this._oldText=""},{computeAABB:function(){},draw:function(t){if(this.text!=this._oldText)if(this._oldText=this.text,this.font&&(t.font=this.font),this.wordBreak)this._texts=this.computeWordBreak(t);else if(this.wordWrap)this._texts=this.computeWordWrap(t);else{var e=new i({text:this.text,textBaseline:this.textBaseline});this.extendCommonProperties(e),this._texts=[e]}a.each(this._texts,function(e){e.draw(t)})},computeWordWrap:function(t){if(this.text){for(var e,r,a,o=this.text.split(" "),s=o.length,u=0,c=[],h=0;s>h;h++)r=h==s-1?o[h]:o[h]+" ",e=t.measureText(r).width,u+e>this.width||!a?(a=new i({text:r,start:n.add([],this.start,[0,this.lineHeight*c.length])}),this.extendCommonProperties(a),c.push(a),u=e):(u+=e,a.text+=r);return c}},computeWordBreak:function(t){if(this.text){for(var e,r,a,o=this.text.length,s=t.measureText(this.text[0]).width,u=[],c=0;o>c;c++)if(r=this.text[c],e=t.measureText(r).width,s+e>this.width||!a){var a=new i({text:r,start:n.add([],this.start,[0,this.lineHeight*u.length])});this.extendCommonProperties(a),u.push(a),s=e}else s+=e,a.text+=r;return u}},extendCommonProperties:function(t){a.extend(t,{textAlign:this.textAlign,textBaseline:this.textBaseline,style:this.style,font:this.font,fill:this.fill,stroke:this.stroke})},intersect:function(){}});return o}),n("2d/renderer",["require","core/base"],function(t){var e=t("core/base"),r=e.derive(function(){return{canvas:null,context:null,width:0,height:0,_latestRenderedScene:null}},function(){this.canvas||(this.canvas=document.createElement("canvas")),this.canvas.addEventListener("click",this._clickHandler.bind(this)),this.canvas.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this.canvas.addEventListener("mouseup",this._mouseUpHandler.bind(this)),this.canvas.addEventListener("mousemove",this._mouseMoveHandler.bind(this)),this.canvas.addEventListener("mouseout",this._mouseOutHandler.bind(this)),this.width?this.canvas.width=this.width:this.width=this.canvas.width,this.height?this.canvas.height=this.height:this.height=this.canvas.height,this.context=this.canvas.getContext("2d")},{resize:function(t,e){this.canvas.width=t,this.canvas.height=e},render:function(t){this.context.clearRect(0,0,this.width,this.height),t.render(this.context),this._latestRenderedScene=t},_clickHandler:function(){this._latestRenderedScene},_mouseDownHandler:function(){},_mouseUpHandler:function(){},_mouseMoveHandler:function(){},_mouseOutHandler:function(){}});return r}),n("2d/scene",["require","./node"],function(t){var e=t("./node"),r=e.derive(function(){return{}},{});return r}),n("core/vector3",["require","glmatrix"],function(t){var e=t("glmatrix"),r=e.vec3,n=function(t,e,n){return t=t||0,e=e||0,n=n||0,Object.create(i,{x:{configurable:!1,set:function(t){this._array[0]=t,this._dirty=!0},get:function(){return this._array[0]}},y:{configurable:!1,set:function(t){this._array[1]=t,this._dirty=!0},get:function(){return this._array[1]}},z:{configurable:!1,set:function(t){this._array[2]=t,this._dirty=!0},get:function(){return this._array[2]}},_array:{writable:!1,configurable:!1,value:r.fromValues(t,e,n)},_dirty:{configurable:!1,value:!0}})},i={constructor:n,add:function(t){return r.add(this._array,this._array,t._array),this._dirty=!0,this},set:function(t,e,r){return this._array[0]=t,this._array[1]=e,this._array[2]=r,this._dirty=!0,this},clone:function(){return new n(this.x,this.y,this.z)},copy:function(t){return r.copy(this._array,t._array),this._dirty=!0,this},cross:function(t,e){return r.cross(t._array,this._array,e._array),this},dist:function(t){return r.dist(this._array,t._array)},distance:function(t){return r.distance(this._array,t._array)},div:function(t){return r.div(this._array,this._array,t._array),this._dirty=!0,this},divide:function(t){return r.divide(this._array,this._array,t._array),this._dirty=!0,this},dot:function(t){return r.dot(this._array,t._array)},len:function(){return r.len(this._array)},length:function(){return r.length(this._array)},lerp:function(t,e,n){return r.lerp(this._array,t._array,e._array,n),this._dirty=!0,this},mul:function(t){return r.mul(this._array,this._array,t._array),this._dirty=!0,this},multiply:function(t){return r.multiply(this._array,this._array,t._array),this._dirty=!0,this},negate:function(){return r.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return r.normalize(this._array,this._array),this._dirty=!0,this},random:function(t){return r.random(this._array,t),this._dirty=!0,this},scale:function(t){return r.scale(this._array,this._array,t),this._dirty=!0,this},scaleAndAdd:function(t,e){return r.scaleAndAdd(this._array,this._array,t._array,e),this._dirty=!0,this},sqrDist:function(t){return r.sqrDist(this._array,t._array)},squaredDistance:function(t){return r.squaredDistance(this._array,t._array)},sqrLen:function(){return r.sqrLen(this._array)},squaredLength:function(){return r.squaredLength(this._array)},sub:function(t){return r.sub(this._array,this._array,t._array),this._dirty=!0,this},subtract:function(t){return r.subtract(this._array,this._array,t._array),this._dirty=!0,this},transformMat3:function(t){return r.transformMat3(this._array,this._array,t._array),this._dirty=!0,this},transformMat4:function(t){return r.transformMat4(this._array,this._array,t._array),this._dirty=!0,this},transformQuat:function(t){return r.transformQuat(this._array,this._array,t._array),this._dirty=!0,this},setEulerFromQuaternion:function(){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return n}),n("core/quaternion",["require","glmatrix"],function(t){var e=t("glmatrix"),r=e.quat,n=function(t,e,n,a){return t=t||0,e=e||0,n=n||0,a=a===void 0?1:a,Object.create(i,{x:{configurable:!1,set:function(t){this._array[0]=t,this._dirty=!0},get:function(){return this._array[0]}},y:{configurable:!1,set:function(t){this._array[1]=t,this._dirty=!0},get:function(){return this._array[1]}},z:{configurable:!1,set:function(t){this._array[2]=t,this._dirty=!0},get:function(){return this._array[2]}},w:{configurable:!1,set:function(t){this._array[2]=t,this._dirty=!0},get:function(){return this._array[2]}},_array:{writable:!1,configurable:!1,value:r.fromValues(t,e,n,a)},_dirty:{configurable:!1,value:!1}})},i={constructor:n,add:function(t){return r.add(this._array,this._array,t._array),this._dirty=!0,this},calculateW:function(){return r.calculateW(this._array,this._array),this._dirty=!0,this},set:function(t,e,r,n){return this._array[0]=t,this._array[1]=e,this._array[2]=r,this._array[3]=n,this._dirty=!0,this},clone:function(){return new n(this.x,this.y,this.z,this.w)},conjugate:function(){return r.conjugate(this._array,this._array),this._dirty=!0,this},copy:function(t){return r.copy(this._array,t._array),this._dirty=!0,this},dot:function(t){return r.dot(this._array,t._array)},fromMat3:function(t){return r.fromMat3(this._array,t._array),this._dirty=!0,this},fromMat4:function(){var t=e.mat3,n=t.create();return function(e){return t.fromMat4(n,e._array),t.transpose(n,n),r.fromMat3(this._array,n),this._dirty=!0,this}}(),identity:function(){return r.identity(this._array),this._dirty=!0,this},invert:function(){return r.invert(this._array,this._array),this._dirty=!0,this},len:function(){return r.len(this._array)},length:function(){return r.length(this._array)},lerp:function(t,e,n){return r.lerp(this._array,t._array,e._array,n),this._dirty=!0,this},mul:function(t){return r.mul(this._array,this._array,t._array),this._dirty=!0,this},multiply:function(t){return r.multiply(this._array,this._array,t._array),this._dirty=!0,this},normalize:function(){return r.normalize(this._array,this._array),this._dirty=!0,this},rotateX:function(t){return r.rotateX(this._array,this._array,t),this._dirty=!0,this},rotateY:function(t){return r.rotateY(this._array,this._array,t),this._dirty=!0,this},rotateZ:function(t){return r.rotateZ(this._array,this._array,t),this._dirty=!0,this},setAxisAngle:function(t,e){return r.setAxisAngle(this._array,t._array,e),this._dirty=!0,this},slerp:function(t,e,n){return r.slerp(this._array,t._array,e._array,n),this._dirty=!0,this},sqrLen:function(){return r.sqrLen(this._array)},squaredLength:function(){return r.squaredLength(this._array)},setFromEuler:function(){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return n}),n("core/matrix4",["require","glmatrix","./vector3"],function(t){function e(t){return{configurable:!1,set:function(e){this._array[t]=e,this._dirty=!0},get:function(){return this._array[t]}}}var r=t("glmatrix"),n=t("./vector3"),i=r.mat4,a=r.vec3,o=r.mat3,s=r.quat,u=function(){var t=new n,r=new n,a=new n;return Object.create(c,{m00:e(0),m01:e(1),m02:e(2),m03:e(3),m10:e(4),m11:e(5),m12:e(6),m13:e(7),m20:e(8),m21:e(9),m22:e(10),m23:e(11),m30:e(12),m31:e(13),m32:e(14),m33:e(15),forward:{configurable:!1,get:function(){var t=this._array;return a.set(t[8],t[9],t[10]),a},set:function(t){var e=this._array,t=t._array;e[8]=t[8],e[9]=t[9],e[10]=t[10]}},up:{configurable:!1,enumerable:!0,get:function(){var t=this._array;return r.set(t[4],t[5],t[6]),r},set:function(t){var e=this._array,t=t._array;e[4]=t[4],e[5]=t[5],e[6]=t[6]}},right:{configurable:!1,get:function(){var e=this._array;return t.set(e[0],e[1],e[2]),t},set:function(t){var e=this._array,t=t._array;e[0]=t[0],e[1]=t[1],e[2]=t[2]}},_array:{writable:!1,configurable:!1,value:i.create()}})},c={constructor:u,adjoint:function(){return i.adjoint(this._array,this._array),this},clone:function(){return(new u).copy(this)},copy:function(t){return i.copy(this._array,t._array),this},determinant:function(){return i.determinant(this._array)},fromQuat:function(t){return i.fromQuat(this._array,t._array),this},fromRotationTranslation:function(t,e){return i.fromRotationTranslation(this._array,t._array,e._array),this},frustum:function(t,e,r,n,a,o){return i.frustum(this._array,t,e,r,n,a,o),this},identity:function(){return i.identity(this._array),this},invert:function(){return i.invert(this._array,this._array),this},lookAt:function(t,e,r){return i.lookAt(this._array,t._array,e._array,r._array),this},mul:function(t){return i.mul(this._array,this._array,t._array),this},mulLeft:function(t){return i.mul(this._array,t._array,this._array),this},multiply:function(t){return i.multiply(this._array,this._array,t._array),this},multiplyLeft:function(t){return i.multiply(this._array,t._array,this._array),this},ortho:function(t,e,r,n,a,o){return i.ortho(this._array,t,e,r,n,a,o),this},perspective:function(t,e,r,n){return i.perspective(this._array,t,e,r,n),this},rotate:function(t,e){return i.rotate(this._array,this._array,t,e._array),this},rotateX:function(t){return i.rotateX(this._array,this._array,t),this},rotateY:function(t){return i.rotateY(this._array,this._array,t),this},rotateZ:function(t){return i.rotateZ(this._array,this._array,t),this},scale:function(t){return i.scale(this._array,this._array,t._array),this},translate:function(t){return i.translate(this._array,this._array,t._array),this},transpose:function(){return i.transpose(this._array,this._array),this},rotateAround:function(){console.warn("TODO")},decomposeMatrix:function(){var t=a.create(),e=a.create(),r=a.create(),n=o.create();return function(i,u,c){var h=this._array;a.set(t,h[0],h[1],h[2]),a.set(e,h[4],h[5],h[6]),a.set(r,h[8],h[9],h[10]),i.x=a.length(t),i.y=a.length(e),i.z=a.length(r),c.set(h[12],h[13],h[14]),o.fromMat4(n,h),o.transpose(n,n),n[0]/=i.x,n[1]/=i.x,n[2]/=i.x,n[3]/=i.y,n[4]/=i.y,n[5]/=i.y,n[6]/=i.z,n[7]/=i.z,n[8]/=i.z,s.fromMat3(u._array,n),u.normalize()}}(),toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return u}),n("core/matrix3",["require","glmatrix"],function(t){function e(t){return{configurable:!1,set:function(e){this._array[t]=e,this._dirty=!0},get:function(){return this._array[t]}}}var r=t("glmatrix"),n=r.mat3,i=function(){return Object.create(a,{m00:e(0),m01:e(1),m02:e(2),m10:e(3),m11:e(4),m12:e(5),m20:e(6),m21:e(7),m22:e(8),_array:{writable:!1,configurable:!1,value:n.create()}})},a={constructor:i,adjoint:function(){return n.adjoint(this._array,this._array),this},clone:function(){return(new i).copy(this)},copy:function(t){return n.copy(this._array,t._array),this},determinant:function(){return n.determinant(this._array)},fromMat2d:function(t){return n.fromMat2d(this._array,t._array)},fromMat4:function(t){return n.fromMat4(this._array,t._array)},fromQuat:function(t){return n.fromQuat(this._array,t._array),this},identity:function(){return n.identity(this._array),this},invert:function(){return n.invert(this._array,this._array),this},mul:function(t){return n.mul(this._array,this._array,t._array),this},mulLeft:function(t){return n.mul(this._array,t._array,this._array),this},multiply:function(t){return n.multiply(this._array,this._array,t._array),this},multiplyLeft:function(t){return n.multiply(this._array,t._array,this._array),this},normalFromMat4:function(t){return n.normalFromMat4(this._array,t._array),t},transpose:function(){return n.transpose(this._array,this._array),this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return i}),n("util/util",["require"],function(){return{genGUID:function(){var t=0;return function(){return++t}}()}}),n("3d/node",["require","core/base","core/vector3","core/quaternion","core/matrix4","core/matrix3","util/util","_"],function(t){var e=t("core/base"),r=t("core/vector3"),n=t("core/quaternion"),i=t("core/matrix4");t("core/matrix3");var a=t("util/util"),o=t("_"),s=e.derive(function(){var t=a.genGUID();return{__GUID__:t,name:"NODE_"+t,visible:!0,position:new r,rotation:new n,scale:new r(1,1,1),eulerAngle:new r,useEuler:!1,children:[],parent:null,worldMatrix:new i,matrix:new i}},{add:function(t){this.children.indexOf(t)>=0||(this.children.push(t),t.parent=this)},remove:function(t){o.without(this.children,t),t.parent=null},traverse:function(t){var e=t&&t(this);if(!e)for(var r=this.children,n=0,i=r.length;i>n;n++)r[n].traverse(t)},updateMatrix:function(){if(!this.position._dirty&&!this.scale._dirty){if(this.useEuler&&!this.eulerAngle._dirty)return;if(!this.rotation._dirty)return}var t=this.matrix;t.identity(),this.useEuler&&(this.rotation.identity(),this.rotation.rotateX(this.eulerAngle.x),this.rotation.rotateY(this.eulerAngle.y),this.rotation.rotateZ(this.eulerAngle.z)),t.fromRotationTranslation(this.rotation,this.position),t.scale(this.scale),this.rotation._dirty=!1,this.scale._dirty=!1,this.position._dirty=!1,this.eulerAngle._dirty=!1},decomposeMatrix:function(){this.matrix.decomposeMatrix(this.scale,this.rotation,this.position),this.useEuler||this.eulerAngle.setEulerFromQuaternion(this.rotation),this.rotation._dirty=!1,this.scale._dirty=!1,this.position._dirty=!1,this.eulerAngle._dirty=!1},updateWorldMatrix:function(){this.updateMatrix(),this.parent?this.worldMatrix.copy(this.parent.worldMatrix).multiply(this.matrix):this.worldMatrix.copy(this.matrix)},update:function(t,e){e||this.trigger("beforeupdate",t),this.updateWorldMatrix(),e||this.trigger("afterupdate",t);for(var r=0;this.children.length>r;r++){var n=this.children[r];n.visible&&n.update(t)}},getWorldPosition:function(){var t=this.worldMatrix._array;return new r(t[12],t[13],t[14])},translate:function(t){this.updateMatrix(),this.translate(t),this.decomposeMatrix()},rotate:function(t,e){this.updateMatrix(),this.matrix.rotate(t,e),this.decomposeMatrix()},rotateAround:function(){var t=new r,e=new i;return function(r,n,i){t.copy(this.position).subtract(r),this.matrix.identity(),this.matrix.translate(r),this.matrix.rotate(i,n),this.useEuler&&(this.rotation.identity(),this.rotation.rotateX(this.eulerAngle.x),this.rotation.rotateY(this.eulerAngle.y),this.rotation.rotateZ(this.eulerAngle.z)),e.fromRotationTranslation(this.rotation,t),this.matrix.multiply(e),this.matrix.scale(this.scale),this.decomposeMatrix()}}(),lookAt:function(){var t=new i,e=new r;return function(r,n){t.lookAt(this.position,r,n||this.matrix.up).invert(),t.decomposeMatrix(e,this.rotation,this.position)}}()});return s}),n("3d/camera",["require","./node","core/matrix4"],function(t){var e=t("./node"),r=t("core/matrix4"),n=e.derive(function(){return{projectionMatrix:new r}},function(){this.update()},{update:function(t){e.prototype.update.call(this,t),this.updateProjectionMatrix()}});return n}),n("3d/camera/orthographic",["require","../camera"],function(t){var e=t("../camera"),r=e.derive(function(){return{left:-1,right:1,near:0,far:1,top:1,bottom:-1}},{updateProjectionMatrix:function(){this.projectionMatrix.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far)}});return r}),n("3d/compositor/graph/graph",["require","core/base","_"],function(t){var e=t("core/base"),r=t("_"),n=e.derive(function(){return{nodes:[]}},{add:function(t){this.nodes.push(t),this.dirty("graph")},remove:function(t){r.without(this.nodes,t),this.dirty("graph")},update:function(){for(var t=0;this.nodes.length>t;t++)this.nodes[t].clear();for(var t=0;this.nodes.length>t;t++){var e=this.nodes[t];if(e.inputs)for(var r in e.inputs){var n=e.inputs[r],i=this.findPin(n);i?e.link(r,i.node,i.pin):console.warn("Pin of "+n.node+"."+n.pin+" not exist")}}},findPin:function(t){var e;if("string"==typeof t.node)for(var r=0;this.nodes.length>r;r++){var n=this.nodes[r];n.name===t.node&&(e=n)}else e=t.node;return e&&e.outputs[t.pin]?{node:e,pin:t.pin}:void 0},fromJSON:function(){}});return n}),n("3d/compositor",["require","./compositor/graph/graph"],function(t){var e=t("./compositor/graph/graph"),r=e.derive(function(){return{}},{render:function(t){this.isDirty("graph")&&(this.update(),this.fresh("graph"));for(var e=0;this.nodes.length>e;e++){var r=this.nodes[e];r.outputs||r.render(t),r.updateReference()}}});return r}),n("3d/scene",["require","./node"],function(t){var e=t("./node"),r=e.derive(function(){return{material:null,lightNumber:{},lightUniforms:{},filter:null}},{});return r}),n("3d/geometry",["require","core/base","util/util","glmatrix","_"],function(t){var e=t("core/base"),r=t("util/util"),n=t("glmatrix"),i=n.vec3;n.vec2,n.mat2;var a=n.mat4;t("_");var o=Array.prototype.slice,s=e.derive(function(){return{__GUID__:r.genGUID(),attributes:{position:{type:"float",semantic:"POSITION",size:3,value:[]},texcoord0:{type:"float",semantic:"TEXCOORD_0",size:2,value:[]},texcoord1:{type:"float",semantic:"TEXCOORD_1",size:2,value:[]},normal:{type:"float",semantic:"NORMAL",size:3,value:[]},tangent:{type:"float",semantic:"TANGENT",size:4,value:[]},color:{type:"ubyte",semantic:"COLOR",size:3,value:[]},barycentric:{type:"float",size:3,value:[]},boneWeight:{type:"float",size:3,value:[]},boneIndex:{type:"float",size:4,value:[]}},useFaces:!0,faces:[],hint:"STATIC_DRAW",chunkSize:65535,_enabledAttributes:null,_verticesNumber:0,_normalType:"vertex",_arrayChunks:[],_verticesReorganizedMap:[],_reorganizedFaces:[]}},{dirty:function(t){if(t){for(var e in this.cache._caches)this.cache._caches[e]["dirty_"+t]=!0;this._enabledAttributes=null}else{this.dirty("indices");for(var r in this.attributes)this.dirty(r)}},getVerticesNumber:function(){return this._verticesNumber=this.attributes.position.value.length,this._verticesNumber},getEnabledAttributes:function(){if(this._enabledAttributes)return this._enabledAttributes;var t={},e=this.getVerticesNumber();for(var r in this.attributes){var n=this.attributes[r];n.value&&n.value.length&&n.value.length===e&&(t[r]=n)}return this._enabledAttributes=t,t},getDirtyAttributes:function(){var t={},e=this.getEnabledAttributes(),r=!0;for(var n in e)e[n],(this.cache.get("dirty_"+n)||this.cache.miss("dirty_"+n))&&(t[n]=e[n],r=!1);return r?void 0:t},getChunkNumber:function(){return this._arrayChunks.length},getBufferChunks:function(t){this.cache.use(t.__GUID__);var e=this.cache.getContext(),r=this.getDirtyAttributes(),n=this.cache.get("dirty_faces")||this.cache.miss("dirty_faces");if(r){this._updateAttributesAndIndicesArrays(r,n),this._updateBuffer(t,r,n);for(var i in r)e["dirty_"+i]=!1}return this.cache.get("chunks")},_updateAttributesAndIndicesArrays:function(t,e){var r=this,n={},i=this.getVerticesNumber(),a=this._verticesReorganizedMap,o={};for(var s in t){switch(U){case"byte":o[s]=Int8Array;break;case"ubyte":o[s]=Uint8Array;break;case"short":o[s]=Int16Array;break;case"ushort":o[s]=Uint16Array;break;default:o[s]=Float32Array}n[s]=0}var u=function(e){if(r._arrayChunks[e])return r._arrayChunks[e];var o={attributeArrays:{},indicesArray:null};for(var s in t)o.attributeArrays[s]=null;for(var s in n)n[s]=0;for(var u=0;i>u;u++)a[u]=-1;return r._arrayChunks.push(o),o},c=Object.keys(t);if(i>this.chunkSize&&this.useFaces){var h,l=0,f=0,d=[0],p=[];for(v=0;i>v;v++)p[v]=-1,a[v]=-1;if(e&&this._reorganizedFaces.length!==this.faces.length)for(v=0;this.faces.length>v;v++)this._reorganizedFaces[v]=[0,0,0];h=u(f);for(var v=0;this.faces.length>v;v++){var m=this.faces[v],_=this._reorganizedFaces[v],g=m[0],y=m[1],x=m[2];l+3>this.chunkSize&&(f++,d[f]=v,l=0,h=u(f));for(var b=-1===a[g],E=-1===a[y],T=-1===a[x],A=0;c.length>A;A++){var s=c[A],w=h.attributeArrays[s],R=t[s].value,O=t[s].size;if(w||(w=h.attributeArrays[s]=[]),1===O)b&&(w[n[s]++]=R[g]),E&&(w[n[s]++]=R[y]),T&&(w[n[s]++]=R[x]);else{if(b)for(var I=0;O>I;I++)w[n[s]++]=R[g][I];if(E)for(var I=0;O>I;I++)w[n[s]++]=R[y][I];if(T)for(var I=0;O>I;I++)w[n[s]++]=R[x][I]}}b?(a[g]=l,_[0]=l,l++):_[0]=a[g],E?(a[y]=l,_[1]=l,l++):_[1]=a[y],T?(a[x]=l,_[2]=l,l++):_[2]=a[x]}for(var P=0;this._arrayChunks.length>P;P++){var S=this._arrayChunks[P];for(var s in S.attributeArrays){var D=S.attributeArrays[s];D instanceof Array&&(S.attributeArrays[s]=new o[s](D))}}if(e)for(var M,N,C,S,P=0;this._arrayChunks.length>P;P++){M=d[P],N=d[P+1]||this.faces.length,C=0,S=this._arrayChunks[P];var B=S.indicesArray;B||(B=S.indicesArray=new Uint16Array(3*(N-M)));for(var v=M;N>v;v++)B[C++]=this._reorganizedFaces[v][0],B[C++]=this._reorganizedFaces[v][1],B[C++]=this._reorganizedFaces[v][2]}}else{var S=u(0);if(this.useFaces){var B=S.indicesArray;B||(B=S.indicesArray=new Uint16Array(3*this.faces.length));for(var C=0,v=0;this.faces.length>v;v++)B[C++]=this.faces[v][0],B[C++]=this.faces[v][1],B[C++]=this.faces[v][2]}for(var s in t){var R=t[s].value,U=t[s].type,O=t[s].size,w=S.attributeArrays[s];if(w||(w=S.attributeArrays[s]=new o[s](i*O)),1===O)for(var v=0;R.length>v;v++)w[v]=R[v];else for(var C=0,v=0;R.length>v;v++)for(var I=0;O>I;I++)w[C++]=R[v][I]}}},_updateBuffer:function(t,e,r){var n=this.cache.get("chunks");if(!n){n=[];for(var i=0;this._arrayChunks.length>i;i++)n[i]={attributeBuffers:{},indicesBuffer:null};this.cache.put("chunks",n)}for(var i=0;n.length>i;i++){var a=n[i];a||(a=n[i]={attributeBuffers:{},indicesBuffer:null});var o=a.attributeBuffers,s=a.indicesBuffer,u=this._arrayChunks[i],c=u.attributeArrays,h=u.indicesArray;for(var l in e){var f,d=e[l],p=(d.value,d.type),v=d.semantic,m=d.size,_=o[l];f=_?_.buffer:t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,f),t.bufferData(t.ARRAY_BUFFER,c[l],t[this.hint]),o[l]={type:p,buffer:f,size:m,semantic:v}}r&&this.useFaces&&(s||(s=a.indicesBuffer={buffer:t.createBuffer(),count:h.length}),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,h,t[this.hint]))}},generateVertexNormals:function(){var t=this.faces,e=(t.length,this.attributes.position.value),r=this.attributes.normal.value,n=i.create();v12=i.create(),v23=i.create(),e.length-r.length;for(var a=0;r.length>a;a++)i.set(r[a],0,0,0);for(var a=r.length;e.length>a;a++)r[a]=[0,0,0];for(var o=0;this.faces.length>o;o++){var s=t[o],u=s[0],c=s[1],h=s[2],l=e[u],f=e[c],d=e[h];i.sub(v12,l,f),i.sub(v23,f,d),i.cross(n,v12,v23),i.add(r[u],r[u],n),i.add(r[c],r[c],n),i.add(r[h],r[h],n)}for(var a=0;r.length>a;a++)i.normalize(r[a],r[a]);this._normalType="vertex"},generateFaceNormals:function(){this.isUniqueVertex()||this.generateUniqueVertex();var t=this.faces,e=t.length,r=this.attributes.position.value,n=this.attributes.normal.value,a=i.create();v12=i.create(),v23=i.create();for(var s=n.length===r.length,u=0;e>u;u++){var c=t[u],h=c[0],l=c[1],f=c[2],d=r[h],p=r[l],v=r[f];i.sub(v12,d,p),i.sub(v23,p,v),i.cross(a,v12,v23),s?(i.copy(n[h],a),i.copy(n[l],a),i.copy(n[f],a)):n[h]=n[l]=n[f]=o.call(a)}this._normalType="face"},generateTangents:function(){for(var t=this.attributes.texcoord0.value,e=this.attributes.position.value,r=this.attributes.tangent.value,n=this.attributes.normal.value,a=[],o=[],s=this.getVerticesNumber(),u=0;s>u;u++)a[u]=[0,0,0],o[u]=[0,0,0];for(var c=[0,0,0],h=[0,0,0],u=0;this.faces.length>u;u++){var l=this.faces[u],f=l[0],d=l[1],p=l[2],v=t[f],m=t[d],_=t[p],g=e[f],y=e[d],x=e[p],b=y[0]-g[0],E=x[0]-g[0],T=y[1]-g[1],A=x[1]-g[1],w=y[2]-g[2],R=x[2]-g[2],O=m[0]-v[0],I=_[0]-v[0],P=m[1]-v[1],S=_[1]-v[1],D=1/(O*S-P*I);c[0]=(S*b-P*E)*D,c[1]=(S*T-P*A)*D,c[2]=(S*w-P*R)*D,h[0]=(O*E-I*b)*D,h[1]=(O*A-I*T)*D,h[2]=(O*R-I*w)*D,i.add(a[f],a[f],c),i.add(a[d],a[d],c),i.add(a[p],a[p],c),i.add(o[f],o[f],h),i.add(o[d],o[d],h),i.add(o[p],o[p],h)}for(var M=[0,0,0,0],N=[0,0,0],u=0;s>u;u++){var C=n[u],B=a[u];i.scale(M,C,i.dot(C,B)),i.sub(M,B,M),i.normalize(M,M),i.cross(N,C,B),M[3]=0>i.dot(N,o[u])?-1:1,r[u]=M.slice()}},isUniqueVertex:function(){return this.faces.length&&this.useFaces?this.getVerticesNumber()===3*this.faces.length:!0},generateUniqueVertex:function(){function t(t){for(var e in i){var r=i[e].value,n=r[0].length||1;1===n?r.push(r[t]):r.push(o.call(r[t]))}}for(var e=[],r=0;this.getVerticesNumber()>r;r++)e[r]=0;for(var n=this.getVerticesNumber(),i=this.getEnabledAttributes(),a=this.faces,r=0;a.length>r;r++){var s=a[r],u=s[0],c=s[1],h=s[2];e[u]>0&&(t(u),s[0]=n,n++),e[c]>0&&(t(c),s[1]=n,n++),e[h]>0&&(t(h),s[2]=n,n++),e[u]++,e[c]++,e[h]++}this.dirty()},generateBarycentric:function(){var t=[1,0,0],e=[0,0,1],r=[0,1,0];return function(){this.isUniqueVertex()||this.generateUniqueVertex();var n=this.attributes.barycentric.value;if(n.length!=3*this.faces.length)for(var i,a,o,s,u=0;this.faces.length>u;u++)s=this.faces[u],i=s[0],a=s[1],o=s[2],n[i]=t,n[a]=e,n[o]=r}}(),applyMatrix:function(t){var e=this.attributes.position.value,r=this.attributes.normal.value;t=t._array;for(var n=0;e.length>n;n++)i.transformMat4(e[n],e[n],t);var o=a.create();a.invert(o,t),a.transpose(o,o);for(var n=0;r.length>n;n++)i.transformMat4(r[n],r[n],o)},dispose:function(){}});return s}),n("3d/geometry/plane",["require","../geometry"],function(t){var e=t("../geometry"),r=e.derive(function(){return{widthSegments:1,heightSegments:1}},function(){for(var t=this.heightSegments,e=this.widthSegments,r=this.attributes.position.value,n=this.attributes.texcoord0.value,i=this.attributes.normal.value,a=this.faces,o=0;t>=o;o++)for(var s=o/t,u=0;e>=u;u++){var c=u/e;if(r.push([2*c-1,2*s-1,0]),n&&n.push([c,s]),i&&i.push([0,0,1]),e>u&&t>o){var h=u+o*(e+1);a.push([h,h+1,h+e+1]),a.push([h+e+1,h+1,h+e+2])}}});return r}),n("3d/shader",["require","core/base","glmatrix","util/util","_"],function(t){function e(t){for(var e=t.split("\n"),r=0,n=e.length;n>r;r++)e[r]=r+1+": "+e[r];return e.join("\n")}var r=t("core/base"),n=t("glmatrix"),i=n.mat2;mat3=n.mat3,mat4=n.mat4,util=t("util/util"),_=t("_");var a=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+(\w+)?(\[.*?\])?\s*(:\s*([\S\s]+?))?;/g,o=/attribute\s+(float|int|vec2|vec3|vec4)\s+(\w*)\s*(:\s*(\w+))?;/g,s={bool:"1i","int":"1i",sampler2D:"t",samplerCube:"t","float":"1f",vec2:"2f",vec3:"3f",vec4:"4f",ivec2:"2i",ivec3:"3i",ivec4:"4i",mat2:"m2",mat3:"m3",mat4:"m4"},u={bool:function(){return!0},"int":function(){return 0},"float":function(){return 0},sampler2D:function(){return null},samplerCube:function(){return null},vec2:function(){return new Float32Array(2)},vec3:function(){return new Float32Array(3)},vec4:function(){return new Float32Array(4)},ivec2:function(){return new Int32Array(2)},ivec3:function(){return new Int32Array(3)},ivec4:function(){return new Int32Array(4)},mat2:function(){return i.create()},mat3:function(){return mat3.create()},mat4:function(){return mat4.create()},array:function(){return[]}},c=["POSITION","NORMAL","BINORMAL","TANGENT","TEXCOORD","TEXCOORD_0","TEXCOORD_1","COLOR","WORLD","VIEW","PROJECTION","WORLDVIEW","VIEWPROJECTION","WORLDVIEWPROJECTION","WORLDINVERSE","VIEWINVERSE","PROJECTIONINVERSE","WORLDVIEWINVERSE","VIEWPROJECTIONINVERSE","WORLDVIEWPROJECTIONINVERSE","WORLDTRANSPOSE","VIEWTRANSPOSE","PROJECTIONTRANSPOSE","WORLDVIEWTRANSPOSE","VIEWPROJECTIONTRANSPOSE","WORLDVIEWPROJECTIONTRANSPOSE","WORLDINVERSETRANSPOSE","VIEWINVERSETRANSPOSE","PROJECTIONINVERSETRANSPOSE","WORLDVIEWINVERSETRANSPOSE","VIEWPROJECTIONINVERSETRANSPOSE","WORLDVIEWPROJECTIONINVERSETRANSPOSE"],h={},l={},f=r.derive(function(){return{__GUID__:util.genGUID(),vertex:"",fragment:"",precision:"mediump",semantics:{},uniformTemplates:{},attributeTemplates:{},vertexDefines:{},fragmentDefines:{},lightNumber:{},_textureStatus:{},_vertexProcessed:"",_fragmentProcessed:"",_program:null}
},function(){this.update()},{setVertex:function(t){this.vertex=t,this.update()},setFragment:function(t){this.fragment=t,this.update()},bind:function(t){this.cache.use(t.__GUID__,{locations:{},attriblocations:{}}),(this.cache.get("dirty")||this.cache.miss("program"))&&(this._buildProgram(t,this._vertexProcessed,this._fragmentProcessed),this.cache.put("dirty",!1)),t.useProgram(this.cache.get("program"))},dirty:function(){for(var t in this.cache._caches){var e=this.cache._caches[t];e.dirty=!0,e.locations={},e.attriblocations={}}},update:function(t){(this.vertex!==this._vertexPrev||this.fragment!==this._fragmentPrev||t)&&(this._parseImport(),this.semantics={},this._textureStatus={},this._parseUniforms(),this._parseAttributes(),this._vertexPrev=this.vertex,this._fragmentPrev=this.fragment),this._addDefine(),this.dirty()},enableTexture:function(t,e){var r=this._textureStatus[t];if(r){var n=r.enabled;if(n)return;r.enabled=!0;var e=e===void 0||!0;e&&this.update()}},enableTexturesAll:function(t){for(var e in this._textureStatus)this._textureStatus[e].enabled=!0;var t=t===void 0||!0;t&&this.update()},disableTexture:function(t,e){var r=this._textureStatus[t];if(r){var n=!r.enabled;if(n)return;r.enabled=!1;var e=e===void 0||!0;e&&this.update()}},disableTexturesAll:function(t,e){for(var t in this._textureStatus)this._textureStatus[t].enabled=!1;var e=e===void 0||!0;e&&this.update()},setUniform:function(t,e,r,n){var i=this.cache.get("program"),a=this.cache.get("locations"),o=a[r];if(null!==o){if(!o){if(o=t.getUniformLocation(i,r),null===o)return a[r]=null,void 0;a[r]=o}switch(e){case"1i":t.uniform1i(o,n);break;case"1f":t.uniform1f(o,n);break;case"1fv":t.uniform1fv(o,n);break;case"1iv":t.uniform1iv(o,n);break;case"2iv":t.uniform2iv(o,n);break;case"2fv":t.uniform2fv(o,n);break;case"3iv":t.uniform3iv(o,n);break;case"3fv":t.uniform3fv(o,n);break;case"4iv":t.uniform4iv(o,n);break;case"4fv":t.uniform4fv(o,n);break;case"2i":t.uniform2i(o,n[0],n[1]);break;case"2f":t.uniform2f(o,n[0],n[1]);break;case"3i":t.uniform3i(o,n[0],n[1],n[2]);break;case"3f":t.uniform3f(o,n[0],n[1],n[2]);break;case"4i":t.uniform4i(o,n[0],n[1],n[2],n[3]);break;case"4f":t.uniform4f(o,n[0],n[1],n[2],n[3]);break;case"m2":t.uniformMatrix2fv(o,!1,n);break;case"m3":t.uniformMatrix3fv(o,!1,n);break;case"m4":t.uniformMatrix4fv(o,!1,n);break;case"m2v":var s=4;case"m3v":var s=9;case"m4v":var s=16;if(n instanceof Array){for(var u=new Float32Array(n.length*s),c=0,h=0;n.length>h;h++)for(var l=n[h],f=0;l.length>f;f++)u[c++]=l[f];t.uniformMatrix4fv(o,!1,u)}else n instanceof Float32Array&&t.uniformMatrix4fv(o,!1,n)}}},enableAttributes:function(t,e){var r=this.cache.get("program"),n=this.cache.get("attriblocations");"string"==typeof e&&(e=Array.prototype.slice.call(arguments,1));var i=l[t.__GUID__];i||(i=l[t.__GUID__]=[]);for(var a in this.attributeTemplates){var o=n[a];if(o===void 0){if(o=t.getAttribLocation(r,a),-1===o)continue;n[a]=o}e.indexOf(a)>=0?i[o]||(t.enableVertexAttribArray(o),i[o]=!0):i[o]&&(t.disableVertexAttribArray(o),i[o]=!1)}},setMeshAttribute:function(t,e,r,n){var i;switch(r){case"byte":i=t.BYTE;break;case"ubyte":i=t.UNSIGNED_BYTE;break;case"short":i=t.SHORT;break;case"ushort":i=t.UNSIGNED_SHORT;break;default:i=t.FLOAT}var a=this.cache.get("program"),o=this.cache.get("attriblocations"),s=o[e];if(s===void 0){if(s=t.getAttribLocation(a,e),-1===s)return;o[e]=s}t.vertexAttribPointer(s,n,i,!1,0,0)},_parseImport:function(){this._vertexProcessedWithoutDefine=f.parseImport(this.vertex),this._fragmentProcessedWithoutDefine=f.parseImport(this.fragment)},_addDefine:function(){var t=[];_.each(this.lightNumber,function(e,r){e&&t.push("#define "+r.toUpperCase()+"_NUMBER "+e)}),_.each(this._textureStatus,function(e,r){e.enabled&&"vertex"===e.shaderType&&t.push("#define "+r.toUpperCase()+"_ENABLED")}),_.each(this.vertexDefines,function(e,r){null===e?t.push("#define "+r):t.push("#define "+r+" "+(""+e))}),this._vertexProcessed=t.join("\n")+"\n"+this._vertexProcessedWithoutDefine,t=[],_.each(this.lightNumber,function(e,r){e&&t.push("#define "+r+"_NUMBER "+e)}),_.each(this._textureStatus,function(e,r){e.enabled&&"fragment"===e.shaderType&&t.push("#define "+r.toUpperCase()+"_ENABLED")}),_.each(this.fragmentDefines,function(e,r){null===e?t.push("#define "+r):t.push("#define "+r+" "+(""+e))});var e=t.join("\n")+"\n"+this._fragmentProcessedWithoutDefine;this._fragmentProcessed=["precision",this.precision,"float"].join(" ")+";\n"+e},_parseUniforms:function(){function t(t,i,a,o,h,l){if(i&&a){var f=s[i],d=!0;if(f){if(("sampler2D"===i||"samplerCube"===i)&&(r._textureStatus[a]={enabled:!1,shaderType:n}),o&&(f+="v"),l)if(0>c.indexOf(l))if("unconfigurable"===l)d=!1;else{var p=r._parseDefaultValue(i,l);p?l="":console.warn('Unkown semantic "'+l+'"')}else r.semantics[l]={symbol:a,type:f},d=!1;d&&(e[a]={type:f,value:o?u.array:p||u[i],semantic:l||null})}return["uniform",i,a,o].join(" ")+";\n"}}var e={},r=this,n="vertex";this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(a,t),n="fragment",this._fragmentProcessedWithoutDefine=this._fragmentProcessedWithoutDefine.replace(a,t),this.uniformTemplates=e},_parseDefaultValue:function(t,e){var r=/\[\s*(.*)\s*\]/;{if("vec2"!==t&&"vec3"!==t&&"vec4"!==t)return"bool"===t?function(){return"true"===e.toLowerCase()?!0:!1}:"float"===t?function(){return parseFloat(e)}:void 0;var n=r.exec(e)[1];if(n){var i=n.split(/\s*,\s*/);return function(){return new Float32Array(i)}}}},createUniforms:function(){var t={};return _.each(this.uniformTemplates,function(e,r){t[r]={type:e.type,value:e.value()}}),t},_parseAttributes:function(){function t(t,n,i,a,o){if(n&&i){var s=1;switch(n){case"vec4":s=4;break;case"vec3":s=3;break;case"vec2":s=2;break;case"float":s=1}e[i]={type:"float",size:s,semantic:o||null},o&&(0>c.indexOf(o)?console.warn('Unkown semantic "'+o+'"'):r.semantics[o]={symbol:i,type:n})}return["attribute",n,i].join(" ")+";\n"}var e={},r=this;this._vertexProcessedWithoutDefine=this._vertexProcessedWithoutDefine.replace(o,t),this.attributeTemplates=e},_buildProgram:function(t,e,r){this.cache.get("program")&&t.deleteProgram(this.cache.get("program"));var n=t.createProgram();try{var i=this._compileShader(t,"vertex",e),a=this._compileShader(t,"fragment",r);if(t.attachShader(n,i),t.attachShader(n,a),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw Error("Could not initialize shader\nVALIDATE_STATUS: "+t.getProgramParameter(n,t.VALIDATE_STATUS)+", gl error ["+t.getError()+"]")}catch(o){if(h[this.__GUID__])return;throw h[this.__GUID__]=this,o}t.deleteShader(i),t.deleteShader(a),this.cache.put("program",n)},_compileShader:function(t,r,n){var i=t.createShader("fragment"===r?t.FRAGMENT_SHADER:t.VERTEX_SHADER);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw Error([t.getShaderInfoLog(i),e(n)].join("\n"));return i},dispose:function(){}}),d=/(@import)\s*([0-9a-zA-Z_\-\.]*)/g;f.parseImport=function(t){return t=t.replace(d,function(t,e,r){return v[r]?f.parseImport(v[r]):void 0})};var p=/(@export)\s*([0-9a-zA-Z_\-\.]*)\s*\n([\s\S]*?)@end/g;f.import=function(t){t.replace(p,function(t,e,r,n){return v[r]=n,n})};var v={};return f.source=function(t){var e=v[t];return e?e:(console.error('Shader "'+t+'" not existed in library'),void 0)},f}),n("3d/texture",["require","core/base","_"],function(t){var e=t("core/base");t("_");var r=e.derive(function(){return{width:512,height:512,type:"UNSIGNED_BYTE",format:"RGBA",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE",minFilter:"LINEAR_MIPMAP_LINEAR",magFilter:"LINEAR",generateMipmaps:!0,anisotropic:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1,NPOT:!1}},{getWebGLTexture:function(t){return this.cache.use(t.__GUID__),this.cache.miss("webgl_texture")&&(this.cache.put("webgl_texture",t.createTexture()),this.cache.put("dirty",!0)),this.cache.get("dirty")&&(this.update(t),this.cache.put("dirty",!1)),this.cache.get("webgl_texture")},bind:function(){},unbind:function(){},dirty:function(){for(var t in this.cache._caches)this.cache._caches[t].dirty=!0},update:function(){},beforeUpdate:function(t){t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,this.unpackAlignment),this.fallBack()},fallBack:function(){var t=this.isPowerOfTwo();"DEPTH_COMPONENT"===this.format&&(this.generateMipmaps=!1),t&&this.generateMipmaps?(this._minFilterOriginal&&(this.minFilter=this._minFilterOriginal),this._magFilterOriginal&&(this.magFilter=this._magFilterOriginal),this._wrapSOriginal&&(this.wrapS=this._wrapSOriginal),this._wrapTOriginal&&(this.wrapT=this._wrapTOriginal)):(this.NPOT=!0,this._minFilterOriginal=this.minFilter,this._magFilterOriginal=this.magFilter,this._wrapSOriginal=this.wrapS,this._wrapTOriginal=this.wrapT,this.minFilter=0==this.minFilter.indexOf("NEAREST")?"NEAREST":"LINEAR",this.magFilter=0==this.magFilter.indexOf("NEAREST")?"NEAREST":"LINEAR",this.wrapS="CLAMP_TO_EDGE",this.wrapT="CLAMP_TO_EDGE")},nextHighestPowerOfTwo:function(t){--t;for(var e=1;32>e;e<<=1)t|=t>>e;return t+1},dispose:function(t){this.cache.use(t.__GUID__),t.deleteTexture(this.cache.get("webgl_texture"))},isRenderable:function(){},isPowerOfTwo:function(){}});return r}),n("3d/webglinfo",[],function(){var t=["OES_texture_float","OES_texture_half_float","OES_standard_derivatives","OES_vertex_array_object","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_depth_texture","EXT_texture_filter_anisotropic","EXT_draw_buffers"],e=!1,r={},n={initialize:function(n){if(!e){for(var i=0;t.length>i;i++){var a=t[i],o=n.getExtension(a);o||(o=n.getExtension("MOZ_"+a)),o||(o=n.getExtension("WEBKIT_"+a)),r[a]=o}e=!0}},getExtension:function(t){return r[t]}};return n}),n("3d/texture/texture2d",["require","../texture","../webglinfo"],function(t){var e=t("../texture"),r=t("../webglinfo"),n=e.derive({image:null,pixels:null},{update:function(t){t.bindTexture(t.TEXTURE_2D,this.cache.get("webgl_texture")),this.beforeUpdate(t);var e=t[this.format.toUpperCase()],n=t[this.type.toUpperCase()];t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[this.wrapS.toUpperCase()]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[this.wrapT.toUpperCase()]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[this.magFilter.toUpperCase()]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[this.minFilter.toUpperCase()]);var i=r.getExtension("EXT_texture_filter_anisotropic");i&&this.anisotropic>1&&t.texParameterf(t.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),this.image?this.image.complete&&t.texImage2D(t.TEXTURE_2D,0,e,e,n,this.image):t.texImage2D(t.TEXTURE_2D,0,e,this.width,this.height,0,e,n,this.pixels),!this.NPOT&&this.generateMipmaps&&t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},isPowerOfTwo:function(){if(this.image)var t=this.image.width,e=this.image.height;else var t=this.width,e=this.height;return 0===(t&t-1)&&0===(e&e-1)},isRenderable:function(){return this.image?this.image.complete:this.width&&this.height},bind:function(t){t.bindTexture(t.TEXTURE_2D,this.getWebGLTexture(t))},unbind:function(t){t.bindTexture(t.TEXTURE_2D,null)}});return n}),n("3d/texture/texturecube",["require","../texture","../webglinfo","_"],function(t){var e=t("../texture"),r=t("../webglinfo"),n=t("_"),i={px:"TEXTURE_CUBE_MAP_POSITIVE_X",py:"TEXTURE_CUBE_MAP_POSITIVE_Y",pz:"TEXTURE_CUBE_MAP_POSITIVE_Z",nx:"TEXTURE_CUBE_MAP_NEGATIVE_X",ny:"TEXTURE_CUBE_MAP_NEGATIVE_Y",nz:"TEXTURE_CUBE_MAP_NEGATIVE_Z"},a=e.derive({image:{px:null,nx:null,py:null,ny:null,pz:null,nz:null},pixels:{px:null,nx:null,py:null,ny:null,pz:null,nz:null}},{update:function(t){t.bindTexture(t.TEXTURE_CUBE_MAP,this.cache.get("webgl_texture")),this.beforeUpdate(t);var e=t[this.format.toUpperCase()],a=t[this.type.toUpperCase()];t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t[this.wrapS.toUpperCase()]),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t[this.wrapT.toUpperCase()]),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t[this.magFilter.toUpperCase()]),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t[this.minFilter.toUpperCase()]);var o=r.getExtension("EXT_texture_filter_anisotropic");o&&this.anisotropic>1&&t.texParameterf(t.TEXTURE_CUBE_MAP,o.TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropic),n.each(this.image,function(r,n){r?t.texImage2D(t[i[n]],0,e,e,a,r):t.texImage2D(t[i[n]],0,e,this.width,this.height,0,e,a,this.pixels[n])},this),!this.NPOT&&this.generateMipmaps&&t.generateMipmap(t.TEXTURE_CUBE_MAP),t.bindTexture(t.TEXTURE_CUBE_MAP,null)},bind:function(t){t.bindTexture(t.TEXTURE_CUBE_MAP,this.getWebGLTexture(t))},unbind:function(t){t.bindTexture(t.TEXTURE_CUBE_MAP,null)},isPowerOfTwo:function(){function t(t){return t&0===t-1}return this.image.px?t(this.image.px.width)&&t(this.image.px.height):t(this.width)&&t(this.height)},isRenderable:function(){return this.image.px?this.image.px.complete&&this.image.nx.complete&&this.image.py.complete&&this.image.ny.complete&&this.image.pz.complete&&this.image.nz.complete:this.width&&this.height}});return a}),n("3d/material",["require","core/base","./shader","util/util","./texture","./texture/texture2d","./texture/texturecube","_"],function(t){var e=t("core/base");t("./shader");var r=t("util/util"),n=t("./texture");t("./texture/texture2d"),t("./texture/texturecube");var i=t("_"),a=e.derive(function(){var t=r.genGUID();return{__GUID__:t,name:"MATERIAL_"+t,uniforms:{},shader:null,depthTest:!0,depthWrite:!0,transparent:!1,blend:null,autoBindingLights:!0}},function(){this.shader&&this.attachShader(this.shader)},{bind:function(t){var e=0;i.each(this.uniforms,function(r,i){if(!(null===r.value||r.value instanceof Array&&!r.value.length))if(r.value.instanceof&&r.value.instanceof(n)){var a=r.value;if(!a.isRenderable())return;t.activeTexture(t.TEXTURE0+e),a.bind(t),this.shader.setUniform(t,"1i",i,e),e++}else if(r.value instanceof Array){var o=r.value[0];if(o&&o.instanceof&&o.instanceof(n)){for(var s=[],u=0;r.value.length>u;u++){var a=r.value[u];a.isRenderable()&&(t.activeTexture(t.TEXTURE0+e),a.bind(t),s.push(e++))}this.shader.setUniform(t,"1iv",i,s)}else this.shader.setUniform(t,r.type,i,r.value)}else this.shader.setUniform(t,r.type,i,r.value)},this)},setUniform:function(t,e){var r=this.uniforms[t];r&&(r.value=e)},setUniforms:function(t){for(var e in t){var r=t[e];this.setUniform(e,r)}},getUniform:function(t){var e=this.uniforms[t];return e?e.value:void 0},attachShader:function(t){this.uniforms=t.createUniforms(),this.shader=t},detachShader:function(){this.shader=null,this.uniforms={}}});return a}),n("3d/mesh",["require","./node","_"],function(t){var e=t("./node");t("_");var r=0,n=e.derive(function(){return{material:null,geometry:null,mode:"TRIANGLES",receiveShadow:!0,castShadow:!0,skeleton:null}},{render:function(t,e){var n=t.gl;this.trigger("beforerender",n);var i=e||this.material,a=i.shader,o=this.geometry,s=n[this.mode.toUpperCase()];if(this.skeleton){var u=this.skeleton.getBoneMatricesArray();a.setUniform(n,"m4v","boneMatrices",u)}for(var c=o.getBufferChunks(n),h=0;c.length>h;h++){currentDrawID=n.__GUID__+"_"+o.__GUID__+"_"+h;var l=c[h],f=l.attributeBuffers,d=l.indicesBuffer;if(currentDrawID!==r){r=currentDrawID,availableAttributes={};for(var p in f){var v=f[p],m=v.semantic;if(m)var _=a.semantics[m],g=_&&_.symbol;else var g=p;g&&a.attributeTemplates[g]&&(availableAttributes[g]=v)}a.enableAttributes(n,Object.keys(availableAttributes));for(var g in availableAttributes){var v=availableAttributes[g],y=v.buffer;n.bindBuffer(n.ARRAY_BUFFER,y),a.setMeshAttribute(n,g,v.type,v.size)}}o.useFaces?(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,d.buffer),n.drawElements(s,d.count,n.UNSIGNED_SHORT,0)):n.drawArrays(s,0,o.vertexCount)}var x={faceNumber:o.faces.length,vertexNumber:o.getVerticesNumber(),drawcallNumber:c.length};return this.trigger("afterrender",n,x),x},bindGeometry:function(){this.material.shader,this.geometry}});return n.materialChanged=function(){r=0},n}),n("3d/compositor/shaders/vertex.essl",[],function(){return"uniform mat4 worldViewProjection : WORLDVIEWPROJECTION;\n\nattribute vec3 position : POSITION;\nattribute vec2 texcoord : TEXCOORD_0;\n\nvarying vec2 v_Texcoord;\n\nvoid main(){\n\n    v_Texcoord = texcoord;\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n}"}),n("3d/compositor/shaders/coloradjust.essl",[],function(){return'@export buildin.compositor.coloradjust\n\nvarying vec2 v_Texcoord;\nuniform sampler2D texture;\n\nuniform float brightness;\nuniform float contrast;\nuniform float exposure;\nuniform float gamma;\nuniform float saturation;\n\n// Values from "Graphics Shaders: Theory and Practice" by Bailey and Cunningham\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord);\n\n    // brightness\n    vec3 color = clamp( tex.rgb + vec3(brightness), 0.0, 1.0);\n    // contrast\n    color = clamp( (color-vec3(0.5))*contrast+vec3(0.5), 0.0, 1.0);\n    // exposure\n    color = clamp( color * pow(2.0, exposure), 0.0, 1.0);\n    // gamma\n    color = clamp( pow(color, vec3(gamma)), 0.0, 1.0);\n    // saturation\n    float luminance = dot( color, w );\n    color = mix(vec3(luminance), color, saturation);\n    \n    gl_FragColor = vec4(color, tex.a);\n}\n\n@end'}),n("3d/compositor/shaders/blur.essl",[],function(){return"/**\n *  http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/\n */\n\n@export buildin.compositor.gaussian_blur_v\n\nuniform sampler2D texture; // the texture with the scene you want to blur\nvarying vec2 v_Texcoord;\n \nuniform float blurSize : 3.0; \nuniform float imageWidth : 512.0;\n\nvoid main(void)\n{\n   vec4 sum = vec4(0.0);\n \n   // blur in y (vertical)\n   // take nine samples, with the distance blurSize between them\n   sum += texture2D(texture, vec2(v_Texcoord.x - 4.0*blurSize/imageWidth, v_Texcoord.y)) * 0.05;\n   sum += texture2D(texture, vec2(v_Texcoord.x - 3.0*blurSize/imageWidth, v_Texcoord.y)) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x - 2.0*blurSize/imageWidth, v_Texcoord.y)) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x - blurSize/imageWidth, v_Texcoord.y)) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y)) * 0.16;\n   sum += texture2D(texture, vec2(v_Texcoord.x + blurSize/imageWidth, v_Texcoord.y)) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x + 2.0*blurSize/imageWidth, v_Texcoord.y)) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x + 3.0*blurSize/imageWidth, v_Texcoord.y)) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x + 4.0*blurSize/imageWidth, v_Texcoord.y)) * 0.05;\n \n   gl_FragColor = sum;\n}\n\n@end\n\n@export buildin.compositor.gaussian_blur_h\n\nuniform sampler2D texture; // this should hold the texture rendered by the horizontal blur pass\nvarying vec2 v_Texcoord;\n \nuniform float blurSize : 3.0;\nuniform float imageHeight : 512.0;\n \nvoid main(void)\n{\n   vec4 sum = vec4(0.0);\n \n   // blur in y (vertical)\n   // take nine samples, with the distance blurSize between them\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y - 4.0*blurSize/imageHeight)) * 0.05;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y - 3.0*blurSize/imageHeight)) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y - 2.0*blurSize/imageHeight)) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y - blurSize/imageHeight)) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y)) * 0.16;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y + blurSize/imageHeight)) * 0.15;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y + 2.0*blurSize/imageHeight)) * 0.12;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y + 3.0*blurSize/imageHeight)) * 0.09;\n   sum += texture2D(texture, vec2(v_Texcoord.x, v_Texcoord.y + 4.0*blurSize/imageHeight)) * 0.05;\n \n   gl_FragColor = sum;\n}\n\n@end\n\n@export buildin.compositor.box_blur\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 3.0;\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n\n   vec4 tex = texture2D(texture, v_Texcoord);\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   tex += texture2D(texture, v_Texcoord + vec2(offset.x, 0.0) );\n   tex += texture2D(texture, v_Texcoord + vec2(offset.x, offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(-offset.x, offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(0.0, offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(-offset.x, 0.0) );\n   tex += texture2D(texture, v_Texcoord + vec2(-offset.x, -offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(offset.x, -offset.y) );\n   tex += texture2D(texture, v_Texcoord + vec2(0.0, -offset.y) );\n\n   tex /= 9.0;\n   return tex;\n}\n\n@end\n\n// http://www.slideshare.net/DICEStudio/five-rendering-ideas-from-battlefield-3-need-for-speed-the-run\n@export buildin.compositor.hexagonal_blur_mrt_1\n\n// MRT in chrome\n// https://www.khronos.org/registry/webgl/sdk/tests/conformance/extensions/ext-draw-buffers.html\n#extension GL_EXT_draw_buffers : require\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 2.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color = vec4(0.0);\n   // Top\n   for(int i = 0; i < 10; i++){\n      color += 1.0/10.0 * texture2D(texture, v_Texcoord + vec2(0.0, offset.y * float(i)) );\n   }\n   gl_FragData[0] = color;\n   vec4 color2 = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color2 += 1.0/10.0 * texture2D(texture, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   gl_FragData[1] = (color + color2) / 2.0;\n}\n\n@end\n\n@export buildin.compositor.hexagonal_blur_mrt_2\n\nuniform sampler2D texture0;\nuniform sampler2D texture1;\n\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 2.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color1 = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color1 += 1.0/10.0 * texture2D(texture0, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   vec4 color2 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < 10; i++){\n      color2 += 1.0/10.0 * texture2D(texture1, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   gl_FragColor = (color1 + color2) / 2.0;\n}\n\n@end\n\n\n@export buildin.compositor.hexagonal_blur_1\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color = vec4(0.0);\n   // Top\n   for(int i = 0; i < 10; i++){\n      color += 1.0/10.0 * texture2D(texture, v_Texcoord + vec2(0.0, offset.y * float(i)) );\n   }\n   gl_FragColor = color;\n}\n\n@end\n\n@export buildin.compositor.hexagonal_blur_2\n\nuniform sampler2D texture;\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform float imageWidth : 512.0;\nuniform float imageHeight : 512.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color += 1.0/10.0 * texture2D(texture, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   gl_FragColor = color;\n}\n@end\n\n@export buildin.compositor.hexagonal_blur_3\n\nuniform sampler2D texture1;\nuniform sampler2D texture2;\n\nvarying vec2 v_Texcoord;\n\nuniform float blurSize : 1.0;\n\nuniform float imageWidth : 1.0;\nuniform float imageHeight : 1.0;\n\nvoid main(void){\n   vec2 offset = vec2(blurSize/imageWidth, blurSize/imageHeight);\n\n   vec4 color1 = vec4(0.0);\n   // Down left\n   for(int i = 0; i < 10; i++){\n      color1 += 1.0/10.0 * texture2D(texture1, v_Texcoord - vec2(offset.x * float(i), offset.y * float(i)) );\n   }\n   vec4 color2 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < 10; i++){\n      color2 += 1.0/10.0 * texture2D(texture1, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   vec4 color3 = vec4(0.0);\n   // Down right\n   for(int i = 0; i < 10; i++){\n      color3 += 1.0/10.0 * texture2D(texture2, v_Texcoord + vec2(offset.x * float(i), -offset.y * float(i)) );\n   }\n\n   gl_FragColor = (color1 + color2 + color3) / 3.0;\n}\n\n@end"}),n("3d/compositor/shaders/grayscale.essl",[],function(){return"\n@export buildin.compositor.grayscale\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\n\nconst vec3 w = vec3(0.2125, 0.7154, 0.0721);\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord );\n    float luminance = dot(tex.rgb, w);\n\n    gl_FragColor = vec4(vec3(luminance), tex.a);\n}\n\n@end"}),n("3d/compositor/shaders/lut.essl",[],function(){return"\n// https://github.com/BradLarson/GPUImage?source=c\n@export buildin.compositor.lut\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\nuniform sampler2D lookup;\n\nvoid main()\n{\n    vec4 tex = texture2D(texture, v_Texcoord);\n\n    float blueColor = tex.b * 63.0;\n    \n    vec2 quad1;\n    quad1.y = floor(floor(blueColor) / 8.0);\n    quad1.x = floor(blueColor) - (quad1.y * 8.0);\n    \n    vec2 quad2;\n    quad2.y = floor(ceil(blueColor) / 8.0);\n    quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n    \n    vec2 texPos1;\n    texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n    texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n    \n    vec2 texPos2;\n    texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.r);\n    texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * tex.g);\n    \n    vec4 newColor1 = texture2D(lookup, texPos1);\n    vec4 newColor2 = texture2D(lookup, texPos2);\n    \n    vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n    gl_FragColor = vec4(newColor.rgb, tex.w);\n}\n\n@end"}),n("3d/compositor/shaders/output.essl",[],function(){return"\n@export buildin.compositor.output\n\nvarying vec2 v_Texcoord;\n\nuniform sampler2D texture;\n\nvoid main()\n{\n    vec4 tex = texture2D( texture, v_Texcoord );\n\n    gl_FragColor = tex;\n}\n\n@end"}),n("3d/compositor/pass",["require","core/base","../scene","../camera/orthographic","../geometry/plane","../shader","../material","../mesh","../scene","./shaders/vertex.essl","../texture","../webglinfo","./shaders/coloradjust.essl","./shaders/blur.essl","./shaders/grayscale.essl","./shaders/lut.essl","./shaders/output.essl"],function(t){var e=t("core/base"),r=t("../scene"),n=t("../camera/orthographic"),i=t("../geometry/plane"),a=t("../shader"),o=t("../material"),s=t("../mesh"),r=t("../scene"),u=t("./shaders/vertex.essl");t("../texture");var c=t("../webglinfo"),h=new i,l=new s({geometry:h}),f=new r,d=new n;f.add(l);var p=e.derive(function(){return{fragment:"",outputs:null,_material:null}},function(){var t=new a({vertex:u,fragment:this.fragment}),e=new o({shader:t});t.enableTexturesAll(),this._material=e},{setUniform:function(t,e){var r=this._material.uniforms[t];r&&(r.value=e)},bind:function(t,e){if(this.outputs){for(var r in this.outputs){var n=this.outputs[r];e.attach(t.gl,n,r)}e.bind(t)}},unbind:function(t,e){e.unbind(t)},render:function(t,e){var r=t.gl;l.material=this._material,e&&this.bind(t,e);var n=c.getExtension("EXT_draw_buffers");if(n){var i=[];for(var a in this.outputs)a=parseInt(a),a>=r.COLOR_ATTACHMENT0&&r.COLOR_ATTACHMENT0+8>=a&&i.push(a);n.drawBuffersEXT(i)}t.render(f,d,!0),e&&this.unbind(t,e)}});return a.import(t("./shaders/coloradjust.essl")),a.import(t("./shaders/blur.essl")),a.import(t("./shaders/grayscale.essl")),a.import(t("./shaders/lut.essl")),a.import(t("./shaders/output.essl")),p}),n("3d/framebuffer",["require","core/base","./texture/texture2d","./texture/texturecube","./webglinfo"],function(t){var e=t("core/base");t("./texture/texture2d");var r=t("./texture/texturecube"),n=t("./webglinfo"),i=e.derive(function(){return{depthBuffer:!0,_attachedTextures:{}}},{bind:function(t){var e=t.gl;if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer(e)),this.cache.put("viewport",t.viewportInfo),t.setViewport(0,0,this.cache.get("width"),this.cache.get("height")),this.cache.miss("renderbuffer")&&this.depthBuffer&&!this.cache.get("depth_texture")&&this.cache.put("renderbuffer",e.createRenderbuffer()),!this.cache.get("depth_texture")&&this.depthBuffer){var r=this.cache.get("width"),n=this.cache.get("height"),i=this.cache.get("renderbuffer");(r!==this.cache.get("renderbuffer_width")||n!==this.cache.get("renderbuffer_height"))&&(e.bindRenderbuffer(e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r,n),this.cache.put("renderbuffer_width",r),this.cache.put("renderbuffer_height",n),e.bindRenderbuffer(e.RENDERBUFFER,null)),this.cache.get("renderbuffer_attached")||(e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,i),this.cache.put("renderbuffer_attached",!0))}},unbind:function(t){var e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this.cache.use(e.__GUID__);var n=this.cache.get("viewport");n&&t.setViewport(n.x,n.y,n.width,n.height);for(var i in this._attachedTextures){var a=this._attachedTextures[i];if(!a.NPOT&&a.generateMipmaps){var o=a.instanceof(r)?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D;e.bindTexture(o,a.getWebGLTexture(e)),e.generateMipmap(o),e.bindTexture(o,null)}}},getFrameBuffer:function(t){return this.cache.use(t.__GUID__),this.cache.miss("framebuffer")&&this.cache.put("framebuffer",t.createFramebuffer()),this.cache.get("framebuffer")},attach:function(t,e,r,i){if(!e.width)return console.error("The texture attached to color buffer is not a valid."),void 0;if(this._renderBuffer&&this.depthBuffer&&(this._width!==e.width||this.height!==e.height)&&console.warn("Attached texture has different width or height, it will cause the render buffer recreate a storage "),t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer(t)),this.cache.put("width",e.width),this.cache.put("height",e.height),i=i||t.TEXTURE_2D,r=r||t.COLOR_ATTACHMENT0,"DEPTH_ATTACHMENT"===r){var a=n.getExtension("WEBGL_depth_texture");if(!a)return console.error(" Depth texture is not supported by the browser "),void 0;if("DEPTH_COMPONENT"!==e.format)return console.error("The texture attached to depth buffer is not a valid."),void 0;this.cache.put("renderbuffer_attached",!1),this.cache.put("depth_texture",!0)}this._attachedTextures[r]=e,t.framebufferTexture2D(t.FRAMEBUFFER,r,i,e.getWebGLTexture(t),0),t.bindFramebuffer(t.FRAMEBUFFER,null)},detach:function(){},dispose:function(t){this.cache.use(t.__GUID__),this.cache.get("renderbuffer")&&t.deleteRenderbuffer(this.cache.get("renderbuffer")),this.cache.get("framebuffer")&&t.deleteFramebuffer(this.cache.get("framebuffer")),this.cache.clearContext()}});return i}),n("3d/compositor/graph/texturepool",["require","../../texture/texture2d","_"],function(t){function e(t){var e={width:512,height:512,type:"UNSIGNED_BYTE",format:"RGBA",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE",minFilter:"LINEAR_MIPMAP_LINEAR",magFilter:"LINEAR",generateMipmaps:!0,anisotropy:1,flipY:!0,unpackAlignment:4,premultiplyAlpha:!1};o.defaults(t,e),r(t);var n="";for(var i in e){if(t[i])var a=""+t[i];else var a=""+e[i];n+=a}return n}function r(t){var e=n(t.width,t.height);"DEPTH_COMPONENT"===t.format&&(t.generateMipmaps=!1),e&&t.generateMipmaps||(t.minFilter=0==t.minFilter.indexOf("NEAREST")?"NEAREST":"LINEAR",t.magFilter=0==t.magFilter.indexOf("NEAREST")?"NEAREST":"LINEAR",t.wrapS="CLAMP_TO_EDGE",t.wrapT="CLAMP_TO_EDGE")}function n(t,e){return 0===(t&t-1)&&0===(e&e-1)}var i=t("../../texture/texture2d"),o=t("_"),s={},u={get:function(t){var r=e(t);s.hasOwnProperty(r)||(s[r]=[]);var n=s[r];if(!n.length){var a=new i(t);
return a}return n.pop()},put:function(t){var r=e(t);s.hasOwnProperty(r)||(s[r]=[]);var n=s[r];n.push(t)},clear:function(t){for(a in s)for(var e=0;s[a].length>e;e++)s[a][e].dispose(t);s={}}};return u}),n("3d/compositor/graph/node",["require","core/base","../pass","../../framebuffer","../../shader","./texturepool"],function(t){var e=t("core/base"),r=t("../pass"),n=t("../../framebuffer");t("../../shader");var i=t("./texturepool"),a=e.derive(function(){return{name:"",inputs:{},outputs:null,shader:"",inputLinks:{},outputLinks:{},_textures:{},pass:null,_outputReferences:{}}},function(){if(this.shader){var t=new r({fragment:this.shader});this.pass=t}this.outputs&&(this.frameBuffer=new n({depthBuffer:!1}))},{render:function(t){var e=t.gl;for(var r in this.inputLinks){var n=this.inputLinks[r],a=n.node.getOutput(t,n.pin);this.pass.setUniform(r,a)}if(this.outputs){this.pass.outputs={};for(var o in this.outputs){var s=this.outputs[o],u=i.get(s.parameters||{});this._textures[o]=u;var c=s.attachment||e.COLOR_ATTACHMENT0;"string"==typeof c&&(c=e[c]),this.pass.outputs[c]=u}this.pass.render(t,this.frameBuffer)}else this.pass.outputs=null,this.pass.render(t);for(var r in this.inputLinks){var n=this.inputLinks[r];n.node.removeReference(n.pin)}},setParameter:function(t,e){this.pass.setUniform(t,e)},setParameters:function(t){for(var e in t)this.setParameter(e,t[e])},getOutput:function(t,e){var r=this.outputs[e];if(r)return this._textures[e]?this._textures[e]:(this.render(t),this._textures[e])},removeReference:function(t){this._outputReferences[t]--,0===this._outputReferences[t]&&(i.put(this._textures[t]),this._textures[t]=null)},link:function(t,e,r){this.inputLinks[t]={node:e,pin:r},e.outputLinks[r]||(e.outputLinks[r]=[]),e.outputLinks[r].push({node:this,pin:t})},clear:function(){this.inputLinks={},this.outputLinks={}},updateReference:function(){for(var t in this.outputLinks)this._outputReferences[t]=this.outputLinks[t].length}});return a}),n("3d/compositor/graph/group",["require","./node","./graph"],function(t){var e=t("./node"),r=t("./graph"),n=e.derive(function(){return{nodes:[],_textures:{}}},{add:function(t){return r.prototype.add.call(this,t)},remove:function(t){return r.prototype.remove.call(this,t)},update:function(){return r.prototype.update.call(this)},findPin:function(t){return r.prototype.findPin.call(this,t)},render:function(t){this.isDirty("graph")&&(this.update(),this.fresh("graph"));var e={};for(var r in this.inputLinks){var n=this.inputLinks[r],i=n.node.getOutput(t,n.pin);e[r]=i}for(var a=0;this.nodes.length>a;a++){var o=this.nodes[a];o.updateReference(),o.groupInputs&&this._updateGroupInputs(o,e)}for(var a=0;this.nodes.length>a;a++){var o=this.nodes[a];o.groupOutputs&&this._updateGroupOutputs(o,t),o.outputs||o.render(t)}for(var s in this.groupOutputs)this._textures[s]||console.error('Group output pin "'+s+'" is not attached');for(var r in this.inputLinks){var n=this.inputLinks[r];n.node.removeReference(n.pin)}},_updateGroupInputs:function(t,e){for(var r in e){var n=e[r];if(t.groupInputs[r]){var i=t.groupInputs[r];t.pass.setUniform(i,n)}}},_updateGroupOutputs:function(t,e){for(var r in t.groupOutputs){var n=t.groupOutputs[r],i=t.getOutput(e,r);this._textures[n]=i}}});return n}),n("3d/compositor/graph/scenenode",["require","./node","../pass","../../framebuffer","./texturepool","../../webglinfo"],function(t){var e=t("./node");t("../pass"),t("../../framebuffer");var r=t("./texturepool"),n=t("../../webglinfo"),i=e.derive(function(){return{scene:null,camera:null,material:null}},function(){this.frameBuffer&&(this.frameBuffer.depthBuffer=!0)},{render:function(t){var e=t.gl;if(this.outputs){var i=this.frameBuffer;for(var a in this.outputs){var o=this.outputs[a],s=r.get(o.parameters||{});this._textures[a]=s;var u=o.attachment||e.COLOR_ATTACHMENT0;"string"==typeof u&&(u=e[u]),i.attach(t.gl,s,u)}i.bind(t);var c=n.getExtension("EXT_draw_buffers");if(c){var h=[];for(var u in this.outputs)u=parseInt(u),u>=e.COLOR_ATTACHMENT0&&e.COLOR_ATTACHMENT0+8>=u&&h.push(u);c.drawBuffersEXT(h)}this.material&&(this.scene.material=this.material),t.render(this.scene,this.camera),this.scene.material=null,i.unbind(t)}else t.render(this.scene,this.camera)}});return i}),n("3d/compositor/graph/texturenode",["require","./node","../../framebuffer","./texturepool","../../shader"],function(t){var e=t("./node");t("../../framebuffer");var r=t("./texturepool"),n=t("../../shader"),i=e.derive(function(){return{shader:n.source("buildin.compositor.output"),texture:null}},{render:function(t){var e=t.gl;if(this.pass.setUniform("texture",this.texture),this.outputs){this.pass.outputs={};for(var n in this.outputs){var i=this.outputs[n],a=r.get(i.parameters||{});this._textures[n]=a;var o=i.attachment||e.COLOR_ATTACHMENT0;"string"==typeof o&&(o=e[o]),this.pass.outputs[o]=a}this.pass.render(t,this.frameBuffer)}else this.pass.outputs=null,this.pass.render(t)}});return i}),n("3d/light",["require","./node"],function(t){var e=t("./node"),r=e.derive(function(){return{color:[1,1,1],intensity:1,castShadow:!0,shadowResolution:512}},{});return r}),n("3d/renderer",["require","core/base","_","glmatrix","util/util","./light","./mesh","./webglinfo"],function(t){var e=t("core/base"),r=t("_"),n=t("glmatrix"),i=n.mat4,a=t("util/util"),o=t("./light"),s=t("./mesh"),u=t("./webglinfo"),c=e.derive(function(){return{__GUID__:a.genGUID(),canvas:null,devicePixelRatio:window.devicePixelRatio||1,color:[1,1,1,0],clear:16640,alhpa:!0,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!1,gl:null,viewportInfo:{}}},function(){this.canvas||(this.canvas=document.createElement("canvas"));try{this.gl=this.canvas.getContext("experimental-webgl",{alhpa:this.alhpa,depth:this.depth,stencil:this.stencil,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer}),this.gl.__GUID__=this.__GUID__,this.resize(this.canvas.width,this.canvas.height),u.initialize(this.gl)}catch(t){throw"Error creating WebGL Context"}},{resize:function(t,e){var r=this.canvas;1!==this.devicePixelRatio&&(r.style.width=t+"px",r.style.height=e+"px"),r.width=t*this.devicePixelRatio,r.height=e*this.devicePixelRatio,this.setViewport(0,0,r.width,r.height)},setViewport:function(t,e,r,n){this.gl.viewport(t,e,r,n),this.viewportInfo={x:t,y:e,width:r,height:n}},render:function(t,e,n){var i=this.gl;n||this.trigger("beforerender",t,e);var a=this.color;i.clearColor(a[0],a[1],a[2],a[3]),i.clear(this.clear);var s=[],u=[],c=[];e.update(),t.update(),this._scene=t;var h=t.material;t.traverse(function(t){if(!t.visible)return!0;if(t.instanceof(o)&&c.push(t),t.render)if(h)h.transparent?u.push(t):s.push(t);else{if(!t.material||!t.material.shader)return;if(!t.geometry)return;t.material.transparent?u.push(t):s.push(t)}}),t.filter&&(s=r.filter(s,t.filter),u=r.filter(u,t.filter));for(var l={},f=0;c.length>f;f++){var d=c[f];l[d.type]||(l[d.type]=0),l[d.type]++}t.lightNumber=l,this.updateLightUnforms(c),s.sort(this._materialSortFunc),u.sort(this._materialSortFunc),n||this.trigger("beforerender:opaque",s),i.enable(i.DEPTH_TEST),i.disable(i.BLEND),this.renderQueue(s,e,h,n),n||(this.trigger("afterrender:opaque",s),this.trigger("beforerender:transparent",u)),i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.renderQueue(u,e,h,n),n||(this.trigger("afterrender:transparent",u),this.trigger("afterrender",t,e))},updateLightUnforms:function(t){var e=this._scene.lightUniforms;for(var r in e)e[r].value.length=0;for(var n=0;t.length>n;n++){var i=t[n];for(r in i.uniformTemplates){var a=i.uniformTemplates[r];e[r]||(e[r]={type:"",value:[]});var o=a.value(i),s=e[r];switch(s.type=a.type+"v",a.type){case"1i":case"1f":s.value.push(o);break;case"2f":case"3f":case"4f":for(var u=0;o.length>u;u++)s.value.push(o[u]);break;default:console.error("Unkown light uniform type "+a.type)}}}},renderQueue:function(t,e,n,a){i.invert(h.VIEW,e.worldMatrix._array),i.copy(h.PROJECTION,e.projectionMatrix._array),i.multiply(h.VIEWPROJECTION,e.projectionMatrix._array,h.VIEW),i.copy(h.VIEWINVERSE,e.worldMatrix._array),i.invert(h.PROJECTIONINVERSE,h.PROJECTION),i.invert(h.VIEWPROJECTIONINVERSE,h.VIEWPROJECTION);for(var o,u,c=this.gl,l=this._scene,f=0;t.length>f;f++){var d=t[f],p=n||d.material,v=p.shader;d.geometry;var m=p.transparent&&p.blend;if(u!==v.__GUID__){var _=!1;if(r.isEqual(v.lightNumber,l.lightNumber)||(_=!0),_){for(var g in l.lightNumber){var y=l.lightNumber[g];v.lightNumber[g]=y}v.update()}v.bind(c);for(var x in l.lightUniforms){var b=l.lightUniforms[x];v.setUniform(c,b.type,x,b.value)}u=v.__GUID__}o!==p.__GUID__&&(p.bind(c),o=p.__GUID__,s.materialChanged()),m&&m(c);var E=d.worldMatrix._array;(v.semantics.hasOwnProperty("WORLD")||v.semantics.hasOwnProperty("WORLDTRANSPOSE"))&&i.copy(h.WORLD,E),(v.semantics.hasOwnProperty("WORLDVIEW")||v.semantics.hasOwnProperty("WORLDVIEWINVERSE")||v.semantics.hasOwnProperty("WORLDVIEWINVERSETRANSPOSE"))&&i.multiply(h.WORLDVIEW,h.VIEW,E),(v.semantics.hasOwnProperty("WORLDVIEWPROJECTION")||v.semantics.hasOwnProperty("WORLDVIEWPROJECTIONINVERSE")||v.semantics.hasOwnProperty("WORLDVIEWPROJECTIONINVERSETRANSPOSE"))&&i.multiply(h.WORLDVIEWPROJECTION,h.VIEWPROJECTION,E),(v.semantics.hasOwnProperty("WORLDINVERSE")||v.semantics.hasOwnProperty("WORLDINVERSETRANSPOSE"))&&i.invert(h.WORLDINVERSE,E),(v.semantics.hasOwnProperty("WORLDVIEWINVERSE")||v.semantics.hasOwnProperty("WORLDVIEWINVERSETRANSPOSE"))&&i.invert(h.WORLDVIEWINVERSE,h.WORLDVIEW),(v.semantics.hasOwnProperty("WORLDVIEWPROJECTIONINVERSE")||v.semantics.hasOwnProperty("WORLDVIEWPROJECTIONINVERSETRANSPOSE"))&&i.invert(h.WORLDVIEWPROJECTIONINVERSE,h.WORLDVIEWPROJECTION);for(var T in h){if(v.semantics.hasOwnProperty(T)){var A=h[T],w=v.semantics[T];v.setUniform(c,w.type,w.symbol,A)}if(v.semantics.hasOwnProperty(T+"TRANSPOSE")){var R=h[T+"TRANSPOSE"],A=h[T],O=v.semantics[T+"TRANSPOSE"];i.transpose(R,A),v.setUniform(c,O.type,O.symbol,R)}}a||this.trigger("beforerender:mesh",d);var I=d.render(this,n);a||this.trigger("afterrender:mesh",d,I),m&&(c.blendEquation(c.FUNC_ADD),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA))}},_materialSortFunc:function(t,e){return t.material.shader==e.material.shader?t.material.__GUID__-e.material.__GUID__:t.material.shader.__GUID__-e.material.__GUID__}}),h={WORLD:i.create(),VIEW:i.create(),PROJECTION:i.create(),WORLDVIEW:i.create(),VIEWPROJECTION:i.create(),WORLDVIEWPROJECTION:i.create(),WORLDINVERSE:i.create(),VIEWINVERSE:i.create(),PROJECTIONINVERSE:i.create(),WORLDVIEWINVERSE:i.create(),VIEWPROJECTIONINVERSE:i.create(),WORLDVIEWPROJECTIONINVERSE:i.create(),WORLDTRANSPOSE:i.create(),VIEWTRANSPOSE:i.create(),PROJECTIONTRANSPOSE:i.create(),WORLDVIEWTRANSPOSE:i.create(),VIEWPROJECTIONTRANSPOSE:i.create(),WORLDVIEWPROJECTIONTRANSPOSE:i.create(),WORLDINVERSETRANSPOSE:i.create(),VIEWINVERSETRANSPOSE:i.create(),PROJECTIONINVERSETRANSPOSE:i.create(),WORLDVIEWINVERSETRANSPOSE:i.create(),VIEWPROJECTIONINVERSETRANSPOSE:i.create(),WORLDVIEWPROJECTIONINVERSETRANSPOSE:i.create()};return c}),n("core/event",["require","./base"],function(t){var e=t("./base"),r=e.derive({cancelBubble:!1},{stopPropagation:function(){this.cancelBubble=!0}});r.throw=function(t,e,r){var n=new MouseEvent(r);for(n.sourceTarget=e;e&&!n.cancelBubble;)n.target=e,e.trigger(t,n),e=e.parent}}),n("core/request",["require"],function(){function t(t){var e=new XMLHttpRequest;e.open("get",t.url),e.responseType=t.responseType||"text",t.onprogress&&(e.onprogress=function(e){if(e.lengthComputable){var r=e.loaded/e.total;t.onprogress(r,e.loaded,e.total)}else t.onprogress(null)}),e.onload=function(){t.onload&&t.onload(e.response)},t.onerror&&(e.onerror=t.onerror),e.send(null)}function e(){}return{get:t,put:e}}),n("core/vector2",function(){}),n("core/vector4",["require","glmatrix"],function(t){var e=t("glmatrix"),r=e.vec4,n=function(t,e,n,a){return t=t||0,e=e||0,n=n||0,a=a||0,Object.create(i,{x:{configurable:!1,set:function(t){this._array[0]=t,this._dirty=!0},get:function(){return this._array[0]}},y:{configurable:!1,set:function(t){this._array[1]=t,this._dirty=!0},get:function(){return this._array[1]}},z:{configurable:!1,set:function(t){this._array[2]=t,this._dirty=!0},get:function(){return this._array[2]}},w:{configurable:!1,set:function(t){this._array[2]=t,this._dirty=!0},get:function(){return this._array[2]}},_array:{writable:!1,configurable:!1,value:r.fromValues(t,e,n,a)},_dirty:{configurable:!1,value:!1}})},i={constructor:n,add:function(t){return r.add(this._array,this._array,t._array),this._dirty=!0,this},set:function(t,e,r,n){return this._array[0]=t,this._array[1]=e,this._array[2]=r,this._array[3]=n,this._dirty=!0,this},clone:function(){return new n(this.x,this.y,this.z,this.w)},copy:function(t){return r.copy(this._array,t._array),this._dirty=!0,this},cross:function(t,e){return r.cross(t._array,this._array,e._array),this},dist:function(t){return r.dist(this._array,t._array)},distance:function(t){return r.distance(this._array,t._array)},div:function(t){return r.div(this._array,this._array,t._array),this._dirty=!0,this},divide:function(t){return r.divide(this._array,this._array,t._array),this._dirty=!0,this},dot:function(t){return r.dot(this._array,t._array)},len:function(){return r.len(this._array)},length:function(){return r.length(this._array)},lerp:function(t,e,n){return r.lerp(this._array,t._array,e._array,n),this._dirty=!0,this},mul:function(t){return r.mul(this._array,this._array,t._array),this._dirty=!0,this},multiply:function(t){return r.multiply(this._array,this._array,t._array),this._dirty=!0,this},negate:function(){return r.negate(this._array,this._array),this._dirty=!0,this},normalize:function(){return r.normalize(this._array,this._array),this._dirty=!0,this},random:function(t){return r.random(this._array,t),this._dirty=!0,this},scale:function(t){return r.scale(this._array,this._array,t),this._dirty=!0,this},scaleAndAdd:function(t,e){return r.scaleAndAdd(this._array,this._array,t._array,e),this._dirty=!0,this},sqrDist:function(t){return r.sqrDist(this._array,t._array)},squaredDistance:function(t){return r.squaredDistance(this._array,t._array)},sqrLen:function(){return r.sqrLen(this._array)},squaredLength:function(){return r.squaredLength(this._array)},sub:function(t){return r.sub(this._array,this._array,t._array),this._dirty=!0,this},subtract:function(t){return r.subtract(this._array,this._array,t._array),this._dirty=!0,this},transformMat4:function(t){return r.transformMat4(this._array,this._array,t._array),this._dirty=!0,this},transformQuat:function(t){return r.transformQuat(this._array,this._array,t._array),this._dirty=!0,this},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return n}),n("util/color",["require"],function(){}),n("util/xmlparser",["require"],function(){}),n("qtekimage",["require","./2d/camera","./2d/node","./2d/renderable/arc","./2d/renderable/circle","./2d/renderable/image","./2d/renderable/line","./2d/renderable/path","./2d/renderable/polygon","./2d/renderable/rectangle","./2d/renderable/roundedrectangle","./2d/renderable/sector","./2d/renderable/text","./2d/renderable/textbox","./2d/renderer","./2d/scene","./2d/style","./2d/util","./3d/camera","./3d/camera/orthographic","./3d/compositor","./3d/compositor/graph/graph","./3d/compositor/graph/group","./3d/compositor/graph/node","./3d/compositor/graph/scenenode","./3d/compositor/graph/texturenode","./3d/compositor/graph/texturepool","./3d/compositor/pass","./3d/framebuffer","./3d/geometry","./3d/geometry/plane","./3d/light","./3d/material","./3d/mesh","./3d/node","./3d/renderer","./3d/scene","./3d/shader","./3d/texture","./3d/texture/texture2d","./3d/webglinfo","./core/base","./core/cache","./core/event","./core/matrix3","./core/matrix4","./core/mixin/derive","./core/mixin/dirty","./core/mixin/notifier","./core/quaternion","./core/request","./core/vector2","./core/vector3","./core/vector4","./util/color","./util/util","./util/xmlparser","glmatrix"],function(t){var e={"2d":{Camera:t("./2d/camera"),Node:t("./2d/node"),renderable:{Arc:t("./2d/renderable/arc"),Circle:t("./2d/renderable/circle"),Image:t("./2d/renderable/image"),Line:t("./2d/renderable/line"),Path:t("./2d/renderable/path"),Polygon:t("./2d/renderable/polygon"),Rectangle:t("./2d/renderable/rectangle"),RoundedRectangle:t("./2d/renderable/roundedrectangle"),Sector:t("./2d/renderable/sector"),Text:t("./2d/renderable/text"),TextBox:t("./2d/renderable/textbox")},Renderer:t("./2d/renderer"),Scene:t("./2d/scene"),Style:t("./2d/style"),util:t("./2d/util")},"3d":{Camera:t("./3d/camera"),camera:{Orthographic:t("./3d/camera/orthographic")},Compositor:t("./3d/compositor"),compositor:{graph:{Graph:t("./3d/compositor/graph/graph"),Group:t("./3d/compositor/graph/group"),Node:t("./3d/compositor/graph/node"),SceneNode:t("./3d/compositor/graph/scenenode"),TextureNode:t("./3d/compositor/graph/texturenode"),TexturePool:t("./3d/compositor/graph/texturepool")},Pass:t("./3d/compositor/pass")},FrameBuffer:t("./3d/framebuffer"),Geometry:t("./3d/geometry"),geometry:{Plane:t("./3d/geometry/plane")},Light:t("./3d/light"),Material:t("./3d/material"),Mesh:t("./3d/mesh"),Node:t("./3d/node"),Renderer:t("./3d/renderer"),Scene:t("./3d/scene"),Shader:t("./3d/shader"),Texture:t("./3d/texture"),texture:{Texture2D:t("./3d/texture/texture2d")},WebGLInfo:t("./3d/webglinfo")},core:{Base:t("./core/base"),Cache:t("./core/cache"),Event:t("./core/event"),Matrix3:t("./core/matrix3"),Matrix4:t("./core/matrix4"),mixin:{derive:t("./core/mixin/derive"),Dirty:t("./core/mixin/dirty"),notifier:t("./core/mixin/notifier")},Quaternion:t("./core/quaternion"),requester:t("./core/request"),Vector2:t("./core/vector2"),Vector3:t("./core/vector3"),Vector4:t("./core/vector4")},util:{Color:t("./util/color"),Util:t("./util/util"),Xmlparser:t("./util/xmlparser")}},r=t("glmatrix");return e.math=r,e});var i=r("qtekimage");for(var a in i)t[a]=i[a]});