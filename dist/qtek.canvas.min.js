(function(t){"undefined"!=typeof define&&define.amd?define(["exports"],t.bind(window)):t(window.qtek={})})(function(t){var e,n,r;(function(t){function i(t,e){return b.call(t,e)}function a(t,e){var n,r,i,a,o,u,s,c,l,f,h=e&&e.split("/"),d=y.map,p=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(e){for(h=h.slice(0,h.length-1),t=h.concat(t.split("/")),c=0;t.length>c;c+=1)if(f=t[c],"."===f)t.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((h||p)&&d){for(n=t.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),h)for(l=h.length;l>0;l-=1)if(i=d[h.slice(0,l).join("/")],i&&(i=i[r])){a=i,o=c;break}if(a)break;!u&&p&&p[r]&&(u=p[r],s=c)}!a&&u&&(a=u,o=s),a&&(n.splice(0,o,a),t=n.join("/"))}return t}function o(e,n){return function(){return d.apply(t,_.call(arguments,0).concat([e,n]))}}function u(t){return function(e){return a(e,t)}}function s(t){return function(e){g[t]=e}}function c(e){if(i(m,e)){var n=m[e];delete m[e],x[e]=!0,h.apply(t,n)}if(!i(g,e)&&!i(x,e))throw Error("No "+e);return g[e]}function l(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function f(t){return function(){return y&&y.config&&y.config[t]||{}}}var h,d,p,v,g={},m={},y={},x={},b=Object.prototype.hasOwnProperty,_=[].slice;p=function(t,e){var n,r=l(t),i=r[0];return t=r[1],i&&(i=a(i,e),n=c(i)),i?t=n&&n.normalize?n.normalize(t,u(e)):a(t,e):(t=a(t,e),r=l(t),i=r[0],t=r[1],i&&(n=c(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:n}},v={require:function(t){return o(t)},exports:function(t){var e=g[t];return e!==void 0?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:f(t)}}},h=function(e,n,r,a){var u,l,f,h,d,y,b=[];if(a=a||e,"function"==typeof r){for(n=!n.length&&r.length?["require","exports","module"]:n,d=0;n.length>d;d+=1)if(h=p(n[d],a),l=h.f,"require"===l)b[d]=v.require(e);else if("exports"===l)b[d]=v.exports(e),y=!0;else if("module"===l)u=b[d]=v.module(e);else if(i(g,l)||i(m,l)||i(x,l))b[d]=c(l);else{if(!h.p)throw Error(e+" missing "+l);h.p.load(h.n,o(a,!0),s(l),{}),b[d]=g[l]}f=r.apply(g[e],b),e&&(u&&u.exports!==t&&u.exports!==g[e]?g[e]=u.exports:f===t&&y||(g[e]=f))}else e&&(g[e]=r)},e=n=d=function(e,n,r,i,a){return"string"==typeof e?v[e]?v[e](n):c(p(e,n).f):(e.splice||(y=e,n.splice?(e=n,n=r,r=null):e=t),n=n||function(){},"function"==typeof r&&(r=i,i=a),i?h(t,e,n,r):setTimeout(function(){h(t,e,n,r)},4),d)},d.config=function(t){return y=t,y.deps&&d(y.deps,y.callback),d},r=function(t,e,n){e.splice||(n=e,e=[]),i(g,t)||i(m,t)||(m[t]=[t,e,n])},r.amd={jQuery:!0}})(),r("build/almond",function(){}),r("2d/camera",function(){}),r("core/mixin/derive",[],function(){function t(t,e,n){"object"==typeof e&&(n=e,e=null);var r={"instanceof":function(t){for(var e=a;e;){if(e===t)return!0;e=e.__super__}}},i=this,a=function(n){if(i.call(this),_.extend(this,"function"==typeof t?t.call(this):t),_.extend(this,n),this.constructor==a){for(var r=a,o=[e];r.__super__;)r=r.__super__,o.unshift(r.__initialize__);for(var u=0;o.length>u;u++)o[u]&&o[u].call(this)}};return a.__super__=i,a.__initialize__=e,_.extend(a.prototype,i.prototype,r,n),a.prototype.constructor=a,a.derive=i.derive,a}return{derive:t}}),r("core/mixin/notifier",[],function(){return{trigger:function(){if(this.__handlers__){var t=arguments[0],e=Array.prototype.slice.call(arguments,1),n=this.__handlers__[t];if(n)for(var r=0;n.length>r;r+=2){var i=n[r],a=n[r+1];i.apply(a||this,e)}}},on:function(t,e,n){if(t){var r=this.__handlers__||(this.__handlers__={});return r[t]||(r[t]=[]),-1==r[t].indexOf(e)&&(r[t].push(e),r[t].push(n)),e}},off:function(t,e){var n=this.__handlers__||(this.__handlers__={});if(n[t])if(e){var r=n[t],i=r.indexOf(e);i>=0&&r.splice(i,2)}else n[t]=[]},has:function(t,e){return this.__handlers__&&this.__handlers__[t]?e?-1!==this.__handlers__[t].indexOf(e):this.__handlers__[t].length:!1}}}),r("core/mixin/dirty",{dirty:function(t){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]=!0},fresh:function(t){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]=!1},isDirty:function(t){return this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]===void 0?!0:this._dirtyFlag[t]}}),r("core/cache",[],function(){var t=function(){this._contextId="",this._caches={},this._context={}};return t.prototype={use:function(t){this._caches.hasOwnProperty(t)||(this._caches[t]={}),this._contextId=t,this._context=this._caches[t]},put:function(t,e){this._context[t]=e},get:function(t){return this._context[t]},clearContext:function(){this._caches[this._contextId]={},this._context={}},"delete":function(t){delete this._context[t]},clearAll:function(){this._caches={}},getContext:function(){return this._context},miss:function(t){return!this._context.hasOwnProperty(t)}},t.prototype.constructor=t,t}),function(t){function e(r){function i(t){return t&&"object"==typeof t&&!br(t)&&Zn.call(t,"__wrapped__")?t:new X(t)}function o(t,e,n){var r=t.length,i=r-e>=n;if(i)for(var a={},o=e-1;r>++o;){var u=Fn(t[o]);(Zn.call(a,u)?a[u]:a[u]=[]).push(t[o])}return function(n){if(i){var r=Fn(n);return Zn.call(a,r)&&Ue(a[r],n)>-1}return Ue(t,n,e)>-1}}function S(t){return t.charCodeAt(0)}function E(t,e){var r=t.index,i=e.index;if(t=t.criteria,e=e.criteria,t!==e){if(t>e||t===n)return 1;if(e>t||e===n)return-1}return i>r?-1:1}function R(t,e,n,r){function i(){var r=arguments,c=o?this:e;if(a||(t=e[u]),n.length&&(r=r.length?(r=V(r),s?r.concat(n):n.concat(r)):n),this instanceof i){W.prototype=t.prototype,c=new W,W.prototype=null;var l=t.apply(c,r);return se(l)?l:c}return t.apply(c,r)}var a=ue(t),o=!n,u=e;if(o){var s=r;n=e}else if(!a){if(!r)throw new Nn;e=t}return i}function H(){for(var t,e={shadowedProps:_,arrays:"isArray(iterable)",bottom:"",init:"iterable",loop:"",top:"",useHas:!0,useKeys:!!Ar},n=0;t=arguments[n];n++)for(var r in t)e[r]=t[r];var a=e.args;e.firstArg=/^[^,]+/.exec(a)[0];var o=Sn("hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectTypes","return function("+a+") {\n"+gr(e)+"\n}");return o(Zn,G,br,de,Ar,i,I)}function D(t){return"\\"+z[t]}function F(t){return Mr[t]}function N(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function X(t){this.__wrapped__=t}function W(){}function U(t){var e=!1;if(!t||nr.call(t)!=j||!vr.argsClass&&G(t))return e;var n=t.constructor;return(ue(n)?n instanceof n:vr.nodeClass||!N(t))?vr.ownLast?(Pr(t,function(t,n,r){return e=Zn.call(r,n),!1}),e===!0):(Pr(t,function(t,n){e=n}),e===!1||Zn.call(t,e)):e}function V(t,e,r){e||(e=0),r===n&&(r=t?t.length:0);for(var i=-1,a=r-e||0,o=In(0>a?0:a);a>++i;)o[i]=t[e+i];return o}function $(t){return Br[t]}function G(t){return nr.call(t)==w}function Q(t,e,r,a,o,u){var s=t;if("function"==typeof e&&(a=r,r=e,e=!1),"function"==typeof r){if(r=a===n?r:i.createCallback(r,a,1),s=r(s),s!==n)return s;s=t}var c=se(s);if(c){var l=nr.call(s);if(!O[l]||!vr.nodeClass&&N(s))return s;var f=br(s)}if(!c||!e)return c?f?V(s):kr({},s):s;var h=pr[l];switch(l){case B:case k:return new h(+s);case P:case C:return new h(s);case T:return h(s.source,p.exec(s))}o||(o=[]),u||(u=[]);for(var d=o.length;d--;)if(o[d]==t)return u[d];return s=f?h(s.length):{},f&&(Zn.call(t,"index")&&(s.index=t.index),Zn.call(t,"input")&&(s.input=t.input)),o.push(t),u.push(s),(f?ke:jr)(t,function(t,i){s[i]=Q(t,e,r,n,o,u)}),s}function K(t,e,n){return Q(t,!0,e,n)}function Y(t,e,r){var a;return e=i.createCallback(e,r),jr(t,function(t,r,i){return e(t,r,i)?(a=r,!1):n}),a}function Z(t){var e=[];return Pr(t,function(t,n){ue(t)&&e.push(n)}),e.sort()}function J(t,e){return t?Zn.call(t,e):!1}function te(t){for(var e=-1,n=Ar(t),r=n.length,i={};r>++e;){var a=n[e];i[t[a]]=a}return i}function ee(t){return t===!0||t===!1||nr.call(t)==B}function ne(t){return t instanceof Ln||nr.call(t)==k}function re(t){return t?1===t.nodeType:!1}function ie(t){var e=!0;if(!t)return e;var n=nr.call(t),r=t.length;return n==M||n==C||(vr.argsClass?n==w:G(t))||n==j&&"number"==typeof r&&ue(t.splice)?!r:(jr(t,function(){return e=!1}),e)}function ae(t,e,r,a,o,u){var c=r===s;if(r&&!c){r=a===n?r:i.createCallback(r,a,2);var l=r(t,e);if(l!==n)return!!l}if(t===e)return 0!==t||1/t==1/e;var f=typeof t,h=typeof e;if(t===t&&(!t||"function"!=f&&"object"!=f)&&(!e||"function"!=h&&"object"!=h))return!1;if(null==t||null==e)return t===e;var d=nr.call(t),p=nr.call(e);if(d==w&&(d=j),p==w&&(p=j),d!=p)return!1;switch(d){case B:case k:return+t==+e;case P:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case T:case C:return t==Fn(e)}var v=d==M;if(!v){if(Zn.call(t,"__wrapped__ ")||Zn.call(e,"__wrapped__"))return ae(t.__wrapped__||t,e.__wrapped__||e,r,a,o,u);if(d!=j||!vr.nodeClass&&(N(t)||N(e)))return!1;var g=!vr.argsObject&&G(t)?Hn:t.constructor,m=!vr.argsObject&&G(e)?Hn:e.constructor;if(g!=m&&!(ue(g)&&g instanceof g&&ue(m)&&m instanceof m))return!1}o||(o=[]),u||(u=[]);for(var y=o.length;y--;)if(o[y]==t)return u[y]==e;var x=0;if(l=!0,o.push(t),u.push(e),v){if(y=t.length,x=e.length,l=x==t.length,!l&&!c)return l;for(;x--;){var b=y,_=e[x];if(c)for(;b--&&!(l=ae(t[b],_,r,a,o,u)););else if(!(l=ae(t[x],_,r,a,o,u)))break}return l}return Pr(e,function(e,i,s){return Zn.call(s,i)?(x++,l=Zn.call(t,i)&&ae(t[i],e,r,a,o,u)):n}),l&&!c&&Pr(t,function(t,e,r){return Zn.call(r,e)?l=--x>-1:n}),l}function oe(t){return ar(t)&&!or(parseFloat(t))}function ue(t){return"function"==typeof t}function se(t){return t?I[typeof t]:!1}function ce(t){return fe(t)&&t!=+t}function le(t){return null===t}function fe(t){return"number"==typeof t||nr.call(t)==P}function he(t){return t instanceof Dn||nr.call(t)==T}function de(t){return"string"==typeof t||nr.call(t)==C}function pe(t){return t===n}function ve(t,e,r){var a=arguments,o=0,u=2;if(!se(t))return t;if(r===s)var c=a[3],l=a[4],f=a[5];else l=[],f=[],"number"!=typeof r&&(u=a.length),u>3&&"function"==typeof a[u-2]?c=i.createCallback(a[--u-1],a[u--],2):u>2&&"function"==typeof a[u-1]&&(c=a[--u]);for(;u>++o;)(br(a[o])?ke:jr)(a[o],function(e,r){var i,a,o=e,u=t[r];if(e&&((a=br(e))||Tr(e))){for(var h=l.length;h--;)if(i=l[h]==e){u=f[h];break}i||(u=a?br(u)?u:[]:Tr(u)?u:{},c&&(o=c(u,e),o!==n&&(u=o)),l.push(e),f.push(u),c||(u=ve(u,e,s,c,l,f)))}else c&&(o=c(u,e),o===n&&(o=e)),o!==n&&(u=o);t[r]=u});return t}function ge(t,e,n){var r="function"==typeof e,a={};if(r)e=i.createCallback(e,n);else var o=Qn.apply(Xn,arguments);return Pr(t,function(t,n,i){(r?!e(t,n,i):0>Ue(o,n,1))&&(a[n]=t)}),a}function me(t){for(var e=-1,n=Ar(t),r=n.length,i=In(r);r>++e;){var a=n[e];i[e]=[a,t[a]]}return i}function ye(t,e,n){var r={};if("function"!=typeof e)for(var a=0,o=Qn.apply(Xn,arguments),u=se(t)?o.length:0;u>++a;){var s=o[a];s in t&&(r[s]=t[s])}else e=i.createCallback(e,n),Pr(t,function(t,n,i){e(t,n,i)&&(r[n]=t)});return r}function xe(t){for(var e=-1,n=Ar(t),r=n.length,i=In(r);r>++e;)i[e]=t[n[e]];return i}function be(t){var e=-1,n=Qn.apply(Xn,V(arguments,1)),r=n.length,i=In(r);for(vr.unindexedChars&&de(t)&&(t=t.split(""));r>++e;)i[e]=t[n[e]];return i}function _e(t,e,r){var i=-1,a=t?t.length:0,o=!1;return r=(0>r?sr(0,a+r):r)||0,"number"==typeof a?o=(de(t)?t.indexOf(e,r):Ue(t,e,r))>-1:wr(t,function(t){return++i>=r?!(o=t===e):n}),o}function Ae(t,e,n){var r={};return e=i.createCallback(e,n),ke(t,function(t,n,i){n=Fn(e(t,n,i)),Zn.call(r,n)?r[n]++:r[n]=1}),r}function we(t,e,n){var r=!0;if(e=i.createCallback(e,n),br(t))for(var a=-1,o=t.length;o>++a&&(r=!!e(t[a],a,t)););else wr(t,function(t,n,i){return r=!!e(t,n,i)});return r}function Me(t,e,n){var r=[];if(e=i.createCallback(e,n),br(t))for(var a=-1,o=t.length;o>++a;){var u=t[a];e(u,a,t)&&r.push(u)}else wr(t,function(t,n,i){e(t,n,i)&&r.push(t)});return r}function Be(t,e,r){if(e=i.createCallback(e,r),!br(t)){var a;return wr(t,function(t,r,i){return e(t,r,i)?(a=t,!1):n}),a}for(var o=-1,u=t.length;u>++o;){var s=t[o];if(e(s,o,t))return s}}function ke(t,e,r){if(e&&r===n&&br(t))for(var i=-1,a=t.length;a>++i&&e(t[i],i,t)!==!1;);else wr(t,e,r);return t}function qe(t,e,n){var r={};return e=i.createCallback(e,n),ke(t,function(t,n,i){n=Fn(e(t,n,i)),(Zn.call(r,n)?r[n]:r[n]=[]).push(t)}),r}function Pe(t,e){var n=V(arguments,2),r=-1,i="function"==typeof e,a=t?t.length:0,o=In("number"==typeof a?a:0);return ke(t,function(t){o[++r]=(i?e:t[e]).apply(t,n)}),o}function je(t,e,n){var r=-1,a=t?t.length:0,o=In("number"==typeof a?a:0);if(e=i.createCallback(e,n),br(t))for(;a>++r;)o[r]=e(t[r],r,t);else wr(t,function(t,n,i){o[++r]=e(t,n,i)});return o}function Te(t,e,n){var r=-1/0,a=r;if(!e&&br(t))for(var o=-1,u=t.length;u>++o;){var s=t[o];s>a&&(a=s)}else e=!e&&de(t)?S:i.createCallback(e,n),wr(t,function(t,n,i){var o=e(t,n,i);o>r&&(r=o,a=t)});return a}function Ce(t,e,n){var r=1/0,a=r;if(!e&&br(t))for(var o=-1,u=t.length;u>++o;){var s=t[o];a>s&&(a=s)}else e=!e&&de(t)?S:i.createCallback(e,n),wr(t,function(t,n,i){var o=e(t,n,i);r>o&&(r=o,a=t)});return a}function Oe(t,e,n,r){var a=3>arguments.length;if(e=i.createCallback(e,r,4),br(t)){var o=-1,u=t.length;for(a&&(n=t[++o]);u>++o;)n=e(n,t[o],o,t)}else wr(t,function(t,r,i){n=a?(a=!1,t):e(n,t,r,i)});return n}function Ie(t,e,n,r){var a=t,o=t?t.length:0,u=3>arguments.length;if("number"!=typeof o){var s=Ar(t);o=s.length}else vr.unindexedChars&&de(t)&&(a=t.split(""));return e=i.createCallback(e,r,4),ke(t,function(t,r,i){r=s?s[--o]:--o,n=u?(u=!1,a[r]):e(n,a[r],r,i)}),n}function ze(t,e,n){return e=i.createCallback(e,n),Me(t,function(t,n,r){return!e(t,n,r)})}function Le(t){var e=-1,n=t?t.length:0,r=In("number"==typeof n?n:0);return ke(t,function(t){var n=Kn(fr()*(++e+1));r[e]=r[n],r[n]=t}),r}function Se(t){var e=t?t.length:0;return"number"==typeof e?e:Ar(t).length}function Ee(t,e,n){var r;if(e=i.createCallback(e,n),br(t))for(var a=-1,o=t.length;o>++a&&!(r=e(t[a],a,t)););else wr(t,function(t,n,i){return!(r=e(t,n,i))});return!!r}function Re(t,e,n){var r=-1,a=t?t.length:0,o=In("number"==typeof a?a:0);for(e=i.createCallback(e,n),ke(t,function(t,n,i){o[++r]={criteria:e(t,n,i),index:r,value:t}}),a=o.length,o.sort(E);a--;)o[a]=o[a].value;return o}function He(t){return t&&"number"==typeof t.length?vr.unindexedChars&&de(t)?t.split(""):V(t):xe(t)}function De(t){for(var e=-1,n=t?t.length:0,r=[];n>++e;){var i=t[e];i&&r.push(i)}return r}function Fe(t){for(var e=-1,n=t?t.length:0,r=Qn.apply(Xn,arguments),i=o(r,n,100),a=[];n>++e;){var u=t[e];i(u)||a.push(u)}return a}function Ne(t,e,n){var r=-1,a=t?t.length:0;for(e=i.createCallback(e,n);a>++r;)if(e(t[r],r,t))return r;return-1}function Xe(t,e,n){if(t){var r=0,a=t.length;if("number"!=typeof e&&null!=e){var o=-1;for(e=i.createCallback(e,n);a>++o&&e(t[o],o,t);)r++}else if(r=e,null==r||n)return t[0];return V(t,0,cr(sr(0,r),a))}}function We(t,e,n,r){var a=-1,o=t?t.length:0,u=[];for("boolean"!=typeof e&&null!=e&&(r=n,n=e,e=!1),null!=n&&(n=i.createCallback(n,r));o>++a;){var s=t[a];n&&(s=n(s,a,t)),br(s)?Jn.apply(u,e?s:We(s)):u.push(s)}return u}function Ue(t,e,n){var r=-1,i=t?t.length:0;if("number"==typeof n)r=(0>n?sr(0,i+n):n||0)-1;else if(n)return r=Ze(t,e),t[r]===e?r:-1;for(;i>++r;)if(t[r]===e)return r;return-1}function Ve(t,e,n){if(!t)return[];var r=0,a=t.length;if("number"!=typeof e&&null!=e){var o=a;for(e=i.createCallback(e,n);o--&&e(t[o],o,t);)r++}else r=null==e||n?1:e||r;return V(t,0,cr(sr(0,a-r),a))}function $e(t){var e=arguments,n=e.length,r={0:{}},i=-1,a=t?t.length:0,u=a>=100,s=[],c=s;t:for(;a>++i;){var l=t[i];if(u)var f=Fn(l),h=Zn.call(r[0],f)?!(c=r[0][f]):c=r[0][f]=[];if(h||0>Ue(c,l)){u&&c.push(l);for(var d=n;--d;)if(!(r[d]||(r[d]=o(e[d],0,100)))(l))continue t;s.push(l)}}return s}function Ge(t,e,n){if(t){var r=0,a=t.length;if("number"!=typeof e&&null!=e){var o=a;for(e=i.createCallback(e,n);o--&&e(t[o],o,t);)r++}else if(r=e,null==r||n)return t[a-1];return V(t,sr(0,a-r))}}function Qe(t,e,n){var r=t?t.length:0;for("number"==typeof n&&(r=(0>n?sr(0,r+n):cr(n,r-1))+1);r--;)if(t[r]===e)return r;return-1}function Ke(t,e,n){t=+t||0,n=+n||1,null==e&&(e=t,t=0);for(var r=-1,i=sr(0,$n((e-t)/n)),a=In(i);i>++r;)a[r]=t,t+=n;return a}function Ye(t,e,n){if("number"!=typeof e&&null!=e){var r=0,a=-1,o=t?t.length:0;for(e=i.createCallback(e,n);o>++a&&e(t[a],a,t);)r++}else r=null==e||n?1:sr(0,e);return V(t,r)}function Ze(t,e,n,r){var a=0,o=t?t.length:a;for(n=n?i.createCallback(n,r,1):_n,e=n(e);o>a;){var u=a+o>>>1;e>n(t[u])?a=u+1:o=u}return a}function Je(){return tn(Qn.apply(Xn,arguments))}function tn(t,e,n,r){var a=-1,o=t?t.length:0,u=[],s=u;"boolean"!=typeof e&&null!=e&&(r=n,n=e,e=!1);var c=!e&&o>=75;if(c)var l={};for(null!=n&&(s=[],n=i.createCallback(n,r));o>++a;){var f=t[a],h=n?n(f,a,t):f;if(c)var d=Fn(h),p=Zn.call(l,d)?!(s=l[d]):s=l[d]=[];(e?!a||s[s.length-1]!==h:p||0>Ue(s,h))&&((n||c)&&s.push(h),u.push(f))}return u}function en(t){for(var e=-1,n=t?t.length:0,r=o(arguments,1,30),i=[];n>++e;){var a=t[e];r(a)||i.push(a)}return i}function nn(t){for(var e=-1,n=t?Te(Cr(arguments,"length")):0,r=In(n);n>++e;)r[e]=Cr(arguments,e);return r}function rn(t,e){for(var n=-1,r=t?t.length:0,i={};r>++n;){var a=t[n];e?i[a]=e[n]:i[a[0]]=a[1]}return i}function an(t,e){return 1>t?e():function(){return 1>--t?e.apply(this,arguments):n}}function on(t,e){return vr.fastBind||rr&&arguments.length>2?rr.call.apply(rr,arguments):R(t,e,V(arguments,2))}function un(t){for(var e=Qn.apply(Xn,arguments),n=e.length>1?0:(e=Z(t),-1),r=e.length;r>++n;){var i=e[n];t[i]=on(t[i],t)}return t}function sn(t,e){return R(t,e,V(arguments,2),s)}function cn(){var t=arguments;return function(){for(var e=arguments,n=t.length;n--;)e=[t[n].apply(this,e)];return e[0]}}function ln(t,e,r){if(null==t)return _n;var i=typeof t;if("function"!=i){if("object"!=i)return function(e){return e[t]};var a=Ar(t);return function(e){for(var n=a.length,r=!1;n--&&(r=ae(e[a[n]],t[a[n]],s)););return r}}return e!==n?1===r?function(n){return t.call(e,n)}:2===r?function(n,r){return t.call(e,n,r)}:4===r?function(n,r,i,a){return t.call(e,n,r,i,a)}:function(n,r,i){return t.call(e,n,r,i)}:t}function fn(t,e,n){function r(){u=null,n||(a=t.apply(o,i))}var i,a,o,u;return function(){var s=n&&!u;return i=arguments,o=this,Gn(u),u=er(r,e),s&&(a=t.apply(o,i)),a}}function hn(t){var e=V(arguments,1);return er(function(){t.apply(n,e)},1)}function dn(t,e){var r=V(arguments,2);return er(function(){t.apply(n,r)},e)}function pn(t,e){var n={};return function(){var r=Fn(e?e.apply(this,arguments):arguments[0]);return Zn.call(n,r)?n[r]:n[r]=t.apply(this,arguments)}}function vn(t){var e,n;return function(){return e?n:(e=!0,n=t.apply(this,arguments),t=null,n)}}function gn(t){return R(t,V(arguments,1))}function mn(t){return R(t,V(arguments,1),null,s)}function yn(t,e){function n(){u=new Ln,o=null,i=t.apply(a,r)}var r,i,a,o,u=0;return function(){var s=new Ln,c=e-(s-u);return r=arguments,a=this,0>=c?(Gn(o),o=null,u=s,i=t.apply(a,r)):o||(o=er(n,c)),i}}function xn(t,e){return function(){var n=[t];return Jn.apply(n,arguments),e.apply(this,n)}}function bn(t){return null==t?"":Fn(t).replace(y,F)}function _n(t){return t}function An(t){ke(Z(t),function(e){var n=i[e]=t[e];i.prototype[e]=function(){var t=this.__wrapped__,e=[t];Jn.apply(e,arguments);var r=n.apply(i,e);return t&&"object"==typeof t&&t==r?this:new X(r)}})}function wn(){return r._=Un,this}function Mn(t,e){return null==t&&null==e&&(e=1),t=+t||0,null==e&&(e=t,t=0),t+Kn(fr()*((+e||0)-t+1))}function Bn(t,e){var r=t?t[e]:n;return ue(r)?t[e]():r}function kn(t,e,r){var a=i.templateSettings;t||(t=""),r=qr({},r,a);var o,u=qr({},r.imports,a.imports),s=Ar(u),h=xe(u),p=0,g=r.interpolate||m,y="__p += '",b=Dn((r.escape||m).source+"|"+g.source+"|"+(g===v?d:m).source+"|"+(r.evaluate||m).source+"|$","g");t.replace(b,function(e,n,r,i,a,u){return r||(r=i),y+=t.slice(p,u).replace(x,D),n&&(y+="' +\n__e("+n+") +\n'"),a&&(o=!0,y+="';\n"+a+";\n__p += '"),r&&(y+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),p=u+e.length,e}),y+="';\n";var _=r.variable,w=_;w||(_="obj",y="with ("+_+") {\n"+y+"\n}\n"),y=(o?y.replace(c,""):y).replace(l,"$1").replace(f,"$1;"),y="function("+_+") {\n"+(w?"":_+" || ("+_+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+y+"return __p\n}";var M="\n/*\n//@ sourceURL="+(r.sourceURL||"/lodash/template/source["+A++ +"]")+"\n*/";try{var B=Sn(s,"return "+y+M).apply(n,h)}catch(k){throw k.source=y,k}return e?B(e):(B.source=y,B)}function qn(t,e,n){t=(t=+t)>-1?t:0;var r=-1,a=In(t);for(e=i.createCallback(e,n,1);t>++r;)a[r]=e(r);return a}function Pn(t){return null==t?"":Fn(t).replace(h,$)}function jn(t){var e=++u;return Fn(null==t?"":t)+e}function Tn(t,e){return e(t),t}function Cn(){return Fn(this.__wrapped__)}function On(){return this.__wrapped__}r=r?L.defaults(t.Object(),r,L.pick(t,b)):t;var In=r.Array,zn=r.Boolean,Ln=r.Date,Sn=r.Function,En=r.Math,Rn=r.Number,Hn=r.Object,Dn=r.RegExp,Fn=r.String,Nn=r.TypeError,Xn=In(),Wn=Hn(),Un=r._,Vn=Dn("^"+Fn(Wn.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),$n=En.ceil,Gn=r.clearTimeout,Qn=Xn.concat,Kn=En.floor,Yn=Vn.test(Yn=Hn.getPrototypeOf)&&Yn,Zn=Wn.hasOwnProperty,Jn=Xn.push,tr=r.setImmediate,er=r.setTimeout,nr=Wn.toString,rr=Vn.test(rr=V.bind)&&rr,ir=Vn.test(ir=In.isArray)&&ir,ar=r.isFinite,or=r.isNaN,ur=Vn.test(ur=Hn.keys)&&ur,sr=En.max,cr=En.min,lr=r.parseInt,fr=En.random,hr=Vn.test(r.attachEvent),dr=rr&&!/\n|true/.test(rr+hr),pr={};pr[M]=In,pr[B]=zn,pr[k]=Ln,pr[j]=Hn,pr[P]=Rn,pr[T]=Dn,pr[C]=Fn;var vr=i.support={};(function(){var t=function(){this.x=1},e={0:1,length:1},n=[];t.prototype={valueOf:1,y:1};for(var r in new t)n.push(r);for(r in arguments);vr.argsObject=arguments.constructor==Hn,vr.argsClass=G(arguments),vr.enumPrototypes=t.propertyIsEnumerable("prototype"),vr.fastBind=rr&&!dr,vr.ownLast="x"!=n[0],vr.nonEnumArgs=0!=r,vr.nonEnumShadows=!/valueOf/.test(n),vr.spliceObjects=(Xn.splice.call(e,0,1),!e[0]),vr.unindexedChars="xx"!="x"[0]+Hn("x")[0];try{vr.nodeClass=!(nr.call(document)==j&&!({toString:0}+""))}catch(i){vr.nodeClass=!0}})(1),i.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:v,variable:"",imports:{_:i}};var gr=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";\n";if(t.arrays?(e+="var length = iterable.length; index = -1;\nif ("+t.arrays+") {  ",vr.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+"\n  }\n}\nelse {  "):vr.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+"\n    }\n  } else {  "),vr.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    ",vr.enumPrototypes&&(e+="if (!(skipProto && index == 'prototype')) {\n  "),e+=t.loop,vr.enumPrototypes&&(e+="}\n"),e+="  }  ";else if(e+="\n  for (index in iterable) {",(vr.enumPrototypes||t.useHas)&&(e+="\n    if (",vr.enumPrototypes&&(e+="!(skipProto && index == 'prototype')"),vr.enumPrototypes&&t.useHas&&(e+=" && "),t.useHas&&(e+="hasOwnProperty.call(iterable, index)"),e+=") {    "),e+=t.loop+";    ",(vr.enumPrototypes||t.useHas)&&(e+="\n    }"),e+="\n  }    ",vr.nonEnumShadows){e+="\n\n  var ctor = iterable.constructor;\n      ";for(var n=0;7>n;n++)e+="\n  index = '"+t.shadowedProps[n]+"';\n  if (","constructor"==t.shadowedProps[n]&&(e+="!(ctor && ctor.prototype === iterable) && "),e+="hasOwnProperty.call(iterable, index)) {\n    "+t.loop+"\n  }      "}return(t.arrays||vr.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},mr={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},yr={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",arrays:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},xr={top:"if (!objectTypes[typeof iterable]) return result;\n"+yr.top,arrays:!1};X.prototype=i.prototype,vr.argsClass||(G=function(t){return t?Zn.call(t,"callee"):!1});var br=ir||function(t){return vr.argsObject&&t instanceof In||nr.call(t)==M},_r=H({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)",arrays:!1}),Ar=ur?function(t){return se(t)?vr.enumPrototypes&&"function"==typeof t||vr.nonEnumArgs&&t.length&&G(t)?_r(t):ur(t):[]}:_r,wr=H(yr),Mr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Br=te(Mr),kr=H(mr,{top:mr.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),qr=H(mr),Pr=H(yr,xr,{useHas:!1}),jr=H(yr,xr);ue(/x/)&&(ue=function(t){return t instanceof Sn||nr.call(t)==q});var Tr=Yn?function(t){if(!t||nr.call(t)!=j||!vr.argsClass&&G(t))return!1;var e=t.valueOf,n="function"==typeof e&&(n=Yn(e))&&Yn(n);return n?t==n||Yn(t)==n:U(t)}:U,Cr=je,Or=Me;dr&&a&&"function"==typeof tr&&(hn=on(tr,r));var Ir=8==lr("08")?lr:function(t,e){return lr(de(t)?t.replace(g,""):t,e||0)};return i.after=an,i.assign=kr,i.at=be,i.bind=on,i.bindAll=un,i.bindKey=sn,i.compact=De,i.compose=cn,i.countBy=Ae,i.createCallback=ln,i.debounce=fn,i.defaults=qr,i.defer=hn,i.delay=dn,i.difference=Fe,i.filter=Me,i.flatten=We,i.forEach=ke,i.forIn=Pr,i.forOwn=jr,i.functions=Z,i.groupBy=qe,i.initial=Ve,i.intersection=$e,i.invert=te,i.invoke=Pe,i.keys=Ar,i.map=je,i.max=Te,i.memoize=pn,i.merge=ve,i.min=Ce,i.omit=ge,i.once=vn,i.pairs=me,i.partial=gn,i.partialRight=mn,i.pick=ye,i.pluck=Cr,i.range=Ke,i.reject=ze,i.rest=Ye,i.shuffle=Le,i.sortBy=Re,i.tap=Tn,i.throttle=yn,i.times=qn,i.toArray=He,i.union=Je,i.uniq=tn,i.values=xe,i.where=Or,i.without=en,i.wrap=xn,i.zip=nn,i.zipObject=rn,i.collect=je,i.drop=Ye,i.each=ke,i.extend=kr,i.methods=Z,i.object=rn,i.select=Me,i.tail=Ye,i.unique=tn,An(i),i.clone=Q,i.cloneDeep=K,i.contains=_e,i.escape=bn,i.every=we,i.find=Be,i.findIndex=Ne,i.findKey=Y,i.has=J,i.identity=_n,i.indexOf=Ue,i.isArguments=G,i.isArray=br,i.isBoolean=ee,i.isDate=ne,i.isElement=re,i.isEmpty=ie,i.isEqual=ae,i.isFinite=oe,i.isFunction=ue,i.isNaN=ce,i.isNull=le,i.isNumber=fe,i.isObject=se,i.isPlainObject=Tr,i.isRegExp=he,i.isString=de,i.isUndefined=pe,i.lastIndexOf=Qe,i.mixin=An,i.noConflict=wn,i.parseInt=Ir,i.random=Mn,i.reduce=Oe,i.reduceRight=Ie,i.result=Bn,i.runInContext=e,i.size=Se,i.some=Ee,i.sortedIndex=Ze,i.template=kn,i.unescape=Pn,i.uniqueId=jn,i.all=we,i.any=Ee,i.detect=Be,i.foldl=Oe,i.foldr=Ie,i.include=_e,i.inject=Oe,jr(i,function(t,e){i.prototype[e]||(i.prototype[e]=function(){var e=[this.__wrapped__];return Jn.apply(e,arguments),t.apply(i,e)})}),i.first=Xe,i.last=Ge,i.take=Xe,i.head=Xe,jr(i,function(t,e){i.prototype[e]||(i.prototype[e]=function(e,n){var r=t(this.__wrapped__,e,n);return null==e||n&&"function"!=typeof e?r:new X(r)})}),i.VERSION="1.1.1",i.prototype.toString=Cn,i.prototype.value=On,i.prototype.valueOf=On,wr(["join","pop","shift"],function(t){var e=Xn[t];i.prototype[t]=function(){return e.apply(this.__wrapped__,arguments)}}),wr(["push","reverse","sort","unshift"],function(t){var e=Xn[t];i.prototype[t]=function(){return e.apply(this.__wrapped__,arguments),this}}),wr(["concat","slice","splice"],function(t){var e=Xn[t];i.prototype[t]=function(){return new X(e.apply(this.__wrapped__,arguments))}}),vr.spliceObjects||wr(["pop","shift","splice"],function(t){var e=Xn[t],n="splice"==t;i.prototype[t]=function(){var t=this.__wrapped__,r=e.apply(t,arguments);return 0===t.length&&delete t[0],n?new X(r):r}}),i}var n,i="object"==typeof exports&&exports,a="object"==typeof module&&module&&module.exports==i&&module,o="object"==typeof global&&global;o.global===o&&(t=o);var u=0,s={},c=/\b__p \+= '';/g,l=/\b(__p \+=) '' \+/g,f=/(__e\(.*?\)|\b__t\)) \+\n'';/g,h=/&(?:amp|lt|gt|quot|#39);/g,d=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,p=/\w*$/,v=/<%=([\s\S]+?)%>/g,g=/^0+(?=.$)/,m=/($^)/,y=/[&<>"']/g,x=/['\n\r\t\u2028\u2029\\]/g,b=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],A=0,w="[object Arguments]",M="[object Array]",B="[object Boolean]",k="[object Date]",q="[object Function]",P="[object Number]",j="[object Object]",T="[object RegExp]",C="[object String]",O={};O[q]=!1,O[w]=O[M]=O[B]=O[k]=O[P]=O[j]=O[T]=O[C]=!0;var I={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},z={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},L=e();"function"==typeof r&&"object"==typeof r.amd&&r.amd?(t._=L,r("_",[],function(){return L})):i&&!i.nodeType?a?(a.exports=L)._=L:i._=L:t._=L}(this),r("core/base",["require","./mixin/derive","./mixin/notifier","./mixin/dirty","./cache","_"],function(t){var e=t("./mixin/derive"),n=t("./mixin/notifier"),r=t("./mixin/dirty"),i=t("./cache"),a=t("_"),o=function(){this.cache=new i};return a.extend(o,e),a.extend(o.prototype,n),a.extend(o.prototype,r),o}),function(t){var e={};"undefined"==typeof exports?"function"==typeof r&&"object"==typeof r.amd&&r.amd?(e.exports={},r("glmatrix",[],function(){return e.exports})):e.exports="undefined"!=typeof window?window:t:e.exports=exports,function(t){if(!e)var e=1e-6;if(!n)var n="undefined"!=typeof Float32Array?Float32Array:Array;if(!r)var r=Math.random;var i={};i.setMatrixArrayType=function(t){n=t},t!==void 0&&(t.glMatrix=i);var a={};a.create=function(){var t=new n(2);return t[0]=0,t[1]=0,t},a.clone=function(t){var e=new n(2);return e[0]=t[0],e[1]=t[1],e},a.fromValues=function(t,e){var r=new n(2);return r[0]=t,r[1]=e,r},a.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},a.set=function(t,e,n){return t[0]=e,t[1]=n,t},a.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},a.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},a.sub=a.subtract,a.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},a.mul=a.multiply,a.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},a.div=a.divide,a.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},a.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},a.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},a.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},a.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)},a.dist=a.distance,a.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},a.sqrDist=a.squaredDistance,a.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},a.len=a.length,a.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},a.sqrLen=a.squaredLength,a.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},a.normalize=function(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},a.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},a.cross=function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t},a.lerp=function(t,e,n,r){var i=e[0],a=e[1];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t},a.random=function(t,e){e=e||1;var n=2*r()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},a.transformMat2=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t},a.transformMat2d=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t
},a.transformMat3=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t},a.transformMat4=function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t},a.forEach=function(){var t=a.create();return function(e,n,r,i,a,o){var u,s;for(n||(n=2),r||(r=0),s=i?Math.min(i*n+r,e.length):e.length,u=r;s>u;u+=n)t[0]=e[u],t[1]=e[u+1],a(t,t,o),e[u]=t[0],e[u+1]=t[1];return e}}(),a.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},t!==void 0&&(t.vec2=a);var o={};o.create=function(){var t=new n(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var e=new n(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.fromValues=function(t,e,r){var i=new n(3);return i[0]=t,i[1]=e,i[2]=r,i},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.set=function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},o.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},o.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},o.sub=o.subtract,o.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},o.mul=o.multiply,o.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},o.div=o.divide,o.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},o.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},o.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},o.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},o.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)},o.dist=o.distance,o.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)},o.len=o.length,o.squaredLength=function(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r},o.sqrLen=o.squaredLength,o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},o.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},o.cross=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],u=n[1],s=n[2];return t[0]=i*s-a*u,t[1]=a*o-r*s,t[2]=r*u-i*o,t},o.lerp=function(t,e,n,r){var i=e[0],a=e[1],o=e[2];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t},o.random=function(t,e){e=e||1;var n=2*r()*Math.PI,i=2*r()-1,a=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=i*e,t},o.transformMat4=function(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12],t[1]=n[1]*r+n[5]*i+n[9]*a+n[13],t[2]=n[2]*r+n[6]*i+n[10]*a+n[14],t},o.transformMat3=function(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t},o.transformQuat=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],u=n[1],s=n[2],c=n[3],l=c*r+u*a-s*i,f=c*i+s*r-o*a,h=c*a+o*i-u*r,d=-o*r-u*i-s*a;return t[0]=l*c+d*-o+f*-s-h*-u,t[1]=f*c+d*-u+h*-o-l*-s,t[2]=h*c+d*-s+l*-u-f*-o,t},o.forEach=function(){var t=o.create();return function(e,n,r,i,a,o){var u,s;for(n||(n=3),r||(r=0),s=i?Math.min(i*n+r,e.length):e.length,u=r;s>u;u+=n)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],a(t,t,o),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2];return e}}(),o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t!==void 0&&(t.vec3=o);var u={};u.create=function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},u.clone=function(t){var e=new n(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.fromValues=function(t,e,r,i){var a=new n(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=i,a},u.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},u.set=function(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t},u.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},u.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t},u.sub=u.subtract,u.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},u.mul=u.multiply,u.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t},u.div=u.divide,u.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},u.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},u.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},u.scaleAndAdd=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},u.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(n*n+r*r+i*i+a*a)},u.dist=u.distance,u.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return n*n+r*r+i*i+a*a},u.sqrDist=u.squaredDistance,u.length=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)},u.len=u.length,u.squaredLength=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i},u.sqrLen=u.squaredLength,u.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},u.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o),t},u.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},u.lerp=function(t,e,n,r){var i=e[0],a=e[1],o=e[2],u=e[3];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t[3]=u+r*(n[3]-u),t},u.random=function(t,e){return e=e||1,t[0]=r(),t[1]=r(),t[2]=r(),t[3]=r(),u.normalize(t,t),u.scale(t,t,e),t},u.transformMat4=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,t},u.transformQuat=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],u=n[1],s=n[2],c=n[3],l=c*r+u*a-s*i,f=c*i+s*r-o*a,h=c*a+o*i-u*r,d=-o*r-u*i-s*a;return t[0]=l*c+d*-o+f*-s-h*-u,t[1]=f*c+d*-u+h*-o-l*-s,t[2]=h*c+d*-s+l*-u-f*-o,t},u.forEach=function(){var t=u.create();return function(e,n,r,i,a,o){var u,s;for(n||(n=4),r||(r=0),s=i?Math.min(i*n+r,e.length):e.length,u=r;s>u;u+=n)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],t[3]=e[u+3],a(t,t,o),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];return e}}(),u.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.vec4=u);var s={};s.create=function(){var t=new n(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},s.clone=function(t){var e=new n(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},s.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},s.invert=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*a-i*r;return o?(o=1/o,t[0]=a*o,t[1]=-r*o,t[2]=-i*o,t[3]=n*o,t):null},s.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},s.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},s.multiply=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=n[0],s=n[1],c=n[2],l=n[3];return t[0]=r*u+i*c,t[1]=r*s+i*l,t[2]=a*u+o*c,t[3]=a*s+o*l,t},s.mul=s.multiply,s.rotate=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=Math.sin(n),s=Math.cos(n);return t[0]=r*s+i*u,t[1]=r*-u+i*s,t[2]=a*s+o*u,t[3]=a*-u+o*s,t},s.scale=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=n[0],s=n[1];return t[0]=r*u,t[1]=i*s,t[2]=a*u,t[3]=o*s,t},s.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.mat2=s);var c={};c.create=function(){var t=new n(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.clone=function(t){var e=new n(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},c.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.invert=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=n*a-r*i;return s?(s=1/s,t[0]=a*s,t[1]=-r*s,t[2]=-i*s,t[3]=n*s,t[4]=(i*u-a*o)*s,t[5]=(r*o-n*u)*s,t):null},c.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},c.multiply=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=n[0],l=n[1],f=n[2],h=n[3],d=n[4],p=n[5];return t[0]=r*c+i*f,t[1]=r*l+i*h,t[2]=a*c+o*f,t[3]=a*l+o*h,t[4]=c*u+f*s+d,t[5]=l*u+h*s+p,t},c.mul=c.multiply,c.rotate=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=Math.sin(n),l=Math.cos(n);return t[0]=r*l+i*c,t[1]=-r*c+i*l,t[2]=a*l+o*c,t[3]=-a*c+l*o,t[4]=l*u+c*s,t[5]=l*s-c*u,t},c.scale=function(t,e,n){var r=n[0],i=n[1];return t[0]=e[0]*r,t[1]=e[1]*i,t[2]=e[2]*r,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*i,t},c.translate=function(t,e,n){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+n[0],t[5]=e[5]+n[1],t},c.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},t!==void 0&&(t.mat2d=c);var l={};l.create=function(){var t=new n(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},l.clone=function(t){var e=new n(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},l.invert=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],c=e[7],l=e[8],f=l*o-u*c,h=-l*a+u*s,d=c*a-o*s,p=n*f+r*h+i*d;return p?(p=1/p,t[0]=f*p,t[1]=(-l*r+i*c)*p,t[2]=(u*r-i*o)*p,t[3]=h*p,t[4]=(l*n-i*s)*p,t[5]=(-u*n+i*a)*p,t[6]=d*p,t[7]=(-c*n+r*s)*p,t[8]=(o*n-r*a)*p,t):null},l.adjoint=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],c=e[7],l=e[8];return t[0]=o*l-u*c,t[1]=i*c-r*l,t[2]=r*u-i*o,t[3]=u*s-a*l,t[4]=n*l-i*s,t[5]=i*a-n*u,t[6]=a*c-o*s,t[7]=r*s-n*c,t[8]=n*o-r*a,t},l.determinant=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],u=t[6],s=t[7],c=t[8];return e*(c*a-o*s)+n*(-c*i+o*u)+r*(s*i-a*u)},l.multiply=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=e[6],l=e[7],f=e[8],h=n[0],d=n[1],p=n[2],v=n[3],g=n[4],m=n[5],y=n[6],x=n[7],b=n[8];return t[0]=h*r+d*o+p*c,t[1]=h*i+d*u+p*l,t[2]=h*a+d*s+p*f,t[3]=v*r+g*o+m*c,t[4]=v*i+g*u+m*l,t[5]=v*a+g*s+m*f,t[6]=y*r+x*o+b*c,t[7]=y*i+x*u+b*l,t[8]=y*a+x*s+b*f,t},l.mul=l.multiply,l.translate=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=e[6],l=e[7],f=e[8],h=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=u,t[5]=s,t[6]=h*r+d*o+c,t[7]=h*i+d*u+l,t[8]=h*a+d*s+f,t},l.rotate=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=e[6],l=e[7],f=e[8],h=Math.sin(n),d=Math.cos(n);return t[0]=d*r+h*o,t[1]=d*i+h*u,t[2]=d*a+h*s,t[3]=d*o-h*r,t[4]=d*u-h*i,t[5]=d*s-h*a,t[6]=c,t[7]=l,t[8]=f,t},l.scale=function(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},l.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},l.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,u=r+r,s=i+i,c=n*o,l=n*u,f=n*s,h=r*u,d=r*s,p=i*s,v=a*o,g=a*u,m=a*s;return t[0]=1-(h+p),t[3]=l+m,t[6]=f-g,t[1]=l-m,t[4]=1-(c+p),t[7]=d+v,t[2]=f+g,t[5]=d-v,t[8]=1-(c+h),t},l.normalFromMat4=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],g=e[14],m=e[15],y=n*u-r*o,x=n*s-i*o,b=n*c-a*o,_=r*s-i*u,A=r*c-a*u,w=i*c-a*s,M=l*v-f*p,B=l*g-h*p,k=l*m-d*p,q=f*g-h*v,P=f*m-d*v,j=h*m-d*g,T=y*j-x*P+b*q+_*k-A*B+w*M;return T?(T=1/T,t[0]=(u*j-s*P+c*q)*T,t[1]=(s*k-o*j-c*B)*T,t[2]=(o*P-u*k+c*M)*T,t[3]=(i*P-r*j-a*q)*T,t[4]=(n*j-i*k+a*B)*T,t[5]=(r*k-n*P-a*M)*T,t[6]=(v*w-g*A+m*_)*T,t[7]=(g*b-p*w-m*x)*T,t[8]=(p*A-v*b+m*y)*T,t):null},l.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t!==void 0&&(t.mat3=l);var f={};f.create=function(){var t=new n(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},f.clone=function(t){var e=new n(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},f.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},f.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},f.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],o=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},f.invert=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],g=e[14],m=e[15],y=n*u-r*o,x=n*s-i*o,b=n*c-a*o,_=r*s-i*u,A=r*c-a*u,w=i*c-a*s,M=l*v-f*p,B=l*g-h*p,k=l*m-d*p,q=f*g-h*v,P=f*m-d*v,j=h*m-d*g,T=y*j-x*P+b*q+_*k-A*B+w*M;return T?(T=1/T,t[0]=(u*j-s*P+c*q)*T,t[1]=(i*P-r*j-a*q)*T,t[2]=(v*w-g*A+m*_)*T,t[3]=(h*A-f*w-d*_)*T,t[4]=(s*k-o*j-c*B)*T,t[5]=(n*j-i*k+a*B)*T,t[6]=(g*b-p*w-m*x)*T,t[7]=(l*w-h*b+d*x)*T,t[8]=(o*P-u*k+c*M)*T,t[9]=(r*k-n*P-a*M)*T,t[10]=(p*A-v*b+m*y)*T,t[11]=(f*b-l*A-d*y)*T,t[12]=(u*B-o*q-s*M)*T,t[13]=(n*q-r*B+i*M)*T,t[14]=(v*x-p*_-g*y)*T,t[15]=(l*_-f*x+h*y)*T,t):null},f.adjoint=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],u=e[5],s=e[6],c=e[7],l=e[8],f=e[9],h=e[10],d=e[11],p=e[12],v=e[13],g=e[14],m=e[15];return t[0]=u*(h*m-d*g)-f*(s*m-c*g)+v*(s*d-c*h),t[1]=-(r*(h*m-d*g)-f*(i*m-a*g)+v*(i*d-a*h)),t[2]=r*(s*m-c*g)-u*(i*m-a*g)+v*(i*c-a*s),t[3]=-(r*(s*d-c*h)-u*(i*d-a*h)+f*(i*c-a*s)),t[4]=-(o*(h*m-d*g)-l*(s*m-c*g)+p*(s*d-c*h)),t[5]=n*(h*m-d*g)-l*(i*m-a*g)+p*(i*d-a*h),t[6]=-(n*(s*m-c*g)-o*(i*m-a*g)+p*(i*c-a*s)),t[7]=n*(s*d-c*h)-o*(i*d-a*h)+l*(i*c-a*s),t[8]=o*(f*m-d*v)-l*(u*m-c*v)+p*(u*d-c*f),t[9]=-(n*(f*m-d*v)-l*(r*m-a*v)+p*(r*d-a*f)),t[10]=n*(u*m-c*v)-o*(r*m-a*v)+p*(r*c-a*u),t[11]=-(n*(u*d-c*f)-o*(r*d-a*f)+l*(r*c-a*u)),t[12]=-(o*(f*g-h*v)-l*(u*g-s*v)+p*(u*h-s*f)),t[13]=n*(f*g-h*v)-l*(r*g-i*v)+p*(r*h-i*f),t[14]=-(n*(u*g-s*v)-o*(r*g-i*v)+p*(r*s-i*u)),t[15]=n*(u*h-s*f)-o*(r*h-i*f)+l*(r*s-i*u),t},f.determinant=function(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],u=t[6],s=t[7],c=t[8],l=t[9],f=t[10],h=t[11],d=t[12],p=t[13],v=t[14],g=t[15],m=e*o-n*a,y=e*u-r*a,x=e*s-i*a,b=n*u-r*o,_=n*s-i*o,A=r*s-i*u,w=c*p-l*d,M=c*v-f*d,B=c*g-h*d,k=l*v-f*p,q=l*g-h*p,P=f*g-h*v;return m*P-y*q+x*k+b*B-_*M+A*w},f.multiply=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=e[6],l=e[7],f=e[8],h=e[9],d=e[10],p=e[11],v=e[12],g=e[13],m=e[14],y=e[15],x=n[0],b=n[1],_=n[2],A=n[3];return t[0]=x*r+b*u+_*f+A*v,t[1]=x*i+b*s+_*h+A*g,t[2]=x*a+b*c+_*d+A*m,t[3]=x*o+b*l+_*p+A*y,x=n[4],b=n[5],_=n[6],A=n[7],t[4]=x*r+b*u+_*f+A*v,t[5]=x*i+b*s+_*h+A*g,t[6]=x*a+b*c+_*d+A*m,t[7]=x*o+b*l+_*p+A*y,x=n[8],b=n[9],_=n[10],A=n[11],t[8]=x*r+b*u+_*f+A*v,t[9]=x*i+b*s+_*h+A*g,t[10]=x*a+b*c+_*d+A*m,t[11]=x*o+b*l+_*p+A*y,x=n[12],b=n[13],_=n[14],A=n[15],t[12]=x*r+b*u+_*f+A*v,t[13]=x*i+b*s+_*h+A*g,t[14]=x*a+b*c+_*d+A*m,t[15]=x*o+b*l+_*p+A*y,t},f.mul=f.multiply,f.translate=function(t,e,n){var r,i,a,o,u,s,c,l,f,h,d,p,v=n[0],g=n[1],m=n[2];return e===t?(t[12]=e[0]*v+e[4]*g+e[8]*m+e[12],t[13]=e[1]*v+e[5]*g+e[9]*m+e[13],t[14]=e[2]*v+e[6]*g+e[10]*m+e[14],t[15]=e[3]*v+e[7]*g+e[11]*m+e[15]):(r=e[0],i=e[1],a=e[2],o=e[3],u=e[4],s=e[5],c=e[6],l=e[7],f=e[8],h=e[9],d=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=u,t[5]=s,t[6]=c,t[7]=l,t[8]=f,t[9]=h,t[10]=d,t[11]=p,t[12]=r*v+u*g+f*m+e[12],t[13]=i*v+s*g+h*m+e[13],t[14]=a*v+c*g+d*m+e[14],t[15]=o*v+l*g+p*m+e[15]),t},f.scale=function(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},f.rotate=function(t,n,r,i){var a,o,u,s,c,l,f,h,d,p,v,g,m,y,x,b,_,A,w,M,B,k,q,P,j=i[0],T=i[1],C=i[2],O=Math.sqrt(j*j+T*T+C*C);return e>Math.abs(O)?null:(O=1/O,j*=O,T*=O,C*=O,a=Math.sin(r),o=Math.cos(r),u=1-o,s=n[0],c=n[1],l=n[2],f=n[3],h=n[4],d=n[5],p=n[6],v=n[7],g=n[8],m=n[9],y=n[10],x=n[11],b=j*j*u+o,_=T*j*u+C*a,A=C*j*u-T*a,w=j*T*u-C*a,M=T*T*u+o,B=C*T*u+j*a,k=j*C*u+T*a,q=T*C*u-j*a,P=C*C*u+o,t[0]=s*b+h*_+g*A,t[1]=c*b+d*_+m*A,t[2]=l*b+p*_+y*A,t[3]=f*b+v*_+x*A,t[4]=s*w+h*M+g*B,t[5]=c*w+d*M+m*B,t[6]=l*w+p*M+y*B,t[7]=f*w+v*M+x*B,t[8]=s*k+h*q+g*P,t[9]=c*k+d*q+m*P,t[10]=l*k+p*q+y*P,t[11]=f*k+v*q+x*P,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)},f.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],o=e[5],u=e[6],s=e[7],c=e[8],l=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+c*r,t[5]=o*i+l*r,t[6]=u*i+f*r,t[7]=s*i+h*r,t[8]=c*i-a*r,t[9]=l*i-o*r,t[10]=f*i-u*r,t[11]=h*i-s*r,t},f.rotateY=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],u=e[2],s=e[3],c=e[8],l=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-c*r,t[1]=o*i-l*r,t[2]=u*i-f*r,t[3]=s*i-h*r,t[8]=a*r+c*i,t[9]=o*r+l*i,t[10]=u*r+f*i,t[11]=s*r+h*i,t},f.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],u=e[2],s=e[3],c=e[4],l=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+c*r,t[1]=o*i+l*r,t[2]=u*i+f*r,t[3]=s*i+h*r,t[4]=c*i-a*r,t[5]=l*i-o*r,t[6]=f*i-u*r,t[7]=h*i-s*r,t},f.fromRotationTranslation=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=r+r,s=i+i,c=a+a,l=r*u,f=r*s,h=r*c,d=i*s,p=i*c,v=a*c,g=o*u,m=o*s,y=o*c;return t[0]=1-(d+v),t[1]=f+y,t[2]=h-m,t[3]=0,t[4]=f-y,t[5]=1-(l+v),t[6]=p+g,t[7]=0,t[8]=h+m,t[9]=p-g,t[10]=1-(l+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},f.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,u=r+r,s=i+i,c=n*o,l=n*u,f=n*s,h=r*u,d=r*s,p=i*s,v=a*o,g=a*u,m=a*s;return t[0]=1-(h+p),t[1]=l+m,t[2]=f-g,t[3]=0,t[4]=l-m,t[5]=1-(c+p),t[6]=d+v,t[7]=0,t[8]=f+g,t[9]=d-v,t[10]=1-(c+h),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},f.frustum=function(t,e,n,r,i,a,o){var u=1/(n-e),s=1/(i-r),c=1/(a-o);return t[0]=2*a*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*s,t[6]=0,t[7]=0,t[8]=(n+e)*u,t[9]=(i+r)*s,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*a*c,t[15]=0,t},f.perspective=function(t,e,n,r,i){var a=1/Math.tan(e/2),o=1/(r-i);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*o,t[15]=0,t},f.ortho=function(t,e,n,r,i,a,o){var u=1/(e-n),s=1/(r-i),c=1/(a-o);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*u,t[13]=(i+r)*s,t[14]=(o+a)*c,t[15]=1,t},f.lookAt=function(t,n,r,i){var a,o,u,s,c,l,h,d,p,v,g=n[0],m=n[1],y=n[2],x=i[0],b=i[1],_=i[2],A=r[0],w=r[1],M=r[2];return e>Math.abs(g-A)&&e>Math.abs(m-w)&&e>Math.abs(y-M)?f.identity(t):(h=g-A,d=m-w,p=y-M,v=1/Math.sqrt(h*h+d*d+p*p),h*=v,d*=v,p*=v,a=b*p-_*d,o=_*h-x*p,u=x*d-b*h,v=Math.sqrt(a*a+o*o+u*u),v?(v=1/v,a*=v,o*=v,u*=v):(a=0,o=0,u=0),s=d*u-p*o,c=p*a-h*u,l=h*o-d*a,v=Math.sqrt(s*s+c*c+l*l),v?(v=1/v,s*=v,c*=v,l*=v):(s=0,c=0,l=0),t[0]=a,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=c,t[6]=d,t[7]=0,t[8]=u,t[9]=l,t[10]=p,t[11]=0,t[12]=-(a*g+o*m+u*y),t[13]=-(s*g+c*m+l*y),t[14]=-(h*g+d*m+p*y),t[15]=1,t)},f.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t!==void 0&&(t.mat4=f);var h={};h.create=function(){var t=new n(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.rotationTo=function(){var t=o.create(),e=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(r,i,a){var u=o.dot(i,a);return-.999999>u?(o.cross(t,e,i),1e-6>o.length(t)&&o.cross(t,n,i),o.normalize(t,t),h.setAxisAngle(r,t,Math.PI),r):u>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o.cross(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+u,h.normalize(r,r))}}(),h.setAxes=function(){var t=l.create();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=n[0],t[5]=n[1],t[8]=n[2],h.normalize(e,h.fromMat3(e,t))}}(),h.clone=u.clone,h.fromValues=u.fromValues,h.copy=u.copy,h.set=u.set,h.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.setAxisAngle=function(t,e,n){n=.5*n;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t},h.add=u.add,h.multiply=function(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],u=n[0],s=n[1],c=n[2],l=n[3];return t[0]=r*l+o*u+i*c-a*s,t[1]=i*l+o*s+a*u-r*c,t[2]=a*l+o*c+r*s-i*u,t[3]=o*l-r*u-i*s-a*c,t},h.mul=h.multiply,h.scale=u.scale,h.rotateX=function(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],u=Math.sin(n),s=Math.cos(n);return t[0]=r*s+o*u,t[1]=i*s+a*u,t[2]=a*s-i*u,t[3]=o*s-r*u,t},h.rotateY=function(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],u=Math.sin(n),s=Math.cos(n);return t[0]=r*s-a*u,t[1]=i*s+o*u,t[2]=a*s+r*u,t[3]=o*s-i*u,t},h.rotateZ=function(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],u=Math.sin(n),s=Math.cos(n);return t[0]=r*s+i*u,t[1]=i*s-r*u,t[2]=a*s+o*u,t[3]=o*s-a*u,t},h.calculateW=function(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t},h.dot=u.dot,h.lerp=u.lerp,h.slerp=function(t,e,n,r){var i,a,o,u,s,c=e[0],l=e[1],f=e[2],h=e[3],d=n[0],p=n[1],v=n[2],g=n[3];return a=c*d+l*p+f*v+h*g,0>a&&(a=-a,d=-d,p=-p,v=-v,g=-g),1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),u=Math.sin((1-r)*i)/o,s=Math.sin(r*i)/o):(u=1-r,s=r),t[0]=u*c+s*d,t[1]=u*l+s*p,t[2]=u*f+s*v,t[3]=u*h+s*g,t},h.invert=function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a,u=o?1/o:0;return t[0]=-n*u,t[1]=-r*u,t[2]=-i*u,t[3]=a*u,t},h.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},h.length=u.length,h.len=h.length,h.squaredLength=u.squaredLength,h.sqrLen=h.squaredLength,h.normalize=u.normalize,h.fromMat3=function(){var t="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(e,n){var r,i=n[0]+n[4]+n[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(n[7]-n[5])*r,e[1]=(n[2]-n[6])*r,e[2]=(n[3]-n[1])*r;else{var a=0;n[4]>n[0]&&(a=1),n[8]>n[3*a+a]&&(a=2);var o=t[a],u=t[o];r=Math.sqrt(n[3*a+a]-n[3*o+o]-n[3*u+u]+1),e[a]=.5*r,r=.5/r,e[3]=(n[3*u+o]-n[3*o+u])*r,e[o]=(n[3*o+a]+n[3*a+o])*r,e[u]=(n[3*u+a]+n[3*a+u])*r}return e}}(),h.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.quat=h)}(e.exports)}(this),r("2d/style",["require","core/base","_"],function(t){function e(t){return(t||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")}var n=t("core/base"),r=t("_"),i=["fillStyle","strokeStyle","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","globalAlpha","font"],a={fill:"fillStyle",stroke:"strokeStyle",alpha:"globalAlpha",shadow:["shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor"]},o=/([0-9]+)\s+([0-9]+)\s+([0-9]+)\s+([a-zA-Z0-9\(\)\s,#]+)/,u=n.derive({},{bind:function(t){var n=i,u=a;for(var s in u)if(this.hasOwnProperty(s)){var c=u[s],l=this[s];if("shadow"==s){var f=o.exec(e(l));if(!f)continue;l=f.slice(1),r.each(l,function(e,n){c[n]&&(t[c[n]]=e)},this)}else t[c]=l}r.each(n,function(e){this.hasOwnProperty(e)&&(t[e]=this[e])},this)}});return u}),r("2d/node",["require","core/base","glmatrix","./style"],function(t){var e=t("core/base"),n=t("glmatrix"),r=n.vec2,i=n.mat2d,a=t("./style"),o=e.derive(function(){return{__mouseover__:!1,id:0,AABB:[r.fromValues(0,0),r.fromValues(0,0)],z:0,style:null,position:r.fromValues(0,0),rotation:0,scale:r.fromValues(1,1),_transform:i.create(),_transformInverse:i.create(),visible:!0,children:{},intersectLineWidth:0,clip:!1,fill:!0,stroke:!0,fixAA:!0}},function(){this.__GUID__=u()},{updateTransform:function(){var t=this._transform;return i.identity(t),this.scale&&i.scale(t,t,this.scale),this.rotation&&i.rotate(t,t,this.rotation),this.position&&i.translate(t,t,this.position),t},updateTransformInverse:function(){i.invert(this._transformInverse,this._transformInverse)},intersectAABB:function(t,e){var n=this.AABB;return t>n[0][0]&&n[1][0]>t&&e>n[0][1]&&n[1][1]>e},add:function(t){t&&(this.children[t.__GUID__]=t,t.parent=this)},remove:function(t){this.children[t.__GUID__]=null,t.parent=null},draw:function(){},render:function(t){var e=this._getSortedRenderQueue();if(t.save(),this.style)if(!this.style instanceof a)for(var n in this.style)this.style[n].bind(t);else this.style.bind(t);var r=this.updateTransform();t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this.draw(t),this.clip&&t.clip();for(var i=0;e.length>i;i++)e[i].render(t);t.restore()},traverse:function(t){var e=t&&t(this);if(!e)for(var n=this.children,r=0,i=n.length;i>r;r++)n[r].traverse(t)},intersect:function(){},_getSortedRenderQueue:function(){var t=[];for(var e in this.children)t.push(this.children[e]);return t.sort(function(t,e){return t.z===e.z?t.__GUID__>e.__GUID__?1:-1:t.z>e.z?1:-1}),t}}),u=function(){var t=0;return function(){return++t}}();return o}),r("2d/util",["require"],function(){return{fixPos:function(t){return[t[0]+.5,t[1]+.5]},fixPosArray:function(t){for(var e=[],n=t.length,r=0;n>r;r++)e.push(this.fixPos(t[r]));return e},computeAABB:function(t){for(var e=t[0][0],n=t[0][0],r=t[0][1],i=t[0][1],a=1;t.length>a;a++)e=e>t[a][0]?t[a][0]:e,n=t[a][0]>n?t[a][0]:n,r=r>t[a][1]?t[a][1]:r,i=t[a][1]>i?t[a][1]:i;return[[e,r],[n,i]]}}}),r("2d/renderable/arc",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),n=t("../util"),r=t("glmatrix");r.vec2;var i=e.derive(function(){return{center:[0,0],radius:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(){var t=this.fixAA?n.fixPos(this.center):this.center;ctx.beginPath(),ctx.arc(t[0],t[1],this.radius,this.startAngle,this.endAngle,!this.clockwise),this.stroke&&ctx.stroke(),this.fill&&ctx.fill()},intersect:function(){return!1}});return i}),r("2d/renderable/circle",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),n=t("../util"),r=t("glmatrix"),i=r.vec2,a=e.derive(function(){return{center:[0,0],radius:0}},{computeAABB:function(){this.AABB=[[this.center[0]-this.radius,this.center[1]-this.radius],[this.center[0]+this.radius,this.center[1]+this.radius]]},draw:function(t){var e=this.fixAA?n.fixPos(this.center):this.center;t.beginPath(),t.arc(e[0],e[1],this.radius,0,2*Math.PI,!1),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(){return i.len([this.center[0]-x,this.center[1]-y])<this.radius}});return a}),r("2d/renderable/image",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),n=t("../util"),r=t("glmatrix");r.vec2;var i={},a=e.derive(function(){return{img:"",start:[0,0],size:0,onload:function(){}}},function(){if("string"==typeof this.img){var t=this;this.load(this.img,function(e){t.img=e,t.onload.call(t)})}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(t){var e=this.fixAA?n.fixPos(this.start):this.start;"string"!=typeof this.img&&(this.size?t.drawImage(this.img,e[0],e[1],this.size[0],this.size[1]):t.drawImage(this.img,e[0],e[1]))},intersect:function(t,e){return this.intersectAABB(t,e)},load:function(t,e){if(i[t]){var n=i[t];n.constructor==Array?n.push(e):e(n)}else{i[t]=[e];var n=new a;n.onload=function(){each(i[t],function(t){t(n)}),i[t]=n},n.src=t}}});return a}),r("2d/renderable/line",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),n=t("../util"),r=t("glmatrix"),i=r.vec2,a=e.derive(function(){return{start:[0,0],end:[0,0],width:0}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,this.end]),this.AABB[0][0]==this.AABB[1][0]&&(this.AABB[0][0]-=this.width/2,this.AABB[1][0]+=this.width/2),this.AABB[0][1]==this.AABB[1][1]&&(this.AABB[0][1]-=this.width/2,this.AABB[1][1]+=this.width/2)},draw:function(t){var e=this.fixAA?n.fixPos(this.start):this.start,r=this.fixAA?n.fixPos(this.end):this.end;t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(r[0],r[1]),t.stroke()},intersect:function(t,e){if(!this.intersectAABB(t,e))return!1;var n=[t,e];b=this.start,c=this.end,ba=i.sub([],n,b),bc=i.sub([],c,b);var r=i.dot(bc,ba);i.normalize(bc,bc);var a=i.add(b,i.scale(bc,r)),o=i.length(i.sub(n,n,a));return this.width/2>o}});return a}),r("2d/renderable/path",["require","../node","../util","glmatrix"],function(t){var e=t("../node");t("../util");var n=t("glmatrix"),r=n.vec2,i=e.derive(function(){return{segments:[],globalStyle:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(t){this.globalStyle?this.drawWithSameStyle(t):this.drawWithDifferentStyle(t)},drawWithSameStyle:function(t){var e=this.segments.length,n=this.segments;t.beginPath(),t.moveTo(n[0].point[0],n[0].point[1]);for(var r=1;e>r;r++)if(n[r-1].handleOut||n[r].handleIn){var i=n[r-1].handleOut||n[r-1].point,a=n[r].handleIn||n[r].point;t.bezierCurveTo(i[0],i[1],a[0],a[1],n[r].point[0],n[r].point[1])}else t.lineTo(n[r].point[0],n[r].point[1]);this.fill&&t.fill(),this.stroke&&t.stroke()},drawWithDifferentStyle:function(t){for(var e=this.segments.length,n=this.segments,r=0;e-1>r;r++){if(t.save(),n[r].style&&n[r].style.bind(t),t.beginPath(),t.moveTo(n[r].point[0],n[r].point[1]),n[r].handleOut||n[r+1].handleIn){var i=n[r].handleOut||n[r].point,a=n[r+1].handleIn||n[r+1].point;t.bezierCurveTo(i[0],i[1],a[0],a[1],n[r+1].point[0],n[r+1].point[1])}else t.lineTo(n[r+1].point[0],n[r+1].point[1]);this.stroke&&t.stroke(),this.fill&&t.fill(),t.restore()}},smooth:function(t){function e(t,e,n){var i=r.scale([],r.add([],e,n),.5);return r.sub([],t,i)}for(var n=this.segments.length,i=[],a=this.segments,o=0;n>o;o++){var u=a[o].point,s=o==n-1?a[0].point:a[o+1].point;i.push(r.scale([],r.add([],u,s),.5))}for(var o=0;n>o;o++){var u=a[o].point,c=i[o],l=0==o?i[n-1]:i[o-1],t=a[o].smoothLevel||t||1,f=r.scale([],r.add([],c,l),.5),h=r.sub([],c,f),d=r.sub([],l,f),p=e(u,l,c);r.scale(d,d,t),r.scale(h,h,t),a[o].handleIn=r.add([],r.add([],f,d),p),a[o].handleOut=r.add([],r.add([],f,h),p)}a[0].handleOut=a[0].handleIn=null,a[n-1].handleIn=a[n-1].handleOut=null},pushPoints:function(t){for(var e=0;t.length>e;e++)this.segments.push({point:t[e],handleIn:null,handleOut:null})}});return i}),r("2d/renderable/polygon",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),n=t("../util"),r=t("glmatrix");return r.vec2,e.derive(function(){return{points:[]}},{computeAABB:function(){this.AABB=n.computeAABB(this.points)},draw:function(t){var e=this.fixAA?n.fixPosArray(this.points):this.points;t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var r=1;e.length>r;r++)t.lineTo(e[r][0],e[r][1]);t.closePath(),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(t,e){if(!this.intersectAABB(t,e))return!1;for(var n,r,i,a,o=this.points.length,u=0,s=this.points,c=0;o>c;c++)n=r.normalize([],[s[c][0]-t,s[c][1]-e]),i=(c+1)%o,r=r.normalize([],[s[i][0]-t,s[i][1]-e]),a=Math.acos(r.dot(n,r)),u+=a;return.001>Math.length(u-2*Math.PI)}}),e
}),r("2d/renderable/rectangle",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),n=t("../util"),r=t("glmatrix"),i=r.vec2,a=e.derive(function(){return{start:[0,0],size:[0,0]}},{computeAABB:function(){var t=i.add([],this.start,this.size);this.AABB=n.computeAABB([this.start,t])},draw:function(t){var e=this.fixAA?n.fixPos(this.start):this.start;t.beginPath(),t.rect(e[0],e[1],this.size[0],this.size[1]),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(t,e){return this.intersectAABB(t,e)}});return a}),r("2d/renderable/roundedrectangle",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),n=t("../util"),r=t("glmatrix"),i=r.vec2,a=e.derive(function(){return{start:[0,0],size:[0,0],radius:0}},{computeAABB:function(){var t=i.add([],this.start,this.size);this.AABB=n.computeAABB([this.start,t])},draw:function(t){if(this.radius.constructor==Number)var e=[this.radius,this.radius,this.radius,this.radius];else if(2==this.radius.length)var e=[this.radius[0],this.radius[1],this.radius[0],this.radius[1]];else var e=this.radius;var r=this.fixAA?n.fixPos(this.start):this.start,a=this.size,o=i.add([],r,[e[0],0]),u=i.add([],r,[a[0],0]),s=i.add([],r,a),c=i.add([],r,[0,a[1]]);t.beginPath(),t.moveTo(o[0],o[1]),e[1]?t.arcTo(u[0],u[1],s[0],s[1],e[1]):t.lineTo(u[0],u[1]),e[2]?t.arcTo(s[0],s[1],c[0],c[1],e[2]):t.lineTo(s[0],s[1]),e[3]?t.arcTo(c[0],c[1],r[0],r[1],e[3]):t.lineTo(c[0],c[1]),e[0]?t.arcTo(r[0],r[1],u[0],u[1],e[0]):t.lineTo(r[0],r[1]),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(){return!1}});return a}),r("2d/renderable/sector",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),n=t("../util"),r=t("glmatrix"),i=r.vec2,a=e.derive(function(){return{center:[0,0],innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,clockwise:!0}},{computeAABB:function(){this.AABB=[0,0]},intersect:function(t,e){var n=this.startAngle,r=this.endAngle,a=this.innerRadius,o=this.outerRadius,u=this.center,s=i.sub([],[t,e],u),c=i.length(s),l=2*Math.PI;if(a>c||c>o)return!1;var f=Math.atan2(s[1],s[0]);return 0>f&&(f+=l),this.clockwise?r>f&&f>n:(n=l-n,r=l-r,f>r&&n>f)},draw:function(t){var e=this.startAngle,r=this.endAngle,a=this.innerRadius,o=this.outerRadius,u=this.fixAA?n.fixPos(this.center):this.center;this.clockwise||(e=2*Math.PI-e,r=2*Math.PI-r);var s=i.add([],u,[a*Math.cos(e),a*Math.sin(e)]),c=i.add([],u,[o*Math.cos(e),o*Math.sin(e)]),l=i.add([],u,[a*Math.cos(r),a*Math.sin(r)]);i.add([],u,[o*Math.cos(r),o*Math.sin(r)]),t.beginPath(),t.moveTo(s[0],s[1]),t.lineTo(c[0],c[1]),t.arc(u[0],u[1],o,e,r,!this.clockwise),t.lineTo(l[0],l[1]),t.arc(u[0],u[1],a,r,e,this.clockwise),t.endPath(),this.stroke&&t.stroke(),this.fill&&t.fill()}});return a}),r("2d/renderable/text",["require","../node","../util","glmatrix"],function(t){var e=t("../node"),n=t("../util"),r=t("glmatrix");r.vec2;var i=e.derive(function(){return{text:"",start:[0,0],size:[0,0],font:"",textAlign:"",textBaseline:""}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(t){var e=this.fixAA?n.fixPos(this.start):this.start;this.font&&(t.font=this.font),this.textAlign&&(t.textAlign=this.textAlign),this.textBaseline&&(t.textBaseline=this.textBaseline),this.fill&&(this.size.length&&this.size[0]?t.fillText(this.text,e[0],e[1],this.size[0]):t.fillText(this.text,e[0],e[1])),this.stroke&&(this.size.length&&this.size[0]?t.strokeText(this.text,e[0],e[1],this.size[0]):t.strokeText(this.text,e[0],e[1]))},resize:function(t){(!this.size[0]||this.needResize)&&(this.size[0]=t.measureText(this.text).width,this.size[1]=t.measureText("m").width)},intersect:function(t,e){return this.intersectAABB(t,e)}});return i}),r("2d/renderable/textbox",["require","../node","../util","glmatrix","./text","_"],function(t){var e=t("../node");t("../util");var n=t("glmatrix"),r=n.vec2,i=t("./text"),a=t("_"),o=e.derive(function(){return{text:"",textAlign:"",textBaseline:"top",font:"",start:[0,0],width:0,wordWrap:!1,wordBreak:!1,lineHeight:0,stroke:!1,_texts:[]}},function(){this._oldText=""},{computeAABB:function(){},draw:function(t){if(this.text!=this._oldText)if(this._oldText=this.text,this.font&&(t.font=this.font),this.wordBreak)this._texts=this.computeWordBreak(t);else if(this.wordWrap)this._texts=this.computeWordWrap(t);else{var e=new i({text:this.text,textBaseline:this.textBaseline});this.extendCommonProperties(e),this._texts=[e]}a.each(this._texts,function(e){e.draw(t)})},computeWordWrap:function(t){if(this.text){for(var e,n,a,o=this.text.split(" "),u=o.length,s=0,c=[],l=0;u>l;l++)n=l==u-1?o[l]:o[l]+" ",e=t.measureText(n).width,s+e>this.width||!a?(a=new i({text:n,start:r.add([],this.start,[0,this.lineHeight*c.length])}),this.extendCommonProperties(a),c.push(a),s=e):(s+=e,a.text+=n);return c}},computeWordBreak:function(t){if(this.text){for(var e,n,a,o=this.text.length,u=t.measureText(this.text[0]).width,s=[],c=0;o>c;c++)if(n=this.text[c],e=t.measureText(n).width,u+e>this.width||!a){var a=new i({text:n,start:r.add([],this.start,[0,this.lineHeight*s.length])});this.extendCommonProperties(a),s.push(a),u=e}else u+=e,a.text+=n;return s}},extendCommonProperties:function(t){a.extend(t,{textAlign:this.textAlign,textBaseline:this.textBaseline,style:this.style,font:this.font,fill:this.fill,stroke:this.stroke})},intersect:function(){}});return o}),r("2d/renderer",["require","core/base"],function(t){var e=t("core/base"),n=e.derive(function(){return{canvas:null,context:null,width:0,height:0,_latestRenderedScene:null}},function(){this.canvas||(this.canvas=document.createElement("canvas")),this.canvas.addEventListener("click",this._clickHandler.bind(this)),this.canvas.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this.canvas.addEventListener("mouseup",this._mouseUpHandler.bind(this)),this.canvas.addEventListener("mousemove",this._mouseMoveHandler.bind(this)),this.canvas.addEventListener("mouseout",this._mouseOutHandler.bind(this)),this.width?this.canvas.width=this.width:this.width=this.canvas.width,this.height?this.canvas.height=this.height:this.height=this.canvas.height,this.context=this.canvas.getContext("2d")},{resize:function(t,e){this.canvas.width=t,this.canvas.height=e},render:function(t){this.context.clearRect(0,0,this.width,this.height),t.render(this.context),this._latestRenderedScene=t},_clickHandler:function(){this._latestRenderedScene},_mouseDownHandler:function(){},_mouseUpHandler:function(){},_mouseMoveHandler:function(){},_mouseOutHandler:function(){}});return n}),r("2d/scene",["require","./node"],function(t){var e=t("./node"),n=e.derive(function(){return{}},{});return n}),r("core/event",["require","./base"],function(t){var e=t("./base"),n=e.derive({cancelBubble:!1},{stopPropagation:function(){this.cancelBubble=!0}});n.throw=function(t,e,n){var r=new MouseEvent(n);for(r.sourceTarget=e;e&&!r.cancelBubble;)r.target=e,e.trigger(t,r),e=e.parent}}),r("core/request",["require"],function(){function t(t){var e=new XMLHttpRequest;e.open("get",t.url),e.responseType=t.responseType||"text",t.onprogress&&(e.onprogress=function(e){if(e.lengthComputable){var n=e.loaded/e.total;t.onprogress(n,e.loaded,e.total)}else t.onprogress(null)}),e.onload=function(){t.onload&&t.onload(e.response)},t.onerror&&(e.onerror=t.onerror),e.send(null)}function e(){}return{get:t,put:e}}),r("text",["module"],function(t){var e,r,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,s=u&&location.protocol&&location.protocol.replace(/\:/,""),c=u&&location.hostname,l=u&&(location.port||void 0),f=[],h=t.config&&t.config()||{};return e={version:"2.0.5",strip:function(t){if(t){t=t.replace(a,"");var e=t.match(o);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:h.createXhr||function(){var t,e,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;3>e;e+=1){n=i[e];try{t=new ActiveXObject(n)}catch(r){}if(t){i=[n];break}}return t},parseName:function(t){var e,n,r,i=!1,a=t.indexOf("."),o=0===t.indexOf("./")||0===t.indexOf("../");return-1!==a&&(!o||a>1)?(e=t.substring(0,a),n=t.substring(a+1,t.length)):e=t,r=n||e,a=r.indexOf("!"),-1!==a&&(i="strip"===r.substring(a+1),r=r.substring(0,a),n?n=r:e=r),{moduleName:e,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,n,r,i){var a,o,u,s=e.xdRegExp.exec(t);return s?(a=s[2],o=s[3],o=o.split(":"),u=o[1],o=o[0],!(a&&a!==n||o&&o.toLowerCase()!==r.toLowerCase()||(u||o)&&u!==i)):!0},finishLoad:function(t,n,r,i){r=n?e.strip(r):r,h.isBuild&&(f[t]=r),i(r)},load:function(t,n,r,i){if(i.isBuild&&!i.inlineText)return r(),void 0;h.isBuild=i.isBuild;var a=e.parseName(t),o=a.moduleName+(a.ext?"."+a.ext:""),f=n.toUrl(o),d=h.useXhr||e.useXhr;!u||d(f,s,c,l)?e.get(f,function(n){e.finishLoad(t,a.strip,n,r)},function(t){r.error&&r.error(t)}):n([o],function(t){e.finishLoad(a.moduleName+"."+a.ext,a.strip,t,r)})},write:function(t,n,r){if(f.hasOwnProperty(n)){var i=e.jsEscape(f[n]);r.asModule(t+"!"+n,"define(function () { return '"+i+"';});\n")}},writeFile:function(t,n,r,i,a){var o=e.parseName(n),u=o.ext?"."+o.ext:"",s=o.moduleName+u,c=r.toUrl(o.moduleName+u)+".js";e.load(s,r,function(){var n=function(t){return i(c,t)};n.asModule=function(t,e){return i.asModule(t,c,e)},e.write(t,s,n,a)},a)}},"node"===h.env||!h.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(r=n.nodeRequire("fs"),e.get=function(t,e){var n=r.readFileSync(t,"utf8");0===n.indexOf("﻿")&&(n=n.substring(1)),e(n)}):"xhr"===h.env||!h.env&&e.createXhr()?e.get=function(t,n,r,i){var a,o=e.createXhr();if(o.open("GET",t,!0),i)for(a in i)i.hasOwnProperty(a)&&o.setRequestHeader(a.toLowerCase(),i[a]);h.onXhr&&h.onXhr(o,t),o.onreadystatechange=function(){var e,i;4===o.readyState&&(e=o.status,e>399&&600>e?(i=Error(t+" HTTP status: "+e),i.xhr=o,r(i)):n(o.responseText))},o.send(null)}:("rhino"===h.env||!h.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(e.get=function(t,e){var n,r,i="utf-8",a=new java.io.File(t),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),i)),s="";try{for(n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),n.append(r);null!==(r=u.readLine());)n.append(o),n.append(r);s=""+n+""}finally{u.close()}e(s)}),e}),r("util/color",["require"],function(){}),r("util/util",["require"],function(){return{genGUID:function(){var t=0;return function(){return++t}}()}}),r("util/xmlparser",["require"],function(){}),r("src/qtek2d.js",["require","2d/camera","2d/node","2d/renderable/arc","2d/renderable/circle","2d/renderable/image","2d/renderable/line","2d/renderable/path","2d/renderable/polygon","2d/renderable/rectangle","2d/renderable/roundedrectangle","2d/renderable/sector","2d/renderable/text","2d/renderable/textbox","2d/renderer","2d/scene","2d/style","2d/util","core/base","core/cache","core/event","core/mixin/derive","core/mixin/dirty","core/mixin/notifier","core/request","text","util/color","util/util","util/xmlparser","glmatrix"],function(t){var e={"2d":{Camera:t("2d/camera"),Node:t("2d/node"),renderable:{Arc:t("2d/renderable/arc"),Circle:t("2d/renderable/circle"),Image:t("2d/renderable/image"),Line:t("2d/renderable/line"),Path:t("2d/renderable/path"),Polygon:t("2d/renderable/polygon"),Rectangle:t("2d/renderable/rectangle"),RoundedRectangle:t("2d/renderable/roundedrectangle"),Sector:t("2d/renderable/sector"),Text:t("2d/renderable/text"),TextBox:t("2d/renderable/textbox")},Renderer:t("2d/renderer"),Scene:t("2d/scene"),Style:t("2d/style"),util:t("2d/util")},core:{Base:t("core/base"),Cache:t("core/cache"),Event:t("core/event"),mixin:{derive:t("core/mixin/derive"),Dirty:t("core/mixin/dirty"),notifier:t("core/mixin/notifier")},requester:t("core/request")},loader:{},Text:t("text"),util:{Color:t("util/color"),Util:t("util/util"),Xmlparser:t("util/xmlparser")}},n=t("glmatrix");return e.math=n,e});var i=n("src/qtek");for(var a in i)t[a]=i[a]});