(function(t){"undefined"!=typeof define&&define.amd?define(["exports"],t.bind(window)):t(window.qtek={})})(function(t){var n,r,e;(function(t){function i(t,n){return b.call(t,n)}function a(t,n){var r,e,i,a,o,u,s,c,l,f,h=n&&n.split("/"),d=y.map,p=d&&d["*"]||{};if(t&&"."===t.charAt(0))if(n){for(h=h.slice(0,h.length-1),t=h.concat(t.split("/")),c=0;t.length>c;c+=1)if(f=t[c],"."===f)t.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((h||p)&&d){for(r=t.split("/"),c=r.length;c>0;c-=1){if(e=r.slice(0,c).join("/"),h)for(l=h.length;l>0;l-=1)if(i=d[h.slice(0,l).join("/")],i&&(i=i[e])){a=i,o=c;break}if(a)break;!u&&p&&p[e]&&(u=p[e],s=c)}!a&&u&&(a=u,o=s),a&&(r.splice(0,o,a),t=r.join("/"))}return t}function o(n,r){return function(){return d.apply(t,x.call(arguments,0).concat([n,r]))}}function u(t){return function(n){return a(n,t)}}function s(t){return function(n){g[t]=n}}function c(n){if(i(m,n)){var r=m[n];delete m[n],_[n]=!0,h.apply(t,r)}if(!i(g,n)&&!i(_,n))throw Error("No "+n);return g[n]}function l(t){var n,r=t?t.indexOf("!"):-1;return r>-1&&(n=t.substring(0,r),t=t.substring(r+1,t.length)),[n,t]}function f(t){return function(){return y&&y.config&&y.config[t]||{}}}var h,d,p,v,g={},m={},y={},_={},b=Object.prototype.hasOwnProperty,x=[].slice;p=function(t,n){var r,e=l(t),i=e[0];return t=e[1],i&&(i=a(i,n),r=c(i)),i?t=r&&r.normalize?r.normalize(t,u(n)):a(t,n):(t=a(t,n),e=l(t),i=e[0],t=e[1],i&&(r=c(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:r}},v={require:function(t){return o(t)},exports:function(t){var n=g[t];return n!==void 0?n:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:f(t)}}},h=function(n,r,e,a){var u,l,f,h,d,y,b=[];if(a=a||n,"function"==typeof e){for(r=!r.length&&e.length?["require","exports","module"]:r,d=0;r.length>d;d+=1)if(h=p(r[d],a),l=h.f,"require"===l)b[d]=v.require(n);else if("exports"===l)b[d]=v.exports(n),y=!0;else if("module"===l)u=b[d]=v.module(n);else if(i(g,l)||i(m,l)||i(_,l))b[d]=c(l);else{if(!h.p)throw Error(n+" missing "+l);h.p.load(h.n,o(a,!0),s(l),{}),b[d]=g[l]}f=e.apply(g[n],b),n&&(u&&u.exports!==t&&u.exports!==g[n]?g[n]=u.exports:f===t&&y||(g[n]=f))}else n&&(g[n]=e)},n=r=d=function(n,r,e,i,a){return"string"==typeof n?v[n]?v[n](r):c(p(n,r).f):(n.splice||(y=n,r.splice?(n=r,r=e,e=null):n=t),r=r||function(){},"function"==typeof e&&(e=i,i=a),i?h(t,n,r,e):setTimeout(function(){h(t,n,r,e)},4),d)},d.config=function(t){return y=t,y.deps&&d(y.deps,y.callback),d},e=function(t,n,r){n.splice||(r=n,n=[]),i(g,t)||i(m,t)||(m[t]=[t,n,r])},e.amd={jQuery:!0}})(),e("../build/almond",function(){}),e("2d/camera",function(){}),e("core/mixin/derive",[],function(){function t(t,n,r){"object"==typeof n&&(r=n,n=null);var e={"instanceof":function(t){for(var n=a;n;){if(n===t)return!0;n=n.__super__}}},i=this,a=function(r){if(i.call(this),_.extend(this,"function"==typeof t?t.call(this):t),_.extend(this,r),this.constructor==a){for(var e=a,o=[n];e.__super__;)e=e.__super__,o.unshift(e.__initialize__);for(var u=0;o.length>u;u++)o[u]&&o[u].call(this)}};return a.__super__=i,a.__initialize__=n,_.extend(a.prototype,i.prototype,e,r),a.prototype.constructor=a,a.derive=i.derive,a}return{derive:t}}),e("core/mixin/notifier",[],function(){return{trigger:function(){if(this.__handlers__){var t=arguments[0],n=Array.prototype.slice.call(arguments,1),r=this.__handlers__[t];if(r)for(var e=0;r.length>e;e+=2){var i=r[e],a=r[e+1];i.apply(a||this,n)}}},on:function(t,n,r){if(t){var e=this.__handlers__||(this.__handlers__={});return e[t]||(e[t]=[]),-1==e[t].indexOf(n)&&(e[t].push(n),e[t].push(r)),n}},off:function(t,n){var r=this.__handlers__||(this.__handlers__={});if(r[t])if(n){var e=r[t],i=e.indexOf(n);i>=0&&e.splice(i,2)}else r[t]=[]},has:function(t,n){return this.__handlers__&&this.__handlers__[t]?n?-1!==this.__handlers__[t].indexOf(n):this.__handlers__[t].length:!1}}}),e("core/mixin/dirty",{dirty:function(t){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]=!0},fresh:function(t){this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]=!1},isDirty:function(t){return this._dirtyFlag||(this._dirtyFlag={}),this._dirtyFlag[t]===void 0?!0:this._dirtyFlag[t]}}),e("core/cache",[],function(){var t=function(){this._contextId="",this._caches={},this._context={}};return t.prototype={use:function(t,n){if(!this._caches.hasOwnProperty(t)&&(this._caches[t]={},n))for(var r in n)this._caches[t][r]=n[r];this._contextId=t,this._context=this._caches[t]},put:function(t,n){this._context[t]=n},get:function(t){return this._context[t]},clearContext:function(){this._caches[this._contextId]={},this._context={}},"delete":function(t){delete this._context[t]},clearAll:function(){this._caches={}},getContext:function(){return this._context},miss:function(t){return!this._context.hasOwnProperty(t)}},t.prototype.constructor=t,t}),function(t){function n(e){function i(t){return t&&"object"==typeof t&&!be(t)&&Kr.call(t,"__wrapped__")?t:new N(t)}function o(t,n,r){var e=t.length,i=e-n>=r;if(i)for(var a={},o=n-1;e>++o;){var u=Hr(t[o]);(Kr.call(a,u)?a[u]:a[u]=[]).push(t[o])}return function(r){if(i){var e=Hr(r);return Kr.call(a,e)&&$n(a[e],r)>-1}return $n(t,r,n)>-1}}function L(t){return t.charCodeAt(0)}function E(t,n){var e=t.index,i=n.index;if(t=t.criteria,n=n.criteria,t!==n){if(t>n||t===r)return 1;if(n>t||n===r)return-1}return i>e?-1:1}function R(t,n,r,e){function i(){var e=arguments,c=o?this:n;if(a||(t=n[u]),r.length&&(e=e.length?(e=$(e),s?e.concat(r):r.concat(e)):r),this instanceof i){V.prototype=t.prototype,c=new V,V.prototype=null;var l=t.apply(c,e);return cn(l)?l:c}return t.apply(c,e)}var a=sn(t),o=!r,u=n;if(o){var s=e;r=n}else if(!a){if(!e)throw new Wr;n=t}return i}function D(){for(var t,n={shadowedProps:x,arrays:"isArray(iterable)",bottom:"",init:"iterable",loop:"",top:"",useHas:!0,useKeys:!!Ae},r=0;t=arguments[r];r++)for(var e in t)n[e]=t[e];var a=n.args;n.firstArg=/^[^,]+/.exec(a)[0];var o=Lr("hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectTypes","return function("+a+") {\n"+ge(n)+"\n}");return o(Kr,X,be,pn,Ae,i,T)}function F(t){return"\\"+I[t]}function H(t){return Me[t]}function W(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function N(t){this.__wrapped__=t}function V(){}function U(t){var n=!1;if(!t||re.call(t)!=C||!ve.argsClass&&X(t))return n;var r=t.constructor;return(sn(r)?r instanceof r:ve.nodeClass||!W(t))?ve.ownLast?(Pe(t,function(t,r,e){return n=Kr.call(e,r),!1}),n===!0):(Pe(t,function(t,r){n=r}),n===!1||Kr.call(t,n)):n}function $(t,n,e){n||(n=0),e===r&&(e=t?t.length:0);for(var i=-1,a=e-n||0,o=Tr(0>a?0:a);a>++i;)o[i]=t[n+i];return o}function Q(t){return Be[t]}function X(t){return re.call(t)==w}function G(t,n,e,a,o,u){var s=t;if("function"==typeof n&&(a=e,e=n,n=!1),"function"==typeof e){if(e=a===r?e:i.createCallback(e,a,1),s=e(s),s!==r)return s;s=t}var c=cn(s);if(c){var l=re.call(s);if(!O[l]||!ve.nodeClass&&W(s))return s;var f=be(s)}if(!c||!n)return c?f?$(s):ke({},s):s;var h=pe[l];switch(l){case B:case k:return new h(+s);case P:case z:return new h(s);case j:return h(s.source,p.exec(s))}o||(o=[]),u||(u=[]);for(var d=o.length;d--;)if(o[d]==t)return u[d];return s=f?h(s.length):{},f&&(Kr.call(t,"index")&&(s.index=t.index),Kr.call(t,"input")&&(s.input=t.input)),o.push(t),u.push(s),(f?qn:Ce)(t,function(t,i){s[i]=G(t,n,e,r,o,u)}),s}function Y(t,n,r){return G(t,!0,n,r)}function Z(t,n,e){var a;return n=i.createCallback(n,e),Ce(t,function(t,e,i){return n(t,e,i)?(a=e,!1):r}),a}function K(t){var n=[];return Pe(t,function(t,r){sn(t)&&n.push(r)}),n.sort()}function J(t,n){return t?Kr.call(t,n):!1}function tn(t){for(var n=-1,r=Ae(t),e=r.length,i={};e>++n;){var a=r[n];i[t[a]]=a}return i}function nn(t){return t===!0||t===!1||re.call(t)==B}function rn(t){return t instanceof Sr||re.call(t)==k}function en(t){return t?1===t.nodeType:!1}function an(t){var n=!0;if(!t)return n;var r=re.call(t),e=t.length;return r==M||r==z||(ve.argsClass?r==w:X(t))||r==C&&"number"==typeof e&&sn(t.splice)?!e:(Ce(t,function(){return n=!1}),n)}function on(t,n,e,a,o,u){var c=e===s;if(e&&!c){e=a===r?e:i.createCallback(e,a,2);var l=e(t,n);if(l!==r)return!!l}if(t===n)return 0!==t||1/t==1/n;var f=typeof t,h=typeof n;if(t===t&&(!t||"function"!=f&&"object"!=f)&&(!n||"function"!=h&&"object"!=h))return!1;if(null==t||null==n)return t===n;var d=re.call(t),p=re.call(n);if(d==w&&(d=C),p==w&&(p=C),d!=p)return!1;switch(d){case B:case k:return+t==+n;case P:return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case j:case z:return t==Hr(n)}var v=d==M;if(!v){if(Kr.call(t,"__wrapped__ ")||Kr.call(n,"__wrapped__"))return on(t.__wrapped__||t,n.__wrapped__||n,e,a,o,u);if(d!=C||!ve.nodeClass&&(W(t)||W(n)))return!1;var g=!ve.argsObject&&X(t)?Dr:t.constructor,m=!ve.argsObject&&X(n)?Dr:n.constructor;if(g!=m&&!(sn(g)&&g instanceof g&&sn(m)&&m instanceof m))return!1}o||(o=[]),u||(u=[]);for(var y=o.length;y--;)if(o[y]==t)return u[y]==n;var _=0;if(l=!0,o.push(t),u.push(n),v){if(y=t.length,_=n.length,l=_==t.length,!l&&!c)return l;for(;_--;){var b=y,x=n[_];if(c)for(;b--&&!(l=on(t[b],x,e,a,o,u)););else if(!(l=on(t[_],x,e,a,o,u)))break}return l}return Pe(n,function(n,i,s){return Kr.call(s,i)?(_++,l=Kr.call(t,i)&&on(t[i],n,e,a,o,u)):r}),l&&!c&&Pe(t,function(t,n,e){return Kr.call(e,n)?l=--_>-1:r}),l}function un(t){return ae(t)&&!oe(parseFloat(t))}function sn(t){return"function"==typeof t}function cn(t){return t?T[typeof t]:!1}function ln(t){return hn(t)&&t!=+t}function fn(t){return null===t}function hn(t){return"number"==typeof t||re.call(t)==P}function dn(t){return t instanceof Fr||re.call(t)==j}function pn(t){return"string"==typeof t||re.call(t)==z}function vn(t){return t===r}function gn(t,n,e){var a=arguments,o=0,u=2;if(!cn(t))return t;if(e===s)var c=a[3],l=a[4],f=a[5];else l=[],f=[],"number"!=typeof e&&(u=a.length),u>3&&"function"==typeof a[u-2]?c=i.createCallback(a[--u-1],a[u--],2):u>2&&"function"==typeof a[u-1]&&(c=a[--u]);for(;u>++o;)(be(a[o])?qn:Ce)(a[o],function(n,e){var i,a,o=n,u=t[e];if(n&&((a=be(n))||je(n))){for(var h=l.length;h--;)if(i=l[h]==n){u=f[h];break}i||(u=a?be(u)?u:[]:je(u)?u:{},c&&(o=c(u,n),o!==r&&(u=o)),l.push(n),f.push(u),c||(u=gn(u,n,s,c,l,f)))}else c&&(o=c(u,n),o===r&&(o=n)),o!==r&&(u=o);t[e]=u});return t}function mn(t,n,r){var e="function"==typeof n,a={};if(e)n=i.createCallback(n,r);else var o=Gr.apply(Nr,arguments);return Pe(t,function(t,r,i){(e?!n(t,r,i):0>$n(o,r,1))&&(a[r]=t)}),a}function yn(t){for(var n=-1,r=Ae(t),e=r.length,i=Tr(e);e>++n;){var a=r[n];i[n]=[a,t[a]]}return i}function _n(t,n,r){var e={};if("function"!=typeof n)for(var a=0,o=Gr.apply(Nr,arguments),u=cn(t)?o.length:0;u>++a;){var s=o[a];s in t&&(e[s]=t[s])}else n=i.createCallback(n,r),Pe(t,function(t,r,i){n(t,r,i)&&(e[r]=t)});return e}function bn(t){for(var n=-1,r=Ae(t),e=r.length,i=Tr(e);e>++n;)i[n]=t[r[n]];return i}function xn(t){var n=-1,r=Gr.apply(Nr,$(arguments,1)),e=r.length,i=Tr(e);for(ve.unindexedChars&&pn(t)&&(t=t.split(""));e>++n;)i[n]=t[r[n]];return i}function An(t,n,e){var i=-1,a=t?t.length:0,o=!1;return e=(0>e?se(0,a+e):e)||0,"number"==typeof a?o=(pn(t)?t.indexOf(n,e):$n(t,n,e))>-1:we(t,function(t){return++i>=e?!(o=t===n):r}),o}function wn(t,n,r){var e={};return n=i.createCallback(n,r),qn(t,function(t,r,i){r=Hr(n(t,r,i)),Kr.call(e,r)?e[r]++:e[r]=1}),e}function Mn(t,n,r){var e=!0;if(n=i.createCallback(n,r),be(t))for(var a=-1,o=t.length;o>++a&&(e=!!n(t[a],a,t)););else we(t,function(t,r,i){return e=!!n(t,r,i)});return e}function Bn(t,n,r){var e=[];if(n=i.createCallback(n,r),be(t))for(var a=-1,o=t.length;o>++a;){var u=t[a];n(u,a,t)&&e.push(u)}else we(t,function(t,r,i){n(t,r,i)&&e.push(t)});return e}function kn(t,n,e){if(n=i.createCallback(n,e),!be(t)){var a;return we(t,function(t,e,i){return n(t,e,i)?(a=t,!1):r}),a}for(var o=-1,u=t.length;u>++o;){var s=t[o];if(n(s,o,t))return s}}function qn(t,n,e){if(n&&e===r&&be(t))for(var i=-1,a=t.length;a>++i&&n(t[i],i,t)!==!1;);else we(t,n,e);return t}function Pn(t,n,r){var e={};return n=i.createCallback(n,r),qn(t,function(t,r,i){r=Hr(n(t,r,i)),(Kr.call(e,r)?e[r]:e[r]=[]).push(t)}),e}function Cn(t,n){var r=$(arguments,2),e=-1,i="function"==typeof n,a=t?t.length:0,o=Tr("number"==typeof a?a:0);return qn(t,function(t){o[++e]=(i?n:t[n]).apply(t,r)}),o}function jn(t,n,r){var e=-1,a=t?t.length:0,o=Tr("number"==typeof a?a:0);if(n=i.createCallback(n,r),be(t))for(;a>++e;)o[e]=n(t[e],e,t);else we(t,function(t,r,i){o[++e]=n(t,r,i)});return o}function zn(t,n,r){var e=-1/0,a=e;if(!n&&be(t))for(var o=-1,u=t.length;u>++o;){var s=t[o];s>a&&(a=s)}else n=!n&&pn(t)?L:i.createCallback(n,r),we(t,function(t,r,i){var o=n(t,r,i);o>e&&(e=o,a=t)});return a}function On(t,n,r){var e=1/0,a=e;if(!n&&be(t))for(var o=-1,u=t.length;u>++o;){var s=t[o];a>s&&(a=s)}else n=!n&&pn(t)?L:i.createCallback(n,r),we(t,function(t,r,i){var o=n(t,r,i);e>o&&(e=o,a=t)});return a}function Tn(t,n,r,e){var a=3>arguments.length;if(n=i.createCallback(n,e,4),be(t)){var o=-1,u=t.length;for(a&&(r=t[++o]);u>++o;)r=n(r,t[o],o,t)}else we(t,function(t,e,i){r=a?(a=!1,t):n(r,t,e,i)});return r}function In(t,n,r,e){var a=t,o=t?t.length:0,u=3>arguments.length;if("number"!=typeof o){var s=Ae(t);o=s.length}else ve.unindexedChars&&pn(t)&&(a=t.split(""));return n=i.createCallback(n,e,4),qn(t,function(t,e,i){e=s?s[--o]:--o,r=u?(u=!1,a[e]):n(r,a[e],e,i)}),r}function Sn(t,n,r){return n=i.createCallback(n,r),Bn(t,function(t,r,e){return!n(t,r,e)})}function Ln(t){var n=-1,r=t?t.length:0,e=Tr("number"==typeof r?r:0);return qn(t,function(t){var r=Yr(fe()*(++n+1));e[n]=e[r],e[r]=t}),e}function En(t){var n=t?t.length:0;return"number"==typeof n?n:Ae(t).length}function Rn(t,n,r){var e;if(n=i.createCallback(n,r),be(t))for(var a=-1,o=t.length;o>++a&&!(e=n(t[a],a,t)););else we(t,function(t,r,i){return!(e=n(t,r,i))});return!!e}function Dn(t,n,r){var e=-1,a=t?t.length:0,o=Tr("number"==typeof a?a:0);for(n=i.createCallback(n,r),qn(t,function(t,r,i){o[++e]={criteria:n(t,r,i),index:e,value:t}}),a=o.length,o.sort(E);a--;)o[a]=o[a].value;return o}function Fn(t){return t&&"number"==typeof t.length?ve.unindexedChars&&pn(t)?t.split(""):$(t):bn(t)}function Hn(t){for(var n=-1,r=t?t.length:0,e=[];r>++n;){var i=t[n];i&&e.push(i)}return e}function Wn(t){for(var n=-1,r=t?t.length:0,e=Gr.apply(Nr,arguments),i=o(e,r,100),a=[];r>++n;){var u=t[n];i(u)||a.push(u)}return a}function Nn(t,n,r){var e=-1,a=t?t.length:0;for(n=i.createCallback(n,r);a>++e;)if(n(t[e],e,t))return e;return-1}function Vn(t,n,r){if(t){var e=0,a=t.length;if("number"!=typeof n&&null!=n){var o=-1;for(n=i.createCallback(n,r);a>++o&&n(t[o],o,t);)e++}else if(e=n,null==e||r)return t[0];return $(t,0,ce(se(0,e),a))}}function Un(t,n,r,e){var a=-1,o=t?t.length:0,u=[];for("boolean"!=typeof n&&null!=n&&(e=r,r=n,n=!1),null!=r&&(r=i.createCallback(r,e));o>++a;){var s=t[a];r&&(s=r(s,a,t)),be(s)?Jr.apply(u,n?s:Un(s)):u.push(s)}return u}function $n(t,n,r){var e=-1,i=t?t.length:0;if("number"==typeof r)e=(0>r?se(0,i+r):r||0)-1;else if(r)return e=Jn(t,n),t[e]===n?e:-1;for(;i>++e;)if(t[e]===n)return e;return-1}function Qn(t,n,r){if(!t)return[];var e=0,a=t.length;if("number"!=typeof n&&null!=n){var o=a;for(n=i.createCallback(n,r);o--&&n(t[o],o,t);)e++}else e=null==n||r?1:n||e;return $(t,0,ce(se(0,a-e),a))}function Xn(t){var n=arguments,r=n.length,e={0:{}},i=-1,a=t?t.length:0,u=a>=100,s=[],c=s;t:for(;a>++i;){var l=t[i];if(u)var f=Hr(l),h=Kr.call(e[0],f)?!(c=e[0][f]):c=e[0][f]=[];if(h||0>$n(c,l)){u&&c.push(l);for(var d=r;--d;)if(!(e[d]||(e[d]=o(n[d],0,100)))(l))continue t;s.push(l)}}return s}function Gn(t,n,r){if(t){var e=0,a=t.length;if("number"!=typeof n&&null!=n){var o=a;for(n=i.createCallback(n,r);o--&&n(t[o],o,t);)e++}else if(e=n,null==e||r)return t[a-1];return $(t,se(0,a-e))}}function Yn(t,n,r){var e=t?t.length:0;for("number"==typeof r&&(e=(0>r?se(0,e+r):ce(r,e-1))+1);e--;)if(t[e]===n)return e;return-1}function Zn(t,n,r){t=+t||0,r=+r||1,null==n&&(n=t,t=0);for(var e=-1,i=se(0,Qr((n-t)/r)),a=Tr(i);i>++e;)a[e]=t,t+=r;return a}function Kn(t,n,r){if("number"!=typeof n&&null!=n){var e=0,a=-1,o=t?t.length:0;for(n=i.createCallback(n,r);o>++a&&n(t[a],a,t);)e++}else e=null==n||r?1:se(0,n);return $(t,e)}function Jn(t,n,r,e){var a=0,o=t?t.length:a;for(r=r?i.createCallback(r,e,1):xr,n=r(n);o>a;){var u=a+o>>>1;n>r(t[u])?a=u+1:o=u}return a}function tr(){return nr(Gr.apply(Nr,arguments))}function nr(t,n,r,e){var a=-1,o=t?t.length:0,u=[],s=u;"boolean"!=typeof n&&null!=n&&(e=r,r=n,n=!1);var c=!n&&o>=75;if(c)var l={};for(null!=r&&(s=[],r=i.createCallback(r,e));o>++a;){var f=t[a],h=r?r(f,a,t):f;if(c)var d=Hr(h),p=Kr.call(l,d)?!(s=l[d]):s=l[d]=[];(n?!a||s[s.length-1]!==h:p||0>$n(s,h))&&((r||c)&&s.push(h),u.push(f))}return u}function rr(t){for(var n=-1,r=t?t.length:0,e=o(arguments,1,30),i=[];r>++n;){var a=t[n];e(a)||i.push(a)}return i}function er(t){for(var n=-1,r=t?zn(ze(arguments,"length")):0,e=Tr(r);r>++n;)e[n]=ze(arguments,n);return e}function ir(t,n){for(var r=-1,e=t?t.length:0,i={};e>++r;){var a=t[r];n?i[a]=n[r]:i[a[0]]=a[1]}return i}function ar(t,n){return 1>t?n():function(){return 1>--t?n.apply(this,arguments):r}}function or(t,n){return ve.fastBind||ee&&arguments.length>2?ee.call.apply(ee,arguments):R(t,n,$(arguments,2))}function ur(t){for(var n=Gr.apply(Nr,arguments),r=n.length>1?0:(n=K(t),-1),e=n.length;e>++r;){var i=n[r];t[i]=or(t[i],t)}return t}function sr(t,n){return R(t,n,$(arguments,2),s)}function cr(){var t=arguments;return function(){for(var n=arguments,r=t.length;r--;)n=[t[r].apply(this,n)];return n[0]}}function lr(t,n,e){if(null==t)return xr;var i=typeof t;if("function"!=i){if("object"!=i)return function(n){return n[t]};var a=Ae(t);return function(n){for(var r=a.length,e=!1;r--&&(e=on(n[a[r]],t[a[r]],s)););return e}}return n!==r?1===e?function(r){return t.call(n,r)}:2===e?function(r,e){return t.call(n,r,e)}:4===e?function(r,e,i,a){return t.call(n,r,e,i,a)}:function(r,e,i){return t.call(n,r,e,i)}:t}function fr(t,n,r){function e(){u=null,r||(a=t.apply(o,i))}var i,a,o,u;return function(){var s=r&&!u;return i=arguments,o=this,Xr(u),u=ne(e,n),s&&(a=t.apply(o,i)),a}}function hr(t){var n=$(arguments,1);return ne(function(){t.apply(r,n)},1)}function dr(t,n){var e=$(arguments,2);return ne(function(){t.apply(r,e)},n)}function pr(t,n){var r={};return function(){var e=Hr(n?n.apply(this,arguments):arguments[0]);return Kr.call(r,e)?r[e]:r[e]=t.apply(this,arguments)}}function vr(t){var n,r;return function(){return n?r:(n=!0,r=t.apply(this,arguments),t=null,r)}}function gr(t){return R(t,$(arguments,1))}function mr(t){return R(t,$(arguments,1),null,s)}function yr(t,n){function r(){u=new Sr,o=null,i=t.apply(a,e)}var e,i,a,o,u=0;return function(){var s=new Sr,c=n-(s-u);return e=arguments,a=this,0>=c?(Xr(o),o=null,u=s,i=t.apply(a,e)):o||(o=ne(r,c)),i}}function _r(t,n){return function(){var r=[t];return Jr.apply(r,arguments),n.apply(this,r)}}function br(t){return null==t?"":Hr(t).replace(y,H)}function xr(t){return t}function Ar(t){qn(K(t),function(n){var r=i[n]=t[n];i.prototype[n]=function(){var t=this.__wrapped__,n=[t];Jr.apply(n,arguments);var e=r.apply(i,n);return t&&"object"==typeof t&&t==e?this:new N(e)}})}function wr(){return e._=Ur,this}function Mr(t,n){return null==t&&null==n&&(n=1),t=+t||0,null==n&&(n=t,t=0),t+Yr(fe()*((+n||0)-t+1))}function Br(t,n){var e=t?t[n]:r;return sn(e)?t[n]():e}function kr(t,n,e){var a=i.templateSettings;t||(t=""),e=qe({},e,a);var o,u=qe({},e.imports,a.imports),s=Ae(u),h=bn(u),p=0,g=e.interpolate||m,y="__p += '",b=Fr((e.escape||m).source+"|"+g.source+"|"+(g===v?d:m).source+"|"+(e.evaluate||m).source+"|$","g");t.replace(b,function(n,r,e,i,a,u){return e||(e=i),y+=t.slice(p,u).replace(_,F),r&&(y+="' +\n__e("+r+") +\n'"),a&&(o=!0,y+="';\n"+a+";\n__p += '"),e&&(y+="' +\n((__t = ("+e+")) == null ? '' : __t) +\n'"),p=u+n.length,n}),y+="';\n";var x=e.variable,w=x;w||(x="obj",y="with ("+x+") {\n"+y+"\n}\n"),y=(o?y.replace(c,""):y).replace(l,"$1").replace(f,"$1;"),y="function("+x+") {\n"+(w?"":x+" || ("+x+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+y+"return __p\n}";var M="\n/*\n//@ sourceURL="+(e.sourceURL||"/lodash/template/source["+A++ +"]")+"\n*/";try{var B=Lr(s,"return "+y+M).apply(r,h)}catch(k){throw k.source=y,k}return n?B(n):(B.source=y,B)}function qr(t,n,r){t=(t=+t)>-1?t:0;var e=-1,a=Tr(t);for(n=i.createCallback(n,r,1);t>++e;)a[e]=n(e);return a}function Pr(t){return null==t?"":Hr(t).replace(h,Q)}function Cr(t){var n=++u;return Hr(null==t?"":t)+n}function jr(t,n){return n(t),t}function zr(){return Hr(this.__wrapped__)}function Or(){return this.__wrapped__}e=e?S.defaults(t.Object(),e,S.pick(t,b)):t;var Tr=e.Array,Ir=e.Boolean,Sr=e.Date,Lr=e.Function,Er=e.Math,Rr=e.Number,Dr=e.Object,Fr=e.RegExp,Hr=e.String,Wr=e.TypeError,Nr=Tr(),Vr=Dr(),Ur=e._,$r=Fr("^"+Hr(Vr.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),Qr=Er.ceil,Xr=e.clearTimeout,Gr=Nr.concat,Yr=Er.floor,Zr=$r.test(Zr=Dr.getPrototypeOf)&&Zr,Kr=Vr.hasOwnProperty,Jr=Nr.push,te=e.setImmediate,ne=e.setTimeout,re=Vr.toString,ee=$r.test(ee=$.bind)&&ee,ie=$r.test(ie=Tr.isArray)&&ie,ae=e.isFinite,oe=e.isNaN,ue=$r.test(ue=Dr.keys)&&ue,se=Er.max,ce=Er.min,le=e.parseInt,fe=Er.random,he=$r.test(e.attachEvent),de=ee&&!/\n|true/.test(ee+he),pe={};pe[M]=Tr,pe[B]=Ir,pe[k]=Sr,pe[C]=Dr,pe[P]=Rr,pe[j]=Fr,pe[z]=Hr;var ve=i.support={};(function(){var t=function(){this.x=1},n={0:1,length:1},r=[];t.prototype={valueOf:1,y:1};for(var e in new t)r.push(e);for(e in arguments);ve.argsObject=arguments.constructor==Dr,ve.argsClass=X(arguments),ve.enumPrototypes=t.propertyIsEnumerable("prototype"),ve.fastBind=ee&&!de,ve.ownLast="x"!=r[0],ve.nonEnumArgs=0!=e,ve.nonEnumShadows=!/valueOf/.test(r),ve.spliceObjects=(Nr.splice.call(n,0,1),!n[0]),ve.unindexedChars="xx"!="x"[0]+Dr("x")[0];try{ve.nodeClass=!(re.call(document)==C&&!({toString:0}+""))}catch(i){ve.nodeClass=!0}})(1),i.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:v,variable:"",imports:{_:i}};var ge=function(t){var n="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";\n";if(t.arrays?(n+="var length = iterable.length; index = -1;\nif ("+t.arrays+") {  ",ve.unindexedChars&&(n+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),n+="\n  while (++index < length) {\n    "+t.loop+"\n  }\n}\nelse {  "):ve.nonEnumArgs&&(n+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+"\n    }\n  } else {  "),ve.enumPrototypes&&(n+="\n  var skipProto = typeof iterable == 'function';\n  "),t.useHas&&t.useKeys)n+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] ? keys(iterable) : [],\n      length = ownProps.length;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n    ",ve.enumPrototypes&&(n+="if (!(skipProto && index == 'prototype')) {\n  "),n+=t.loop,ve.enumPrototypes&&(n+="}\n"),n+="  }  ";else if(n+="\n  for (index in iterable) {",(ve.enumPrototypes||t.useHas)&&(n+="\n    if (",ve.enumPrototypes&&(n+="!(skipProto && index == 'prototype')"),ve.enumPrototypes&&t.useHas&&(n+=" && "),t.useHas&&(n+="hasOwnProperty.call(iterable, index)"),n+=") {    "),n+=t.loop+";    ",(ve.enumPrototypes||t.useHas)&&(n+="\n    }"),n+="\n  }    ",ve.nonEnumShadows){n+="\n\n  var ctor = iterable.constructor;\n      ";for(var r=0;7>r;r++)n+="\n  index = '"+t.shadowedProps[r]+"';\n  if (","constructor"==t.shadowedProps[r]&&(n+="!(ctor && ctor.prototype === iterable) && "),n+="hasOwnProperty.call(iterable, index)) {\n    "+t.loop+"\n  }      "}return(t.arrays||ve.nonEnumArgs)&&(n+="\n}"),n+=t.bottom+";\nreturn result"},me={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},ye={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",arrays:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},_e={top:"if (!objectTypes[typeof iterable]) return result;\n"+ye.top,arrays:!1};N.prototype=i.prototype,ve.argsClass||(X=function(t){return t?Kr.call(t,"callee"):!1});var be=ie||function(t){return ve.argsObject&&t instanceof Tr||re.call(t)==M},xe=D({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)",arrays:!1}),Ae=ue?function(t){return cn(t)?ve.enumPrototypes&&"function"==typeof t||ve.nonEnumArgs&&t.length&&X(t)?xe(t):ue(t):[]}:xe,we=D(ye),Me={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Be=tn(Me),ke=D(me,{top:me.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),qe=D(me),Pe=D(ye,_e,{useHas:!1}),Ce=D(ye,_e);sn(/x/)&&(sn=function(t){return t instanceof Lr||re.call(t)==q});var je=Zr?function(t){if(!t||re.call(t)!=C||!ve.argsClass&&X(t))return!1;var n=t.valueOf,r="function"==typeof n&&(r=Zr(n))&&Zr(r);return r?t==r||Zr(t)==r:U(t)}:U,ze=jn,Oe=Bn;de&&a&&"function"==typeof te&&(hr=or(te,e));var Te=8==le("08")?le:function(t,n){return le(pn(t)?t.replace(g,""):t,n||0)};return i.after=ar,i.assign=ke,i.at=xn,i.bind=or,i.bindAll=ur,i.bindKey=sr,i.compact=Hn,i.compose=cr,i.countBy=wn,i.createCallback=lr,i.debounce=fr,i.defaults=qe,i.defer=hr,i.delay=dr,i.difference=Wn,i.filter=Bn,i.flatten=Un,i.forEach=qn,i.forIn=Pe,i.forOwn=Ce,i.functions=K,i.groupBy=Pn,i.initial=Qn,i.intersection=Xn,i.invert=tn,i.invoke=Cn,i.keys=Ae,i.map=jn,i.max=zn,i.memoize=pr,i.merge=gn,i.min=On,i.omit=mn,i.once=vr,i.pairs=yn,i.partial=gr,i.partialRight=mr,i.pick=_n,i.pluck=ze,i.range=Zn,i.reject=Sn,i.rest=Kn,i.shuffle=Ln,i.sortBy=Dn,i.tap=jr,i.throttle=yr,i.times=qr,i.toArray=Fn,i.union=tr,i.uniq=nr,i.values=bn,i.where=Oe,i.without=rr,i.wrap=_r,i.zip=er,i.zipObject=ir,i.collect=jn,i.drop=Kn,i.each=qn,i.extend=ke,i.methods=K,i.object=ir,i.select=Bn,i.tail=Kn,i.unique=nr,Ar(i),i.clone=G,i.cloneDeep=Y,i.contains=An,i.escape=br,i.every=Mn,i.find=kn,i.findIndex=Nn,i.findKey=Z,i.has=J,i.identity=xr,i.indexOf=$n,i.isArguments=X,i.isArray=be,i.isBoolean=nn,i.isDate=rn,i.isElement=en,i.isEmpty=an,i.isEqual=on,i.isFinite=un,i.isFunction=sn,i.isNaN=ln,i.isNull=fn,i.isNumber=hn,i.isObject=cn,i.isPlainObject=je,i.isRegExp=dn,i.isString=pn,i.isUndefined=vn,i.lastIndexOf=Yn,i.mixin=Ar,i.noConflict=wr,i.parseInt=Te,i.random=Mr,i.reduce=Tn,i.reduceRight=In,i.result=Br,i.runInContext=n,i.size=En,i.some=Rn,i.sortedIndex=Jn,i.template=kr,i.unescape=Pr,i.uniqueId=Cr,i.all=Mn,i.any=Rn,i.detect=kn,i.foldl=Tn,i.foldr=In,i.include=An,i.inject=Tn,Ce(i,function(t,n){i.prototype[n]||(i.prototype[n]=function(){var n=[this.__wrapped__];return Jr.apply(n,arguments),t.apply(i,n)})}),i.first=Vn,i.last=Gn,i.take=Vn,i.head=Vn,Ce(i,function(t,n){i.prototype[n]||(i.prototype[n]=function(n,r){var e=t(this.__wrapped__,n,r);return null==n||r&&"function"!=typeof n?e:new N(e)})}),i.VERSION="1.1.1",i.prototype.toString=zr,i.prototype.value=Or,i.prototype.valueOf=Or,we(["join","pop","shift"],function(t){var n=Nr[t];i.prototype[t]=function(){return n.apply(this.__wrapped__,arguments)}}),we(["push","reverse","sort","unshift"],function(t){var n=Nr[t];i.prototype[t]=function(){return n.apply(this.__wrapped__,arguments),this}}),we(["concat","slice","splice"],function(t){var n=Nr[t];i.prototype[t]=function(){return new N(n.apply(this.__wrapped__,arguments))}}),ve.spliceObjects||we(["pop","shift","splice"],function(t){var n=Nr[t],r="splice"==t;i.prototype[t]=function(){var t=this.__wrapped__,e=n.apply(t,arguments);return 0===t.length&&delete t[0],r?new N(e):e}}),i}var r,i="object"==typeof exports&&exports,a="object"==typeof module&&module&&module.exports==i&&module,o="object"==typeof global&&global;o.global===o&&(t=o);var u=0,s={},c=/\b__p \+= '';/g,l=/\b(__p \+=) '' \+/g,f=/(__e\(.*?\)|\b__t\)) \+\n'';/g,h=/&(?:amp|lt|gt|quot|#39);/g,d=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,p=/\w*$/,v=/<%=([\s\S]+?)%>/g,g=/^0+(?=.$)/,m=/($^)/,y=/[&<>"']/g,_=/['\n\r\t\u2028\u2029\\]/g,b=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],x=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],A=0,w="[object Arguments]",M="[object Array]",B="[object Boolean]",k="[object Date]",q="[object Function]",P="[object Number]",C="[object Object]",j="[object RegExp]",z="[object String]",O={};O[q]=!1,O[w]=O[M]=O[B]=O[k]=O[P]=O[C]=O[j]=O[z]=!0;var T={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},I={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},S=n();"function"==typeof e&&"object"==typeof e.amd&&e.amd?(t._=S,e("_",[],function(){return S})):i&&!i.nodeType?a?(a.exports=S)._=S:i._=S:t._=S}(this),e("core/base",["require","./mixin/derive","./mixin/notifier","./mixin/dirty","./cache","_"],function(t){var n=t("./mixin/derive"),r=t("./mixin/notifier"),e=t("./mixin/dirty"),i=t("./cache"),a=t("_"),o=function(){this.cache=new i};return a.extend(o,n),a.extend(o.prototype,r),a.extend(o.prototype,e),o}),function(t){var n={};"undefined"==typeof exports?"function"==typeof e&&"object"==typeof e.amd&&e.amd?(n.exports={},e("glmatrix",[],function(){return n.exports})):n.exports="undefined"!=typeof window?window:t:n.exports=exports,function(t){if(!n)var n=1e-6;if(!r)var r="undefined"!=typeof Float32Array?Float32Array:Array;if(!e)var e=Math.random;var i={};i.setMatrixArrayType=function(t){r=t},t!==void 0&&(t.glMatrix=i);var a={};a.create=function(){var t=new r(2);return t[0]=0,t[1]=0,t},a.clone=function(t){var n=new r(2);return n[0]=t[0],n[1]=t[1],n},a.fromValues=function(t,n){var e=new r(2);return e[0]=t,e[1]=n,e},a.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t},a.set=function(t,n,r){return t[0]=n,t[1]=r,t},a.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t},a.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t},a.sub=a.subtract,a.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t},a.mul=a.multiply,a.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t},a.div=a.divide,a.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t},a.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t},a.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t},a.scaleAndAdd=function(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t},a.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1];return Math.sqrt(r*r+e*e)},a.dist=a.distance,a.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1];return r*r+e*e},a.sqrDist=a.squaredDistance,a.length=function(t){var n=t[0],r=t[1];return Math.sqrt(n*n+r*r)},a.len=a.length,a.squaredLength=function(t){var n=t[0],r=t[1];return n*n+r*r},a.sqrLen=a.squaredLength,a.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t},a.normalize=function(t,n){var r=n[0],e=n[1],i=r*r+e*e;return i>0&&(i=1/Math.sqrt(i),t[0]=n[0]*i,t[1]=n[1]*i),t},a.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]},a.cross=function(t,n,r){var e=n[0]*r[1]-n[1]*r[0];return t[0]=t[1]=0,t[2]=e,t},a.lerp=function(t,n,r,e){var i=n[0],a=n[1];return t[0]=i+e*(r[0]-i),t[1]=a+e*(r[1]-a),t},a.random=function(t,n){n=n||1;var r=2*e()*Math.PI;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t},a.transformMat2=function(t,n,r){var e=n[0],i=n[1];return t[0]=r[0]*e+r[2]*i,t[1]=r[1]*e+r[3]*i,t},a.transformMat2d=function(t,n,r){var e=n[0],i=n[1];
return t[0]=r[0]*e+r[2]*i+r[4],t[1]=r[1]*e+r[3]*i+r[5],t},a.transformMat3=function(t,n,r){var e=n[0],i=n[1];return t[0]=r[0]*e+r[3]*i+r[6],t[1]=r[1]*e+r[4]*i+r[7],t},a.transformMat4=function(t,n,r){var e=n[0],i=n[1];return t[0]=r[0]*e+r[4]*i+r[12],t[1]=r[1]*e+r[5]*i+r[13],t},a.forEach=function(){var t=a.create();return function(n,r,e,i,a,o){var u,s;for(r||(r=2),e||(e=0),s=i?Math.min(i*r+e,n.length):n.length,u=e;s>u;u+=r)t[0]=n[u],t[1]=n[u+1],a(t,t,o),n[u]=t[0],n[u+1]=t[1];return n}}(),a.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},t!==void 0&&(t.vec2=a);var o={};o.create=function(){var t=new r(3);return t[0]=0,t[1]=0,t[2]=0,t},o.clone=function(t){var n=new r(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n},o.fromValues=function(t,n,e){var i=new r(3);return i[0]=t,i[1]=n,i[2]=e,i},o.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},o.set=function(t,n,r,e){return t[0]=n,t[1]=r,t[2]=e,t},o.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t},o.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t},o.sub=o.subtract,o.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t},o.mul=o.multiply,o.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t},o.div=o.divide,o.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t},o.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t},o.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t},o.scaleAndAdd=function(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t[2]=n[2]+r[2]*e,t},o.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],i=n[2]-t[2];return Math.sqrt(r*r+e*e+i*i)},o.dist=o.distance,o.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],i=n[2]-t[2];return r*r+e*e+i*i},o.sqrDist=o.squaredDistance,o.length=function(t){var n=t[0],r=t[1],e=t[2];return Math.sqrt(n*n+r*r+e*e)},o.len=o.length,o.squaredLength=function(t){var n=t[0],r=t[1],e=t[2];return n*n+r*r+e*e},o.sqrLen=o.squaredLength,o.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t},o.normalize=function(t,n){var r=n[0],e=n[1],i=n[2],a=r*r+e*e+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=n[0]*a,t[1]=n[1]*a,t[2]=n[2]*a),t},o.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},o.cross=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=r[0],u=r[1],s=r[2];return t[0]=i*s-a*u,t[1]=a*o-e*s,t[2]=e*u-i*o,t},o.lerp=function(t,n,r,e){var i=n[0],a=n[1],o=n[2];return t[0]=i+e*(r[0]-i),t[1]=a+e*(r[1]-a),t[2]=o+e*(r[2]-o),t},o.random=function(t,n){n=n||1;var r=2*e()*Math.PI,i=2*e()-1,a=Math.sqrt(1-i*i)*n;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=i*n,t},o.transformMat4=function(t,n,r){var e=n[0],i=n[1],a=n[2];return t[0]=r[0]*e+r[4]*i+r[8]*a+r[12],t[1]=r[1]*e+r[5]*i+r[9]*a+r[13],t[2]=r[2]*e+r[6]*i+r[10]*a+r[14],t},o.transformMat3=function(t,n,r){var e=n[0],i=n[1],a=n[2];return t[0]=e*r[0]+i*r[3]+a*r[6],t[1]=e*r[1]+i*r[4]+a*r[7],t[2]=e*r[2]+i*r[5]+a*r[8],t},o.transformQuat=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=r[0],u=r[1],s=r[2],c=r[3],l=c*e+u*a-s*i,f=c*i+s*e-o*a,h=c*a+o*i-u*e,d=-o*e-u*i-s*a;return t[0]=l*c+d*-o+f*-s-h*-u,t[1]=f*c+d*-u+h*-o-l*-s,t[2]=h*c+d*-s+l*-u-f*-o,t},o.forEach=function(){var t=o.create();return function(n,r,e,i,a,o){var u,s;for(r||(r=3),e||(e=0),s=i?Math.min(i*r+e,n.length):n.length,u=e;s>u;u+=r)t[0]=n[u],t[1]=n[u+1],t[2]=n[u+2],a(t,t,o),n[u]=t[0],n[u+1]=t[1],n[u+2]=t[2];return n}}(),o.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t!==void 0&&(t.vec3=o);var u={};u.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},u.clone=function(t){var n=new r(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},u.fromValues=function(t,n,e,i){var a=new r(4);return a[0]=t,a[1]=n,a[2]=e,a[3]=i,a},u.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},u.set=function(t,n,r,e,i){return t[0]=n,t[1]=r,t[2]=e,t[3]=i,t},u.add=function(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t[3]=n[3]+r[3],t},u.subtract=function(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t[3]=n[3]-r[3],t},u.sub=u.subtract,u.multiply=function(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t[2]=n[2]*r[2],t[3]=n[3]*r[3],t},u.mul=u.multiply,u.divide=function(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t[2]=n[2]/r[2],t[3]=n[3]/r[3],t},u.div=u.divide,u.min=function(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t[2]=Math.min(n[2],r[2]),t[3]=Math.min(n[3],r[3]),t},u.max=function(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t[2]=Math.max(n[2],r[2]),t[3]=Math.max(n[3],r[3]),t},u.scale=function(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t},u.scaleAndAdd=function(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t[2]=n[2]+r[2]*e,t[3]=n[3]+r[3]*e,t},u.distance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],i=n[2]-t[2],a=n[3]-t[3];return Math.sqrt(r*r+e*e+i*i+a*a)},u.dist=u.distance,u.squaredDistance=function(t,n){var r=n[0]-t[0],e=n[1]-t[1],i=n[2]-t[2],a=n[3]-t[3];return r*r+e*e+i*i+a*a},u.sqrDist=u.squaredDistance,u.length=function(t){var n=t[0],r=t[1],e=t[2],i=t[3];return Math.sqrt(n*n+r*r+e*e+i*i)},u.len=u.length,u.squaredLength=function(t){var n=t[0],r=t[1],e=t[2],i=t[3];return n*n+r*r+e*e+i*i},u.sqrLen=u.squaredLength,u.negate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t},u.normalize=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=r*r+e*e+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=n[0]*o,t[1]=n[1]*o,t[2]=n[2]*o,t[3]=n[3]*o),t},u.dot=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},u.lerp=function(t,n,r,e){var i=n[0],a=n[1],o=n[2],u=n[3];return t[0]=i+e*(r[0]-i),t[1]=a+e*(r[1]-a),t[2]=o+e*(r[2]-o),t[3]=u+e*(r[3]-u),t},u.random=function(t,n){return n=n||1,t[0]=e(),t[1]=e(),t[2]=e(),t[3]=e(),u.normalize(t,t),u.scale(t,t,n),t},u.transformMat4=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3];return t[0]=r[0]*e+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*e+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*e+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*e+r[7]*i+r[11]*a+r[15]*o,t},u.transformQuat=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=r[0],u=r[1],s=r[2],c=r[3],l=c*e+u*a-s*i,f=c*i+s*e-o*a,h=c*a+o*i-u*e,d=-o*e-u*i-s*a;return t[0]=l*c+d*-o+f*-s-h*-u,t[1]=f*c+d*-u+h*-o-l*-s,t[2]=h*c+d*-s+l*-u-f*-o,t},u.forEach=function(){var t=u.create();return function(n,r,e,i,a,o){var u,s;for(r||(r=4),e||(e=0),s=i?Math.min(i*r+e,n.length):n.length,u=e;s>u;u+=r)t[0]=n[u],t[1]=n[u+1],t[2]=n[u+2],t[3]=n[u+3],a(t,t,o),n[u]=t[0],n[u+1]=t[1],n[u+2]=t[2],n[u+3]=t[3];return n}}(),u.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.vec4=u);var s={};s.create=function(){var t=new r(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},s.clone=function(t){var n=new r(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n},s.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},s.transpose=function(t,n){if(t===n){var r=n[1];t[1]=n[2],t[2]=r}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t},s.invert=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=r*a-i*e;return o?(o=1/o,t[0]=a*o,t[1]=-e*o,t[2]=-i*o,t[3]=r*o,t):null},s.adjoint=function(t,n){var r=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=r,t},s.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},s.multiply=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=r[0],s=r[1],c=r[2],l=r[3];return t[0]=e*u+i*c,t[1]=e*s+i*l,t[2]=a*u+o*c,t[3]=a*s+o*l,t},s.mul=s.multiply,s.rotate=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=Math.sin(r),s=Math.cos(r);return t[0]=e*s+i*u,t[1]=e*-u+i*s,t[2]=a*s+o*u,t[3]=a*-u+o*s,t},s.scale=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=r[0],s=r[1];return t[0]=e*u,t[1]=i*s,t[2]=a*u,t[3]=o*s,t},s.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.mat2=s);var c={};c.create=function(){var t=new r(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.clone=function(t){var n=new r(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n},c.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t},c.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},c.invert=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=n[4],u=n[5],s=r*a-e*i;return s?(s=1/s,t[0]=a*s,t[1]=-e*s,t[2]=-i*s,t[3]=r*s,t[4]=(i*u-a*o)*s,t[5]=(e*o-r*u)*s,t):null},c.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},c.multiply=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5],c=r[0],l=r[1],f=r[2],h=r[3],d=r[4],p=r[5];return t[0]=e*c+i*f,t[1]=e*l+i*h,t[2]=a*c+o*f,t[3]=a*l+o*h,t[4]=c*u+f*s+d,t[5]=l*u+h*s+p,t},c.mul=c.multiply,c.rotate=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5],c=Math.sin(r),l=Math.cos(r);return t[0]=e*l+i*c,t[1]=-e*c+i*l,t[2]=a*l+o*c,t[3]=-a*c+l*o,t[4]=l*u+c*s,t[5]=l*s-c*u,t},c.scale=function(t,n,r){var e=r[0],i=r[1];return t[0]=n[0]*e,t[1]=n[1]*i,t[2]=n[2]*e,t[3]=n[3]*i,t[4]=n[4]*e,t[5]=n[5]*i,t},c.translate=function(t,n,r){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4]+r[0],t[5]=n[5]+r[1],t},c.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},t!==void 0&&(t.mat2d=c);var l={};l.create=function(){var t=new r(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.fromMat4=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t},l.clone=function(t){var n=new r(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n},l.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},l.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},l.transpose=function(t,n){if(t===n){var r=n[1],e=n[2],i=n[5];t[1]=n[3],t[2]=n[6],t[3]=r,t[5]=n[7],t[6]=e,t[7]=i}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t},l.invert=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=n[4],u=n[5],s=n[6],c=n[7],l=n[8],f=l*o-u*c,h=-l*a+u*s,d=c*a-o*s,p=r*f+e*h+i*d;return p?(p=1/p,t[0]=f*p,t[1]=(-l*e+i*c)*p,t[2]=(u*e-i*o)*p,t[3]=h*p,t[4]=(l*r-i*s)*p,t[5]=(-u*r+i*a)*p,t[6]=d*p,t[7]=(-c*r+e*s)*p,t[8]=(o*r-e*a)*p,t):null},l.adjoint=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=n[4],u=n[5],s=n[6],c=n[7],l=n[8];return t[0]=o*l-u*c,t[1]=i*c-e*l,t[2]=e*u-i*o,t[3]=u*s-a*l,t[4]=r*l-i*s,t[5]=i*a-r*u,t[6]=a*c-o*s,t[7]=e*s-r*c,t[8]=r*o-e*a,t},l.determinant=function(t){var n=t[0],r=t[1],e=t[2],i=t[3],a=t[4],o=t[5],u=t[6],s=t[7],c=t[8];return n*(c*a-o*s)+r*(-c*i+o*u)+e*(s*i-a*u)},l.multiply=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5],c=n[6],l=n[7],f=n[8],h=r[0],d=r[1],p=r[2],v=r[3],g=r[4],m=r[5],y=r[6],_=r[7],b=r[8];return t[0]=h*e+d*o+p*c,t[1]=h*i+d*u+p*l,t[2]=h*a+d*s+p*f,t[3]=v*e+g*o+m*c,t[4]=v*i+g*u+m*l,t[5]=v*a+g*s+m*f,t[6]=y*e+_*o+b*c,t[7]=y*i+_*u+b*l,t[8]=y*a+_*s+b*f,t},l.mul=l.multiply,l.translate=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5],c=n[6],l=n[7],f=n[8],h=r[0],d=r[1];return t[0]=e,t[1]=i,t[2]=a,t[3]=o,t[4]=u,t[5]=s,t[6]=h*e+d*o+c,t[7]=h*i+d*u+l,t[8]=h*a+d*s+f,t},l.rotate=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5],c=n[6],l=n[7],f=n[8],h=Math.sin(r),d=Math.cos(r);return t[0]=d*e+h*o,t[1]=d*i+h*u,t[2]=d*a+h*s,t[3]=d*o-h*e,t[4]=d*u-h*i,t[5]=d*s-h*a,t[6]=c,t[7]=l,t[8]=f,t},l.scale=function(t,n,r){var e=r[0],i=r[1];return t[0]=e*n[0],t[1]=e*n[1],t[2]=e*n[2],t[3]=i*n[3],t[4]=i*n[4],t[5]=i*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t},l.fromMat2d=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t},l.fromQuat=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=r+r,u=e+e,s=i+i,c=r*o,l=r*u,f=r*s,h=e*u,d=e*s,p=i*s,v=a*o,g=a*u,m=a*s;return t[0]=1-(h+p),t[3]=l+m,t[6]=f-g,t[1]=l-m,t[4]=1-(c+p),t[7]=d+v,t[2]=f+g,t[5]=d-v,t[8]=1-(c+h),t},l.normalFromMat4=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=n[4],u=n[5],s=n[6],c=n[7],l=n[8],f=n[9],h=n[10],d=n[11],p=n[12],v=n[13],g=n[14],m=n[15],y=r*u-e*o,_=r*s-i*o,b=r*c-a*o,x=e*s-i*u,A=e*c-a*u,w=i*c-a*s,M=l*v-f*p,B=l*g-h*p,k=l*m-d*p,q=f*g-h*v,P=f*m-d*v,C=h*m-d*g,j=y*C-_*P+b*q+x*k-A*B+w*M;return j?(j=1/j,t[0]=(u*C-s*P+c*q)*j,t[1]=(s*k-o*C-c*B)*j,t[2]=(o*P-u*k+c*M)*j,t[3]=(i*P-e*C-a*q)*j,t[4]=(r*C-i*k+a*B)*j,t[5]=(e*k-r*P-a*M)*j,t[6]=(v*w-g*A+m*x)*j,t[7]=(g*b-p*w-m*_)*j,t[8]=(p*A-v*b+m*y)*j,t):null},l.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t!==void 0&&(t.mat3=l);var f={};f.create=function(){var t=new r(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},f.clone=function(t){var n=new r(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},f.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},f.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},f.transpose=function(t,n){if(t===n){var r=n[1],e=n[2],i=n[3],a=n[6],o=n[7],u=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=r,t[6]=n[9],t[7]=n[13],t[8]=e,t[9]=a,t[11]=n[14],t[12]=i,t[13]=o,t[14]=u}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t},f.invert=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=n[4],u=n[5],s=n[6],c=n[7],l=n[8],f=n[9],h=n[10],d=n[11],p=n[12],v=n[13],g=n[14],m=n[15],y=r*u-e*o,_=r*s-i*o,b=r*c-a*o,x=e*s-i*u,A=e*c-a*u,w=i*c-a*s,M=l*v-f*p,B=l*g-h*p,k=l*m-d*p,q=f*g-h*v,P=f*m-d*v,C=h*m-d*g,j=y*C-_*P+b*q+x*k-A*B+w*M;return j?(j=1/j,t[0]=(u*C-s*P+c*q)*j,t[1]=(i*P-e*C-a*q)*j,t[2]=(v*w-g*A+m*x)*j,t[3]=(h*A-f*w-d*x)*j,t[4]=(s*k-o*C-c*B)*j,t[5]=(r*C-i*k+a*B)*j,t[6]=(g*b-p*w-m*_)*j,t[7]=(l*w-h*b+d*_)*j,t[8]=(o*P-u*k+c*M)*j,t[9]=(e*k-r*P-a*M)*j,t[10]=(p*A-v*b+m*y)*j,t[11]=(f*b-l*A-d*y)*j,t[12]=(u*B-o*q-s*M)*j,t[13]=(r*q-e*B+i*M)*j,t[14]=(v*_-p*x-g*y)*j,t[15]=(l*x-f*_+h*y)*j,t):null},f.adjoint=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=n[4],u=n[5],s=n[6],c=n[7],l=n[8],f=n[9],h=n[10],d=n[11],p=n[12],v=n[13],g=n[14],m=n[15];return t[0]=u*(h*m-d*g)-f*(s*m-c*g)+v*(s*d-c*h),t[1]=-(e*(h*m-d*g)-f*(i*m-a*g)+v*(i*d-a*h)),t[2]=e*(s*m-c*g)-u*(i*m-a*g)+v*(i*c-a*s),t[3]=-(e*(s*d-c*h)-u*(i*d-a*h)+f*(i*c-a*s)),t[4]=-(o*(h*m-d*g)-l*(s*m-c*g)+p*(s*d-c*h)),t[5]=r*(h*m-d*g)-l*(i*m-a*g)+p*(i*d-a*h),t[6]=-(r*(s*m-c*g)-o*(i*m-a*g)+p*(i*c-a*s)),t[7]=r*(s*d-c*h)-o*(i*d-a*h)+l*(i*c-a*s),t[8]=o*(f*m-d*v)-l*(u*m-c*v)+p*(u*d-c*f),t[9]=-(r*(f*m-d*v)-l*(e*m-a*v)+p*(e*d-a*f)),t[10]=r*(u*m-c*v)-o*(e*m-a*v)+p*(e*c-a*u),t[11]=-(r*(u*d-c*f)-o*(e*d-a*f)+l*(e*c-a*u)),t[12]=-(o*(f*g-h*v)-l*(u*g-s*v)+p*(u*h-s*f)),t[13]=r*(f*g-h*v)-l*(e*g-i*v)+p*(e*h-i*f),t[14]=-(r*(u*g-s*v)-o*(e*g-i*v)+p*(e*s-i*u)),t[15]=r*(u*h-s*f)-o*(e*h-i*f)+l*(e*s-i*u),t},f.determinant=function(t){var n=t[0],r=t[1],e=t[2],i=t[3],a=t[4],o=t[5],u=t[6],s=t[7],c=t[8],l=t[9],f=t[10],h=t[11],d=t[12],p=t[13],v=t[14],g=t[15],m=n*o-r*a,y=n*u-e*a,_=n*s-i*a,b=r*u-e*o,x=r*s-i*o,A=e*s-i*u,w=c*p-l*d,M=c*v-f*d,B=c*g-h*d,k=l*v-f*p,q=l*g-h*p,P=f*g-h*v;return m*P-y*q+_*k+b*B-x*M+A*w},f.multiply=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5],c=n[6],l=n[7],f=n[8],h=n[9],d=n[10],p=n[11],v=n[12],g=n[13],m=n[14],y=n[15],_=r[0],b=r[1],x=r[2],A=r[3];return t[0]=_*e+b*u+x*f+A*v,t[1]=_*i+b*s+x*h+A*g,t[2]=_*a+b*c+x*d+A*m,t[3]=_*o+b*l+x*p+A*y,_=r[4],b=r[5],x=r[6],A=r[7],t[4]=_*e+b*u+x*f+A*v,t[5]=_*i+b*s+x*h+A*g,t[6]=_*a+b*c+x*d+A*m,t[7]=_*o+b*l+x*p+A*y,_=r[8],b=r[9],x=r[10],A=r[11],t[8]=_*e+b*u+x*f+A*v,t[9]=_*i+b*s+x*h+A*g,t[10]=_*a+b*c+x*d+A*m,t[11]=_*o+b*l+x*p+A*y,_=r[12],b=r[13],x=r[14],A=r[15],t[12]=_*e+b*u+x*f+A*v,t[13]=_*i+b*s+x*h+A*g,t[14]=_*a+b*c+x*d+A*m,t[15]=_*o+b*l+x*p+A*y,t},f.mul=f.multiply,f.translate=function(t,n,r){var e,i,a,o,u,s,c,l,f,h,d,p,v=r[0],g=r[1],m=r[2];return n===t?(t[12]=n[0]*v+n[4]*g+n[8]*m+n[12],t[13]=n[1]*v+n[5]*g+n[9]*m+n[13],t[14]=n[2]*v+n[6]*g+n[10]*m+n[14],t[15]=n[3]*v+n[7]*g+n[11]*m+n[15]):(e=n[0],i=n[1],a=n[2],o=n[3],u=n[4],s=n[5],c=n[6],l=n[7],f=n[8],h=n[9],d=n[10],p=n[11],t[0]=e,t[1]=i,t[2]=a,t[3]=o,t[4]=u,t[5]=s,t[6]=c,t[7]=l,t[8]=f,t[9]=h,t[10]=d,t[11]=p,t[12]=e*v+u*g+f*m+n[12],t[13]=i*v+s*g+h*m+n[13],t[14]=a*v+c*g+d*m+n[14],t[15]=o*v+l*g+p*m+n[15]),t},f.scale=function(t,n,r){var e=r[0],i=r[1],a=r[2];return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=n[11]*a,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},f.rotate=function(t,r,e,i){var a,o,u,s,c,l,f,h,d,p,v,g,m,y,_,b,x,A,w,M,B,k,q,P,C=i[0],j=i[1],z=i[2],O=Math.sqrt(C*C+j*j+z*z);return n>Math.abs(O)?null:(O=1/O,C*=O,j*=O,z*=O,a=Math.sin(e),o=Math.cos(e),u=1-o,s=r[0],c=r[1],l=r[2],f=r[3],h=r[4],d=r[5],p=r[6],v=r[7],g=r[8],m=r[9],y=r[10],_=r[11],b=C*C*u+o,x=j*C*u+z*a,A=z*C*u-j*a,w=C*j*u-z*a,M=j*j*u+o,B=z*j*u+C*a,k=C*z*u+j*a,q=j*z*u-C*a,P=z*z*u+o,t[0]=s*b+h*x+g*A,t[1]=c*b+d*x+m*A,t[2]=l*b+p*x+y*A,t[3]=f*b+v*x+_*A,t[4]=s*w+h*M+g*B,t[5]=c*w+d*M+m*B,t[6]=l*w+p*M+y*B,t[7]=f*w+v*M+_*B,t[8]=s*k+h*q+g*P,t[9]=c*k+d*q+m*P,t[10]=l*k+p*q+y*P,t[11]=f*k+v*q+_*P,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},f.rotateX=function(t,n,r){var e=Math.sin(r),i=Math.cos(r),a=n[4],o=n[5],u=n[6],s=n[7],c=n[8],l=n[9],f=n[10],h=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=a*i+c*e,t[5]=o*i+l*e,t[6]=u*i+f*e,t[7]=s*i+h*e,t[8]=c*i-a*e,t[9]=l*i-o*e,t[10]=f*i-u*e,t[11]=h*i-s*e,t},f.rotateY=function(t,n,r){var e=Math.sin(r),i=Math.cos(r),a=n[0],o=n[1],u=n[2],s=n[3],c=n[8],l=n[9],f=n[10],h=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=a*i-c*e,t[1]=o*i-l*e,t[2]=u*i-f*e,t[3]=s*i-h*e,t[8]=a*e+c*i,t[9]=o*e+l*i,t[10]=u*e+f*i,t[11]=s*e+h*i,t},f.rotateZ=function(t,n,r){var e=Math.sin(r),i=Math.cos(r),a=n[0],o=n[1],u=n[2],s=n[3],c=n[4],l=n[5],f=n[6],h=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=a*i+c*e,t[1]=o*i+l*e,t[2]=u*i+f*e,t[3]=s*i+h*e,t[4]=c*i-a*e,t[5]=l*i-o*e,t[6]=f*i-u*e,t[7]=h*i-s*e,t},f.fromRotationTranslation=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=e+e,s=i+i,c=a+a,l=e*u,f=e*s,h=e*c,d=i*s,p=i*c,v=a*c,g=o*u,m=o*s,y=o*c;return t[0]=1-(d+v),t[1]=f+y,t[2]=h-m,t[3]=0,t[4]=f-y,t[5]=1-(l+v),t[6]=p+g,t[7]=0,t[8]=h+m,t[9]=p-g,t[10]=1-(l+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},f.fromQuat=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=r+r,u=e+e,s=i+i,c=r*o,l=r*u,f=r*s,h=e*u,d=e*s,p=i*s,v=a*o,g=a*u,m=a*s;return t[0]=1-(h+p),t[1]=l+m,t[2]=f-g,t[3]=0,t[4]=l-m,t[5]=1-(c+p),t[6]=d+v,t[7]=0,t[8]=f+g,t[9]=d-v,t[10]=1-(c+h),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},f.frustum=function(t,n,r,e,i,a,o){var u=1/(r-n),s=1/(i-e),c=1/(a-o);return t[0]=2*a*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*s,t[6]=0,t[7]=0,t[8]=(r+n)*u,t[9]=(i+e)*s,t[10]=(o+a)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*o*a*c,t[15]=0,t},f.perspective=function(t,n,r,e,i){var a=1/Math.tan(n/2),o=1/(e-i);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+e)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*e*o,t[15]=0,t},f.ortho=function(t,n,r,e,i,a,o){var u=1/(n-r),s=1/(e-i),c=1/(a-o);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(n+r)*u,t[13]=(i+e)*s,t[14]=(o+a)*c,t[15]=1,t},f.lookAt=function(t,r,e,i){var a,o,u,s,c,l,h,d,p,v,g=r[0],m=r[1],y=r[2],_=i[0],b=i[1],x=i[2],A=e[0],w=e[1],M=e[2];return n>Math.abs(g-A)&&n>Math.abs(m-w)&&n>Math.abs(y-M)?f.identity(t):(h=g-A,d=m-w,p=y-M,v=1/Math.sqrt(h*h+d*d+p*p),h*=v,d*=v,p*=v,a=b*p-x*d,o=x*h-_*p,u=_*d-b*h,v=Math.sqrt(a*a+o*o+u*u),v?(v=1/v,a*=v,o*=v,u*=v):(a=0,o=0,u=0),s=d*u-p*o,c=p*a-h*u,l=h*o-d*a,v=Math.sqrt(s*s+c*c+l*l),v?(v=1/v,s*=v,c*=v,l*=v):(s=0,c=0,l=0),t[0]=a,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=c,t[6]=d,t[7]=0,t[8]=u,t[9]=l,t[10]=p,t[11]=0,t[12]=-(a*g+o*m+u*y),t[13]=-(s*g+c*m+l*y),t[14]=-(h*g+d*m+p*y),t[15]=1,t)},f.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t!==void 0&&(t.mat4=f);var h={};h.create=function(){var t=new r(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.rotationTo=function(){var t=o.create(),n=o.fromValues(1,0,0),r=o.fromValues(0,1,0);return function(e,i,a){var u=o.dot(i,a);return-.999999>u?(o.cross(t,n,i),1e-6>o.length(t)&&o.cross(t,r,i),o.normalize(t,t),h.setAxisAngle(e,t,Math.PI),e):u>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(o.cross(t,i,a),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=1+u,h.normalize(e,e))}}(),h.setAxes=function(){var t=l.create();return function(n,r,e,i){return t[0]=e[0],t[3]=e[1],t[6]=e[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=r[0],t[5]=r[1],t[8]=r[2],h.normalize(n,h.fromMat3(n,t))}}(),h.clone=u.clone,h.fromValues=u.fromValues,h.copy=u.copy,h.set=u.set,h.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},h.setAxisAngle=function(t,n,r){r=.5*r;var e=Math.sin(r);return t[0]=e*n[0],t[1]=e*n[1],t[2]=e*n[2],t[3]=Math.cos(r),t},h.add=u.add,h.multiply=function(t,n,r){var e=n[0],i=n[1],a=n[2],o=n[3],u=r[0],s=r[1],c=r[2],l=r[3];return t[0]=e*l+o*u+i*c-a*s,t[1]=i*l+o*s+a*u-e*c,t[2]=a*l+o*c+e*s-i*u,t[3]=o*l-e*u-i*s-a*c,t},h.mul=h.multiply,h.scale=u.scale,h.rotateX=function(t,n,r){r*=.5;var e=n[0],i=n[1],a=n[2],o=n[3],u=Math.sin(r),s=Math.cos(r);return t[0]=e*s+o*u,t[1]=i*s+a*u,t[2]=a*s-i*u,t[3]=o*s-e*u,t},h.rotateY=function(t,n,r){r*=.5;var e=n[0],i=n[1],a=n[2],o=n[3],u=Math.sin(r),s=Math.cos(r);return t[0]=e*s-a*u,t[1]=i*s+o*u,t[2]=a*s+e*u,t[3]=o*s-i*u,t},h.rotateZ=function(t,n,r){r*=.5;var e=n[0],i=n[1],a=n[2],o=n[3],u=Math.sin(r),s=Math.cos(r);return t[0]=e*s+i*u,t[1]=i*s-e*u,t[2]=a*s+o*u,t[3]=o*s-a*u,t},h.calculateW=function(t,n){var r=n[0],e=n[1],i=n[2];return t[0]=r,t[1]=e,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-r*r-e*e-i*i)),t},h.dot=u.dot,h.lerp=u.lerp,h.slerp=function(t,n,r,e){var i,a,o,u,s,c=n[0],l=n[1],f=n[2],h=n[3],d=r[0],p=r[1],v=r[2],g=r[3];return a=c*d+l*p+f*v+h*g,0>a&&(a=-a,d=-d,p=-p,v=-v,g=-g),1-a>1e-6?(i=Math.acos(a),o=Math.sin(i),u=Math.sin((1-e)*i)/o,s=Math.sin(e*i)/o):(u=1-e,s=e),t[0]=u*c+s*d,t[1]=u*l+s*p,t[2]=u*f+s*v,t[3]=u*h+s*g,t},h.invert=function(t,n){var r=n[0],e=n[1],i=n[2],a=n[3],o=r*r+e*e+i*i+a*a,u=o?1/o:0;return t[0]=-r*u,t[1]=-e*u,t[2]=-i*u,t[3]=a*u,t},h.conjugate=function(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t},h.length=u.length,h.len=h.length,h.squaredLength=u.squaredLength,h.sqrLen=h.squaredLength,h.normalize=u.normalize,h.fromMat3=function(){var t="undefined"!=typeof Int8Array?new Int8Array([1,2,0]):[1,2,0];return function(n,r){var e,i=r[0]+r[4]+r[8];if(i>0)e=Math.sqrt(i+1),n[3]=.5*e,e=.5/e,n[0]=(r[7]-r[5])*e,n[1]=(r[2]-r[6])*e,n[2]=(r[3]-r[1])*e;else{var a=0;r[4]>r[0]&&(a=1),r[8]>r[3*a+a]&&(a=2);var o=t[a],u=t[o];e=Math.sqrt(r[3*a+a]-r[3*o+o]-r[3*u+u]+1),n[a]=.5*e,e=.5/e,n[3]=(r[3*u+o]-r[3*o+u])*e,n[o]=(r[3*o+a]+r[3*a+o])*e,n[u]=(r[3*u+a]+r[3*a+u])*e}return n}}(),h.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t!==void 0&&(t.quat=h)}(n.exports)}(this),e("2d/style",["require","core/base","_"],function(t){function n(t){return(t||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")}var r=t("core/base"),e=t("_"),i=["fillStyle","strokeStyle","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","globalAlpha","font"],a={fill:"fillStyle",stroke:"strokeStyle",alpha:"globalAlpha",shadow:["shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor"]},o=/([0-9]+)\s+([0-9]+)\s+([0-9]+)\s+([a-zA-Z0-9\(\)\s,#]+)/,u=r.derive({},{bind:function(t){var r=i,u=a;for(var s in u)if(this.hasOwnProperty(s)){var c=u[s],l=this[s];if("shadow"==s){var f=o.exec(n(l));if(!f)continue;l=f.slice(1),e.each(l,function(n,r){c[r]&&(t[c[r]]=n)},this)}else t[c]=l}e.each(r,function(n){this.hasOwnProperty(n)&&(t[n]=this[n])},this)}});return u}),e("2d/node",["require","core/base","glmatrix","./style"],function(t){var n=t("core/base"),r=t("glmatrix"),e=r.vec2,i=r.mat2d,a=t("./style"),o=n.derive(function(){return{__mouseover__:!1,id:0,AABB:[e.fromValues(0,0),e.fromValues(0,0)],z:0,style:null,position:e.fromValues(0,0),rotation:0,scale:e.fromValues(1,1),_transform:i.create(),_transformInverse:i.create(),visible:!0,children:{},intersectLineWidth:0,clip:!1,fill:!0,stroke:!0,fixAA:!0}},function(){this.__GUID__=u()},{updateTransform:function(){var t=this._transform;return i.identity(t),this.scale&&i.scale(t,t,this.scale),this.rotation&&i.rotate(t,t,this.rotation),this.position&&i.translate(t,t,this.position),t},updateTransformInverse:function(){i.invert(this._transformInverse,this._transformInverse)},intersectAABB:function(t,n){var r=this.AABB;return t>r[0][0]&&r[1][0]>t&&n>r[0][1]&&r[1][1]>n},add:function(t){t&&(this.children[t.__GUID__]=t,t.parent=this)},remove:function(t){this.children[t.__GUID__]=null,t.parent=null},draw:function(){},render:function(t){var n=this._getSortedRenderQueue();if(t.save(),this.style)if(!this.style instanceof a)for(var r in this.style)this.style[r].bind(t);else this.style.bind(t);var e=this.updateTransform();t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),this.draw(t),this.clip&&t.clip();for(var i=0;n.length>i;i++)n[i].render(t);t.restore()},traverse:function(t){var n=t&&t(this);if(!n)for(var r=this.children,e=0,i=r.length;i>e;e++)r[e].traverse(t)},intersect:function(){},_getSortedRenderQueue:function(){var t=[];for(var n in this.children)t.push(this.children[n]);return t.sort(function(t,n){return t.z===n.z?t.__GUID__>n.__GUID__?1:-1:t.z>n.z?1:-1}),t}}),u=function(){var t=0;return function(){return++t}}();return o}),e("2d/util",["require"],function(){return{fixPos:function(t){return[t[0]+.5,t[1]+.5]},fixPosArray:function(t){for(var n=[],r=t.length,e=0;r>e;e++)n.push(this.fixPos(t[e]));return n},computeAABB:function(t){for(var n=t[0][0],r=t[0][0],e=t[0][1],i=t[0][1],a=1;t.length>a;a++)n=n>t[a][0]?t[a][0]:n,r=t[a][0]>r?t[a][0]:r,e=e>t[a][1]?t[a][1]:e,i=t[a][1]>i?t[a][1]:i;return[[n,e],[r,i]]}}}),e("2d/renderable/arc",["require","../node","../util","glmatrix"],function(t){var n=t("../node"),r=t("../util"),e=t("glmatrix");e.vec2;var i=n.derive(function(){return{center:[0,0],radius:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(){var t=this.fixAA?r.fixPos(this.center):this.center;ctx.beginPath(),ctx.arc(t[0],t[1],this.radius,this.startAngle,this.endAngle,!this.clockwise),this.stroke&&ctx.stroke(),this.fill&&ctx.fill()},intersect:function(){return!1}});return i}),e("2d/renderable/circle",["require","../node","../util","glmatrix"],function(t){var n=t("../node"),r=t("../util"),e=t("glmatrix"),i=e.vec2,a=n.derive(function(){return{center:[0,0],radius:0}},{computeAABB:function(){this.AABB=[[this.center[0]-this.radius,this.center[1]-this.radius],[this.center[0]+this.radius,this.center[1]+this.radius]]},draw:function(t){var n=this.fixAA?r.fixPos(this.center):this.center;t.beginPath(),t.arc(n[0],n[1],this.radius,0,2*Math.PI,!1),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(){return i.len([this.center[0]-x,this.center[1]-y])<this.radius}});return a}),e("2d/renderable/image",["require","../node","../util","glmatrix"],function(t){var n=t("../node"),r=t("../util"),e=t("glmatrix");e.vec2;var i={},a=n.derive(function(){return{img:"",start:[0,0],size:0,onload:function(){}}},function(){if("string"==typeof this.img){var t=this;this.load(this.img,function(n){t.img=n,t.onload.call(t)})}},{computeAABB:function(){this.AABB=r.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(t){var n=this.fixAA?r.fixPos(this.start):this.start;"string"!=typeof this.img&&(this.size?t.drawImage(this.img,n[0],n[1],this.size[0],this.size[1]):t.drawImage(this.img,n[0],n[1]))},intersect:function(t,n){return this.intersectAABB(t,n)},load:function(t,n){if(i[t]){var r=i[t];r.constructor==Array?r.push(n):n(r)}else{i[t]=[n];var r=new a;r.onload=function(){each(i[t],function(t){t(r)}),i[t]=r},r.src=t}}});return a}),e("2d/renderable/line",["require","../node","../util","glmatrix"],function(t){var n=t("../node"),r=t("../util"),e=t("glmatrix"),i=e.vec2,a=n.derive(function(){return{start:[0,0],end:[0,0],width:0}},{computeAABB:function(){this.AABB=r.computeAABB([this.start,this.end]),this.AABB[0][0]==this.AABB[1][0]&&(this.AABB[0][0]-=this.width/2,this.AABB[1][0]+=this.width/2),this.AABB[0][1]==this.AABB[1][1]&&(this.AABB[0][1]-=this.width/2,this.AABB[1][1]+=this.width/2)},draw:function(t){var n=this.fixAA?r.fixPos(this.start):this.start,e=this.fixAA?r.fixPos(this.end):this.end;t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(e[0],e[1]),t.stroke()},intersect:function(t,n){if(!this.intersectAABB(t,n))return!1;var r=[t,n];b=this.start,c=this.end,ba=i.sub([],r,b),bc=i.sub([],c,b);var e=i.dot(bc,ba);i.normalize(bc,bc);var a=i.add(b,i.scale(bc,e)),o=i.length(i.sub(r,r,a));return this.width/2>o}});return a}),e("2d/renderable/path",["require","../node","../util","glmatrix"],function(t){var n=t("../node");t("../util");var r=t("glmatrix"),e=r.vec2,i=n.derive(function(){return{segments:[],globalStyle:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(t){this.globalStyle?this.drawWithSameStyle(t):this.drawWithDifferentStyle(t)},drawWithSameStyle:function(t){var n=this.segments.length,r=this.segments;t.beginPath(),t.moveTo(r[0].point[0],r[0].point[1]);for(var e=1;n>e;e++)if(r[e-1].handleOut||r[e].handleIn){var i=r[e-1].handleOut||r[e-1].point,a=r[e].handleIn||r[e].point;t.bezierCurveTo(i[0],i[1],a[0],a[1],r[e].point[0],r[e].point[1])}else t.lineTo(r[e].point[0],r[e].point[1]);this.fill&&t.fill(),this.stroke&&t.stroke()},drawWithDifferentStyle:function(t){for(var n=this.segments.length,r=this.segments,e=0;n-1>e;e++){if(t.save(),r[e].style&&r[e].style.bind(t),t.beginPath(),t.moveTo(r[e].point[0],r[e].point[1]),r[e].handleOut||r[e+1].handleIn){var i=r[e].handleOut||r[e].point,a=r[e+1].handleIn||r[e+1].point;t.bezierCurveTo(i[0],i[1],a[0],a[1],r[e+1].point[0],r[e+1].point[1])}else t.lineTo(r[e+1].point[0],r[e+1].point[1]);this.stroke&&t.stroke(),this.fill&&t.fill(),t.restore()}},smooth:function(t){function n(t,n,r){var i=e.scale([],e.add([],n,r),.5);return e.sub([],t,i)}for(var r=this.segments.length,i=[],a=this.segments,o=0;r>o;o++){var u=a[o].point,s=o==r-1?a[0].point:a[o+1].point;i.push(e.scale([],e.add([],u,s),.5))}for(var o=0;r>o;o++){var u=a[o].point,c=i[o],l=0==o?i[r-1]:i[o-1],t=a[o].smoothLevel||t||1,f=e.scale([],e.add([],c,l),.5),h=e.sub([],c,f),d=e.sub([],l,f),p=n(u,l,c);e.scale(d,d,t),e.scale(h,h,t),a[o].handleIn=e.add([],e.add([],f,d),p),a[o].handleOut=e.add([],e.add([],f,h),p)}a[0].handleOut=a[0].handleIn=null,a[r-1].handleIn=a[r-1].handleOut=null},pushPoints:function(t){for(var n=0;t.length>n;n++)this.segments.push({point:t[n],handleIn:null,handleOut:null})}});return i}),e("2d/renderable/polygon",["require","../node","../util","glmatrix"],function(t){var n=t("../node"),r=t("../util"),e=t("glmatrix");return e.vec2,n.derive(function(){return{points:[]}},{computeAABB:function(){this.AABB=r.computeAABB(this.points)},draw:function(t){var n=this.fixAA?r.fixPosArray(this.points):this.points;t.beginPath(),t.moveTo(n[0][0],n[0][1]);for(var e=1;n.length>e;e++)t.lineTo(n[e][0],n[e][1]);t.closePath(),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(t,n){if(!this.intersectAABB(t,n))return!1;for(var r,e,i,a,o=this.points.length,u=0,s=this.points,c=0;o>c;c++)r=e.normalize([],[s[c][0]-t,s[c][1]-n]),i=(c+1)%o,e=e.normalize([],[s[i][0]-t,s[i][1]-n]),a=Math.acos(e.dot(r,e)),u+=a;
return.001>Math.length(u-2*Math.PI)}}),n}),e("2d/renderable/rectangle",["require","../node","../util","glmatrix"],function(t){var n=t("../node"),r=t("../util"),e=t("glmatrix"),i=e.vec2,a=n.derive(function(){return{start:[0,0],size:[0,0]}},{computeAABB:function(){var t=i.add([],this.start,this.size);this.AABB=r.computeAABB([this.start,t])},draw:function(t){var n=this.fixAA?r.fixPos(this.start):this.start;t.beginPath(),t.rect(n[0],n[1],this.size[0],this.size[1]),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(t,n){return this.intersectAABB(t,n)}});return a}),e("2d/renderable/roundedrectangle",["require","../node","../util","glmatrix"],function(t){var n=t("../node"),r=t("../util"),e=t("glmatrix"),i=e.vec2,a=n.derive(function(){return{start:[0,0],size:[0,0],radius:0}},{computeAABB:function(){var t=i.add([],this.start,this.size);this.AABB=r.computeAABB([this.start,t])},draw:function(t){if(this.radius.constructor==Number)var n=[this.radius,this.radius,this.radius,this.radius];else if(2==this.radius.length)var n=[this.radius[0],this.radius[1],this.radius[0],this.radius[1]];else var n=this.radius;var e=this.fixAA?r.fixPos(this.start):this.start,a=this.size,o=i.add([],e,[n[0],0]),u=i.add([],e,[a[0],0]),s=i.add([],e,a),c=i.add([],e,[0,a[1]]);t.beginPath(),t.moveTo(o[0],o[1]),n[1]?t.arcTo(u[0],u[1],s[0],s[1],n[1]):t.lineTo(u[0],u[1]),n[2]?t.arcTo(s[0],s[1],c[0],c[1],n[2]):t.lineTo(s[0],s[1]),n[3]?t.arcTo(c[0],c[1],e[0],e[1],n[3]):t.lineTo(c[0],c[1]),n[0]?t.arcTo(e[0],e[1],u[0],u[1],n[0]):t.lineTo(e[0],e[1]),this.stroke&&t.stroke(),this.fill&&t.fill()},intersect:function(){return!1}});return a}),e("2d/renderable/sector",["require","../node","../util","glmatrix"],function(t){var n=t("../node"),r=t("../util"),e=t("glmatrix"),i=e.vec2,a=n.derive(function(){return{center:[0,0],innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,clockwise:!0}},{computeAABB:function(){this.AABB=[0,0]},intersect:function(t,n){var r=this.startAngle,e=this.endAngle,a=this.innerRadius,o=this.outerRadius,u=this.center,s=i.sub([],[t,n],u),c=i.length(s),l=2*Math.PI;if(a>c||c>o)return!1;var f=Math.atan2(s[1],s[0]);return 0>f&&(f+=l),this.clockwise?e>f&&f>r:(r=l-r,e=l-e,f>e&&r>f)},draw:function(t){var n=this.startAngle,e=this.endAngle,a=this.innerRadius,o=this.outerRadius,u=this.fixAA?r.fixPos(this.center):this.center;this.clockwise||(n=2*Math.PI-n,e=2*Math.PI-e);var s=i.add([],u,[a*Math.cos(n),a*Math.sin(n)]),c=i.add([],u,[o*Math.cos(n),o*Math.sin(n)]),l=i.add([],u,[a*Math.cos(e),a*Math.sin(e)]);i.add([],u,[o*Math.cos(e),o*Math.sin(e)]),t.beginPath(),t.moveTo(s[0],s[1]),t.lineTo(c[0],c[1]),t.arc(u[0],u[1],o,n,e,!this.clockwise),t.lineTo(l[0],l[1]),t.arc(u[0],u[1],a,e,n,this.clockwise),t.endPath(),this.stroke&&t.stroke(),this.fill&&t.fill()}});return a}),e("2d/renderable/text",["require","../node","../util","glmatrix"],function(t){var n=t("../node"),r=t("../util"),e=t("glmatrix");e.vec2;var i=n.derive(function(){return{text:"",start:[0,0],size:[0,0],font:"",textAlign:"",textBaseline:""}},{computeAABB:function(){this.AABB=r.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(t){var n=this.fixAA?r.fixPos(this.start):this.start;this.font&&(t.font=this.font),this.textAlign&&(t.textAlign=this.textAlign),this.textBaseline&&(t.textBaseline=this.textBaseline),this.fill&&(this.size.length&&this.size[0]?t.fillText(this.text,n[0],n[1],this.size[0]):t.fillText(this.text,n[0],n[1])),this.stroke&&(this.size.length&&this.size[0]?t.strokeText(this.text,n[0],n[1],this.size[0]):t.strokeText(this.text,n[0],n[1]))},resize:function(t){(!this.size[0]||this.needResize)&&(this.size[0]=t.measureText(this.text).width,this.size[1]=t.measureText("m").width)},intersect:function(t,n){return this.intersectAABB(t,n)}});return i}),e("2d/renderable/textbox",["require","../node","../util","glmatrix","./text","_"],function(t){var n=t("../node");t("../util");var r=t("glmatrix"),e=r.vec2,i=t("./text"),a=t("_"),o=n.derive(function(){return{text:"",textAlign:"",textBaseline:"top",font:"",start:[0,0],width:0,wordWrap:!1,wordBreak:!1,lineHeight:0,stroke:!1,_texts:[]}},function(){this._oldText=""},{computeAABB:function(){},draw:function(t){if(this.text!=this._oldText)if(this._oldText=this.text,this.font&&(t.font=this.font),this.wordBreak)this._texts=this.computeWordBreak(t);else if(this.wordWrap)this._texts=this.computeWordWrap(t);else{var n=new i({text:this.text,textBaseline:this.textBaseline});this.extendCommonProperties(n),this._texts=[n]}a.each(this._texts,function(n){n.draw(t)})},computeWordWrap:function(t){if(this.text){for(var n,r,a,o=this.text.split(" "),u=o.length,s=0,c=[],l=0;u>l;l++)r=l==u-1?o[l]:o[l]+" ",n=t.measureText(r).width,s+n>this.width||!a?(a=new i({text:r,start:e.add([],this.start,[0,this.lineHeight*c.length])}),this.extendCommonProperties(a),c.push(a),s=n):(s+=n,a.text+=r);return c}},computeWordBreak:function(t){if(this.text){for(var n,r,a,o=this.text.length,u=t.measureText(this.text[0]).width,s=[],c=0;o>c;c++)if(r=this.text[c],n=t.measureText(r).width,u+n>this.width||!a){var a=new i({text:r,start:e.add([],this.start,[0,this.lineHeight*s.length])});this.extendCommonProperties(a),s.push(a),u=n}else u+=n,a.text+=r;return s}},extendCommonProperties:function(t){a.extend(t,{textAlign:this.textAlign,textBaseline:this.textBaseline,style:this.style,font:this.font,fill:this.fill,stroke:this.stroke})},intersect:function(){}});return o}),e("2d/renderer",["require","core/base"],function(t){var n=t("core/base"),r=n.derive(function(){return{canvas:null,context:null,width:0,height:0,_latestRenderedScene:null}},function(){this.canvas||(this.canvas=document.createElement("canvas")),this.canvas.addEventListener("click",this._clickHandler.bind(this)),this.canvas.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this.canvas.addEventListener("mouseup",this._mouseUpHandler.bind(this)),this.canvas.addEventListener("mousemove",this._mouseMoveHandler.bind(this)),this.canvas.addEventListener("mouseout",this._mouseOutHandler.bind(this)),this.width?this.canvas.width=this.width:this.width=this.canvas.width,this.height?this.canvas.height=this.height:this.height=this.canvas.height,this.context=this.canvas.getContext("2d")},{resize:function(t,n){this.canvas.width=t,this.canvas.height=n},render:function(t){this.context.clearRect(0,0,this.width,this.height),t.render(this.context),this._latestRenderedScene=t},_clickHandler:function(){this._latestRenderedScene},_mouseDownHandler:function(){},_mouseUpHandler:function(){},_mouseMoveHandler:function(){},_mouseOutHandler:function(){}});return r}),e("2d/scene",["require","./node"],function(t){var n=t("./node"),r=n.derive(function(){return{}},{});return r}),e("core/event",["require","./base"],function(t){var n=t("./base"),r=n.derive({cancelBubble:!1},{stopPropagation:function(){this.cancelBubble=!0}});r.throw=function(t,n,r){var e=new MouseEvent(r);for(e.sourceTarget=n;n&&!e.cancelBubble;)e.target=n,n.trigger(t,e),n=n.parent}}),e("core/quaternion",["require","glmatrix"],function(t){var n=t("glmatrix"),r=n.quat,e=function(t,n,e,a){return t=t||0,n=n||0,e=e||0,a=a===void 0?1:a,Object.create(i,{x:{configurable:!1,set:function(t){this._array[0]=t,this._dirty=!0},get:function(){return this._array[0]}},y:{configurable:!1,set:function(t){this._array[1]=t,this._dirty=!0},get:function(){return this._array[1]}},z:{configurable:!1,set:function(t){this._array[2]=t,this._dirty=!0},get:function(){return this._array[2]}},w:{configurable:!1,set:function(t){this._array[2]=t,this._dirty=!0},get:function(){return this._array[2]}},_array:{writable:!1,configurable:!1,value:r.fromValues(t,n,e,a)},_dirty:{configurable:!1,value:!1}})},i={constructor:e,add:function(t){return r.add(this._array,this._array,t._array),this._dirty=!0,this},calculateW:function(){return r.calculateW(this._array,this._array),this._dirty=!0,this},set:function(t,n,r,e){return this._array[0]=t,this._array[1]=n,this._array[2]=r,this._array[3]=e,this._dirty=!0,this},clone:function(){return new e(this.x,this.y,this.z,this.w)},conjugate:function(){return r.conjugate(this._array,this._array),this._dirty=!0,this},copy:function(t){return r.copy(this._array,t._array),this._dirty=!0,this},dot:function(t){return r.dot(this._array,t._array)},fromMat3:function(t){return r.fromMat3(this._array,t._array),this._dirty=!0,this},fromMat4:function(){var t=n.mat3,e=t.create();return function(n){return t.fromMat4(e,n._array),t.transpose(e,e),r.fromMat3(this._array,e),this._dirty=!0,this}}(),identity:function(){return r.identity(this._array),this._dirty=!0,this},invert:function(){return r.invert(this._array,this._array),this._dirty=!0,this},len:function(){return r.len(this._array)},length:function(){return r.length(this._array)},lerp:function(t,n,e){return r.lerp(this._array,t._array,n._array,e),this._dirty=!0,this},mul:function(t){return r.mul(this._array,this._array,t._array),this._dirty=!0,this},multiply:function(t){return r.multiply(this._array,this._array,t._array),this._dirty=!0,this},normalize:function(){return r.normalize(this._array,this._array),this._dirty=!0,this},rotateX:function(t){return r.rotateX(this._array,this._array,t),this._dirty=!0,this},rotateY:function(t){return r.rotateY(this._array,this._array,t),this._dirty=!0,this},rotateZ:function(t){return r.rotateZ(this._array,this._array,t),this._dirty=!0,this},setAxisAngle:function(t,n){return r.setAxisAngle(this._array,t._array,n),this._dirty=!0,this},slerp:function(t,n,e){return r.slerp(this._array,t._array,n._array,e),this._dirty=!0,this},sqrLen:function(){return r.sqrLen(this._array)},squaredLength:function(){return r.squaredLength(this._array)},setFromEuler:function(){},toString:function(){return"["+Array.prototype.join.call(this._array,",")+"]"}};return e}),e("core/request",["require"],function(){function t(t){var n=new XMLHttpRequest;n.open("get",t.url),n.responseType=t.responseType||"text",t.onprogress&&(n.onprogress=function(n){if(n.lengthComputable){var r=n.loaded/n.total;t.onprogress(r,n.loaded,n.total)}else t.onprogress(null)}),n.onload=function(){t.onload&&t.onload(n.response)},t.onerror&&(n.onerror=t.onerror),n.send(null)}function n(){}return{get:t,put:n}}),e("core/vector2",function(){}),e("util/color",["require"],function(){}),e("util/util",["require"],function(){return{genGUID:function(){var t=0;return function(){return++t}}()}}),e("util/xmlparser",["require"],function(){}),e("qtek2d",["require","2d/camera","2d/node","2d/renderable/arc","2d/renderable/circle","2d/renderable/image","2d/renderable/line","2d/renderable/path","2d/renderable/polygon","2d/renderable/rectangle","2d/renderable/roundedrectangle","2d/renderable/sector","2d/renderable/text","2d/renderable/textbox","2d/renderer","2d/scene","2d/style","2d/util","core/base","core/cache","core/event","core/mixin/derive","core/mixin/dirty","core/mixin/notifier","core/quaternion","core/request","core/vector2","util/color","util/util","util/xmlparser","glmatrix"],function(t){var n={"2d":{Camera:t("2d/camera"),Node:t("2d/node"),renderable:{Arc:t("2d/renderable/arc"),Circle:t("2d/renderable/circle"),Image:t("2d/renderable/image"),Line:t("2d/renderable/line"),Path:t("2d/renderable/path"),Polygon:t("2d/renderable/polygon"),Rectangle:t("2d/renderable/rectangle"),RoundedRectangle:t("2d/renderable/roundedrectangle"),Sector:t("2d/renderable/sector"),Text:t("2d/renderable/text"),TextBox:t("2d/renderable/textbox")},Renderer:t("2d/renderer"),Scene:t("2d/scene"),Style:t("2d/style"),util:t("2d/util")},core:{Base:t("core/base"),Cache:t("core/cache"),Event:t("core/event"),mixin:{derive:t("core/mixin/derive"),Dirty:t("core/mixin/dirty"),notifier:t("core/mixin/notifier")},Quaternion:t("core/quaternion"),requester:t("core/request"),Vector2:t("core/vector2")},util:{Color:t("util/color"),Util:t("util/util"),Xmlparser:t("util/xmlparser")}},r=t("glmatrix");return n.math=r,n});var i=r("qtek");for(var a in i)t[a]=i[a]});